import e from"util";import"url";import"http";import"https";import"zlib";import t from"fs";import r from"process";import n from"v8";import"cluster";function s(e,t,r){const n={Resolver:r.Resolver,Service:r.Service,Protocol:r.Protocol,Result:r.Result};e.Histogram("resolver_request_duration_histogram_milliseconds",t,n)}function o(e,t,r){const n={Service:r.Service,Vendor:r.Vendor,Call:r.Call,Result:r.Result};e.Histogram("api_request_duration_histogram_milliseconds",t,n)}function i(e,t){return(r,n,s)=>{const o=Date.now();n.on("finish",(()=>{const r=Date.now(),n={Service:t.Service};e.Histogram("http_request_duration_histogram_milliseconds",r-o,n)})),s()}}function a(e,t,r){const n={Service:r.Service,Function:r.Function,Result:r.Result};e.Histogram("call_duration_histogram_milliseconds",t,n)}var l,c;function u(e,t,r){const n={Service:r.Service,Table:r.Table,Method:r.Method,Result:r.Result};e.Histogram("database_duration_histogram_milliseconds",t,n)}!function(e){e.Insert="insert",e.Update="update",e.Delete="delete",e.Select="select"}(l||(l={}));class h{constructor(e){this.client=e}static getInstance(e){return h.instance||(h.instance=new h(e)),h.instance}Histogram(e,t,r){this.client.Histogram(e,t,r)}Count(e,t){this.client.Count(e,t)}Gauge(e,t,r){this.client.Gauge(e,t,r)}Summary(e,t,r){this.client.Summary(e,t,r)}ResolverMetric(e,t){return s(this.client,e,t)}ApiMetric(e,t){return o(this.client,e,t)}HttpMiddlewareMetric(e){return i(this.client,e)}CallMetric(e,t){return a(this.client,e,t)}DatabaseMetric(e,t){return u(this.client,e,t)}}!function(e){e.Success="success",e.Error="error"}(c||(c={}));const p=require("dd-trace");class f{constructor(){p.init()}Count(e,t,r=1){p.dogstatsd.increment(e,r,t)}Histogram(e,t,r,n=1){p.dogstatsd.distribution(e,t,r)}Gauge(e,t,r,n=1){p.dogstatsd.gauge(e,t,r)}Summary(e,t,r,n=1){console.log("Summary is unsupported")}}function m(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var d={exports:{}},g={};function b(e,t){if(0===e.length)return"";let r="";for(let n=0;n<e.length;n++){const s=e[n],o=t[s];void 0!==o&&(r+=`${s}:${o},`)}return r}function _(e,t){if(t)return b(t,e);const r=Object.keys(e);return r.length>1&&r.sort(),b(r,e)}g.getValueAsString=function(e){return Number.isNaN(e)?"Nan":Number.isFinite(e)?`${e}`:e<0?"-Inf":"+Inf"},g.removeLabels=function(e,t,r){delete e[_(t,r)]},g.setValue=function(e,t,r){return e[_(r)]={value:"number"==typeof t?t:0,labels:r||{}},e},g.setValueDelta=function(e,t,r,n=""){const s="number"==typeof t?t:0;return e[n]?e[n].value+=s:e[n]={value:s,labels:r},e},g.getLabels=function(e,t){if("object"==typeof t[0])return t[0];if(e.length!==t.length)throw new Error("Invalid number of arguments");const r={};for(let n=0;n<e.length;n++)r[e[n]]=t[n];return r},g.hashObject=_,g.isObject=function(e){return null!==e&&"object"==typeof e},g.nowTimestamp=function(){return Date.now()/1e3};class v extends Map{add(e,t){this.has(e)?this.get(e).push(t):this.set(e,[t])}}g.Grouper=v;const{getValueAsString:y}=g;let x=class e{static get PROMETHEUS_CONTENT_TYPE(){return"text/plain; version=0.0.4; charset=utf-8"}static get OPENMETRICS_CONTENT_TYPE(){return"application/openmetrics-text; version=1.0.0; charset=utf-8"}constructor(t=e.PROMETHEUS_CONTENT_TYPE){if(this._metrics={},this._collectors=[],this._defaultLabels={},t!==e.PROMETHEUS_CONTENT_TYPE&&t!==e.OPENMETRICS_CONTENT_TYPE)throw new TypeError(`Content type ${t} is unsupported`);this._contentType=t}getMetricsAsArray(){return Object.values(this._metrics)}async getMetricsAsString(t){const r="function"==typeof t.getForPromString?await t.getForPromString():await t.get(),n=T(r.name),s=[`# HELP ${n} ${T(r.help)}`,`# TYPE ${n} ${r.type}`],o=Object.keys(this._defaultLabels).length>0?this._defaultLabels:null,i=this.contentType===e.OPENMETRICS_CONTENT_TYPE;for(const e of r.values||[]){let{metricName:t=n,labels:a={}}=e;const{sharedLabels:l={}}=e;i&&"counter"===r.type&&(t=`${t}_total`),o&&(a={...a,...o,...a});const c=[...w(a,l),E(l)].filter(Boolean);let u=`${t}${c.length?`{${c.join(",")}}`:""} ${y(e.value)}`;const{exemplar:h}=e;if(h&&i){u+=` # {${w(h.labelSet).join(",")}} ${y(h.value)} ${h.timestamp}`}s.push(u)}return s.join("\n")}async metrics(){const t=this.contentType===e.OPENMETRICS_CONTENT_TYPE,r=this.getMetricsAsArray().map((e=>(t&&"counter"===e.type&&(e.name=e.name.replace(/_total$/,"")),this.getMetricsAsString(e)))),n=await Promise.all(r);return t?`${n.join("\n")}\n# EOF\n`:`${n.join("\n\n")}\n`}registerMetric(e){if(this._metrics[e.name]&&this._metrics[e.name]!==e)throw new Error(`A metric with the name ${e.name} has already been registered.`);this._metrics[e.name]=e}clear(){this._metrics={},this._defaultLabels={}}async getMetricsAsJSON(){const e=[],t=Object.keys(this._defaultLabels),r=[];for(const e of this.getMetricsAsArray())r.push(e.get());const n=await Promise.all(r);for(const r of n){if(r.values&&t.length>0)for(const e of r.values){e.labels=Object.assign({},e.labels);for(const r of t)e.labels[r]=e.labels[r]||this._defaultLabels[r]}e.push(r)}return e}removeSingleMetric(e){delete this._metrics[e]}getSingleMetricAsString(e){return this.getMetricsAsString(this._metrics[e])}getSingleMetric(e){return this._metrics[e]}setDefaultLabels(e){this._defaultLabels=e}resetMetrics(){for(const e in this._metrics)this._metrics[e].reset()}get contentType(){return this._contentType}setContentType(t){if(t!==e.OPENMETRICS_CONTENT_TYPE&&t!==e.PROMETHEUS_CONTENT_TYPE)throw new Error(`Content type ${t} is unsupported`);this._contentType=t}static merge(t){const r=t[0].contentType;for(const e of t)if(e.contentType!==r)throw new Error("Registers can only be merged if they have the same content type");const n=new e(r);return t.reduce(((e,t)=>e.concat(t.getMetricsAsArray())),[]).forEach(n.registerMetric,n),n}};function w(e,t){const{hasOwnProperty:r}=Object.prototype,n=[];for(const[s,o]of Object.entries(e))t&&r.call(t,s)||n.push(`${s}="${O(o)}"`);return n}const N=new WeakMap;function E(e){const t=N.get(e);if(t)return t;const r=w(e).join(",");return N.set(e,r),r}function O(e){return"string"!=typeof e?e:T(e).replace(/"/g,'\\"')}function T(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n")}d.exports=x,d.exports.globalRegistry=new x;var M=d.exports,S={};const C=e,j=/^[a-zA-Z_:][a-zA-Z0-9_:]*$/,R=/^[a-zA-Z_][a-zA-Z0-9_]*$/;S.validateMetricName=function(e){return j.test(e)},S.validateLabelName=function(e=[]){return e.every((e=>R.test(e)))},S.validateLabel=function(e,t){for(const r in t)if(!e.includes(r))throw new Error(`Added label "${r}" is not included in initial labelset: ${C.inspect(e)}`)};const L=M,{isObject:A}=g,{validateMetricName:k,validateLabelName:P}=S;var V={Metric:class{constructor(e,t={}){if(!A(e))throw new TypeError("constructor expected a config object");if(Object.assign(this,{labelNames:[],registers:[L.globalRegistry],aggregator:"sum",enableExemplars:!1},t,e),this.registers||(this.registers=[L.globalRegistry]),!this.help)throw new Error("Missing mandatory help parameter");if(!this.name)throw new Error("Missing mandatory name parameter");if(!k(this.name))throw new Error("Invalid metric name");if(!P(this.labelNames))throw new Error("Invalid label name");if(this.collect&&"function"!=typeof this.collect)throw new Error('Optional "collect" parameter must be a function');this.labelNames?this.sortedLabelNames=[...this.labelNames].sort():this.sortedLabelNames=[],this.reset();for(const e of this.registers){if(this.enableExemplars&&e.contentType===L.PROMETHEUS_CONTENT_TYPE)throw new TypeError("Exemplars are supported only on OpenMetrics registries");e.registerMetric(this)}}reset(){}}};var I=class{constructor(e={},t=null){this.labelSet=e,this.value=t}validateExemplarLabelSet(e){let t="";for(const[r,n]of Object.entries(e))t+=`${r}${n}`;if(t.length>128)throw new RangeError("Label set size must be smaller than 128 UTF-8 chars")}};const D=e,{hashObject:B,isObject:z,getLabels:$,removeLabels:H,nowTimestamp:U}=g,{validateLabel:G}=S,{Metric:F}=V,q=I;function W(e,t,r={},n=""){return e[n]?e[n].value+=t:e[n]={value:t,labels:r},e}var Y=class extends F{constructor(e){super(e),this.type="counter",this.defaultLabels={},this.defaultValue=1,this.defaultExemplarLabelSet={},e.enableExemplars?(this.enableExemplars=!0,this.inc=this.incWithExemplar):this.inc=this.incWithoutExemplar}incWithoutExemplar(e,t){let r="";if(z(e)?(r=B(e,this.sortedLabelNames),G(this.labelNames,e)):(t=e,e={}),t&&!Number.isFinite(t))throw new TypeError(`Value is not a valid number: ${D.format(t)}`);if(t<0)throw new Error("It is not possible to decrease a counter");return null==t&&(t=1),W(this.hashMap,t,e,r),{labelHash:r}}incWithExemplar({labels:e=this.defaultLabels,value:t=this.defaultValue,exemplarLabels:r=this.defaultExemplarLabelSet}={}){const n=this.incWithoutExemplar(e,t);this.updateExemplar(r,t,n.labelHash)}updateExemplar(e,t,r){z(this.hashMap[r].exemplar)||(this.hashMap[r].exemplar=new q),this.hashMap[r].exemplar.validateExemplarLabelSet(e),this.hashMap[r].exemplar.labelSet=e,this.hashMap[r].exemplar.value=t||1,this.hashMap[r].exemplar.timestamp=U()}reset(){this.hashMap={},0===this.labelNames.length&&W(this.hashMap,0)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}labels(...e){const t=$(this.labelNames,e)||{};return{inc:this.inc.bind(this,t)}}remove(...e){const t=$(this.labelNames,e)||{};return G(this.labelNames,t),H.call(this,this.hashMap,t,this.sortedLabelNames)}};const K=e,{setValue:X,setValueDelta:Z,getLabels:Q,hashObject:J,isObject:ee,removeLabels:te}=g,{validateLabel:re}=S,{Metric:ne}=V;function se(e,t,r){if("number"!=typeof r)throw new TypeError(`Delta is not a valid number: ${K.format(r)}`);re(e.labelNames,t);const n=J(t,e.sortedLabelNames);Z(e.hashMap,r,t,n)}function oe(e){return ee(e)?e:{}}function ie(e,t){return ee(e)?t:e}var ae=class extends ne{constructor(e){super(e),this.type="gauge"}set(e,t){t=ie(e,t),function(e,t,r){if("number"!=typeof r)throw new TypeError(`Value is not a valid number: ${K.format(r)}`);re(e.labelNames,t),X(e.hashMap,r,t)}(this,e=oe(e),t)}reset(){this.hashMap={},0===this.labelNames.length&&X(this.hashMap,0,{})}inc(e,t){void 0===(t=ie(e,t))&&(t=1),se(this,e=oe(e),t)}dec(e,t){void 0===(t=ie(e,t))&&(t=1),se(this,e=oe(e),-t)}setToCurrentTime(e){const t=Date.now()/1e3;void 0===e?this.set(t):this.set(e,t)}startTimer(e){const t=process.hrtime();return r=>{const n=process.hrtime(t),s=n[0]+n[1]/1e9;return this.set(Object.assign({},e,r),s),s}}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}_getValue(e){const t=J(e||{},this.sortedLabelNames);return this.hashMap[t]?this.hashMap[t].value:0}labels(...e){const t=Q(this.labelNames,e);return re(this.labelNames,t),{inc:this.inc.bind(this,t),dec:this.dec.bind(this,t),set:this.set.bind(this,t),setToCurrentTime:this.setToCurrentTime.bind(this,t),startTimer:this.startTimer.bind(this,t)}}remove(...e){const t=Q(this.labelNames,e);re(this.labelNames,t),te.call(this,this.hashMap,t,this.sortedLabelNames)}};const le=e,{getLabels:ce,hashObject:ue,isObject:he,removeLabels:pe,nowTimestamp:fe}=g,{validateLabel:me}=S,{Metric:de}=V,ge=I;function be(e){return()=>{const t=process.hrtime();return r=>{const n=process.hrtime(t),s=n[0]+n[1]/1e9;return this.observe(Object.assign({},e,r),s),s}}}function _e(e,t){return()=>{const r=process.hrtime();return(n,s)=>{const o=process.hrtime(r),i=o[0]+o[1]/1e9;return this.observe({labels:Object.assign({},e,n),value:i,exemplarLabels:Object.assign({},t,s)}),i}}}function ve(e,t,r,n,s={}){return{labels:e,sharedLabels:s,value:t,metricName:r,exemplar:n}}function ye(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(t<=n)return n}return-1}function xe(e){return t=>{const r=function(e,t){return he(e)?{labels:e,value:t}:{value:e,labels:{}}}(e,t);if(me(this.labelNames,r.labels),!Number.isFinite(r.value))throw new TypeError(`Value is not a valid number: ${le.format(r.value)}`);const n=ue(r.labels,this.sortedLabelNames);let s=this.hashMap[n];s||(s=we(r.labels,this.bucketValues,this.bucketExemplars));const o=ye(this.upperBounds,r.value);s.sum+=r.value,s.count+=1,Object.prototype.hasOwnProperty.call(s.bucketValues,o)&&(s.bucketValues[o]+=1),this.hashMap[n]=s}}function we(e,t,r){return{labels:e,bucketValues:{...t},bucketExemplars:{...r},sum:0,count:0}}function Ne(e){const{sharedLabels:t,labels:r,...n}=e;for(const e of Object.keys(t))r[e]=t[e];return n.labels=r,n}var Ee=class extends de{constructor(e){super(e,{buckets:[.005,.01,.025,.05,.1,.25,.5,1,2.5,5,10]}),this.type="histogram",this.defaultLabels={},this.defaultExemplarLabelSet={},this.enableExemplars=!1,e.enableExemplars?(this.enableExemplars=!0,this.observe=this.observeWithExemplar):this.observe=this.observeWithoutExemplar;for(const e of this.labelNames)if("le"===e)throw new Error("le is a reserved label keyword");this.upperBounds=this.buckets,this.bucketValues=this.upperBounds.reduce(((e,t)=>(e[t]=0,e)),{}),this.bucketExemplars=this.upperBounds.reduce(((e,t)=>(e[t]=null,e)),{}),Object.freeze(this.bucketValues),Object.freeze(this.bucketExemplars),Object.freeze(this.upperBounds),0===this.labelNames.length&&(this.hashMap={[ue({})]:we({},this.bucketValues,this.bucketExemplars)})}observeWithoutExemplar(e,t){xe.call(this,0===e?0:e||{})(t)}observeWithExemplar({labels:e=this.defaultLabels,value:t,exemplarLabels:r=this.defaultExemplarLabelSet}={}){xe.call(this,0===e?0:e||{})(t),this.updateExemplar(e,t,r)}updateExemplar(e,t,r){const n=ue(e,this.sortedLabelNames),s=ye(this.upperBounds,t),{bucketExemplars:o}=this.hashMap[n];let i=o[s];he(i)||(i=new ge,o[s]=i),i.validateExemplarLabelSet(r),i.labelSet=r,i.value=t,i.timestamp=fe()}async get(){const e=await this.getForPromString();return e.values=e.values.map(Ne),e}async getForPromString(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.values(this.hashMap).map(function(e){const t=`${e.name}_bucket`;return r=>{let n=0;return{buckets:e.upperBounds.map((e=>(n+=r.bucketValues[e],ve({le:e},n,t,r.bucketExemplars[e],r.labels)))),data:r}}}(this)).reduce(function(e){return(t,r)=>{t.push(...r.buckets);const n={le:"+Inf"};return t.push(ve(n,r.data.count,`${e.name}_bucket`,r.data.bucketExemplars[-1],r.data.labels),ve({},r.data.sum,`${e.name}_sum`,void 0,r.data.labels),ve({},r.data.count,`${e.name}_count`,void 0,r.data.labels)),t}}(this),[]);return{name:this.name,help:this.help,type:this.type,values:e,aggregator:this.aggregator}}reset(){this.hashMap={}}zero(e){const t=ue(e,this.sortedLabelNames);this.hashMap[t]=we(e,this.bucketValues,this.bucketExemplars)}startTimer(e,t){return this.enableExemplars?_e.call(this,e,t)():be.call(this,e)()}labels(...e){const t=ce(this.labelNames,e);return me(this.labelNames,t),{observe:xe.call(this,t),startTimer:be.call(this,t)}}remove(...e){const t=ce(this.labelNames,e);me(this.labelNames,t),pe.call(this,this.hashMap,t,this.sortedLabelNames)}};function Oe(){}function Te(e){this._tree=e,this._ancestors=[],this._cursor=null}Oe.prototype.clear=function(){this._root=null,this.size=0},Oe.prototype.find=function(e){for(var t=this._root;null!==t;){var r=this._comparator(e,t.data);if(0===r)return t.data;t=t.get_child(r>0)}return null},Oe.prototype.findIter=function(e){for(var t=this._root,r=this.iterator();null!==t;){var n=this._comparator(e,t.data);if(0===n)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(n>0)}return null},Oe.prototype.lowerBound=function(e){for(var t=this._root,r=this.iterator(),n=this._comparator;null!==t;){var s=n(e,t.data);if(0===s)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(s>0)}for(var o=r._ancestors.length-1;o>=0;--o)if(n(e,(t=r._ancestors[o]).data)<0)return r._cursor=t,r._ancestors.length=o,r;return r._ancestors.length=0,r},Oe.prototype.upperBound=function(e){for(var t=this.lowerBound(e),r=this._comparator;null!==t.data()&&0===r(t.data(),e);)t.next();return t},Oe.prototype.min=function(){var e=this._root;if(null===e)return null;for(;null!==e.left;)e=e.left;return e.data},Oe.prototype.max=function(){var e=this._root;if(null===e)return null;for(;null!==e.right;)e=e.right;return e.data},Oe.prototype.iterator=function(){return new Te(this)},Oe.prototype.each=function(e){for(var t,r=this.iterator();null!==(t=r.next());)if(!1===e(t))return},Oe.prototype.reach=function(e){for(var t,r=this.iterator();null!==(t=r.prev());)if(!1===e(t))return},Te.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},Te.prototype.next=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._minNode(e)}else{var t;if(null===this._cursor.right)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===t);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},Te.prototype.prev=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._maxNode(e)}else{var t;if(null===this._cursor.left)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===t);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},Te.prototype._minNode=function(e){for(;null!==e.left;)this._ancestors.push(e),e=e.left;this._cursor=e},Te.prototype._maxNode=function(e){for(;null!==e.right;)this._ancestors.push(e),e=e.right;this._cursor=e};var Me=Oe,Se=Me;function Ce(e){this.data=e,this.left=null,this.right=null,this.red=!0}function je(e){this._root=null,this._comparator=e,this.size=0}function Re(e){return null!==e&&e.red}function Le(e,t){var r=e.get_child(!t);return e.set_child(!t,r.get_child(t)),r.set_child(t,e),e.red=!0,r.red=!1,r}function Ae(e,t){return e.set_child(!t,Le(e.get_child(!t),!t)),Le(e,t)}Ce.prototype.get_child=function(e){return e?this.right:this.left},Ce.prototype.set_child=function(e,t){e?this.right=t:this.left=t},je.prototype=new Se,je.prototype.insert=function(e){var t=!1;if(null===this._root)this._root=new Ce(e),t=!0,this.size++;else{var r=new Ce(void 0),n=0,s=0,o=null,i=r,a=null,l=this._root;for(i.right=this._root;;){if(null===l?(l=new Ce(e),a.set_child(n,l),t=!0,this.size++):Re(l.left)&&Re(l.right)&&(l.red=!0,l.left.red=!1,l.right.red=!1),Re(l)&&Re(a)){var c=i.right===o;l===a.get_child(s)?i.set_child(c,Le(o,!s)):i.set_child(c,Ae(o,!s))}var u=this._comparator(l.data,e);if(0===u)break;s=n,n=u<0,null!==o&&(i=o),o=a,a=l,l=l.get_child(n)}this._root=r.right}return this._root.red=!1,t},je.prototype.remove=function(e){if(null===this._root)return!1;var t=new Ce(void 0),r=t;r.right=this._root;for(var n=null,s=null,o=null,i=1;null!==r.get_child(i);){var a=i;s=n,n=r,r=r.get_child(i);var l=this._comparator(e,r.data);if(i=l>0,0===l&&(o=r),!Re(r)&&!Re(r.get_child(i)))if(Re(r.get_child(!i))){var c=Le(r,i);n.set_child(a,c),n=c}else if(!Re(r.get_child(!i))){var u=n.get_child(!a);if(null!==u)if(Re(u.get_child(!a))||Re(u.get_child(a))){var h=s.right===n;Re(u.get_child(a))?s.set_child(h,Ae(n,a)):Re(u.get_child(!a))&&s.set_child(h,Le(n,a));var p=s.get_child(h);p.red=!0,r.red=!0,p.left.red=!1,p.right.red=!1}else n.red=!1,u.red=!0,r.red=!0}}return null!==o&&(o.data=r.data,n.set_child(n.right===r,r.get_child(null===r.left)),this.size--),this._root=t.right,null!==this._root&&(this._root.red=!1),null!==o};var ke=je,Pe=Me;function Ve(e){this.data=e,this.left=null,this.right=null}function Ie(e){this._root=null,this._comparator=e,this.size=0}Ve.prototype.get_child=function(e){return e?this.right:this.left},Ve.prototype.set_child=function(e,t){e?this.right=t:this.left=t},Ie.prototype=new Pe,Ie.prototype.insert=function(e){if(null===this._root)return this._root=new Ve(e),this.size++,!0;for(var t=0,r=null,n=this._root;;){if(null===n)return n=new Ve(e),r.set_child(t,n),ret=!0,this.size++,!0;if(0===this._comparator(n.data,e))return!1;t=this._comparator(n.data,e)<0,r=n,n=n.get_child(t)}},Ie.prototype.remove=function(e){if(null===this._root)return!1;var t=new Ve(void 0),r=t;r.right=this._root;for(var n=null,s=null,o=1;null!==r.get_child(o);){n=r,r=r.get_child(o);var i=this._comparator(e,r.data);o=i>0,0===i&&(s=r)}return null!==s&&(s.data=r.data,n.set_child(n.right===r,r.get_child(null===r.left)),this._root=t.right,this.size--,!0)};var De={RBTree:ke,BinTree:Ie}.RBTree;function Be(e,t,r){this.discrete=!1===e,this.delta=e||.01,this.K=void 0===t?25:t,this.CX=void 0===r?1.1:r,this.centroids=new De(ze),this.nreset=0,this.reset()}function ze(e,t){return e.mean>t.mean?1:e.mean<t.mean?-1:0}function $e(e,t){return e.mean_cumn-t.mean_cumn}function He(e){this.config=e||{},this.mode=this.config.mode||"auto",Be.call(this,"cont"===this.mode&&e.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}Be.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},Be.prototype.size=function(){return this.centroids.size},Be.prototype.toArray=function(e){var t=[];return e?(this._cumulate(!0),this.centroids.each((function(e){t.push(e)}))):this.centroids.each((function(e){t.push({mean:e.mean,n:e.n})})),t},Be.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},Be.prototype.push=function(e,t){t=t||1,e=Array.isArray(e)?e:[e];for(var r=0;r<e.length;r++)this._digest(e[r],t)},Be.prototype.push_centroid=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this._digest(e[t].mean,e[t].n)},Be.prototype._cumulate=function(e){if(!(this.n===this.last_cumulate||!e&&this.CX&&this.CX>this.n/this.last_cumulate)){var t=0;this.centroids.each((function(e){e.mean_cumn=t+e.n/2,t=e.cumn=t+e.n})),this.n=this.last_cumulate=t}},Be.prototype.find_nearest=function(e){if(0===this.size())return null;var t=this.centroids.lowerBound({mean:e}),r=null===t.data()?t.prev():t.data();if(r.mean===e||this.discrete)return r;var n=t.prev();return n&&Math.abs(n.mean-e)<Math.abs(r.mean-e)?n:r},Be.prototype._new_centroid=function(e,t,r){var n={mean:e,n:t,cumn:r};return this.centroids.insert(n),this.n+=t,n},Be.prototype._addweight=function(e,t,r){t!==e.mean&&(e.mean+=r*(t-e.mean)/(e.n+r)),e.cumn+=r,e.mean_cumn+=r/2,e.n+=r,this.n+=r},Be.prototype._digest=function(e,t){var r=this.centroids.min(),n=this.centroids.max(),s=this.find_nearest(e);if(s&&s.mean===e)this._addweight(s,e,t);else if(s===r)this._new_centroid(e,t,0);else if(s===n)this._new_centroid(e,t,this.n);else if(this.discrete)this._new_centroid(e,t,s.cumn);else{var o=s.mean_cumn/this.n;Math.floor(4*this.n*this.delta*o*(1-o))-s.n>=t?this._addweight(s,e,t):this._new_centroid(e,t,s.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},Be.prototype.bound_mean=function(e){var t=this.centroids.upperBound({mean:e}),r=t.prev();return[r,r.mean===e?r:t.next()]},Be.prototype.p_rank=function(e){var t=(Array.isArray(e)?e:[e]).map(this._p_rank,this);return Array.isArray(e)?t:t[0]},Be.prototype._p_rank=function(e){if(0!==this.size()){if(e<this.centroids.min().mean)return 0;if(e>this.centroids.max().mean)return 1;this._cumulate(!0);var t=this.bound_mean(e),r=t[0],n=t[1];if(this.discrete)return r.cumn/this.n;var s=r.mean_cumn;return r!==n&&(s+=(e-r.mean)*(n.mean_cumn-r.mean_cumn)/(n.mean-r.mean)),s/this.n}},Be.prototype.bound_mean_cumn=function(e){this.centroids._comparator=$e;var t=this.centroids.upperBound({mean_cumn:e});this.centroids._comparator=ze;var r=t.prev();return[r,r&&r.mean_cumn===e?r:t.next()]},Be.prototype.percentile=function(e){var t=(Array.isArray(e)?e:[e]).map(this._percentile,this);return Array.isArray(e)?t:t[0]},Be.prototype._percentile=function(e){if(0!==this.size()){this._cumulate(!0);var t=this.n*e,r=this.bound_mean_cumn(t),n=r[0],s=r[1];return s===n||null===n||null===s?(n||s).mean:this.discrete?t<=n.cumn?n.mean:s.mean:n.mean+(t-n.mean_cumn)*(s.mean-n.mean)/(s.mean_cumn-n.mean_cumn)}},Be.prototype.compress=function(){if(!this.compressing){var e,t,r=this.toArray();for(this.reset(),this.compressing=!0;r.length>0;)this.push_centroid((e=r,t=void 0,t=Math.floor(Math.random()*e.length),e.splice(t,1)[0]));this._cumulate(!0),this.compressing=!1}},He.prototype=Object.create(Be.prototype),He.prototype.constructor=He,He.prototype.push=function(e){Be.prototype.push.call(this,e),this.check_continuous()},He.prototype._new_centroid=function(e,t,r){this.n_unique+=1,Be.prototype._new_centroid.call(this,e,t,r)},He.prototype._addweight=function(e,t,r){1===e.n&&(this.n_unique-=1),Be.prototype._addweight.call(this,e,t,r)},He.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&(this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0))};var Ue={TDigest:Be,Digest:He};const{TDigest:Ge}=Ue;function Fe(){let e=Date.now()-this.lastRotateTimestampMillis;for(;e>this.durationBetweenRotatesMillis&&this.shouldRotate;)this.ringBuffer[this.currentBuffer]=new Ge,++this.currentBuffer>=this.ringBuffer.length&&(this.currentBuffer=0),e-=this.durationBetweenRotatesMillis,this.lastRotateTimestampMillis+=this.durationBetweenRotatesMillis;return this.ringBuffer[this.currentBuffer]}var qe=class{constructor(e,t){this.maxAgeSeconds=e||0,this.ageBuckets=t||0,this.shouldRotate=e&&t,this.ringBuffer=Array(t).fill(new Ge),this.currentBuffer=0,this.lastRotateTimestampMillis=Date.now(),this.durationBetweenRotatesMillis=1e3*e/t||1/0}size(){return Fe.call(this).size()}percentile(e){return Fe.call(this).percentile(e)}push(e){Fe.call(this),this.ringBuffer.forEach((t=>{t.push(e)}))}reset(){this.ringBuffer.forEach((e=>{e.reset()}))}compress(){this.ringBuffer.forEach((e=>{e.compress()}))}};const We=e,{getLabels:Ye,hashObject:Ke,removeLabels:Xe}=g,{validateLabel:Ze}=S,{Metric:Qe}=V,Je=qe;function et(e){return()=>{const t=process.hrtime();return r=>{const n=process.hrtime(t),s=n[0]+n[1]/1e9;return this.observe(Object.assign({},e,r),s),s}}}function tt(e){return t=>{const r=function(e,t){if(void 0===t)return{value:e,labels:{}};return{labels:e,value:t}}(e,t);if(Ze(this.labelNames,e),!Number.isFinite(r.value))throw new TypeError(`Value is not a valid number: ${We.format(r.value)}`);const n=Ke(r.labels,this.sortedLabelNames);let s=this.hashMap[n];s||(s={labels:r.labels,td:new Je(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}),s.td.push(r.value),s.count++,s.count%this.compressCount==0&&s.td.compress(),s.sum+=r.value,this.hashMap[n]=s}}var rt=class extends Qe{constructor(e){super(e,{percentiles:[.01,.05,.5,.9,.95,.99,.999],compressCount:1e3,hashMap:{}}),this.type="summary";for(const e of this.labelNames)if("quantile"===e)throw new Error("quantile is a reserved label keyword");0===this.labelNames.length&&(this.hashMap={[Ke({})]:{labels:{},td:new Je(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}})}observe(e,t){tt.call(this,0===e?0:e||{})(t)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.keys(this.hashMap),t=[];return e.forEach((e=>{const r=this.hashMap[e];var n,s;r&&(this.pruneAgedBuckets&&0===r.td.size()?delete this.hashMap[e]:((n=r,s=this.percentiles,n.td.compress(),s.map((e=>{const t=n.td.percentile(e);return{labels:Object.assign({quantile:e},n.labels),value:t||0}}))).forEach((e=>{t.push(e)})),t.push(function(e,t){return{metricName:`${t.name}_sum`,labels:e.labels,value:e.sum}}(r,this)),t.push(function(e,t){return{metricName:`${t.name}_count`,labels:e.labels,value:e.count}}(r,this))))})),{name:this.name,help:this.help,type:this.type,values:t,aggregator:this.aggregator}}reset(){Object.values(this.hashMap).forEach((e=>{e.td.reset(),e.count=0,e.sum=0}))}startTimer(e){return et.call(this,e)()}labels(...e){const t=Ye(this.labelNames,e);return Ze(this.labelNames,t),{observe:tt.call(this,t),startTimer:et.call(this,t)}}remove(...e){const t=Ye(this.labelNames,e);Ze(this.labelNames,t),Xe.call(this,this.hashMap,t,this.sortedLabelNames)}},nt={exports:{}},st={exports:{}},ot="object"==typeof globalThis?globalThis:global,it="1.7.0",at=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var lt=function(e){var t=new Set([e]),r=new Set,n=e.match(at);if(!n)return function(){return!1};var s=+n[1],o=+n[2],i=+n[3];if(null!=n[4])return function(t){return t===e};function a(e){return r.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;var n=e.match(at);if(!n)return a(e);var c=+n[1],u=+n[2],h=+n[3];return null!=n[4]||s!==c?a(e):0===s?o===u&&i<=h?l(e):a(e):o<=u?l(e):a(e)}}(it),ct=it.split(".")[0],ut=Symbol.for("opentelemetry.js.api."+ct),ht=ot;function pt(e,t,r,n){var s;void 0===n&&(n=!1);var o=ht[ut]=null!==(s=ht[ut])&&void 0!==s?s:{version:it};if(!n&&o[e]){var i=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(i.stack||i.message),!1}if(o.version!==it){i=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+it);return r.error(i.stack||i.message),!1}return o[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+it+"."),!0}function ft(e){var t,r,n=null===(t=ht[ut])||void 0===t?void 0:t.version;if(n&&lt(n))return null===(r=ht[ut])||void 0===r?void 0:r[e]}function mt(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+it+".");var r=ht[ut];r&&delete r[e]}var dt,gt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(s)throw s.error}}return i},bt=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,o=t.length;s<o;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},_t=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vt("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vt("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vt("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vt("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vt("verbose",this._namespace,e)},e}();function vt(e,t,r){var n=ft("diag");if(n)return r.unshift(t),n[e].apply(n,bt([],gt(r),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(dt||(dt={}));var yt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(s)throw s.error}}return i},xt=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,o=t.length;s<o;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},wt=function(){function e(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=ft("diag");if(n)return n[e].apply(n,xt([],yt(t),!1))}}var t=this;t.setLogger=function(e,r){var n,s,o;if(void 0===r&&(r={logLevel:dt.INFO}),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(n=i.stack)&&void 0!==n?n:i.message),!1}"number"==typeof r&&(r={logLevel:r});var a=ft("diag"),l=function(e,t){function r(r,n){var s=t[r];return"function"==typeof s&&e>=n?s.bind(t):function(){}}return e<dt.NONE?e=dt.NONE:e>dt.ALL&&(e=dt.ALL),t=t||{},{error:r("error",dt.ERROR),warn:r("warn",dt.WARN),info:r("info",dt.INFO),debug:r("debug",dt.DEBUG),verbose:r("verbose",dt.VERBOSE)}}(null!==(s=r.logLevel)&&void 0!==s?s:dt.INFO,e);if(a&&!r.suppressOverrideMessage){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),l.warn("Current logger will overwrite one already registered from "+c)}return pt("diag",l,t,!0)},t.disable=function(){mt("diag",t)},t.createComponentLogger=function(e){return new _t(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),Nt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(s)throw s.error}}return i},Et=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ot=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=Nt(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,r){var n=new e(this._entries);return n._entries.set(t,r),n},e.prototype.removeEntry=function(t){var r=new e(this._entries);return r._entries.delete(t),r},e.prototype.removeEntries=function(){for(var t,r,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var o=new e(this._entries);try{for(var i=Et(n),a=i.next();!a.done;a=i.next()){var l=a.value;o._entries.delete(l)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e}(),Tt=Symbol("BaggageEntryMetadata"),Mt=wt.instance();function St(e){return void 0===e&&(e={}),new Ot(new Map(Object.entries(e)))}function Ct(e){return Symbol.for(e)}var jt,Rt,Lt=function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(e){return r._currentContext.get(e)},r.setValue=function(t,n){var s=new e(r._currentContext);return s._currentContext.set(t,n),s},r.deleteValue=function(t){var n=new e(r._currentContext);return n._currentContext.delete(t),n}},At=new Lt,kt=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],Pt=function(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(console){var n=console[e];if("function"!=typeof n&&(n=console.log),"function"==typeof n)return n.apply(console,t)}}}for(var t=0;t<kt.length;t++)this[kt[t].n]=e(kt[t].c)},Vt=(jt=function(e,t){return jt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},jt(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}jt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),It=function(){function e(){}return e.prototype.createHistogram=function(e,t){return Yt},e.prototype.createCounter=function(e,t){return Wt},e.prototype.createUpDownCounter=function(e,t){return Kt},e.prototype.createObservableGauge=function(e,t){return Zt},e.prototype.createObservableCounter=function(e,t){return Xt},e.prototype.createObservableUpDownCounter=function(e,t){return Qt},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),Dt=function(){},Bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vt(t,e),t.prototype.add=function(e,t){},t}(Dt),zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vt(t,e),t.prototype.add=function(e,t){},t}(Dt),$t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vt(t,e),t.prototype.record=function(e,t){},t}(Dt),Ht=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),Ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vt(t,e),t}(Ht),Gt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vt(t,e),t}(Ht),Ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vt(t,e),t}(Ht),qt=new It,Wt=new Bt,Yt=new $t,Kt=new zt,Xt=new Ut,Zt=new Gt,Qt=new Ft;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(Rt||(Rt={}));var Jt,er={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},tr={set:function(e,t,r){null!=e&&(e[t]=r)}},rr=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(s)throw s.error}}return i},nr=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,o=t.length;s<o;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},sr=function(){function e(){}return e.prototype.active=function(){return At},e.prototype.with=function(e,t,r){for(var n=[],s=3;s<arguments.length;s++)n[s-3]=arguments[s];return t.call.apply(t,nr([r],rr(n),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),or=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(s)throw s.error}}return i},ir=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,o=t.length;s<o;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},ar="context",lr=new sr,cr=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return pt(ar,e,wt.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,r){for(var n,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(n=this._getContextManager()).with.apply(n,ir([e,t,r],or(s),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return ft(ar)||lr},e.prototype.disable=function(){this._getContextManager().disable(),mt(ar,wt.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(Jt||(Jt={}));var ur="0000000000000000",hr="00000000000000000000000000000000",pr={traceId:hr,spanId:ur,traceFlags:Jt.NONE},fr=function(){function e(e){void 0===e&&(e=pr),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),mr=Ct("OpenTelemetry Context Key SPAN");function dr(e){return e.getValue(mr)||void 0}function gr(){return dr(cr.getInstance().active())}function br(e,t){return e.setValue(mr,t)}function _r(e){return e.deleteValue(mr)}function vr(e,t){return br(e,new fr(t))}function yr(e){var t;return null===(t=dr(e))||void 0===t?void 0:t.spanContext()}var xr=/^([0-9a-f]{32})$/i,wr=/^[0-9a-f]{16}$/i;function Nr(e){return xr.test(e)&&e!==hr}function Er(e){return wr.test(e)&&e!==ur}function Or(e){return Nr(e.traceId)&&Er(e.spanId)}function Tr(e){return new fr(e)}var Mr=cr.getInstance(),Sr=function(){function e(){}return e.prototype.startSpan=function(e,t,r){if(void 0===r&&(r=Mr.active()),Boolean(null==t?void 0:t.root))return new fr;var n,s=r&&yr(r);return"object"==typeof(n=s)&&"string"==typeof n.spanId&&"string"==typeof n.traceId&&"number"==typeof n.traceFlags&&Or(s)?new fr(s):new fr},e.prototype.startActiveSpan=function(e,t,r,n){var s,o,i;if(!(arguments.length<2)){2===arguments.length?i=t:3===arguments.length?(s=t,i=r):(s=t,o=r,i=n);var a=null!=o?o:Mr.active(),l=this.startSpan(e,s,a),c=br(a,l);return Mr.with(c,i,void 0,l)}},e}();var Cr,jr,Rr,Lr=new Sr,Ar=function(){function e(e,t,r,n){this._provider=e,this.name=t,this.version=r,this.options=n}return e.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},e.prototype.startActiveSpan=function(e,t,r,n){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Lr},e}(),kr=new(function(){function e(){}return e.prototype.getTracer=function(e,t,r){return new Sr},e}()),Pr=function(){function e(){}return e.prototype.getTracer=function(e,t,r){var n;return null!==(n=this.getDelegateTracer(e,t,r))&&void 0!==n?n:new Ar(this,e,t,r)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:kr},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,r){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t,r)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Cr||(Cr={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(jr||(jr={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(Rr||(Rr={}));var Vr="[_0-9a-z-*/]",Ir=new RegExp("^(?:"+("[a-z]"+Vr+"{0,255}")+"|"+("[a-z0-9]"+Vr+"{0,240}@[a-z]"+Vr+"{0,13}")+")$"),Dr=/^[ -~]{0,255}[!-~]$/,Br=/,|=/;var zr=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,r){return t.push(r+"="+e.get(r)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var r=t.trim(),n=r.indexOf("=");if(-1!==n){var s=r.slice(0,n),o=r.slice(n+1,t.length);(function(e){return Ir.test(e)})(s)&&function(e){return Dr.test(e)&&!Br.test(e)}(o)&&e.set(s,o)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();var $r=cr.getInstance(),Hr=wt.instance(),Ur=new(function(){function e(){}return e.prototype.getMeter=function(e,t,r){return qt},e}()),Gr="metrics",Fr=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return pt(Gr,e,wt.instance())},e.prototype.getMeterProvider=function(){return ft(Gr)||Ur},e.prototype.getMeter=function(e,t,r){return this.getMeterProvider().getMeter(e,t,r)},e.prototype.disable=function(){mt(Gr,wt.instance())},e}(),qr=Fr.getInstance(),Wr=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),Yr=Ct("OpenTelemetry Baggage Key");function Kr(e){return e.getValue(Yr)||void 0}function Xr(){return Kr(cr.getInstance().active())}function Zr(e,t){return e.setValue(Yr,t)}function Qr(e){return e.deleteValue(Yr)}var Jr="propagation",en=new Wr,tn=function(){function e(){this.createBaggage=St,this.getBaggage=Kr,this.getActiveBaggage=Xr,this.setBaggage=Zr,this.deleteBaggage=Qr}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return pt(Jr,e,wt.instance())},e.prototype.inject=function(e,t,r){return void 0===r&&(r=tr),this._getGlobalPropagator().inject(e,t,r)},e.prototype.extract=function(e,t,r){return void 0===r&&(r=er),this._getGlobalPropagator().extract(e,t,r)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){mt(Jr,wt.instance())},e.prototype._getGlobalPropagator=function(){return ft(Jr)||en},e}(),rn=tn.getInstance(),nn="trace",sn=function(){function e(){this._proxyTracerProvider=new Pr,this.wrapSpanContext=Tr,this.isSpanContextValid=Or,this.deleteSpan=_r,this.getSpan=dr,this.getActiveSpan=gr,this.getSpanContext=yr,this.setSpan=br,this.setSpanContext=vr}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=pt(nn,this._proxyTracerProvider,wt.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return ft(nn)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){mt(nn,wt.instance()),this._proxyTracerProvider=new Pr},e}(),on=sn.getInstance(),an={context:$r,diag:Hr,metrics:qr,propagation:rn,trace:on};const ln=m(Object.freeze({__proto__:null,DiagConsoleLogger:Pt,get DiagLogLevel(){return dt},INVALID_SPANID:ur,INVALID_SPAN_CONTEXT:pr,INVALID_TRACEID:hr,ProxyTracer:Ar,ProxyTracerProvider:Pr,ROOT_CONTEXT:At,get SamplingDecision(){return Cr},get SpanKind(){return jr},get SpanStatusCode(){return Rr},get TraceFlags(){return Jt},get ValueType(){return Rt},baggageEntryMetadataFromString:function(e){return"string"!=typeof e&&(Mt.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:Tt,toString:function(){return e}}},context:$r,createContextKey:Ct,createNoopMeter:function(){return qt},createTraceState:function(e){return new zr(e)},default:an,defaultTextMapGetter:er,defaultTextMapSetter:tr,diag:Hr,isSpanContextValid:Or,isValidSpanId:Er,isValidTraceId:Nr,metrics:qr,propagation:rn,trace:on})),cn=Y,un="process_cpu_user_seconds_total",hn="process_cpu_system_seconds_total",pn="process_cpu_seconds_total";st.exports=(e,t={})=>{const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},o=!!t.enableExemplars&&t.enableExemplars,i=Object.keys(s);let a=process.cpuUsage();const l=new cn({name:n+un,help:"Total user CPU time spent in seconds.",enableExemplars:o,registers:r,labelNames:i,collect(){const e=process.cpuUsage(),t=e.user-a.user,r=e.system-a.system;if(a=e,this.enableExemplars){let e={};const n=ln.trace.getSpan(ln.context.active());n&&(e={traceId:n.spanContext().traceId,spanId:n.spanContext().spanId}),l.inc({labels:s,value:t/1e6,exemplarLabels:e}),c.inc({labels:s,value:r/1e6,exemplarLabels:e}),u.inc({labels:s,value:(t+r)/1e6,exemplarLabels:e})}else l.inc(s,t/1e6),c.inc(s,r/1e6),u.inc(s,(t+r)/1e6)}}),c=new cn({name:n+hn,help:"Total system CPU time spent in seconds.",enableExemplars:o,registers:r,labelNames:i}),u=new cn({name:n+pn,help:"Total user and system CPU time spent in seconds.",enableExemplars:o,registers:r,labelNames:i})},st.exports.metricNames=[un,hn,pn];var fn=st.exports,mn={exports:{}};const dn=ae,gn=Math.round(Date.now()/1e3-process.uptime()),bn="process_start_time_seconds";mn.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new dn({name:r+bn,help:"Start time of the process since unix epoch in seconds.",registers:e?[e]:void 0,labelNames:s,aggregator:"omit",collect(){this.set(n,gn)}})},mn.exports.metricNames=[bn];var _n=mn.exports,vn={exports:{}},yn={exports:{}};const xn=ae,wn=t,Nn=["VmSize","VmRSS","VmData"],En="process_resident_memory_bytes",On="process_virtual_memory_bytes",Tn="process_heap_bytes";yn.exports=(e,t={})=>{const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},o=Object.keys(s),i=new xn({name:n+En,help:"Resident memory size in bytes.",registers:r,labelNames:o,collect(){try{const e=wn.readFileSync("/proc/self/status","utf8"),t=e.split("\n").reduce(((e,t)=>{if(!Nn.some((e=>t.startsWith(e))))return e;const r=t.split(":");let n=r[1].trim();return n=n.substr(0,n.length-3),n=1024*Number(n),e[r[0]]=n,e}),{});i.set(s,t.VmRSS),a.set(s,t.VmSize),l.set(s,t.VmData)}catch{}}}),a=new xn({name:n+On,help:"Virtual memory size in bytes.",registers:r,labelNames:o}),l=new xn({name:n+Tn,help:"Process heap size in bytes.",registers:r,labelNames:o})},yn.exports.metricNames=[En,On,Tn];var Mn=yn.exports;var Sn=function(){try{return process.memoryUsage()}catch{return}};const Cn=ae,jn=Mn,Rn=Sn,Ln="process_resident_memory_bytes";vn.exports=(e,t)=>"linux"===process.platform?jn(e,t):function(e,t={}){const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new Cn({name:r+Ln,help:"Resident memory size in bytes.",registers:e?[e]:void 0,labelNames:s,collect(){const e=Rn();e&&this.set(n,e.rss)}})}(e,t),vn.exports.metricNames="linux"===process.platform?jn.metricNames:[Ln];var An=vn.exports,kn={exports:{}};const Pn=ae,Vn=t,In=r,Dn="process_open_fds";kn.exports=(e,t={})=>{if("linux"!==In.platform)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new Pn({name:r+Dn,help:"Number of open file descriptors.",registers:e?[e]:void 0,labelNames:s,collect(){try{const e=Vn.readdirSync("/proc/self/fd");this.set(n,e.length-1)}catch{}}})},kn.exports.metricNames=[Dn];var Bn=kn.exports,zn={exports:{}};const $n=ae,Hn=t,Un="process_max_fds";let Gn;zn.exports=(e,t={})=>{if(void 0===Gn)try{const e=Hn.readFileSync("/proc/self/limits","utf8").split("\n");for(const t of e)if(t.startsWith("Max open files")){const e=t.split(/  +/);Gn=Number(e[1]);break}}catch{return}if(void 0===Gn)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new $n({name:r+Un,help:"Maximum number of open file descriptors.",registers:e?[e]:void 0,labelNames:s,collect(){void 0!==Gn&&this.set(n,Gn)}})},zn.exports.metricNames=[Un];var Fn=zn.exports,qn={exports:{}};const Wn=ae;let Yn;try{Yn=require("perf_hooks")}catch{}const Kn="nodejs_eventloop_lag_seconds",Xn="nodejs_eventloop_lag_min_seconds",Zn="nodejs_eventloop_lag_max_seconds",Qn="nodejs_eventloop_lag_mean_seconds",Jn="nodejs_eventloop_lag_stddev_seconds",es="nodejs_eventloop_lag_p50_seconds",ts="nodejs_eventloop_lag_p90_seconds",rs="nodejs_eventloop_lag_p99_seconds";function ns(e,t,r){const n=process.hrtime(e),s=(1e9*n[0]+n[1])/1e9;t.set(r,s)}qn.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n),o=e?[e]:void 0;let i;if(Yn&&Yn.monitorEventLoopDelay){const e=Yn.monitorEventLoopDelay({resolution:t.eventLoopMonitoringPrecision});e.enable(),i=()=>{const t=process.hrtime();setImmediate(ns,t,a,n),l.set(n,e.min/1e9),c.set(n,e.max/1e9),u.set(n,e.mean/1e9),h.set(n,e.stddev/1e9),p.set(n,e.percentile(50)/1e9),f.set(n,e.percentile(90)/1e9),m.set(n,e.percentile(99)/1e9),e.reset()}}else i=()=>{const e=process.hrtime();setImmediate(ns,e,a,n)};const a=new Wn({name:r+Kn,help:"Lag of event loop in seconds.",registers:o,labelNames:s,aggregator:"average",collect:i}),l=new Wn({name:r+Xn,help:"The minimum recorded event loop delay.",registers:o,labelNames:s,aggregator:"min"}),c=new Wn({name:r+Zn,help:"The maximum recorded event loop delay.",registers:o,labelNames:s,aggregator:"max"}),u=new Wn({name:r+Qn,help:"The mean of the recorded event loop delays.",registers:o,labelNames:s,aggregator:"average"}),h=new Wn({name:r+Jn,help:"The standard deviation of the recorded event loop delays.",registers:o,labelNames:s,aggregator:"average"}),p=new Wn({name:r+es,help:"The 50th percentile of the recorded event loop delays.",registers:o,labelNames:s,aggregator:"average"}),f=new Wn({name:r+ts,help:"The 90th percentile of the recorded event loop delays.",registers:o,labelNames:s,aggregator:"average"}),m=new Wn({name:r+rs,help:"The 99th percentile of the recorded event loop delays.",registers:o,labelNames:s,aggregator:"average"})},qn.exports.metricNames=[Kn,Xn,Zn,Qn,Jn,es,ts,rs];var ss=qn.exports,os={exports:{}};var is={aggregateByObjectName:function(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];n&&void 0!==n.constructor&&(Object.hasOwnProperty.call(t,n.constructor.name)?t[n.constructor.name]+=1:t[n.constructor.name]=1)}return t},updateMetrics:function(e,t,r){e.reset();for(const n in t)e.set(Object.assign({type:n},r||{}),t[n])}};const{aggregateByObjectName:as}=is,{updateMetrics:ls}=is,cs=ae,us="nodejs_active_handles",hs="nodejs_active_handles_total";os.exports=(e,t={})=>{if("function"!=typeof process._getActiveHandles)return;const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},o=Object.keys(s);new cs({name:n+us,help:"Number of active libuv handles grouped by handle type. Every handle type is C++ class name.",labelNames:["type",...o],registers:r,collect(){const e=process._getActiveHandles();ls(this,as(e),s)}}),new cs({name:n+hs,help:"Total number of active handles.",registers:r,labelNames:o,collect(){const e=process._getActiveHandles();this.set(s,e.length)}})},os.exports.metricNames=[us,hs];var ps=os.exports,fs={exports:{}};const ms=ae,{aggregateByObjectName:ds}=is,{updateMetrics:gs}=is,bs="nodejs_active_requests",_s="nodejs_active_requests_total";fs.exports=(e,t={})=>{if("function"!=typeof process._getActiveRequests)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new ms({name:r+bs,help:"Number of active libuv requests grouped by request type. Every request type is C++ class name.",labelNames:["type",...s],registers:e?[e]:void 0,collect(){const e=process._getActiveRequests();gs(this,ds(e),n)}}),new ms({name:r+_s,help:"Total number of active requests.",registers:e?[e]:void 0,labelNames:s,collect(){const e=process._getActiveRequests();this.set(n,e.length)}})},fs.exports.metricNames=[bs,_s];var vs=fs.exports,ys={exports:{}};const xs=ae,{updateMetrics:ws}=is,Ns="nodejs_active_resources",Es="nodejs_active_resources_total";ys.exports=(e,t={})=>{if("function"!=typeof process.getActiveResourcesInfo)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new xs({name:r+Ns,help:"Number of active resources that are currently keeping the event loop alive, grouped by async resource type.",labelNames:["type",...s],registers:e?[e]:void 0,collect(){const e=process.getActiveResourcesInfo(),t={};for(let r=0;r<e.length;r++){const n=e[r];Object.hasOwn(t,n)?t[n]+=1:t[n]=1}ws(this,t,n)}}),new xs({name:r+Es,help:"Total number of active resources.",registers:e?[e]:void 0,labelNames:s,collect(){const e=process.getActiveResourcesInfo();this.set(n,e.length)}})},ys.exports.metricNames=[Ns,Es];var Os=ys.exports,Ts={exports:{}};const Ms=ae,Ss=Sn,Cs="nodejs_heap_size_total_bytes",js="nodejs_heap_size_used_bytes",Rs="nodejs_external_memory_bytes";Ts.exports=(e,t={})=>{if("function"!=typeof process.memoryUsage)return;const r=t.labels?t.labels:{},n=Object.keys(r),s=e?[e]:void 0,o=t.prefix?t.prefix:"",i=new Ms({name:o+Cs,help:"Process heap size from Node.js in bytes.",registers:s,labelNames:n,collect:()=>{const e=Ss();e&&(i.set(r,e.heapTotal),a.set(r,e.heapUsed),void 0!==e.external&&l.set(r,e.external))}}),a=new Ms({name:o+js,help:"Process heap size used from Node.js in bytes.",registers:s,labelNames:n}),l=new Ms({name:o+Rs,help:"Node.js external memory size in bytes.",registers:s,labelNames:n})},Ts.exports.metricNames=[Cs,js,Rs];var Ls=Ts.exports,As={exports:{}};const ks=ae,Ps=n,Vs=["total","used","available"],Is={};Vs.forEach((e=>{Is[e]=`nodejs_heap_space_size_${e}_bytes`})),As.exports=(e,t={})=>{const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},o=["space",...Object.keys(s)],i={};Vs.forEach((e=>{i[e]=new ks({name:n+Is[e],help:`Process heap space size ${e} from Node.js in bytes.`,labelNames:o,registers:r})})),i.total.collect=()=>{for(const e of Ps.getHeapSpaceStatistics()){const t=e.space_name.substr(0,e.space_name.indexOf("_space"));i.total.set({space:t,...s},e.space_size),i.used.set({space:t,...s},e.space_used_size),i.available.set({space:t,...s},e.space_available_size)}}},As.exports.metricNames=Object.values(Is);var Ds=As.exports,Bs={exports:{}};const zs=ae,$s=process.version,Hs=$s.slice(1).split(".").map(Number),Us="nodejs_version_info";Bs.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new zs({name:r+Us,help:"Node.js version info.",labelNames:["version","major","minor","patch",...s],registers:e?[e]:void 0,aggregator:"first",collect(){this.labels($s,Hs[0],Hs[1],Hs[2],...Object.values(n)).set(1)}})},Bs.exports.metricNames=[Us];var Gs=Bs.exports,Fs={exports:{}};const qs=Ee;let Ws;try{Ws=require("perf_hooks")}catch{}const Ys="nodejs_gc_duration_seconds",Ks=[.001,.01,.1,1,2,5],Xs=[];Ws&&Ws.constants&&(Xs[Ws.constants.NODE_PERFORMANCE_GC_MAJOR]="major",Xs[Ws.constants.NODE_PERFORMANCE_GC_MINOR]="minor",Xs[Ws.constants.NODE_PERFORMANCE_GC_INCREMENTAL]="incremental",Xs[Ws.constants.NODE_PERFORMANCE_GC_WEAKCB]="weakcb"),Fs.exports=(e,t={})=>{if(!Ws)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n),o=t.gcDurationBuckets?t.gcDurationBuckets:Ks,i=new qs({name:r+Ys,help:"Garbage collection duration by kind, one of major, minor, incremental or weakcb.",labelNames:["kind",...s],enableExemplars:!1,buckets:o,registers:e?[e]:void 0});new Ws.PerformanceObserver((e=>{const t=e.getEntries()[0],r=t.detail?Xs[t.detail.kind]:Xs[t.kind];i.observe(Object.assign({kind:r},n),t.duration/1e3)})).observe({entryTypes:["gc"]})},Fs.exports.metricNames=[Ys];var Zs=Fs.exports;const{isObject:Qs}=g,Js=ps,eo=vs,to=Os,ro=Ls,no=Ds,so=Gs,oo=Zs,io={processCpuTotal:fn,processStartTime:_n,osMemoryHeap:An,processOpenFileDescriptors:Bn,processMaxFileDescriptors:Fn,eventLoopLag:ss,..."function"==typeof process.getActiveResourcesInfo?{processResources:to}:{},processHandles:Js,processRequests:eo,heapSizeAndUsed:ro,heapSpacesSizeAndUsed:no,version:so,gc:oo},ao=Object.keys(io);nt.exports=function(e){if(null!=e&&!Qs(e))throw new TypeError("config must be null, undefined, or an object");e={eventLoopMonitoringPrecision:10,...e};for(const t of Object.values(io))t(e.register,e)},nt.exports.metricsList=ao;M.globalRegistry,M.globalRegistry,M.globalRegistry.contentType,M.PROMETHEUS_CONTENT_TYPE,M.OPENMETRICS_CONTENT_TYPE;var lo=Y,co=ae,uo=Ee,ho=rt;class po{constructor(){this.HistogramVecs={},this.CounterVecs={},this.GaugeVecs={},this.SummaryVecs={}}CreateHistogramVec(e,t,r,n){this.HistogramVecs[e]||(this.HistogramVecs[e]={Labels:r,Metric:new uo({name:e,help:t,labelNames:r,buckets:n})})}CreateCounterVec(e,t,r){this.CounterVecs[e]||(this.CounterVecs[e]={Labels:r,Metric:new lo({name:e,help:t,labelNames:r})})}CreateGaugeVec(e,t,r){this.GaugeVecs[e]||(this.GaugeVecs[e]={Labels:r,Metric:new co({name:e,help:t,labelNames:r})})}CreateSummaryVec(e,t,r){this.SummaryVecs[e]||(this.SummaryVecs[e]={Labels:r,Metric:new ho({name:e,help:t,labelNames:r})})}Histogram(e,t,r){const n=Object.keys(r);this.HistogramVecs[e]||this.CreateHistogramVec(e,e,n);const s=[];for(const t of this.HistogramVecs[e].Labels)s.push(r[t]);this.HistogramVecs[e].Metric.labels(...s).observe(t)}Count(e,t){const r=Object.keys(t);this.CounterVecs[e]||this.CreateCounterVec(e,e,r);const n=[];for(const r of this.CounterVecs[e].Labels)n.push(t[r]);this.CounterVecs[e].Metric.labels(...n).inc()}Gauge(e,t,r){const n=Object.keys(r);this.GaugeVecs[e]||this.CreateGaugeVec(e,e,n);const s=[];for(const t of this.GaugeVecs[e].Labels)s.push(r[t]);this.GaugeVecs[e].Metric.labels(...s).set(t)}Summary(e,t,r){const n=Object.keys(r);this.SummaryVecs[e]||this.CreateSummaryVec(e,e,n);const s=[];for(const t of this.SummaryVecs[e].Labels)s.push(r[t]);this.SummaryVecs[e].Metric.labels(...s).observe(t)}}export{o as ApiMetric,a as CallMetric,f as DataDogClient,u as DatabaseMetric,i as HttpMiddlewareMetric,h as Metrics,po as PrometheusClient,s as ResolverMetric,c as Result};
