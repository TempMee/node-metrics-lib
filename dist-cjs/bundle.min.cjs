"use strict";var require$$0$1=require("path"),require$$0$2=require("crypto"),require$$0$4=require("async_hooks"),require$$2=require("diagnostics_channel"),require$$0$3=require("util"),require$$0$5=require("perf_hooks"),require$$0$b=require("v8"),require$$0$a=require("os"),require$$0$9=require("dns"),require$$0$7=require("stream"),require$$1$1=require("http"),require$$2$1=require("https"),require$$0$8=require("url"),require$$5=require("zlib"),require$$0$6=require("fs"),require$$2$2=require("dgram"),require$$1$2=require("net"),require$$0$c=require("child_process"),require$$0$d=require("assert"),require$$0$e=require("graphql/language/visitor"),require$$1$3=require("graphql/language/printer"),require$$2$3=require("graphql/utilities"),require$$1$4=require("module"),require$$0$f=require("events");require("node:dns");var require$$2$4=require("worker_threads"),require$$2$5=require("node:worker_threads"),require$$1$5=require("process"),DatabaseMetricMethod,Result;function ResolverMetric(e,t,r){const s={Resolver:r.Resolver,Service:r.Service,Protocol:r.Protocol,Result:r.Result};e.Histogram("resolver_request_duration_histogram_milliseconds",t,s)}function ApiMetric(e,t,r){const s={Service:r.Service,Vendor:r.Vendor,Call:r.Call,Result:r.Result};e.Histogram("api_request_duration_histogram_milliseconds",t,s)}function HttpMiddlewareMetric(e,t){return(r,s,n)=>{const i=Date.now();s.on("finish",(()=>{const r=Date.now(),s={Service:t.Service};e.Histogram("http_request_duration_histogram_milliseconds",r-i,s)})),n()}}function CallMetric(e,t,r){const s={Service:r.Service,Function:r.Function,Result:r.Result};e.Histogram("call_duration_histogram_milliseconds",t,s)}function DatabaseMetric(e,t,r){const s={Service:r.Service,Table:r.Table,Method:r.Method,Result:r.Result};e.Histogram("database_duration_histogram_milliseconds",t,s)}require("cluster"),function(e){e.Insert="insert",e.Update="update",e.Delete="delete",e.Select="select"}(DatabaseMetricMethod||(DatabaseMetricMethod={}));class Metrics{constructor(e){this.client=e}static getInstance(e){return Metrics.instance||(Metrics.instance=new Metrics(e)),Metrics.instance}Histogram(e,t,r){this.client.Histogram(e,t,r)}Count(e,t){this.client.Count(e,t)}Gauge(e,t,r){this.client.Gauge(e,t,r)}Summary(e,t,r){this.client.Summary(e,t,r)}ResolverMetric(e,t){return ResolverMetric(this.client,e,t)}ApiMetric(e,t){return ApiMetric(this.client,e,t)}HttpMiddlewareMetric(e){return HttpMiddlewareMetric(this.client,e)}CallMetric(e,t){return CallMetric(this.client,e,t)}DatabaseMetric(e,t){return DatabaseMetric(this.client,e,t)}}exports.Result=void 0,Result=exports.Result||(exports.Result={}),Result.Success="success",Result.Error="error";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},util$f,hasRequiredUtil$9,scope$1,hasRequiredScope$1,priority,hasRequiredPriority,span_context$2,hasRequiredSpan_context$2,span_context$1,hasRequiredSpan_context$1,id,hasRequiredId;function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})})),r}function requireUtil$9(){if(hasRequiredUtil$9)return util$f;hasRequiredUtil$9=1;const e=require$$0$1;return util$f={isTrue:function(e){return"true"===(e=String(e).toLowerCase())||"1"===e},isFalse:function(e){return"false"===(e=String(e).toLowerCase())||"0"===e},isError:function(e){return e instanceof Error||!(!e||!e.message)},globMatch:function(e,t){let r=0,s=0,n=0,i=0;for(;r<e.length||s<t.length;){if(r<e.length){const a=e[r];switch(a){default:if(s<t.length&&t[s]===a){r++,s++;continue}break;case"?":if(s<t.length){r++,s++;continue}break;case"*":n=r,i=s+1,r++;continue}}if(!(i>0&&i<=t.length))return!1;r=n,s=i}return!0},calculateDDBasePath:function(t){const r=t.split(e.sep),s=r.lastIndexOf("packages");return r.slice(0,s+1).join(e.sep)+e.sep}}}function requireScope$1(){if(hasRequiredScope$1)return scope$1;hasRequiredScope$1=1;return scope$1=class{active(){return null}activate(e,t){return"function"!=typeof t?t:t()}bind(e,t){return e}}}function requirePriority(){return hasRequiredPriority?priority:(hasRequiredPriority=1,priority={USER_REJECT:-1,AUTO_REJECT:0,AUTO_KEEP:1,USER_KEEP:2})}function requireSpan_context$2(){if(hasRequiredSpan_context$2)return span_context$2;hasRequiredSpan_context$2=1;const{AUTO_KEEP:e}=requirePriority(),t="_dd.p.tid";return span_context$2=class{constructor(e){e=e||{},this._traceId=e.traceId,this._spanId=e.spanId,this._parentId=e.parentId||null,this._name=e.name,this._isFinished=e.isFinished||!1,this._tags=e.tags||{},this._sampling=e.sampling||{},this._spanSampling=void 0,this._baggageItems=e.baggageItems||{},this._traceparent=e.traceparent,this._tracestate=e.tracestate,this._noop=e.noop||null,this._trace=e.trace||{started:[],finished:[],tags:{}}}toTraceId(e=!1){return e?this._traceId.toBuffer().length<=8&&this._trace.tags[t]?this._trace.tags[t]+this._traceId.toString(16).padStart(16,"0"):this._traceId.toString(16).padStart(32,"0"):this._traceId.toString(10)}toSpanId(e=!1){return e?this._spanId.toString(16).padStart(16,"0"):this._spanId.toString(10)}toTraceparent(){const t=this._sampling.priority>=e?"01":"00",r=this.toTraceId(!0),s=this.toSpanId(!0);return`${this._traceparent&&this._traceparent.version||"00"}-${r}-${s}-${t}`}}}function requireSpan_context$1(){if(hasRequiredSpan_context$1)return span_context$1;hasRequiredSpan_context$1=1;const e=requireSpan_context$2(),t=requirePriority().USER_REJECT;return span_context$1=class extends e{constructor(e){super(e),this._sampling.priority=t}}}function requireId(){if(hasRequiredId)return id;hasRequiredId=1;const{randomFillSync:e}=require$$0$2,t=4294967296,r=new Uint8Array(65536),s=new Uint8Array(8),n=Array.prototype.map,i=e=>`${e<16?"0":""}${e.toString(16)}`;let a=0;class o{constructor(n,i=16){this._isUint64BE=!0,this._buffer=16===i?function(t){if("0"===t)return s;if(!t)return function(){0===a&&e(r);a=(a+1)%8192;const t=8*a;return[127&r[t],r[t+1],r[t+2],r[t+3],r[t+4],r[t+5],r[t+6],r[t+7]]}();const n=16*Math.ceil(t.length/16),i=n/2,o=new Array(i);t=t.padStart(n,"0");for(let e=0;e<i;e++)o[e]=parseInt(t.substring(2*e,2*e+2),16);return o}(n):function(e,r){const s=new Array(8),n=e.length;let i=0,a=0,o=0;"-"===e[0]&&i++;const c=i;for(;i<n;){const s=parseInt(e[i++],r);if(!(s>=0))break;o=o*r+s,a=a*r+Math.floor(o/t),o%=t}c&&(a=~a,o?o=t-o:a++);return u(s,a,0),u(s,o,4),s}(n,i)}toString(e=16){return 16===e?(r=this._buffer,n.call(r,i).join("")):function(e,r){let s=c(e,e.length-8),n=c(e,e.length-4),i="";r=r||10;for(;;){const e=s%r*t+n;if(s=Math.floor(s/r),n=Math.floor(e/r),i=(e%r).toString(r)+i,!s&&!n)break}return i}(this._buffer,e);var r}toBuffer(){return this._buffer}toArray(){return 8===this._buffer.length?this._buffer:this._buffer.slice(-8)}toJSON(){return this.toString()}equals(e){for(let t=this._buffer.length,r=e._buffer.length;t>=0&&r>=0;t--,r--)if(this._buffer[t]!==e._buffer[r])return!1;return!0}}function c(e,t){return 16777216*e[t+0]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]}function u(e,t,r){e[3+r]=255&t,t>>=8,e[2+r]=255&t,t>>=8,e[1+r]=255&t,t>>=8,e[0+r]=255&t}return id=(e,t)=>new o(e,t)}var storage$1={exports:{}},re$1={exports:{}},constants$3,hasRequiredConstants$3,debug_1,hasRequiredDebug,hasRequiredRe,parseOptions_1,hasRequiredParseOptions,identifiers,hasRequiredIdentifiers,semver$1,hasRequiredSemver$1,parse_1,hasRequiredParse$2,valid_1,hasRequiredValid$1,clean_1,hasRequiredClean,inc_1,hasRequiredInc,diff_1,hasRequiredDiff,major_1,hasRequiredMajor,minor_1,hasRequiredMinor,patch_1,hasRequiredPatch$1,prerelease_1,hasRequiredPrerelease,compare_1,hasRequiredCompare,rcompare_1,hasRequiredRcompare,compareLoose_1,hasRequiredCompareLoose,compareBuild_1,hasRequiredCompareBuild,sort_1,hasRequiredSort,rsort_1,hasRequiredRsort,gt_1,hasRequiredGt,lt_1,hasRequiredLt,eq_1,hasRequiredEq,neq_1,hasRequiredNeq,gte_1,hasRequiredGte,lte_1,hasRequiredLte,cmp_1,hasRequiredCmp,coerce_1,hasRequiredCoerce,iterator,hasRequiredIterator,yallist,hasRequiredYallist,lruCache$2,hasRequiredLruCache$2,range,hasRequiredRange,comparator,hasRequiredComparator,satisfies_1,hasRequiredSatisfies,toComparators_1,hasRequiredToComparators,maxSatisfying_1,hasRequiredMaxSatisfying,minSatisfying_1,hasRequiredMinSatisfying,minVersion_1,hasRequiredMinVersion,valid,hasRequiredValid,outside_1,hasRequiredOutside,gtr_1,hasRequiredGtr,ltr_1,hasRequiredLtr,intersects_1,hasRequiredIntersects,simplify,hasRequiredSimplify,subset_1,hasRequiredSubset,semver,hasRequiredSemver;function requireConstants$3(){if(hasRequiredConstants$3)return constants$3;hasRequiredConstants$3=1;const e=Number.MAX_SAFE_INTEGER||9007199254740991;return constants$3={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}}function requireDebug(){if(hasRequiredDebug)return debug_1;hasRequiredDebug=1;const e="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};return debug_1=e}function requireRe(){return hasRequiredRe||(hasRequiredRe=1,function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:n}=requireConstants$3(),i=requireDebug(),a=(t=e.exports={}).re=[],o=t.safeRe=[],c=t.src=[],u=t.t={};let l=0;const p="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",n],[p,s]],h=(e,t,r)=>{const s=(e=>{for(const[t,r]of d)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=l++;i(e,n,t),u[e]=n,c[n]=t,a[n]=new RegExp(t,r?"g":void 0),o[n]=new RegExp(s,r?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),h("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${p}+`),h("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),h("FULL",`^${c[u.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),h("LOOSE",`^${c[u.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),h("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),h("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),h("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),h("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),h("COERCERTL",c[u.COERCE],!0),h("COERCERTLFULL",c[u.COERCEFULL],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(re$1,re$1.exports)),re$1.exports}function requireParseOptions(){if(hasRequiredParseOptions)return parseOptions_1;hasRequiredParseOptions=1;const e=Object.freeze({loose:!0}),t=Object.freeze({});return parseOptions_1=r=>r?"object"!=typeof r?e:r:t}function requireIdentifiers(){if(hasRequiredIdentifiers)return identifiers;hasRequiredIdentifiers=1;const e=/^[0-9]+$/,t=(t,r)=>{const s=e.test(t),n=e.test(r);return s&&n&&(t=+t,r=+r),t===r?0:s&&!n?-1:n&&!s?1:t<r?-1:1};return identifiers={compareIdentifiers:t,rcompareIdentifiers:(e,r)=>t(r,e)}}function requireSemver$1(){if(hasRequiredSemver$1)return semver$1;hasRequiredSemver$1=1;const e=requireDebug(),{MAX_LENGTH:t,MAX_SAFE_INTEGER:r}=requireConstants$3(),{safeRe:s,t:n}=requireRe(),i=requireParseOptions(),{compareIdentifiers:a}=requireIdentifiers();class o{constructor(a,c){if(c=i(c),a instanceof o){if(a.loose===!!c.loose&&a.includePrerelease===!!c.includePrerelease)return a;a=a.version}else if("string"!=typeof a)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof a}".`);if(a.length>t)throw new TypeError(`version is longer than ${t} characters`);e("SemVer",a,c),this.options=c,this.loose=!!c.loose,this.includePrerelease=!!c.includePrerelease;const u=a.trim().match(c.loose?s[n.LOOSE]:s[n.FULL]);if(!u)throw new TypeError(`Invalid Version: ${a}`);if(this.raw=a,this.major=+u[1],this.minor=+u[2],this.patch=+u[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");u[4]?this.prerelease=u[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<r)return t}return e})):this.prerelease=[],this.build=u[5]?u[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(e("SemVer.compare",this.version,this.options,t),!(t instanceof o)){if("string"==typeof t&&t===this.version)return 0;t=new o(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(e){return e instanceof o||(e=new o(e,this.options)),a(this.major,e.major)||a(this.minor,e.minor)||a(this.patch,e.patch)}comparePre(t){if(t instanceof o||(t=new o(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{const s=this.prerelease[r],n=t.prerelease[r];if(e("prerelease compare",r,s,n),void 0===s&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===s)return-1;if(s!==n)return a(s,n)}while(++r)}compareBuild(t){t instanceof o||(t=new o(t,this.options));let r=0;do{const s=this.build[r],n=t.build[r];if(e("prerelease compare",r,s,n),void 0===s&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===s)return-1;if(s!==n)return a(s,n)}while(++r)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let s=this.prerelease.length;for(;--s>=0;)"number"==typeof this.prerelease[s]&&(this.prerelease[s]++,s=-2);if(-1===s){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let s=[t,e];!1===r&&(s=[t]),0===a(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return semver$1=o}function requireParse$2(){if(hasRequiredParse$2)return parse_1;hasRequiredParse$2=1;const e=requireSemver$1();return parse_1=(t,r,s=!1)=>{if(t instanceof e)return t;try{return new e(t,r)}catch(e){if(!s)return null;throw e}},parse_1}function requireValid$1(){if(hasRequiredValid$1)return valid_1;hasRequiredValid$1=1;const e=requireParse$2();return valid_1=(t,r)=>{const s=e(t,r);return s?s.version:null},valid_1}function requireClean(){if(hasRequiredClean)return clean_1;hasRequiredClean=1;const e=requireParse$2();return clean_1=(t,r)=>{const s=e(t.trim().replace(/^[=v]+/,""),r);return s?s.version:null},clean_1}function requireInc(){if(hasRequiredInc)return inc_1;hasRequiredInc=1;const e=requireSemver$1();return inc_1=(t,r,s,n,i)=>{"string"==typeof s&&(i=n,n=s,s=void 0);try{return new e(t instanceof e?t.version:t,s).inc(r,n,i).version}catch(e){return null}},inc_1}function requireDiff(){if(hasRequiredDiff)return diff_1;hasRequiredDiff=1;const e=requireParse$2();return diff_1=(t,r)=>{const s=e(t,null,!0),n=e(r,null,!0),i=s.compare(n);if(0===i)return null;const a=i>0,o=a?s:n,c=a?n:s,u=!!o.prerelease.length;if(!!c.prerelease.length&&!u)return c.patch||c.minor?o.patch?"patch":o.minor?"minor":"major":"major";const l=u?"pre":"";return s.major!==n.major?l+"major":s.minor!==n.minor?l+"minor":s.patch!==n.patch?l+"patch":"prerelease"},diff_1}function requireMajor(){if(hasRequiredMajor)return major_1;hasRequiredMajor=1;const e=requireSemver$1();return major_1=(t,r)=>new e(t,r).major}function requireMinor(){if(hasRequiredMinor)return minor_1;hasRequiredMinor=1;const e=requireSemver$1();return minor_1=(t,r)=>new e(t,r).minor}function requirePatch$1(){if(hasRequiredPatch$1)return patch_1;hasRequiredPatch$1=1;const e=requireSemver$1();return patch_1=(t,r)=>new e(t,r).patch}function requirePrerelease(){if(hasRequiredPrerelease)return prerelease_1;hasRequiredPrerelease=1;const e=requireParse$2();return prerelease_1=(t,r)=>{const s=e(t,r);return s&&s.prerelease.length?s.prerelease:null},prerelease_1}function requireCompare(){if(hasRequiredCompare)return compare_1;hasRequiredCompare=1;const e=requireSemver$1();return compare_1=(t,r,s)=>new e(t,s).compare(new e(r,s))}function requireRcompare(){if(hasRequiredRcompare)return rcompare_1;hasRequiredRcompare=1;const e=requireCompare();return rcompare_1=(t,r,s)=>e(r,t,s)}function requireCompareLoose(){if(hasRequiredCompareLoose)return compareLoose_1;hasRequiredCompareLoose=1;const e=requireCompare();return compareLoose_1=(t,r)=>e(t,r,!0)}function requireCompareBuild(){if(hasRequiredCompareBuild)return compareBuild_1;hasRequiredCompareBuild=1;const e=requireSemver$1();return compareBuild_1=(t,r,s)=>{const n=new e(t,s),i=new e(r,s);return n.compare(i)||n.compareBuild(i)}}function requireSort(){if(hasRequiredSort)return sort_1;hasRequiredSort=1;const e=requireCompareBuild();return sort_1=(t,r)=>t.sort(((t,s)=>e(t,s,r)))}function requireRsort(){if(hasRequiredRsort)return rsort_1;hasRequiredRsort=1;const e=requireCompareBuild();return rsort_1=(t,r)=>t.sort(((t,s)=>e(s,t,r)))}function requireGt(){if(hasRequiredGt)return gt_1;hasRequiredGt=1;const e=requireCompare();return gt_1=(t,r,s)=>e(t,r,s)>0}function requireLt(){if(hasRequiredLt)return lt_1;hasRequiredLt=1;const e=requireCompare();return lt_1=(t,r,s)=>e(t,r,s)<0}function requireEq(){if(hasRequiredEq)return eq_1;hasRequiredEq=1;const e=requireCompare();return eq_1=(t,r,s)=>0===e(t,r,s)}function requireNeq(){if(hasRequiredNeq)return neq_1;hasRequiredNeq=1;const e=requireCompare();return neq_1=(t,r,s)=>0!==e(t,r,s)}function requireGte(){if(hasRequiredGte)return gte_1;hasRequiredGte=1;const e=requireCompare();return gte_1=(t,r,s)=>e(t,r,s)>=0}function requireLte(){if(hasRequiredLte)return lte_1;hasRequiredLte=1;const e=requireCompare();return lte_1=(t,r,s)=>e(t,r,s)<=0}function requireCmp(){if(hasRequiredCmp)return cmp_1;hasRequiredCmp=1;const e=requireEq(),t=requireNeq(),r=requireGt(),s=requireGte(),n=requireLt(),i=requireLte();return cmp_1=(a,o,c,u)=>{switch(o){case"===":return"object"==typeof a&&(a=a.version),"object"==typeof c&&(c=c.version),a===c;case"!==":return"object"==typeof a&&(a=a.version),"object"==typeof c&&(c=c.version),a!==c;case"":case"=":case"==":return e(a,c,u);case"!=":return t(a,c,u);case">":return r(a,c,u);case">=":return s(a,c,u);case"<":return n(a,c,u);case"<=":return i(a,c,u);default:throw new TypeError(`Invalid operator: ${o}`)}}}function requireCoerce(){if(hasRequiredCoerce)return coerce_1;hasRequiredCoerce=1;const e=requireSemver$1(),t=requireParse$2(),{safeRe:r,t:s}=requireRe();return coerce_1=(n,i)=>{if(n instanceof e)return n;if("number"==typeof n&&(n=String(n)),"string"!=typeof n)return null;let a=null;if((i=i||{}).rtl){const e=i.includePrerelease?r[s.COERCERTLFULL]:r[s.COERCERTL];let t;for(;(t=e.exec(n))&&(!a||a.index+a[0].length!==n.length);)a&&t.index+t[0].length===a.index+a[0].length||(a=t),e.lastIndex=t.index+t[1].length+t[2].length;e.lastIndex=-1}else a=n.match(i.includePrerelease?r[s.COERCEFULL]:r[s.COERCE]);if(null===a)return null;const o=a[2],c=a[3]||"0",u=a[4]||"0",l=i.includePrerelease&&a[5]?`-${a[5]}`:"",p=i.includePrerelease&&a[6]?`+${a[6]}`:"";return t(`${o}.${c}.${u}${l}${p}`,i)},coerce_1}function requireIterator(){return hasRequiredIterator?iterator:(hasRequiredIterator=1,iterator=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}})}function requireYallist(){if(hasRequiredYallist)return yallist;function e(t){var r=this;if(r instanceof e||(r=new e),r.tail=null,r.head=null,r.length=0,t&&"function"==typeof t.forEach)t.forEach((function(e){r.push(e)}));else if(arguments.length>0)for(var s=0,n=arguments.length;s<n;s++)r.push(arguments[s]);return r}function t(e,t,r){var s=t===e.head?new n(r,null,t,e):new n(r,t,t.next,e);return null===s.next&&(e.tail=s),null===s.prev&&(e.head=s),e.length++,s}function r(e,t){e.tail=new n(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function s(e,t){e.head=new n(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function n(e,t,r,s){if(!(this instanceof n))return new n(e,t,r,s);this.list=s,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}hasRequiredYallist=1,yallist=e,e.Node=n,e.create=e,e.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},e.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},e.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},e.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)r(this,arguments[e]);return this.length},e.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)s(this,arguments[e]);return this.length},e.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},e.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},e.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,s=0;null!==r;s++)e.call(t,r.value,s,this),r=r.next},e.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,s=this.length-1;null!==r;s--)e.call(t,r.value,s,this),r=r.prev},e.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},e.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},e.prototype.map=function(t,r){r=r||this;for(var s=new e,n=this.head;null!==n;)s.push(t.call(r,n.value,this)),n=n.next;return s},e.prototype.mapReverse=function(t,r){r=r||this;for(var s=new e,n=this.tail;null!==n;)s.push(t.call(r,n.value,this)),n=n.prev;return s},e.prototype.reduce=function(e,t){var r,s=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");s=this.head.next,r=this.head.value}for(var n=0;null!==s;n++)r=e(r,s.value,n),s=s.next;return r},e.prototype.reduceReverse=function(e,t){var r,s=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");s=this.tail.prev,r=this.tail.value}for(var n=this.length-1;null!==s;n--)r=e(r,s.value,n),s=s.prev;return r},e.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},e.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},e.prototype.slice=function(t,r){(r=r||this.length)<0&&(r+=this.length),(t=t||0)<0&&(t+=this.length);var s=new e;if(r<t||r<0)return s;t<0&&(t=0),r>this.length&&(r=this.length);for(var n=0,i=this.head;null!==i&&n<t;n++)i=i.next;for(;null!==i&&n<r;n++,i=i.next)s.push(i.value);return s},e.prototype.sliceReverse=function(t,r){(r=r||this.length)<0&&(r+=this.length),(t=t||0)<0&&(t+=this.length);var s=new e;if(r<t||r<0)return s;t<0&&(t=0),r>this.length&&(r=this.length);for(var n=this.length,i=this.tail;null!==i&&n>r;n--)i=i.prev;for(;null!==i&&n>t;n--,i=i.prev)s.push(i.value);return s},e.prototype.splice=function(e,r,...s){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,i=this.head;null!==i&&n<e;n++)i=i.next;var a=[];for(n=0;i&&n<r;n++)a.push(i.value),i=this.removeNode(i);null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(n=0;n<s.length;n++)i=t(this,i,s[n]);return a},e.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var s=r.prev;r.prev=r.next,r.next=s}return this.head=t,this.tail=e,this};try{requireIterator()(e)}catch(e){}return yallist}function requireLruCache$2(){if(hasRequiredLruCache$2)return lruCache$2;hasRequiredLruCache$2=1;const e=requireYallist(),t=Symbol("max"),r=Symbol("length"),s=Symbol("lengthCalculator"),n=Symbol("allowStale"),i=Symbol("maxAge"),a=Symbol("dispose"),o=Symbol("noDisposeOnSet"),c=Symbol("lruList"),u=Symbol("cache"),l=Symbol("updateAgeOnGet"),p=()=>1;const d=(e,t,r)=>{const s=e[u].get(t);if(s){const t=s.value;if(h(e,t)){if(g(e,s),!e[n])return}else r&&(e[l]&&(s.value.now=Date.now()),e[c].unshiftNode(s));return t.value}},h=(e,t)=>{if(!t||!t.maxAge&&!e[i])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[i]&&r>e[i]},f=e=>{if(e[r]>e[t])for(let s=e[c].tail;e[r]>e[t]&&null!==s;){const t=s.prev;g(e,s),s=t}},g=(e,t)=>{if(t){const s=t.value;e[a]&&e[a](s.key,s.value),e[r]-=s.length,e[u].delete(s.key),e[c].removeNode(t)}};class m{constructor(e,t,r,s,n){this.key=e,this.value=t,this.length=r,this.now=s,this.maxAge=n||0}}const _=(e,t,r,s)=>{let i=r.value;h(e,i)&&(g(e,r),e[n]||(i=void 0)),i&&t.call(s,i.value,i.key,e)};return lruCache$2=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[t]=e.max||1/0;const r=e.length||p;if(this[s]="function"!=typeof r?p:r,this[n]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[i]=e.maxAge||0,this[a]=e.dispose,this[o]=e.noDisposeOnSet||!1,this[l]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[t]=e||1/0,f(this)}get max(){return this[t]}set allowStale(e){this[n]=!!e}get allowStale(){return this[n]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[i]=e,f(this)}get maxAge(){return this[i]}set lengthCalculator(e){"function"!=typeof e&&(e=p),e!==this[s]&&(this[s]=e,this[r]=0,this[c].forEach((e=>{e.length=this[s](e.value,e.key),this[r]+=e.length}))),f(this)}get lengthCalculator(){return this[s]}get length(){return this[r]}get itemCount(){return this[c].length}rforEach(e,t){t=t||this;for(let r=this[c].tail;null!==r;){const s=r.prev;_(this,e,r,t),r=s}}forEach(e,t){t=t||this;for(let r=this[c].head;null!==r;){const s=r.next;_(this,e,r,t),r=s}}keys(){return this[c].toArray().map((e=>e.key))}values(){return this[c].toArray().map((e=>e.value))}reset(){this[a]&&this[c]&&this[c].length&&this[c].forEach((e=>this[a](e.key,e.value))),this[u]=new Map,this[c]=new e,this[r]=0}dump(){return this[c].map((e=>!h(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[c]}set(e,n,l){if((l=l||this[i])&&"number"!=typeof l)throw new TypeError("maxAge must be a number");const p=l?Date.now():0,d=this[s](n,e);if(this[u].has(e)){if(d>this[t])return g(this,this[u].get(e)),!1;const s=this[u].get(e).value;return this[a]&&(this[o]||this[a](e,s.value)),s.now=p,s.maxAge=l,s.value=n,this[r]+=d-s.length,s.length=d,this.get(e),f(this),!0}const h=new m(e,n,d,p,l);return h.length>this[t]?(this[a]&&this[a](e,n),!1):(this[r]+=h.length,this[c].unshift(h),this[u].set(e,this[c].head),f(this),!0)}has(e){if(!this[u].has(e))return!1;const t=this[u].get(e).value;return!h(this,t)}get(e){return d(this,e,!0)}peek(e){return d(this,e,!1)}pop(){const e=this[c].tail;return e?(g(this,e),e.value):null}del(e){g(this,this[u].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const s=e[r],n=s.e||0;if(0===n)this.set(s.k,s.v);else{const e=n-t;e>0&&this.set(s.k,s.v,e)}}}prune(){this[u].forEach(((e,t)=>d(this,t,!1)))}},lruCache$2}function requireRange(){if(hasRequiredRange)return range;hasRequiredRange=1;class e{constructor(t,n){if(n=r(n),t instanceof e)return t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease?t:new e(t.raw,n);if(t instanceof s)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!h(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&f(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const r=((this.options.includePrerelease&&p)|(this.options.loose&&d))+":"+e,i=t.get(r);if(i)return i;const f=this.options.loose,g=f?a[o.HYPHENRANGELOOSE]:a[o.HYPHENRANGE];e=e.replace(g,A(this.options.includePrerelease)),n("hyphen replace",e),e=e.replace(a[o.COMPARATORTRIM],c),n("comparator trim",e),e=e.replace(a[o.TILDETRIM],u),n("tilde trim",e),e=e.replace(a[o.CARETTRIM],l),n("caret trim",e);let _=e.split(" ").map((e=>m(e,this.options))).join(" ").split(/\s+/).map((e=>T(e,this.options)));f&&(_=_.filter((e=>(n("loose invalid filter",e,this.options),!!e.match(a[o.COMPARATORLOOSE]))))),n("range list",_);const b=new Map,y=_.map((e=>new s(e,this.options)));for(const e of y){if(h(e))return[e];b.set(e.value,e)}b.size>1&&b.has("")&&b.delete("");const v=[...b.values()];return t.set(r,v),v}intersects(t,r){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some((e=>g(e,r)&&t.set.some((t=>g(t,r)&&e.every((e=>t.every((t=>e.intersects(t,r)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new i(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(w(this.set[t],e,this.options))return!0;return!1}}range=e;const t=new(requireLruCache$2())({max:1e3}),r=requireParseOptions(),s=requireComparator(),n=requireDebug(),i=requireSemver$1(),{safeRe:a,t:o,comparatorTrimReplace:c,tildeTrimReplace:u,caretTrimReplace:l}=requireRe(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:d}=requireConstants$3(),h=e=>"<0.0.0-0"===e.value,f=e=>""===e.value,g=(e,t)=>{let r=!0;const s=e.slice();let n=s.pop();for(;r&&s.length;)r=s.every((e=>n.intersects(e,t))),n=s.pop();return r},m=(e,t)=>(n("comp",e,t),e=v(e,t),n("caret",e),e=b(e,t),n("tildes",e),e=q(e,t),n("xrange",e),e=R(e,t),n("stars",e),e),_=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map((e=>y(e,t))).join(" "),y=(e,t)=>{const r=t.loose?a[o.TILDELOOSE]:a[o.TILDE];return e.replace(r,((t,r,s,i,a)=>{let o;return n("tilde",e,t,r,s,i,a),_(r)?o="":_(s)?o=`>=${r}.0.0 <${+r+1}.0.0-0`:_(i)?o=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:a?(n("replaceTilde pr",a),o=`>=${r}.${s}.${i}-${a} <${r}.${+s+1}.0-0`):o=`>=${r}.${s}.${i} <${r}.${+s+1}.0-0`,n("tilde return",o),o}))},v=(e,t)=>e.trim().split(/\s+/).map((e=>S(e,t))).join(" "),S=(e,t)=>{n("caret",e,t);const r=t.loose?a[o.CARETLOOSE]:a[o.CARET],s=t.includePrerelease?"-0":"";return e.replace(r,((t,r,i,a,o)=>{let c;return n("caret",e,t,r,i,a,o),_(r)?c="":_(i)?c=`>=${r}.0.0${s} <${+r+1}.0.0-0`:_(a)?c="0"===r?`>=${r}.${i}.0${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${s} <${+r+1}.0.0-0`:o?(n("replaceCaret pr",o),c="0"===r?"0"===i?`>=${r}.${i}.${a}-${o} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}-${o} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a}-${o} <${+r+1}.0.0-0`):(n("no pr"),c="0"===r?"0"===i?`>=${r}.${i}.${a}${s} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a} <${+r+1}.0.0-0`),n("caret return",c),c}))},q=(e,t)=>(n("replaceXRanges",e,t),e.split(/\s+/).map((e=>E(e,t))).join(" ")),E=(e,t)=>{e=e.trim();const r=t.loose?a[o.XRANGELOOSE]:a[o.XRANGE];return e.replace(r,((r,s,i,a,o,c)=>{n("xRange",e,r,s,i,a,o,c);const u=_(i),l=u||_(a),p=l||_(o),d=p;return"="===s&&d&&(s=""),c=t.includePrerelease?"-0":"",u?r=">"===s||"<"===s?"<0.0.0-0":"*":s&&d?(l&&(a=0),o=0,">"===s?(s=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===s&&(s="<",l?i=+i+1:a=+a+1),"<"===s&&(c="-0"),r=`${s+i}.${a}.${o}${c}`):l?r=`>=${i}.0.0${c} <${+i+1}.0.0-0`:p&&(r=`>=${i}.${a}.0${c} <${i}.${+a+1}.0-0`),n("xRange return",r),r}))},R=(e,t)=>(n("replaceStars",e,t),e.trim().replace(a[o.STAR],"")),T=(e,t)=>(n("replaceGTE0",e,t),e.trim().replace(a[t.includePrerelease?o.GTE0PRE:o.GTE0],"")),A=e=>(t,r,s,n,i,a,o,c,u,l,p,d,h)=>`${r=_(s)?"":_(n)?`>=${s}.0.0${e?"-0":""}`:_(i)?`>=${s}.${n}.0${e?"-0":""}`:a?`>=${r}`:`>=${r}${e?"-0":""}`} ${c=_(u)?"":_(l)?`<${+u+1}.0.0-0`:_(p)?`<${u}.${+l+1}.0-0`:d?`<=${u}.${l}.${p}-${d}`:e?`<${u}.${l}.${+p+1}-0`:`<=${c}`}`.trim(),w=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(n(e[r].semver),e[r].semver!==s.ANY&&e[r].semver.prerelease.length>0){const s=e[r].semver;if(s.major===t.major&&s.minor===t.minor&&s.patch===t.patch)return!0}return!1}return!0};return range}function requireComparator(){if(hasRequiredComparator)return comparator;hasRequiredComparator=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(s,n){if(n=r(n),s instanceof t){if(s.loose===!!n.loose)return s;s=s.value}s=s.trim().split(/\s+/).join(" "),a("comparator",s,n),this.options=n,this.loose=!!n.loose,this.parse(s),this.semver===e?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(t){const r=this.options.loose?s[n.COMPARATORLOOSE]:s[n.COMPARATOR],i=t.match(r);if(!i)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==i[1]?i[1]:"","="===this.operator&&(this.operator=""),i[2]?this.semver=new o(i[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(a("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new o(t,this.options)}catch(e){return!1}return i(t,this.operator,this.semver,this.options)}intersects(e,s){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,s).test(this.value):""===e.operator?""===e.value||new c(this.value,s).test(e.semver):(!(s=r(s)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!s.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(i(this.semver,"<",e.semver,s)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(i(this.semver,">",e.semver,s)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}comparator=t;const r=requireParseOptions(),{safeRe:s,t:n}=requireRe(),i=requireCmp(),a=requireDebug(),o=requireSemver$1(),c=requireRange();return comparator}function requireSatisfies(){if(hasRequiredSatisfies)return satisfies_1;hasRequiredSatisfies=1;const e=requireRange();return satisfies_1=(t,r,s)=>{try{r=new e(r,s)}catch(e){return!1}return r.test(t)},satisfies_1}function requireToComparators(){if(hasRequiredToComparators)return toComparators_1;hasRequiredToComparators=1;const e=requireRange();return toComparators_1=(t,r)=>new e(t,r).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" "))),toComparators_1}function requireMaxSatisfying(){if(hasRequiredMaxSatisfying)return maxSatisfying_1;hasRequiredMaxSatisfying=1;const e=requireSemver$1(),t=requireRange();return maxSatisfying_1=(r,s,n)=>{let i=null,a=null,o=null;try{o=new t(s,n)}catch(e){return null}return r.forEach((t=>{o.test(t)&&(i&&-1!==a.compare(t)||(i=t,a=new e(i,n)))})),i},maxSatisfying_1}function requireMinSatisfying(){if(hasRequiredMinSatisfying)return minSatisfying_1;hasRequiredMinSatisfying=1;const e=requireSemver$1(),t=requireRange();return minSatisfying_1=(r,s,n)=>{let i=null,a=null,o=null;try{o=new t(s,n)}catch(e){return null}return r.forEach((t=>{o.test(t)&&(i&&1!==a.compare(t)||(i=t,a=new e(i,n)))})),i},minSatisfying_1}function requireMinVersion(){if(hasRequiredMinVersion)return minVersion_1;hasRequiredMinVersion=1;const e=requireSemver$1(),t=requireRange(),r=requireGt();return minVersion_1=(s,n)=>{s=new t(s,n);let i=new e("0.0.0");if(s.test(i))return i;if(i=new e("0.0.0-0"),s.test(i))return i;i=null;for(let t=0;t<s.set.length;++t){const n=s.set[t];let a=null;n.forEach((t=>{const s=new e(t.semver.version);switch(t.operator){case">":0===s.prerelease.length?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":a&&!r(s,a)||(a=s);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}})),!a||i&&!r(i,a)||(i=a)}return i&&s.test(i)?i:null},minVersion_1}function requireValid(){if(hasRequiredValid)return valid;hasRequiredValid=1;const e=requireRange();return valid=(t,r)=>{try{return new e(t,r).range||"*"}catch(e){return null}},valid}function requireOutside(){if(hasRequiredOutside)return outside_1;hasRequiredOutside=1;const e=requireSemver$1(),t=requireComparator(),{ANY:r}=t,s=requireRange(),n=requireSatisfies(),i=requireGt(),a=requireLt(),o=requireLte(),c=requireGte();return outside_1=(u,l,p,d)=>{let h,f,g,m,_;switch(u=new e(u,d),l=new s(l,d),p){case">":h=i,f=o,g=a,m=">",_=">=";break;case"<":h=a,f=c,g=i,m="<",_="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(n(u,l,d))return!1;for(let e=0;e<l.set.length;++e){const s=l.set[e];let n=null,i=null;if(s.forEach((e=>{e.semver===r&&(e=new t(">=0.0.0")),n=n||e,i=i||e,h(e.semver,n.semver,d)?n=e:g(e.semver,i.semver,d)&&(i=e)})),n.operator===m||n.operator===_)return!1;if((!i.operator||i.operator===m)&&f(u,i.semver))return!1;if(i.operator===_&&g(u,i.semver))return!1}return!0},outside_1}function requireGtr(){if(hasRequiredGtr)return gtr_1;hasRequiredGtr=1;const e=requireOutside();return gtr_1=(t,r,s)=>e(t,r,">",s),gtr_1}function requireLtr(){if(hasRequiredLtr)return ltr_1;hasRequiredLtr=1;const e=requireOutside();return ltr_1=(t,r,s)=>e(t,r,"<",s),ltr_1}function requireIntersects(){if(hasRequiredIntersects)return intersects_1;hasRequiredIntersects=1;const e=requireRange();return intersects_1=(t,r,s)=>(t=new e(t,s),r=new e(r,s),t.intersects(r,s))}function requireSimplify(){if(hasRequiredSimplify)return simplify;hasRequiredSimplify=1;const e=requireSatisfies(),t=requireCompare();return simplify=(r,s,n)=>{const i=[];let a=null,o=null;const c=r.sort(((e,r)=>t(e,r,n)));for(const t of c){e(t,s,n)?(o=t,a||(a=t)):(o&&i.push([a,o]),o=null,a=null)}a&&i.push([a,null]);const u=[];for(const[e,t]of i)e===t?u.push(e):t||e!==c[0]?t?e===c[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");const l=u.join(" || "),p="string"==typeof s.raw?s.raw:String(s);return l.length<p.length?l:s},simplify}function requireSubset(){if(hasRequiredSubset)return subset_1;hasRequiredSubset=1;const e=requireRange(),t=requireComparator(),{ANY:r}=t,s=requireSatisfies(),n=requireCompare(),i=[new t(">=0.0.0-0")],a=[new t(">=0.0.0")],o=(e,t,o)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===r){if(1===t.length&&t[0].semver===r)return!0;e=o.includePrerelease?i:a}if(1===t.length&&t[0].semver===r){if(o.includePrerelease)return!0;t=a}const l=new Set;let p,d,h,f,g,m,_;for(const t of e)">"===t.operator||">="===t.operator?p=c(p,t,o):"<"===t.operator||"<="===t.operator?d=u(d,t,o):l.add(t.semver);if(l.size>1)return null;if(p&&d){if(h=n(p.semver,d.semver,o),h>0)return null;if(0===h&&(">="!==p.operator||"<="!==d.operator))return null}for(const e of l){if(p&&!s(e,String(p),o))return null;if(d&&!s(e,String(d),o))return null;for(const r of t)if(!s(e,String(r),o))return!1;return!0}let b=!(!d||o.includePrerelease||!d.semver.prerelease.length)&&d.semver,y=!(!p||o.includePrerelease||!p.semver.prerelease.length)&&p.semver;b&&1===b.prerelease.length&&"<"===d.operator&&0===b.prerelease[0]&&(b=!1);for(const e of t){if(_=_||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,p)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),">"===e.operator||">="===e.operator){if(f=c(p,e,o),f===e&&f!==p)return!1}else if(">="===p.operator&&!s(p.semver,String(e),o))return!1;if(d)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if(g=u(d,e,o),g===e&&g!==d)return!1}else if("<="===d.operator&&!s(d.semver,String(e),o))return!1;if(!e.operator&&(d||p)&&0!==h)return!1}return!(p&&m&&!d&&0!==h)&&(!(d&&_&&!p&&0!==h)&&(!y&&!b))},c=(e,t,r)=>{if(!e)return t;const s=n(e.semver,t.semver,r);return s>0?e:s<0||">"===t.operator&&">="===e.operator?t:e},u=(e,t,r)=>{if(!e)return t;const s=n(e.semver,t.semver,r);return s<0?e:s>0||"<"===t.operator&&"<="===e.operator?t:e};return subset_1=(t,r,s={})=>{if(t===r)return!0;t=new e(t,s),r=new e(r,s);let n=!1;e:for(const e of t.set){for(const t of r.set){const r=o(e,t,s);if(n=n||null!==r,r)continue e}if(n)return!1}return!0}}function requireSemver(){if(hasRequiredSemver)return semver;hasRequiredSemver=1;const e=requireRe(),t=requireConstants$3(),r=requireSemver$1(),s=requireIdentifiers(),n=requireParse$2(),i=requireValid$1(),a=requireClean(),o=requireInc(),c=requireDiff(),u=requireMajor(),l=requireMinor(),p=requirePatch$1(),d=requirePrerelease(),h=requireCompare(),f=requireRcompare(),g=requireCompareLoose(),m=requireCompareBuild(),_=requireSort(),b=requireRsort(),y=requireGt(),v=requireLt(),S=requireEq(),q=requireNeq(),E=requireGte(),R=requireLte(),T=requireCmp(),A=requireCoerce(),w=requireComparator(),x=requireRange(),I=requireSatisfies(),C=requireToComparators(),O=requireMaxSatisfying(),$=requireMinSatisfying(),k=requireMinVersion(),P=requireValid(),N=requireOutside(),L=requireGtr(),M=requireLtr(),D=requireIntersects(),j=requireSimplify(),U=requireSubset();return semver={parse:n,valid:i,clean:a,inc:o,diff:c,major:u,minor:l,patch:p,prerelease:d,compare:h,rcompare:f,compareLoose:g,compareBuild:m,sort:_,rsort:b,gt:y,lt:v,eq:S,neq:q,gte:E,lte:R,cmp:T,coerce:A,Comparator:w,Range:x,satisfies:I,toComparators:C,maxSatisfying:O,minSatisfying:$,minVersion:k,validRange:P,outside:N,gtr:L,ltr:M,intersects:D,simplifyRange:j,subset:U,SemVer:r,re:e.re,src:e.src,tokens:e.t,SEMVER_SPEC_VERSION:t.SEMVER_SPEC_VERSION,RELEASE_TYPES:t.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}}var checks={},hasRequiredChecks,primordials,hasRequiredPrimordials$1,errors$1,hasRequiredErrors$1,acquireChannelRegistry,hasRequiredAcquireChannelRegistry,reimplementation,hasRequiredReimplementation,patchGarbageCollectionBug,hasRequiredPatchGarbageCollectionBug,patchTopSubscribeUnsubscribe,hasRequiredPatchTopSubscribeUnsubscribe,patchChannelUnsubscribeReturn,hasRequiredPatchChannelUnsubscribeReturn,patchChannelStoreMethods,hasRequiredPatchChannelStoreMethods,patchTracingChannel,hasRequiredPatchTracingChannel,patchSyncUnsubscribeBug,hasRequiredPatchSyncUnsubscribeBug,dcPolyfill,hasRequiredDcPolyfill,async_resource,hasRequiredAsync_resource,async_hooks,hasRequiredAsync_hooks,hasRequiredStorage$3,datadogCore,hasRequiredDatadogCore,span$2,hasRequiredSpan$2,tracer$4,hasRequiredTracer$3,noop,hasRequiredNoop;function requireChecks(){if(hasRequiredChecks)return checks;hasRequiredChecks=1;const[e,t,r]=process.versions.node.split(".").map(Number);function s(){return e>20||e>=20&&t>=6}function n(){return e>=16||15===e&&t>=1||14===e&&t>=17}return checks.MAJOR=e,checks.MINOR=t,checks.PATCH=r,checks.hasFullSupport=s,checks.hasTracingChannel=function(){return e>=20},checks.hasDiagnosticsChannel=n,checks.hasTopSubscribeUnsubscribe=function(){return e>=20||16===e&&t>=17||18===e&&t>=7},checks.hasGarbageCollectionBug=function(){return n()&&!s()},checks.hasZeroSubscribersBug=function(){return 19===e&&9===t},checks.hasChannelStoreMethods=function(){return e>=20||19===e&&t>=9},checks.hasChUnsubscribeReturn=function(){return e>=18||14===e&&t>=19||16===e&&t>=14||17===e&&t>=1},checks.hasSyncUnsubscribeBug=function(){return 20===e&&t<=5},checks}function requirePrimordials$1(){if(hasRequiredPrimordials$1)return primordials;hasRequiredPrimordials$1=1;const e=e=>(...t)=>e.call(...t);const t=Reflect.apply,r=Promise.reject.bind(Promise),s=Promise.resolve,n=e(Promise.prototype.then),i=e(Array.prototype.splice),a=e(Array.prototype.at||function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),o=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,p=Object.setPrototypeOf,d=Symbol.for;return primordials={ReflectApply:t,PromiseReject:r,PromiseResolve:s,PromisePrototypeThen:n,ArrayPrototypeSplice:i,ArrayPrototypeAt:a,ObjectDefineProperty:o,ObjectDefineProperties:c,ObjectGetOwnPropertyDescriptor:u,ObjectGetPrototypeOf:l,ObjectSetPrototypeOf:p,SymbolFor:d}}function requireErrors$1(){if(hasRequiredErrors$1)return errors$1;hasRequiredErrors$1=1;const e=require$$0$3,{ObjectDefineProperties:t}=requirePrimordials$1();class r extends TypeError{constructor(r,s){if(super(),null==s)r+=`. Received ${s}`;else if("function"==typeof s&&s.name)r+=`. Received function ${s.name}`;else if("object"==typeof s)if(s.constructor&&s.constructor.name)r+=`. Received an instance of ${s.constructor.name}`;else{r+=`. Received ${e.inspect(s,{depth:-1})}`}else{let t=e.inspect(s,{colors:!1});t.length>25&&(t=`${t.slice(0,25)}...`),r+=`. Received type ${typeof s} (${t})`}this.code=this.constructor.name,t(this,{message:{value:r,enumerable:!1,writable:!0,configurable:!0},toString:{value(){return`${this.name} [${this.code}]: ${this.message}`},enumerable:!1,writable:!0,configurable:!0}})}}return errors$1={ERR_INVALID_ARG_TYPE:r}}function requireAcquireChannelRegistry(){if(hasRequiredAcquireChannelRegistry)return acquireChannelRegistry;hasRequiredAcquireChannelRegistry=1;const{ObjectDefineProperty:e,SymbolFor:t}=requirePrimordials$1(),r=t("dc-polyfill-v1");return process[r]||e(process,r,{configurable:!1,enumerable:!1,writable:!1,value:{}}),acquireChannelRegistry=process[r]}function requireReimplementation(){if(hasRequiredReimplementation)return reimplementation;hasRequiredReimplementation=1;const{ObjectSetPrototypeOf:e,ObjectGetPrototypeOf:t}=requirePrimordials$1(),{ERR_INVALID_ARG_TYPE:r}=requireErrors$1(),s=requireAcquireChannelRegistry();class n{subscribe(e){if("function"!=typeof e)throw new r('The "subscription" argument must be of type function',e);this._subscribers.push(e)}unsubscribe(t){const r=this._subscribers.indexOf(t);return-1!==r&&(this._subscribers.splice(r,1),this._subscribers.length||e(this,i.prototype),!0)}get hasSubscribers(){return!0}publish(e){for(let t=0;t<this._subscribers.length;t++)try{(0,this._subscribers[t])(e,this.name)}catch(e){process.nextTick((()=>{throw e}))}}}class i{constructor(e){this._subscribers=void 0,this.name=e}static[Symbol.hasInstance](e){const r=t(e);return r===i.prototype||r===n.prototype}subscribe(t){e(this,n.prototype),this._subscribers=[],this.subscribe(t)}unsubscribe(){return!1}get hasSubscribers(){return!1}publish(){}}return reimplementation={channel:function(e){const t=s[e];if(t)return t;if("string"!=typeof e&&"symbol"!=typeof e)throw new r('The "channel" argument must be one of type string or symbol',e);return s[e]=new i(e)},hasSubscribers:function(e){const t=s[e];return!!t&&t.hasSubscribers},Channel:i,deleteChannel:function(e){return!!s[e]&&(s[e]=null,!0)}},reimplementation}function requirePatchGarbageCollectionBug(){if(hasRequiredPatchGarbageCollectionBug)return patchGarbageCollectionBug;hasRequiredPatchGarbageCollectionBug=1;const e=function(){},{ObjectDefineProperty:t,ObjectGetOwnPropertyDescriptor:r}=requirePrimordials$1();return patchGarbageCollectionBug=function(s){const n=s.channel,i=new WeakSet,a={...s};return a.channel=function(){const s=n.apply(this,arguments);return i.has(s)||(n(arguments[0]).subscribe(e),i.add(s),r(s,"hasSubscribers")||t(s,"hasSubscribers",{get:function(){const t=s._subscribers;return t.length>1||!(t.length<1)&&t[0]!==e}})),s},a},patchGarbageCollectionBug}function requirePatchTopSubscribeUnsubscribe(){return hasRequiredPatchTopSubscribeUnsubscribe?patchTopSubscribeUnsubscribe:(hasRequiredPatchTopSubscribeUnsubscribe=1,patchTopSubscribeUnsubscribe=function(e){const t={...e};return t.subscribe=(e,r)=>t.channel(e).subscribe(r),t.unsubscribe=(e,r)=>t.channel(e).unsubscribe(r),t})}function requirePatchChannelUnsubscribeReturn(){if(hasRequiredPatchChannelUnsubscribeReturn)return patchChannelUnsubscribeReturn;hasRequiredPatchChannelUnsubscribeReturn=1;const{ObjectGetPrototypeOf:e}=requirePrimordials$1();return patchChannelUnsubscribeReturn=function(t){const r=new WeakSet,s=t.channel;t.Channel;const n={...t};return n.channel=function(){const t=s.apply(this,arguments);return r.has(t)||(t.unsubscribe=function(){delete t.unsubscribe;const r=this._subscribers.length;return e(t).unsubscribe.apply(this,arguments),this._subscribers.length<r},r.add(t)),t},n},patchChannelUnsubscribeReturn}function requirePatchChannelStoreMethods(){if(hasRequiredPatchChannelStoreMethods)return patchChannelStoreMethods;hasRequiredPatchChannelStoreMethods=1;const{ReflectApply:e}=requirePrimordials$1();function t(e,t,s,n=r){return()=>{let r;try{r=n(t)}catch(e){return process.nextTick((()=>{throw e})),s()}return e.run(r,s)}}function r(e){return e}return patchChannelStoreMethods=function(r){const s=new WeakSet,n=r.channel,i={...r};return i.channel=function(){const r=n.apply(this,arguments);return s.has(r)||(r._stores=new Map,r.bindStore=function(e,t){this._stores.set(e,t)},r.unbindStore=function(e){return!!this._stores.has(e)&&(this._stores.delete(e),!0)},r.runStores=function(r,s,n,...i){let a=()=>(this.publish(r),e(s,n,i));for(const e of this._stores.entries()){const s=e[0],n=e[1];a=t(s,r,a,n)}return a()}),r},i},patchChannelStoreMethods}function requirePatchTracingChannel(){if(hasRequiredPatchTracingChannel)return patchTracingChannel;hasRequiredPatchTracingChannel=1;const{ReflectApply:e,PromiseReject:t,PromiseResolve:r,PromisePrototypeThen:s,ArrayPrototypeSplice:n,ArrayPrototypeAt:i}=requirePrimordials$1(),{ERR_INVALID_ARG_TYPE:a}=requireErrors$1(),o=["start","end","asyncStart","asyncEnd","error"];return patchTracingChannel=function(c){const{channel:u}=c,l={...c};class p{constructor(e){if("string"==typeof e)this.start=u(`tracing:${e}:start`),this.end=u(`tracing:${e}:end`),this.asyncStart=u(`tracing:${e}:asyncStart`),this.asyncEnd=u(`tracing:${e}:asyncEnd`),this.error=u(`tracing:${e}:error`);else{if("object"!=typeof e)throw new a("nameOrChannels",["string","object","Channel"],e);{const{start:t,end:r,asyncStart:s,asyncEnd:n,error:i}=e;this.start=t,this.end=r,this.asyncStart=s,this.asyncEnd=n,this.error=i}}}subscribe(e){for(const t of o)e[t]&&this[t]&&this[t].subscribe(e[t])}unsubscribe(e){let t=!0;for(const r of o)e[r]&&(this[r]&&this[r].unsubscribe(e[r])||(t=!1));return t}traceSync(t,r={},s,...n){const{start:i,end:a,error:o}=this;return i.runStores(r,(()=>{try{const i=e(t,s,n);return r.result=i,i}catch(e){throw r.error=e,o.publish(r),e}finally{a.publish(r)}}))}tracePromise(n,i={},a,...o){const{start:c,end:u,asyncStart:l,asyncEnd:p,error:d}=this;function h(e){return i.error=e,d.publish(i),l.publish(i),p.publish(i),t(e)}function f(e){return i.result=e,l.publish(i),p.publish(i),e}return c.runStores(i,(()=>{try{let t=e(n,a,o);return t instanceof Promise||(t=r(t)),s(t,f,h)}catch(e){throw i.error=e,d.publish(i),e}finally{u.publish(i)}}))}traceCallback(t,r=-1,s={},o,...c){const{start:u,end:l,asyncStart:p,asyncEnd:d,error:h}=this;const f=i(c,r);if("function"!=typeof f)throw new a("callback",["function"],f);return n(c,r,1,(function(t,r){t?(s.error=t,h.publish(s)):s.result=r,p.runStores(s,(()=>{try{if(f)return e(f,this,arguments)}finally{d.publish(s)}}))})),u.runStores(s,(()=>{try{return e(t,o,c)}catch(e){throw s.error=e,h.publish(s),e}finally{l.publish(s)}}))}}return l.tracingChannel=function(e){return new p(e)},l},patchTracingChannel}function requirePatchSyncUnsubscribeBug(){return hasRequiredPatchSyncUnsubscribeBug||(hasRequiredPatchSyncUnsubscribeBug=1,patchSyncUnsubscribeBug=function(e){const t=new WeakSet,r=e.channel,s={...e};return s.channel=function(){const e=r.apply(this,arguments);if(t.has(e))return e;const s=e.publish;return e.publish=function(){return e._subscribers||(e._subscribers=[]),s.apply(e,arguments)},e},s}),patchSyncUnsubscribeBug}function requireDcPolyfill(){if(hasRequiredDcPolyfill)return dcPolyfill;hasRequiredDcPolyfill=1;const e=requireChecks();requirePrimordials$1();let t=e.hasDiagnosticsChannel()?require$$2:requireReimplementation();return e.hasGarbageCollectionBug()&&(t=requirePatchGarbageCollectionBug()(t)),e.hasTopSubscribeUnsubscribe()||(t=requirePatchTopSubscribeUnsubscribe()(t)),e.hasChUnsubscribeReturn()||(t=requirePatchChannelUnsubscribeReturn()(t)),e.hasChannelStoreMethods()||(t=requirePatchChannelStoreMethods()(t)),e.hasTracingChannel()||(t=requirePatchTracingChannel()(t)),e.hasSyncUnsubscribeBug()&&(t=requirePatchSyncUnsubscribeBug()(t)),dcPolyfill=t}function requireAsync_resource(){if(hasRequiredAsync_resource)return async_resource;hasRequiredAsync_resource=1;const{createHook:e,executionAsyncResource:t}=require$$0$4,{channel:r}=requireDcPolyfill(),s=r("dd-trace:storage:before"),n=r("dd-trace:storage:after"),i=r("dd-trace:storage:enter");let a=Symbol;function o(){a=new Function("name","return %CreatePrivateSymbol(name)")}try{o()}catch(e){try{const e=require("v8");e.setFlagsFromString("--allow-natives-syntax"),o(),e.setFlagsFromString("--no-allow-natives-syntax")}catch(e){}}return async_resource=class{constructor(){this._ddResourceStore=a("ddResourceStore"),this._enabled=!1,this._hook=e(this._createHook())}disable(){this._enabled&&(this._hook.disable(),this._enabled=!1)}getStore(){if(!this._enabled)return;return this._executionAsyncResource()[this._ddResourceStore]}enterWith(e){this._enable();this._executionAsyncResource()[this._ddResourceStore]=e,i.publish()}run(e,t,...r){this._enable();const s=this._executionAsyncResource(),n=s[this._ddResourceStore];s[this._ddResourceStore]=e,i.publish();try{return t(...r)}finally{s[this._ddResourceStore]=n,i.publish()}}_createHook(){return{init:this._init.bind(this),before(){s.publish()},after(){n.publish()}}}_enable(){this._enabled||(this._enabled=!0,this._hook.enable())}_init(e,t,r,s){const n=this._executionAsyncResource();Object.prototype.hasOwnProperty.call(n,this._ddResourceStore)&&(s[this._ddResourceStore]=n[this._ddResourceStore])}_executionAsyncResource(){return t()||{}}},async_resource}function requireAsync_hooks(){if(hasRequiredAsync_hooks)return async_hooks;hasRequiredAsync_hooks=1;const{executionAsyncId:e}=require$$0$4,t=requireAsync_resource();return async_hooks=class extends t{constructor(){super(),this._resources=new Map}disable(){super.disable(),this._resources.clear()}_createHook(){return{...super._createHook(),destroy:this._destroy.bind(this)}}_init(e,t,r,s){super._init.apply(this,arguments),this._resources.set(e,s)}_destroy(e){this._resources.delete(e)}_executionAsyncResource(){const t=e();let r=this._resources.get(t);return r||this._resources.set(t,r={}),r}},async_hooks}function requireStorage$3(){if(hasRequiredStorage$3)return storage$1.exports;hasRequiredStorage$3=1;const e=requireSemver().satisfies(process.versions.node,">=14.5");return storage$1.exports=e?requireAsync_resource():requireAsync_hooks(),storage$1.exports}function requireDatadogCore(){if(hasRequiredDatadogCore)return datadogCore;hasRequiredDatadogCore=1;const e=new(requireStorage$3());return datadogCore={storage:e}}function requireSpan$2(){if(hasRequiredSpan$2)return span$2;hasRequiredSpan$2=1;const e=requireSpan_context$1(),t=requireId(),{storage:r}=requireDatadogCore();return span$2=class{constructor(e,t){this._store=r.getStore(),this._noopTracer=e,this._noopContext=this._createContext(t)}context(){return this._noopContext}tracer(){return this._noopTracer}setOperationName(e){return this}setBaggageItem(e,t){return this}getBaggageItem(e){}setTag(e,t){return this}addTags(e){return this}addLink(e){return this}log(){return this}logEvent(){}finish(e){}_createContext(r){const s=t();return new e(r?{noop:this,traceId:r._traceId,spanId:s,parentId:r._spanId,baggageItems:Object.assign({},r._baggageItems)}:{noop:this,traceId:s,spanId:s})}},span$2}function requireTracer$3(){if(hasRequiredTracer$3)return tracer$4;hasRequiredTracer$3=1;const e=requireScope$1(),t=requireSpan$2();return tracer$4=class{constructor(r){this._scope=new e,this._span=new t(this)}configure(e){}trace(e,t,r){return r(this._span,(()=>{}))}wrap(e,t,r){return r}scope(){return this._scope}getRumData(){return""}setUrl(){}startSpan(e,t){return this._span}inject(e,t,r){}extract(e,t){return this._span.context()}setUser(){return this}}}function requireNoop(){if(hasRequiredNoop)return noop;hasRequiredNoop=1;return noop=class{trackUserLoginSuccessEvent(){}trackUserLoginFailureEvent(){}trackCustomEvent(){}isUserBlocked(){}blockRequest(){}setUser(){}}}var _globalThis$2="object"==typeof globalThis?globalThis:global,VERSION$2="1.7.0",re=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function _makeCompatibilityCheck(e){var t=new Set([e]),r=new Set,s=e.match(re);if(!s)return function(){return!1};var n=+s[1],i=+s[2],a=+s[3];if(null!=s[4])return function(t){return t===e};function o(e){return r.add(e),!1}function c(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;var s=e.match(re);if(!s)return o(e);var u=+s[1],l=+s[2],p=+s[3];return null!=s[4]||n!==u?o(e):0===n?i===l&&a<=p?c(e):o(e):i<=l?c(e):o(e)}}var isCompatible=_makeCompatibilityCheck(VERSION$2),major=VERSION$2.split(".")[0],GLOBAL_OPENTELEMETRY_API_KEY=Symbol.for("opentelemetry.js.api."+major),_global=_globalThis$2;function registerGlobal(e,t,r,s){var n;void 0===s&&(s=!1);var i=_global[GLOBAL_OPENTELEMETRY_API_KEY]=null!==(n=_global[GLOBAL_OPENTELEMETRY_API_KEY])&&void 0!==n?n:{version:VERSION$2};if(!s&&i[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(a.stack||a.message),!1}if(i.version!==VERSION$2){a=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+e+" does not match previously registered API v"+VERSION$2);return r.error(a.stack||a.message),!1}return i[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+VERSION$2+"."),!0}function getGlobal(e){var t,r,s=null===(t=_global[GLOBAL_OPENTELEMETRY_API_KEY])||void 0===t?void 0:t.version;if(s&&isCompatible(s))return null===(r=_global[GLOBAL_OPENTELEMETRY_API_KEY])||void 0===r?void 0:r[e]}function unregisterGlobal(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+VERSION$2+".");var r=_global[GLOBAL_OPENTELEMETRY_API_KEY];r&&delete r[e]}var __read$7=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},__spreadArray$4=function(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},DiagComponentLogger=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return logProxy("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return logProxy("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return logProxy("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return logProxy("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return logProxy("verbose",this._namespace,e)},e}(),DiagLogLevel;function logProxy(e,t,r){var s=getGlobal("diag");if(s)return r.unshift(t),s[e].apply(s,__spreadArray$4([],__read$7(r),!1))}function createLogLevelDiagLogger(e,t){function r(r,s){var n=t[r];return"function"==typeof n&&e>=s?n.bind(t):function(){}}return e<DiagLogLevel.NONE?e=DiagLogLevel.NONE:e>DiagLogLevel.ALL&&(e=DiagLogLevel.ALL),t=t||{},{error:r("error",DiagLogLevel.ERROR),warn:r("warn",DiagLogLevel.WARN),info:r("info",DiagLogLevel.INFO),debug:r("debug",DiagLogLevel.DEBUG),verbose:r("verbose",DiagLogLevel.VERBOSE)}}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(DiagLogLevel||(DiagLogLevel={}));var __read$6=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},__spreadArray$3=function(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},API_NAME$4="diag",DiagAPI=function(){function e(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var s=getGlobal("diag");if(s)return s[e].apply(s,__spreadArray$3([],__read$6(t),!1))}}var t=this;t.setLogger=function(e,r){var s,n,i;if(void 0===r&&(r={logLevel:DiagLogLevel.INFO}),e===t){var a=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(s=a.stack)&&void 0!==s?s:a.message),!1}"number"==typeof r&&(r={logLevel:r});var o=getGlobal("diag"),c=createLogLevelDiagLogger(null!==(n=r.logLevel)&&void 0!==n?n:DiagLogLevel.INFO,e);if(o&&!r.suppressOverrideMessage){var u=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";o.warn("Current logger will be overwritten from "+u),c.warn("Current logger will overwrite one already registered from "+u)}return registerGlobal("diag",c,t,!0)},t.disable=function(){unregisterGlobal(API_NAME$4,t)},t.createComponentLogger=function(e){return new DiagComponentLogger(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),__read$5=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},__values$3=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},BaggageImpl=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=__read$5(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,r){var s=new e(this._entries);return s._entries.set(t,r),s},e.prototype.removeEntry=function(t){var r=new e(this._entries);return r._entries.delete(t),r},e.prototype.removeEntries=function(){for(var t,r,s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];var i=new e(this._entries);try{for(var a=__values$3(s),o=a.next();!o.done;o=a.next()){var c=o.value;i._entries.delete(c)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return i},e.prototype.clear=function(){return new e},e}(),baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata"),diag$1=DiagAPI.instance();function createBaggage(e){return void 0===e&&(e={}),new BaggageImpl(new Map(Object.entries(e)))}function baggageEntryMetadataFromString(e){return"string"!=typeof e&&(diag$1.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:baggageEntryMetadataSymbol,toString:function(){return e}}}function createContextKey(e){return Symbol.for(e)}var BaseContext=function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(e){return r._currentContext.get(e)},r.setValue=function(t,s){var n=new e(r._currentContext);return n._currentContext.set(t,s),n},r.deleteValue=function(t){var s=new e(r._currentContext);return s._currentContext.delete(t),s}},ROOT_CONTEXT=new BaseContext,consoleMap=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],DiagConsoleLogger=function(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(console){var s=console[e];if("function"!=typeof s&&(s=console.log),"function"==typeof s)return s.apply(console,t)}}}for(var t=0;t<consoleMap.length;t++)this[consoleMap[t].n]=e(consoleMap[t].c)},__extends$1=(extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),extendStatics,NoopMeter=function(){function e(){}return e.prototype.createHistogram=function(e,t){return NOOP_HISTOGRAM_METRIC},e.prototype.createCounter=function(e,t){return NOOP_COUNTER_METRIC},e.prototype.createUpDownCounter=function(e,t){return NOOP_UP_DOWN_COUNTER_METRIC},e.prototype.createObservableGauge=function(e,t){return NOOP_OBSERVABLE_GAUGE_METRIC},e.prototype.createObservableCounter=function(e,t){return NOOP_OBSERVABLE_COUNTER_METRIC},e.prototype.createObservableUpDownCounter=function(e,t){return NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),NoopMetric=function(){},NoopCounterMetric=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t.prototype.add=function(e,t){},t}(NoopMetric),NoopUpDownCounterMetric=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t.prototype.add=function(e,t){},t}(NoopMetric),NoopHistogramMetric=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t.prototype.record=function(e,t){},t}(NoopMetric),NoopObservableMetric=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),NoopObservableCounterMetric=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t}(NoopObservableMetric),NoopObservableGaugeMetric=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t}(NoopObservableMetric),NoopObservableUpDownCounterMetric=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t}(NoopObservableMetric),NOOP_METER=new NoopMeter,NOOP_COUNTER_METRIC=new NoopCounterMetric,NOOP_HISTOGRAM_METRIC=new NoopHistogramMetric,NOOP_UP_DOWN_COUNTER_METRIC=new NoopUpDownCounterMetric,NOOP_OBSERVABLE_COUNTER_METRIC=new NoopObservableCounterMetric,NOOP_OBSERVABLE_GAUGE_METRIC=new NoopObservableGaugeMetric,NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new NoopObservableUpDownCounterMetric,ValueType;function createNoopMeter(){return NOOP_METER}!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(ValueType||(ValueType={}));var defaultTextMapGetter={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},defaultTextMapSetter={set:function(e,t,r){null!=e&&(e[t]=r)}},__read$4=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},__spreadArray$2=function(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},NoopContextManager=function(){function e(){}return e.prototype.active=function(){return ROOT_CONTEXT},e.prototype.with=function(e,t,r){for(var s=[],n=3;n<arguments.length;n++)s[n-3]=arguments[n];return t.call.apply(t,__spreadArray$2([r],__read$4(s),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),__read$3=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},__spreadArray$1=function(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},API_NAME$3="context",NOOP_CONTEXT_MANAGER=new NoopContextManager,ContextAPI=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return registerGlobal(API_NAME$3,e,DiagAPI.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,r){for(var s,n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];return(s=this._getContextManager()).with.apply(s,__spreadArray$1([e,t,r],__read$3(n),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return getGlobal(API_NAME$3)||NOOP_CONTEXT_MANAGER},e.prototype.disable=function(){this._getContextManager().disable(),unregisterGlobal(API_NAME$3,DiagAPI.instance())},e}(),TraceFlags;!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(TraceFlags||(TraceFlags={}));var INVALID_SPANID="0000000000000000",INVALID_TRACEID="00000000000000000000000000000000",INVALID_SPAN_CONTEXT={traceId:INVALID_TRACEID,spanId:INVALID_SPANID,traceFlags:TraceFlags.NONE},NonRecordingSpan=function(){function e(e){void 0===e&&(e=INVALID_SPAN_CONTEXT),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),SPAN_KEY=createContextKey("OpenTelemetry Context Key SPAN");function getSpan(e){return e.getValue(SPAN_KEY)||void 0}function getActiveSpan(){return getSpan(ContextAPI.getInstance().active())}function setSpan(e,t){return e.setValue(SPAN_KEY,t)}function deleteSpan(e){return e.deleteValue(SPAN_KEY)}function setSpanContext(e,t){return setSpan(e,new NonRecordingSpan(t))}function getSpanContext(e){var t;return null===(t=getSpan(e))||void 0===t?void 0:t.spanContext()}var VALID_TRACEID_REGEX=/^([0-9a-f]{32})$/i,VALID_SPANID_REGEX=/^[0-9a-f]{16}$/i;function isValidTraceId(e){return VALID_TRACEID_REGEX.test(e)&&e!==INVALID_TRACEID}function isValidSpanId(e){return VALID_SPANID_REGEX.test(e)&&e!==INVALID_SPANID}function isSpanContextValid(e){return isValidTraceId(e.traceId)&&isValidSpanId(e.spanId)}function wrapSpanContext(e){return new NonRecordingSpan(e)}var contextApi=ContextAPI.getInstance(),NoopTracer=function(){function e(){}return e.prototype.startSpan=function(e,t,r){if(void 0===r&&(r=contextApi.active()),Boolean(null==t?void 0:t.root))return new NonRecordingSpan;var s=r&&getSpanContext(r);return isSpanContext(s)&&isSpanContextValid(s)?new NonRecordingSpan(s):new NonRecordingSpan},e.prototype.startActiveSpan=function(e,t,r,s){var n,i,a;if(!(arguments.length<2)){2===arguments.length?a=t:3===arguments.length?(n=t,a=r):(n=t,i=r,a=s);var o=null!=i?i:contextApi.active(),c=this.startSpan(e,n,o),u=setSpan(o,c);return contextApi.with(u,a,void 0,c)}},e}();function isSpanContext(e){return"object"==typeof e&&"string"==typeof e.spanId&&"string"==typeof e.traceId&&"number"==typeof e.traceFlags}var NOOP_TRACER=new NoopTracer,ProxyTracer=function(){function e(e,t,r,s){this._provider=e,this.name=t,this.version=r,this.options=s}return e.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},e.prototype.startActiveSpan=function(e,t,r,s){var n=this._getTracer();return Reflect.apply(n.startActiveSpan,n,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):NOOP_TRACER},e}(),NoopTracerProvider=function(){function e(){}return e.prototype.getTracer=function(e,t,r){return new NoopTracer},e}(),NOOP_TRACER_PROVIDER=new NoopTracerProvider,ProxyTracerProvider=function(){function e(){}return e.prototype.getTracer=function(e,t,r){var s;return null!==(s=this.getDelegateTracer(e,t,r))&&void 0!==s?s:new ProxyTracer(this,e,t,r)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:NOOP_TRACER_PROVIDER},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,r){var s;return null===(s=this._delegate)||void 0===s?void 0:s.getTracer(e,t,r)},e}(),SamplingDecision,SpanKind,SpanStatusCode;!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(SamplingDecision||(SamplingDecision={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(SpanKind||(SpanKind={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(SpanStatusCode||(SpanStatusCode={}));var VALID_KEY_CHAR_RANGE$1="[_0-9a-z-*/]",VALID_KEY$1="[a-z]"+VALID_KEY_CHAR_RANGE$1+"{0,255}",VALID_VENDOR_KEY$1="[a-z0-9]"+VALID_KEY_CHAR_RANGE$1+"{0,240}@[a-z]"+VALID_KEY_CHAR_RANGE$1+"{0,13}",VALID_KEY_REGEX$1=new RegExp("^(?:"+VALID_KEY$1+"|"+VALID_VENDOR_KEY$1+")$"),VALID_VALUE_BASE_REGEX$1=/^[ -~]{0,255}[!-~]$/,INVALID_VALUE_COMMA_EQUAL_REGEX$1=/,|=/;function validateKey$1(e){return VALID_KEY_REGEX$1.test(e)}function validateValue$1(e){return VALID_VALUE_BASE_REGEX$1.test(e)&&!INVALID_VALUE_COMMA_EQUAL_REGEX$1.test(e)}var MAX_TRACE_STATE_ITEMS$1=32,MAX_TRACE_STATE_LEN$1=512,LIST_MEMBERS_SEPARATOR$1=",",LIST_MEMBER_KEY_VALUE_SPLITTER$1="=",TraceStateImpl=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,r){return t.push(r+LIST_MEMBER_KEY_VALUE_SPLITTER$1+e.get(r)),t}),[]).join(LIST_MEMBERS_SEPARATOR$1)},e.prototype._parse=function(e){e.length>MAX_TRACE_STATE_LEN$1||(this._internalState=e.split(LIST_MEMBERS_SEPARATOR$1).reverse().reduce((function(e,t){var r=t.trim(),s=r.indexOf(LIST_MEMBER_KEY_VALUE_SPLITTER$1);if(-1!==s){var n=r.slice(0,s),i=r.slice(s+1,t.length);validateKey$1(n)&&validateValue$1(i)&&e.set(n,i)}return e}),new Map),this._internalState.size>MAX_TRACE_STATE_ITEMS$1&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,MAX_TRACE_STATE_ITEMS$1))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();function createTraceState(e){return new TraceStateImpl(e)}var context=ContextAPI.getInstance(),diag=DiagAPI.instance(),NoopMeterProvider=function(){function e(){}return e.prototype.getMeter=function(e,t,r){return NOOP_METER},e}(),NOOP_METER_PROVIDER=new NoopMeterProvider,API_NAME$2="metrics",MetricsAPI=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return registerGlobal(API_NAME$2,e,DiagAPI.instance())},e.prototype.getMeterProvider=function(){return getGlobal(API_NAME$2)||NOOP_METER_PROVIDER},e.prototype.getMeter=function(e,t,r){return this.getMeterProvider().getMeter(e,t,r)},e.prototype.disable=function(){unregisterGlobal(API_NAME$2,DiagAPI.instance())},e}(),metrics$2=MetricsAPI.getInstance(),NoopTextMapPropagator=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),BAGGAGE_KEY=createContextKey("OpenTelemetry Baggage Key");function getBaggage(e){return e.getValue(BAGGAGE_KEY)||void 0}function getActiveBaggage(){return getBaggage(ContextAPI.getInstance().active())}function setBaggage(e,t){return e.setValue(BAGGAGE_KEY,t)}function deleteBaggage(e){return e.deleteValue(BAGGAGE_KEY)}var API_NAME$1="propagation",NOOP_TEXT_MAP_PROPAGATOR=new NoopTextMapPropagator,PropagationAPI=function(){function e(){this.createBaggage=createBaggage,this.getBaggage=getBaggage,this.getActiveBaggage=getActiveBaggage,this.setBaggage=setBaggage,this.deleteBaggage=deleteBaggage}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return registerGlobal(API_NAME$1,e,DiagAPI.instance())},e.prototype.inject=function(e,t,r){return void 0===r&&(r=defaultTextMapSetter),this._getGlobalPropagator().inject(e,t,r)},e.prototype.extract=function(e,t,r){return void 0===r&&(r=defaultTextMapGetter),this._getGlobalPropagator().extract(e,t,r)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){unregisterGlobal(API_NAME$1,DiagAPI.instance())},e.prototype._getGlobalPropagator=function(){return getGlobal(API_NAME$1)||NOOP_TEXT_MAP_PROPAGATOR},e}(),propagation=PropagationAPI.getInstance(),API_NAME="trace",TraceAPI=function(){function e(){this._proxyTracerProvider=new ProxyTracerProvider,this.wrapSpanContext=wrapSpanContext,this.isSpanContextValid=isSpanContextValid,this.deleteSpan=deleteSpan,this.getSpan=getSpan,this.getActiveSpan=getActiveSpan,this.getSpanContext=getSpanContext,this.setSpan=setSpan,this.setSpanContext=setSpanContext}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=registerGlobal(API_NAME,this._proxyTracerProvider,DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return getGlobal(API_NAME)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){unregisterGlobal(API_NAME,DiagAPI.instance()),this._proxyTracerProvider=new ProxyTracerProvider},e}(),trace=TraceAPI.getInstance(),index={context:context,diag:diag,metrics:metrics$2,propagation:propagation,trace:trace},esm$1=Object.freeze({__proto__:null,DiagConsoleLogger:DiagConsoleLogger,get DiagLogLevel(){return DiagLogLevel},INVALID_SPANID:INVALID_SPANID,INVALID_SPAN_CONTEXT:INVALID_SPAN_CONTEXT,INVALID_TRACEID:INVALID_TRACEID,ProxyTracer:ProxyTracer,ProxyTracerProvider:ProxyTracerProvider,ROOT_CONTEXT:ROOT_CONTEXT,get SamplingDecision(){return SamplingDecision},get SpanKind(){return SpanKind},get SpanStatusCode(){return SpanStatusCode},get TraceFlags(){return TraceFlags},get ValueType(){return ValueType},baggageEntryMetadataFromString:baggageEntryMetadataFromString,context:context,createContextKey:createContextKey,createNoopMeter:createNoopMeter,createTraceState:createTraceState,default:index,defaultTextMapGetter:defaultTextMapGetter,defaultTextMapSetter:defaultTextMapSetter,diag:diag,isSpanContextValid:isSpanContextValid,isValidSpanId:isValidSpanId,isValidTraceId:isValidTraceId,metrics:metrics$2,propagation:propagation,trace:trace}),require$$0=getAugmentedNamespace(esm$1),span_context,hasRequiredSpan_context,context_manager,hasRequiredContext_manager,span_processor$1,hasRequiredSpan_processor$1;function requireSpan_context(){if(hasRequiredSpan_context)return span_context;hasRequiredSpan_context=1;const e=require$$0,{AUTO_KEEP:t}=requirePriority(),r=requireSpan_context$2(),s=requireId();return span_context=class{constructor(e){e instanceof r||(e=e?new r(e):function(){const e=s();return new r({traceId:e,spanId:e})}()),this._ddContext=e}get traceId(){return this._ddContext._traceId.toString(16)}get spanId(){return this._ddContext._spanId.toString(16)}get traceFlags(){return this._ddContext._sampling.priority>=t?1:0}get traceState(){const t=this._ddContext._tracestate;return e.createTraceState(t?t.toString():"")}},span_context}function requireContext_manager(){if(hasRequiredContext_manager)return context_manager;hasRequiredContext_manager=1;const{AsyncLocalStorage:e}=require$$0$4,{trace:t,ROOT_CONTEXT:r}=require$$0,s=requireSpan_context(),n=requireDdTrace();let i;t.getSpan({getValue(e){i=e}});return context_manager=class{constructor(){this._store=new e}active(){const e=this._store.getStore()||r;return new Proxy(e,{get:(e,t)=>"getValue"===t?function(e){return t=>t===i?{spanContext(){const e=n.scope().active(),t=e&&e.context();return new s(t)}}:e.getValue(t)}(e):e[t]})}with(e,r,s,...i){const a=t.getSpan(e);return n.scope().activate(a._ddSpan,(()=>{const t=null==s?r:r.bind(s);return this._store.run(e,t,...i)}))}bind(e,t){const r=this;return function(...s){return r.with(e,t,this,...s)}}enable(){}disable(){}},context_manager}function requireSpan_processor$1(){if(hasRequiredSpan_processor$1)return span_processor$1;hasRequiredSpan_processor$1=1;class e{forceFlush(){return Promise.resolve()}onStart(e,t){}onEnd(e){}shutdown(){return Promise.resolve()}}return span_processor$1={MultiSpanProcessor:class extends e{constructor(e){super(),this._processors=e}forceFlush(){return Promise.all(this._processors.map((e=>e.forceFlush())))}onStart(e,t){for(const r of this._processors)r.onStart(e,t)}onEnd(e){for(const t of this._processors)t.onEnd(e)}shutdown(){return Promise.all(this._processors.map((e=>e.shutdown())))}},NoopSpanProcessor:e},span_processor$1}var SUPPRESS_TRACING_KEY=createContextKey("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function suppressTracing(e){return e.setValue(SUPPRESS_TRACING_KEY,!0)}function unsuppressTracing(e){return e.deleteValue(SUPPRESS_TRACING_KEY)}function isTracingSuppressed(e){return!0===e.getValue(SUPPRESS_TRACING_KEY)}var BAGGAGE_KEY_PAIR_SEPARATOR="=",BAGGAGE_PROPERTIES_SEPARATOR=";",BAGGAGE_ITEMS_SEPARATOR=",",BAGGAGE_HEADER="baggage",BAGGAGE_MAX_NAME_VALUE_PAIRS=180,BAGGAGE_MAX_PER_NAME_VALUE_PAIRS=4096,BAGGAGE_MAX_TOTAL_LENGTH=8192,__read$2=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a};function serializeKeyPairs(e){return e.reduce((function(e,t){var r=""+e+(""!==e?BAGGAGE_ITEMS_SEPARATOR:"")+t;return r.length>BAGGAGE_MAX_TOTAL_LENGTH?e:r}),"")}function getKeyPairs(e){return e.getAllEntries().map((function(e){var t=__read$2(e,2),r=t[0],s=t[1],n=encodeURIComponent(r)+"="+encodeURIComponent(s.value);return void 0!==s.metadata&&(n+=BAGGAGE_PROPERTIES_SEPARATOR+s.metadata.toString()),n}))}function parsePairKeyValue(e){var t=e.split(BAGGAGE_PROPERTIES_SEPARATOR);if(!(t.length<=0)){var r=t.shift();if(r){var s=r.indexOf(BAGGAGE_KEY_PAIR_SEPARATOR);if(!(s<=0)){var n,i=decodeURIComponent(r.substring(0,s).trim()),a=decodeURIComponent(r.substring(s+1).trim());return t.length>0&&(n=baggageEntryMetadataFromString(t.join(BAGGAGE_PROPERTIES_SEPARATOR))),{key:i,value:a,metadata:n}}}}}function parseKeyPairsIntoRecord(e){return"string"!=typeof e||0===e.length?{}:e.split(BAGGAGE_ITEMS_SEPARATOR).map((function(e){return parsePairKeyValue(e)})).filter((function(e){return void 0!==e&&e.value.length>0})).reduce((function(e,t){return e[t.key]=t.value,e}),{})}var utils$2=Object.freeze({__proto__:null,getKeyPairs:getKeyPairs,parseKeyPairsIntoRecord:parseKeyPairsIntoRecord,parsePairKeyValue:parsePairKeyValue,serializeKeyPairs:serializeKeyPairs}),W3CBaggagePropagator=function(){function e(){}return e.prototype.inject=function(e,t,r){var s=propagation.getBaggage(e);if(s&&!isTracingSuppressed(e)){var n=serializeKeyPairs(getKeyPairs(s).filter((function(e){return e.length<=BAGGAGE_MAX_PER_NAME_VALUE_PAIRS})).slice(0,BAGGAGE_MAX_NAME_VALUE_PAIRS));n.length>0&&r.set(t,BAGGAGE_HEADER,n)}},e.prototype.extract=function(e,t,r){var s=r.get(t,BAGGAGE_HEADER),n=Array.isArray(s)?s.join(BAGGAGE_ITEMS_SEPARATOR):s;if(!n)return e;var i={};return 0===n.length?e:(n.split(BAGGAGE_ITEMS_SEPARATOR).forEach((function(e){var t=parsePairKeyValue(e);if(t){var r={value:t.value};t.metadata&&(r.metadata=t.metadata),i[t.key]=r}})),0===Object.entries(i).length?e:propagation.setBaggage(e,propagation.createBaggage(i)))},e.prototype.fields=function(){return[BAGGAGE_HEADER]},e}(),AnchoredClock=function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}return e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e},e}(),__values$2=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read$1=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a};function sanitizeAttributes(e){var t,r,s={};if("object"!=typeof e||null==e)return s;try{for(var n=__values$2(Object.entries(e)),i=n.next();!i.done;i=n.next()){var a=__read$1(i.value,2),o=a[0],c=a[1];isAttributeKey(o)?isAttributeValue(c)?Array.isArray(c)?s[o]=c.slice():s[o]=c:diag.warn("Invalid attribute value set for key: "+o):diag.warn("Invalid attribute key: "+o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return s}function isAttributeKey(e){return"string"==typeof e&&e.length>0}function isAttributeValue(e){return null==e||(Array.isArray(e)?isHomogeneousAttributeValueArray(e):isValidPrimitiveAttributeValue(e))}function isHomogeneousAttributeValueArray(e){var t,r,s;try{for(var n=__values$2(e),i=n.next();!i.done;i=n.next()){var a=i.value;if(null!=a){if(!s){if(isValidPrimitiveAttributeValue(a)){s=typeof a;continue}return!1}if(typeof a!==s)return!1}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!0}function isValidPrimitiveAttributeValue(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function loggingErrorHandler(){return function(e){diag.error(stringifyException(e))}}function stringifyException(e){return"string"==typeof e?e:JSON.stringify(flattenException(e))}function flattenException(e){for(var t={},r=e;null!==r;)Object.getOwnPropertyNames(r).forEach((function(e){if(!t[e]){var s=r[e];s&&(t[e]=String(s))}})),r=Object.getPrototypeOf(r);return t}var delegateHandler=loggingErrorHandler(),TracesSamplerValues;function setGlobalErrorHandler(e){delegateHandler=e}function globalErrorHandler(e){try{delegateHandler(e)}catch(e){}}!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(TracesSamplerValues||(TracesSamplerValues={}));var _globalThis$1="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},DEFAULT_LIST_SEPARATOR=",",ENVIRONMENT_BOOLEAN_KEYS=["OTEL_SDK_DISABLED"];function isEnvVarABoolean(e){return ENVIRONMENT_BOOLEAN_KEYS.indexOf(e)>-1}var ENVIRONMENT_NUMBERS_KEYS=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function isEnvVarANumber(e){return ENVIRONMENT_NUMBERS_KEYS.indexOf(e)>-1}var ENVIRONMENT_LISTS_KEYS=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function isEnvVarAList(e){return ENVIRONMENT_LISTS_KEYS.indexOf(e)>-1}var DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT=1/0,DEFAULT_ATTRIBUTE_COUNT_LIMIT=128,DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT=128,DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT=128,DEFAULT_ENVIRONMENT={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:DiagLogLevel.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_ATTRIBUTE_COUNT_LIMIT:DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:TracesSamplerValues.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function parseBoolean(e,t,r){if(void 0!==r[e]){var s=String(r[e]);t[e]="true"===s.toLowerCase()}}function parseNumber(e,t,r,s,n){if(void 0===s&&(s=-1/0),void 0===n&&(n=1/0),void 0!==r[e]){var i=Number(r[e]);isNaN(i)||(t[e]=i<s?s:i>n?n:i)}}function parseStringList(e,t,r,s){void 0===s&&(s=DEFAULT_LIST_SEPARATOR);var n=r[e];"string"==typeof n&&(t[e]=n.split(s).map((function(e){return e.trim()})))}var logLevelMap={ALL:DiagLogLevel.ALL,VERBOSE:DiagLogLevel.VERBOSE,DEBUG:DiagLogLevel.DEBUG,INFO:DiagLogLevel.INFO,WARN:DiagLogLevel.WARN,ERROR:DiagLogLevel.ERROR,NONE:DiagLogLevel.NONE};function setLogLevelFromEnv(e,t,r){var s=r[e];if("string"==typeof s){var n=logLevelMap[s.toUpperCase()];null!=n&&(t[e]=n)}}function parseEnvironment(e){var t={};for(var r in DEFAULT_ENVIRONMENT){var s=r;if("OTEL_LOG_LEVEL"===s)setLogLevelFromEnv(s,t,e);else if(isEnvVarABoolean(s))parseBoolean(s,t,e);else if(isEnvVarANumber(s))parseNumber(s,t,e);else if(isEnvVarAList(s))parseStringList(s,t,e);else{var n=e[s];null!=n&&(t[s]=String(n))}}return t}function getEnvWithoutDefaults(){return"undefined"!=typeof process&&process&&process.env?parseEnvironment(process.env):parseEnvironment(_globalThis$1)}function getEnv(){var e=parseEnvironment(process.env);return Object.assign({},DEFAULT_ENVIRONMENT,e)}var _globalThis="object"==typeof globalThis?globalThis:global;function intValue(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function hexToBinary(e){for(var t=new Uint8Array(e.length/2),r=0,s=0;s<e.length;s+=2){var n=intValue(e.charCodeAt(s)),i=intValue(e.charCodeAt(s+1));t[r++]=n<<4|i}return t}function hexToBase64(e){return Buffer.from(hexToBinary(e)).toString("base64")}var SPAN_ID_BYTES=8,TRACE_ID_BYTES=16,RandomIdGenerator=function(){this.generateTraceId=getIdGenerator(TRACE_ID_BYTES),this.generateSpanId=getIdGenerator(SPAN_ID_BYTES)},SHARED_BUFFER=Buffer.allocUnsafe(TRACE_ID_BYTES);function getIdGenerator(e){return function(){for(var t=0;t<e/4;t++)SHARED_BUFFER.writeUInt32BE(Math.random()*Math.pow(2,32)>>>0,4*t);for(t=0;t<e&&!(SHARED_BUFFER[t]>0);t++)t===e-1&&(SHARED_BUFFER[e-1]=1);return SHARED_BUFFER.toString("hex",0,e)}}var otperformance=require$$0$5.performance,VERSION$1="1.21.0",SemanticResourceAttributes={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},TelemetrySdkLanguageValues={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"},_a,SDK_INFO=(_a={},_a[SemanticResourceAttributes.TELEMETRY_SDK_NAME]="opentelemetry",_a[SemanticResourceAttributes.PROCESS_RUNTIME_NAME]="node",_a[SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE]=TelemetrySdkLanguageValues.NODEJS,_a[SemanticResourceAttributes.TELEMETRY_SDK_VERSION]=VERSION$1,_a);function unrefTimer(e){e.unref()}var NANOSECOND_DIGITS=9,NANOSECOND_DIGITS_IN_MILLIS=6,MILLISECONDS_TO_NANOSECONDS=Math.pow(10,NANOSECOND_DIGITS_IN_MILLIS),SECOND_TO_NANOSECONDS=Math.pow(10,NANOSECOND_DIGITS),ExportResultCode;function millisToHrTime(e){var t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*MILLISECONDS_TO_NANOSECONDS)]}function getTimeOrigin(){var e=otperformance.timeOrigin;if("number"!=typeof e){var t=otperformance;e=t.timing&&t.timing.fetchStart}return e}function hrTime(e){return addHrTimes(millisToHrTime(getTimeOrigin()),millisToHrTime("number"==typeof e?e:otperformance.now()))}function timeInputToHrTime(e){if(isTimeInputHrTime(e))return e;if("number"==typeof e)return e<getTimeOrigin()?hrTime(e):millisToHrTime(e);if(e instanceof Date)return millisToHrTime(e.getTime());throw TypeError("Invalid input type")}function hrTimeDuration(e,t){var r=t[0]-e[0],s=t[1]-e[1];return s<0&&(r-=1,s+=SECOND_TO_NANOSECONDS),[r,s]}function hrTimeToTimeStamp(e){var t=NANOSECOND_DIGITS,r=""+"0".repeat(t)+e[1]+"Z",s=r.substr(r.length-t-1);return new Date(1e3*e[0]).toISOString().replace("000Z",s)}function hrTimeToNanoseconds(e){return e[0]*SECOND_TO_NANOSECONDS+e[1]}function hrTimeToMilliseconds(e){return 1e3*e[0]+e[1]/1e6}function hrTimeToMicroseconds(e){return 1e6*e[0]+e[1]/1e3}function isTimeInputHrTime(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function isTimeInput(e){return isTimeInputHrTime(e)||"number"==typeof e||e instanceof Date}function addHrTimes(e,t){var r=[e[0]+t[0],e[1]+t[1]];return r[1]>=SECOND_TO_NANOSECONDS&&(r[1]-=SECOND_TO_NANOSECONDS,r[0]+=1),r}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(ExportResultCode||(ExportResultCode={}));var __values$1=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},CompositePropagator=function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}return e.prototype.inject=function(e,t,r){var s,n;try{for(var i=__values$1(this._propagators),a=i.next();!a.done;a=i.next()){var o=a.value;try{o.inject(e,t,r)}catch(e){diag.warn("Failed to inject with "+o.constructor.name+". Err: "+e.message)}}}catch(e){s={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}},e.prototype.extract=function(e,t,r){return this._propagators.reduce((function(e,s){try{return s.extract(e,t,r)}catch(e){diag.warn("Failed to inject with "+s.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()},e}(),VALID_KEY_CHAR_RANGE="[_0-9a-z-*/]",VALID_KEY="[a-z]"+VALID_KEY_CHAR_RANGE+"{0,255}",VALID_VENDOR_KEY="[a-z0-9]"+VALID_KEY_CHAR_RANGE+"{0,240}@[a-z]"+VALID_KEY_CHAR_RANGE+"{0,13}",VALID_KEY_REGEX=new RegExp("^(?:"+VALID_KEY+"|"+VALID_VENDOR_KEY+")$"),VALID_VALUE_BASE_REGEX=/^[ -~]{0,255}[!-~]$/,INVALID_VALUE_COMMA_EQUAL_REGEX=/,|=/;function validateKey(e){return VALID_KEY_REGEX.test(e)}function validateValue(e){return VALID_VALUE_BASE_REGEX.test(e)&&!INVALID_VALUE_COMMA_EQUAL_REGEX.test(e)}var MAX_TRACE_STATE_ITEMS=32,MAX_TRACE_STATE_LEN=512,LIST_MEMBERS_SEPARATOR=",",LIST_MEMBER_KEY_VALUE_SPLITTER="=",TraceState=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,r){return t.push(r+LIST_MEMBER_KEY_VALUE_SPLITTER+e.get(r)),t}),[]).join(LIST_MEMBERS_SEPARATOR)},e.prototype._parse=function(e){e.length>MAX_TRACE_STATE_LEN||(this._internalState=e.split(LIST_MEMBERS_SEPARATOR).reverse().reduce((function(e,t){var r=t.trim(),s=r.indexOf(LIST_MEMBER_KEY_VALUE_SPLITTER);if(-1!==s){var n=r.slice(0,s),i=r.slice(s+1,t.length);validateKey(n)&&validateValue(i)&&e.set(n,i)}return e}),new Map),this._internalState.size>MAX_TRACE_STATE_ITEMS&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,MAX_TRACE_STATE_ITEMS))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),TRACE_PARENT_HEADER="traceparent",TRACE_STATE_HEADER="tracestate",VERSION="00",VERSION_PART="(?!ff)[\\da-f]{2}",TRACE_ID_PART="(?![0]{32})[\\da-f]{32}",PARENT_ID_PART="(?![0]{16})[\\da-f]{16}",FLAGS_PART="[\\da-f]{2}",TRACE_PARENT_REGEX=new RegExp("^\\s?("+VERSION_PART+")-("+TRACE_ID_PART+")-("+PARENT_ID_PART+")-("+FLAGS_PART+")(-.*)?\\s?$");function parseTraceParent(e){var t=TRACE_PARENT_REGEX.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}var W3CTraceContextPropagator=function(){function e(){}return e.prototype.inject=function(e,t,r){var s=trace.getSpanContext(e);if(s&&!isTracingSuppressed(e)&&isSpanContextValid(s)){var n=VERSION+"-"+s.traceId+"-"+s.spanId+"-0"+Number(s.traceFlags||TraceFlags.NONE).toString(16);r.set(t,TRACE_PARENT_HEADER,n),s.traceState&&r.set(t,TRACE_STATE_HEADER,s.traceState.serialize())}},e.prototype.extract=function(e,t,r){var s=r.get(t,TRACE_PARENT_HEADER);if(!s)return e;var n=Array.isArray(s)?s[0]:s;if("string"!=typeof n)return e;var i=parseTraceParent(n);if(!i)return e;i.isRemote=!0;var a=r.get(t,TRACE_STATE_HEADER);if(a){var o=Array.isArray(a)?a.join(","):a;i.traceState=new TraceState("string"==typeof o?o:void 0)}return trace.setSpanContext(e,i)},e.prototype.fields=function(){return[TRACE_PARENT_HEADER,TRACE_STATE_HEADER]},e}(),RPC_METADATA_KEY=createContextKey("OpenTelemetry SDK Context Key RPC_METADATA"),RPCType;function setRPCMetadata(e,t){return e.setValue(RPC_METADATA_KEY,t)}function deleteRPCMetadata(e){return e.deleteValue(RPC_METADATA_KEY)}function getRPCMetadata(e){return e.getValue(RPC_METADATA_KEY)}!function(e){e.HTTP="http"}(RPCType||(RPCType={}));var AlwaysOffSampler=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:SamplingDecision.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),AlwaysOnSampler=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:SamplingDecision.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),ParentBasedSampler=function(){function e(e){var t,r,s,n;this._root=e.root,this._root||(globalErrorHandler(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new AlwaysOnSampler),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new AlwaysOnSampler,this._remoteParentNotSampled=null!==(r=e.remoteParentNotSampled)&&void 0!==r?r:new AlwaysOffSampler,this._localParentSampled=null!==(s=e.localParentSampled)&&void 0!==s?s:new AlwaysOnSampler,this._localParentNotSampled=null!==(n=e.localParentNotSampled)&&void 0!==n?n:new AlwaysOffSampler}return e.prototype.shouldSample=function(e,t,r,s,n,i){var a=trace.getSpanContext(e);return a&&isSpanContextValid(a)?a.isRemote?a.traceFlags&TraceFlags.SAMPLED?this._remoteParentSampled.shouldSample(e,t,r,s,n,i):this._remoteParentNotSampled.shouldSample(e,t,r,s,n,i):a.traceFlags&TraceFlags.SAMPLED?this._localParentSampled.shouldSample(e,t,r,s,n,i):this._localParentNotSampled.shouldSample(e,t,r,s,n,i):this._root.shouldSample(e,t,r,s,n,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),TraceIdRatioBasedSampler=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:isValidTraceId(t)&&this._accumulate(t)<this._upperBound?SamplingDecision.RECORD_AND_SAMPLED:SamplingDecision.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,r=0;r<e.length/8;r++){var s=8*r;t=(t^parseInt(e.slice(s,s+8),16))>>>0}return t},e}(),objectTag="[object Object]",nullTag="[object Null]",undefinedTag="[object Undefined]",funcProto=Function.prototype,funcToString=funcProto.toString,objectCtorString=funcToString.call(Object),getPrototype=overArg(Object.getPrototypeOf,Object),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,symToStringTag=Symbol?Symbol.toStringTag:void 0,nativeObjectToString=objectProto.toString;function overArg(e,t){return function(r){return e(t(r))}}function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!==objectTag)return!1;var t=getPrototype(e);if(null===t)return!0;var r=hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&funcToString.call(r)===objectCtorString}function isObjectLike(e){return null!=e&&"object"==typeof e}function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag],s=!1;try{e[symToStringTag]=void 0,s=!0}catch(e){}var n=nativeObjectToString.call(e);return s&&(t?e[symToStringTag]=r:delete e[symToStringTag]),n}function objectToString(e){return nativeObjectToString.call(e)}var MAX_LEVEL=20;function merge(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.shift(),s=new WeakMap;e.length>0;)r=mergeTwoObjects(r,e.shift(),0,s);return r}function takeValue(e){return isArray(e)?e.slice():e}function mergeTwoObjects(e,t,r,s){var n;if(void 0===r&&(r=0),!(r>MAX_LEVEL)){if(r++,isPrimitive(e)||isPrimitive(t)||isFunction(t))n=takeValue(t);else if(isArray(e)){if(n=e.slice(),isArray(t))for(var i=0,a=t.length;i<a;i++)n.push(takeValue(t[i]));else if(isObject$5(t))for(i=0,a=(o=Object.keys(t)).length;i<a;i++){n[c=o[i]]=takeValue(t[c])}}else if(isObject$5(e))if(isObject$5(t)){if(!shouldMerge(e,t))return t;n=Object.assign({},e);var o;for(i=0,a=(o=Object.keys(t)).length;i<a;i++){var c,u=t[c=o[i]];if(isPrimitive(u))void 0===u?delete n[c]:n[c]=u;else{var l=n[c],p=u;if(wasObjectReferenced(e,c,s)||wasObjectReferenced(t,c,s))delete n[c];else{if(isObject$5(l)&&isObject$5(p)){var d=s.get(l)||[],h=s.get(p)||[];d.push({obj:e,key:c}),h.push({obj:t,key:c}),s.set(l,d),s.set(p,h)}n[c]=mergeTwoObjects(n[c],u,r,s)}}}}else n=t;return n}}function wasObjectReferenced(e,t,r){for(var s=r.get(e[t])||[],n=0,i=s.length;n<i;n++){var a=s[n];if(a.key===t&&a.obj===e)return!0}return!1}function isArray(e){return Array.isArray(e)}function isFunction(e){return"function"==typeof e}function isObject$5(e){return!isPrimitive(e)&&!isArray(e)&&!isFunction(e)&&"object"==typeof e}function isPrimitive(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}function shouldMerge(e,t){return!(!isPlainObject(e)||!isPlainObject(t))}var __extends=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),TimeoutError=function(e){function t(r){var s=e.call(this,r)||this;return Object.setPrototypeOf(s,t.prototype),s}return __extends(t,e),t}(Error);function callWithTimeout(e,t){var r,s=new Promise((function(e,s){r=setTimeout((function(){s(new TimeoutError("Operation timed out."))}),t)}));return Promise.race([e,s]).then((function(e){return clearTimeout(r),e}),(function(e){throw clearTimeout(r),e}))}var __values=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function urlMatches(e,t){return"string"==typeof t?e===t:!!e.match(t)}function isUrlIgnored(e,t){var r,s;if(!t)return!1;try{for(var n=__values(t),i=n.next();!i.done;i=n.next()){if(urlMatches(e,i.value))return!0}}catch(e){r={error:e}}finally{try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(r)throw r.error}}return!1}function isWrapped(e){return"function"==typeof e&&"function"==typeof e.__original&&"function"==typeof e.__unwrap&&!0===e.__wrapped}var Deferred=function(){function e(){var e=this;this._promise=new Promise((function(t,r){e._resolve=t,e._reject=r}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),__read=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},__spreadArray=function(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},BindOnceFuture=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new Deferred}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,__spreadArray([this._that],__read(r),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}();function _export(e,t){return new Promise((function(r){context.with(suppressTracing(context.active()),(function(){e.export(t,(function(e){r(e)}))}))}))}var internal={_export:_export},esm=Object.freeze({__proto__:null,AlwaysOffSampler:AlwaysOffSampler,AlwaysOnSampler:AlwaysOnSampler,AnchoredClock:AnchoredClock,BindOnceFuture:BindOnceFuture,CompositePropagator:CompositePropagator,DEFAULT_ATTRIBUTE_COUNT_LIMIT:DEFAULT_ATTRIBUTE_COUNT_LIMIT,DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT:DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,DEFAULT_ENVIRONMENT:DEFAULT_ENVIRONMENT,DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT,get ExportResultCode(){return ExportResultCode},ParentBasedSampler:ParentBasedSampler,get RPCType(){return RPCType},RandomIdGenerator:RandomIdGenerator,SDK_INFO:SDK_INFO,TRACE_PARENT_HEADER:TRACE_PARENT_HEADER,TRACE_STATE_HEADER:TRACE_STATE_HEADER,TimeoutError:TimeoutError,TraceIdRatioBasedSampler:TraceIdRatioBasedSampler,TraceState:TraceState,get TracesSamplerValues(){return TracesSamplerValues},VERSION:VERSION$1,W3CBaggagePropagator:W3CBaggagePropagator,W3CTraceContextPropagator:W3CTraceContextPropagator,_globalThis:_globalThis,addHrTimes:addHrTimes,baggageUtils:utils$2,callWithTimeout:callWithTimeout,deleteRPCMetadata:deleteRPCMetadata,getEnv:getEnv,getEnvWithoutDefaults:getEnvWithoutDefaults,getRPCMetadata:getRPCMetadata,getTimeOrigin:getTimeOrigin,globalErrorHandler:globalErrorHandler,hexToBase64:hexToBase64,hexToBinary:hexToBinary,hrTime:hrTime,hrTimeDuration:hrTimeDuration,hrTimeToMicroseconds:hrTimeToMicroseconds,hrTimeToMilliseconds:hrTimeToMilliseconds,hrTimeToNanoseconds:hrTimeToNanoseconds,hrTimeToTimeStamp:hrTimeToTimeStamp,internal:internal,isAttributeKey:isAttributeKey,isAttributeValue:isAttributeValue,isTimeInput:isTimeInput,isTimeInputHrTime:isTimeInputHrTime,isTracingSuppressed:isTracingSuppressed,isUrlIgnored:isUrlIgnored,isWrapped:isWrapped,loggingErrorHandler:loggingErrorHandler,merge:merge,millisToHrTime:millisToHrTime,otperformance:otperformance,parseEnvironment:parseEnvironment,parseTraceParent:parseTraceParent,sanitizeAttributes:sanitizeAttributes,setGlobalErrorHandler:setGlobalErrorHandler,setRPCMetadata:setRPCMetadata,suppressTracing:suppressTracing,timeInputToHrTime:timeInputToHrTime,unrefTimer:unrefTimer,unsuppressTracing:unsuppressTracing,urlMatches:urlMatches}),require$$1=getAugmentedNamespace(esm),sampler$1,hasRequiredSampler$1,channels$1,hasRequiredChannels$1,writer$7,hasRequiredWriter$7,log_1$1,hasRequiredLog$2,tagger,hasRequiredTagger$1,docker,hasRequiredDocker,agents,hasRequiredAgents,request_1,hasRequiredRequest,dogstatsd,hasRequiredDogstatsd;function requireSampler$1(){if(hasRequiredSampler$1)return sampler$1;hasRequiredSampler$1=1;return sampler$1=class{shouldSample(e,t,r,s,n,i){return{decision:2}}toString(){return"DatadogSampler"}}}function requireChannels$1(){if(hasRequiredChannels$1)return channels$1;hasRequiredChannels$1=1;const{channel:e}=requireDcPolyfill(),t={Debug:"debug",Info:"info",Warn:"warn",Error:"error"},r=t.Debug,s={[t.Debug]:n(t.Debug,20),[t.Info]:n(t.Info,30),[t.Warn]:n(t.Warn,40),[t.Error]:n(t.Error,50)};function n(t,r){const s=e(`datadog:log:${t}`);return s.logLevel=r,s}return channels$1={Level:t,getChannelLogLevel:function(e){let t;return t=e&&"string"==typeof e&&s[e.toLowerCase().trim()]||s[r],t.logLevel},debugChannel:s[t.Debug],infoChannel:s[t.Info],warnChannel:s[t.Warn],errorChannel:s[t.Error]}}function requireWriter$7(){if(hasRequiredWriter$7)return writer$7;hasRequiredWriter$7=1;const{storage:e}=requireDatadogCore(),{getChannelLogLevel:t,debugChannel:r,infoChannel:s,warnChannel:n,errorChannel:i}=requireChannels$1(),a={debug:e=>console.debug(e),info:e=>console.info(e),warn:e=>console.warn(e),error:e=>console.error(e)};let o=!1,c=a,u=t();function l(t){const r=e.getStore();e.enterWith({noop:!0}),t(),e.enterWith(r)}function p(e){r.hasSubscribers&&r.unsubscribe(g),s.hasSubscribers&&s.unsubscribe(f),n.hasSubscribers&&n.unsubscribe(h),i.hasSubscribers&&i.unsubscribe(d),e&&(r.logLevel>=u&&r.subscribe(g),s.logLevel>=u&&s.subscribe(f),n.logLevel>=u&&n.subscribe(h),i.logLevel>=u&&i.subscribe(d))}function d(e){o&&m(e)}function h(e){o&&_(e)}function f(e){o&&b(e)}function g(e){o&&y(e)}function m(e){"object"==typeof e&&e?e.stack||(e=String(e.message||e)):e=String(e),"string"==typeof e&&(e=new Error(e)),l((()=>c.error(e)))}function _(e){if(!c.warn)return y(e);l((()=>c.warn(e)))}function b(e){if(!c.info)return y(e);l((()=>c.info(e)))}function y(e){l((()=>c.debug(e)))}return writer$7={use:function(e){e&&e.debug instanceof Function&&e.error instanceof Function&&(c=e)},toggle:function(e,r){void 0!==r&&(u=t(r)),o=e,p(o)},reset:function(){c=a,o=!1,u=t(),p(!1)},error:m,warn:_,info:b,debug:y}}function requireLog$2(){if(hasRequiredLog$2)return log_1$1;hasRequiredLog$2=1;const{debugChannel:e,infoChannel:t,warnChannel:r,errorChannel:s}=requireChannels$1(),n=requireWriter$7(),i=e=>{const t={};return function(r){return t[r]||(t[r]=e.apply(this,arguments)),t[r]}};function a(e){return"function"==typeof e?e():e}const o={use(e){return n.use(e),this},toggle(e,t){return n.toggle(e,t),this},reset(){return n.reset(),this._deprecate=i(((e,t)=>(s.publish(t),!0))),this},debug(t){return e.hasSubscribers&&e.publish(a(t)),this},info(e){return t.hasSubscribers&&t.publish(a(e)),this},warn(e){return r.hasSubscribers&&r.publish(a(e)),this},error(e){return s.hasSubscribers&&s.publish(a(e)),this},deprecate(e,t){return this._deprecate(e,t)}};return o.reset(),log_1$1=o}function requireTagger$1(){if(hasRequiredTagger$1)return tagger;hasRequiredTagger$1=1;const e=requireLog$2();return tagger={add:function t(r,s){if(r&&s){if(Array.isArray(s))return s.forEach((e=>t(r,e)));try{if("string"==typeof s){const e=s.split(",");for(const t of e){const e=t.indexOf(":");if(-1===e)continue;const s=t.slice(0,e),n=t.slice(e+1);r[s.trim()]=n.trim()}}else Object.assign(r,s)}catch(t){e.error(t)}}}},tagger}function requireDocker(){if(hasRequiredDocker)return docker;hasRequiredDocker=1;const e=require$$0$6,t=new RegExp(".*([0-9a-f]{8}[-_][0-9a-f]{4}[-_][0-9a-f]{4}[-_][0-9a-f]{4}[-_][0-9a-f]{12}|[0-9a-f]{8}(?:-[0-9a-f]{4}){4}$|[0-9a-f]{64}|[0-9a-f]{32}-\\d+)(?:\\.scope)?$","m"),r=function(){const r=function(){try{return e.readFileSync("/proc/self/cgroup").toString()}catch(e){}}()||"";return(r.trim().match(t)||[])[1]}();return docker={id:()=>r}}function requireAgents(){if(hasRequiredAgents)return agents;hasRequiredAgents=1;const e=require$$1$1,t=require$$2$1,{storage:r}=requireDatadogCore();function s(e){return class extends e{constructor(){super({keepAlive:true,maxSockets:1})}createConnection(...e){return this._noop((()=>super.createConnection(...e)))}keepSocketAlive(...e){return this._noop((()=>super.keepSocketAlive(...e)))}reuseSocket(...e){return this._noop((()=>super.reuseSocket(...e)))}_noop(e){return r.run({noop:!0},e)}}}const n=s(e.Agent),i=s(t.Agent);return agents={httpAgent:new n,HttpsAgent:new i}}function requireRequest(){if(hasRequiredRequest)return request_1;hasRequiredRequest=1;const{Readable:e}=require$$0$7,t=require$$1$1,r=require$$2$1,{parse:s}=require$$0$8,n=require$$5,i=requireDocker(),{httpAgent:a,httpsAgent:o}=requireAgents(),{storage:c}=requireDatadogCore(),u=requireLog$2(),l=i.id();let p=0;function d(e){const r=e.agent||t.globalAgent,s={protocol:e.protocol||r.protocol,hostname:"string"==typeof e.hostname&&e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname||e.host||"localhost",hash:e.hash,search:e.search,pathname:e.pathname,path:`${e.pathname||""}${e.search||""}`,href:e.href};return""!==e.port&&(s.port=Number(e.port)),(e.username||e.password)&&(s.auth=`${e.username}:${e.password}`),s}function h(i,f,g){if(f.headers||(f.headers={}),f.url){const e="object"==typeof f.url?d(f.url):function(e){const t="function"==typeof urlToHttpOptions?d(new URL(e)):s(e);if("unix:"===t.protocol&&"."===t.host){const r=e.replace(/^unix:/,"");t.path=r,t.pathname=r}return t}(f.url);"unix:"===e.protocol?f.socketPath=e.pathname:(f.path||(f.path=e.path),f.protocol=e.protocol,f.hostname=e.hostname,f.port=e.port)}const m=i instanceof e,_=f.timeout||2e3,b="https:"===f.protocol,y=b?r:t,v=[].concat(i);m||(f.headers["Content-Length"]=function(e){return e.length>0?e.reduce(((e,t)=>e+t.length),0):0}(v)),l&&(f.headers["Datadog-Container-ID"]=l),f.agent=b?o:a;const S=e=>{const r=[];e.setTimeout(_),e.on("data",(e=>{r.push(e)})),e.on("end",(()=>{p--;const s=Buffer.concat(r);if(e.statusCode>=200&&e.statusCode<=299){"gzip"===e.headers["content-encoding"]?n.gunzip(s,((t,r)=>{t?(u.error(`Could not gunzip response: ${t.message}`),g(null,"",e.statusCode)):g(null,r.toString(),e.statusCode)})):g(null,s.toString(),e.statusCode)}else{let r="";try{r=`Error from ${new URL(f.path,f.url||f.hostname||`http://localhost:${f.port}`).href}: ${e.statusCode} ${t.STATUS_CODES[e.statusCode]}.`}catch(e){}const n=s.toString();n&&(r+=` Response from the endpoint: "${n}"`);const i=new Error(r);i.status=e.statusCode,g(i,null,e.statusCode)}}))},q=e=>{if(!h.writable)return u.debug("Maximum number of active requests reached: payload is discarded."),g(null);p++;const t=c.getStore();c.enterWith({noop:!0});const r=y.request(f,S);r.once("error",(t=>{p--,e(t)})),r.setTimeout(_,r.abort),m?i.pipe(r):(v.forEach((e=>r.write(e))),r.end()),c.enterWith(t)};q((()=>setTimeout((()=>q(g)))))}return Object.defineProperty(h,"writable",{get:()=>p<8}),request_1=h}function requireDogstatsd(){if(hasRequiredDogstatsd)return dogstatsd;hasRequiredDogstatsd=1;const e=require$$0$9.lookup,t=requireRequest(),r=require$$2$2,s=require$$1$2.isIP,n=requireLog$2(),{URL:i,format:a}=require$$0$8;class o{constructor(e={}){e.metricsProxyUrl&&(this._httpOptions={url:e.metricsProxyUrl.toString(),path:"/dogstatsd/v2/proxy"}),this._host=e.host||"localhost",this._family=s(this._host),this._port=e.port||8125,this._prefix=e.prefix||"",this._tags=e.tags||[],this._queue=[],this._buffer="",this._offset=0,this._udp4=this._socket("udp4"),this._udp6=this._socket("udp6")}increment(e,t,r){this._add(e,t,"c",r)}gauge(e,t,r){this._add(e,t,"g",r)}distribution(e,t,r){this._add(e,t,"d",r)}flush(){const e=this._enqueue();n.debug(`Flushing ${e.length} metrics via ${this._httpOptions?"HTTP":"UDP"}`),0!==this._queue.length&&(this._queue=[],this._httpOptions?this._sendHttp(e):this._sendUdp(e))}_sendHttp(e){const r=Buffer.concat(e);t(r,this._httpOptions,(t=>{t&&(n.error("HTTP error from agent: "+t.stack),404===t.status&&(this._httpOptions=null),this._sendUdp(e))}))}_sendUdp(t){0!==this._family?this._sendUdpFromQueue(t,this._host,this._family):e(this._host,((e,r,s)=>{if(e)return n.error(e);this._sendUdpFromQueue(t,r,s)}))}_sendUdpFromQueue(e,t,r){const s=6===r?this._udp6:this._udp4;e.forEach((e=>{n.debug(`Sending to DogStatsD: ${e}`),s.send(e,0,e.length,this._port,t)}))}_add(e,t,r,s){const n=`${this._prefix+e}:${t}|${r}`;(s=s?this._tags.concat(s):this._tags).length>0?this._write(`${n}|#${s.join(",")}\n`):this._write(`${n}\n`)}_write(e){const t=Buffer.byteLength(e);this._offset+t>1024&&this._enqueue(),this._offset+=t,this._buffer+=e}_enqueue(){return this._offset>0&&(this._queue.push(Buffer.from(this._buffer)),this._buffer="",this._offset=0),this._queue}_socket(e){const t=r.createSocket(e);return t.on("error",(()=>{})),t.unref(),t}static generateClientConfig(e={}){const t=[];e.tags&&Object.keys(e.tags).filter((t=>"string"==typeof e.tags[t])).filter((t=>"runtime-id"!==t||e.experimental&&e.experimental.runtimeId)).forEach((r=>{const s=e.tags[r].replace(/[^a-z0-9_:./-]/gi,"_");t.push(`${r}:${s}`)}));const r={host:e.dogstatsd.hostname,port:e.dogstatsd.port,tags:t};return e.url?r.metricsProxyUrl=e.url:e.port&&(r.metricsProxyUrl=new i(a({protocol:"http:",hostname:e.hostname||"localhost",port:e.port}))),r}}class c{constructor(e){const t=o.generateClientConfig(e);this.dogstatsd=new o(t)}increment(e,t=1,r){return this.dogstatsd.increment(e,t,c.tagTranslator(r))}decrement(e,t=1,r){return this.dogstatsd.increment(e,-1*t,c.tagTranslator(r))}gauge(e,t,r){return this.dogstatsd.gauge(e,t,c.tagTranslator(r))}distribution(e,t,r){return this.dogstatsd.distribution(e,t,c.tagTranslator(r))}flush(){return this.dogstatsd.flush()}static tagTranslator(e){const t=[];if(!e)return t;for(const[r,s]of Object.entries(e))t.push(`${r}:${s}`);return t}}return dogstatsd={DogStatsDClient:o,NoopDogStatsDClient:class{gauge(){}increment(){}distribution(){}flush(){}},CustomMetrics:c}}var dist$1={},ddsketch={},DDSketch={},store={},DenseStore={},util$e={},hasRequiredUtil$8;function requireUtil$8(){if(hasRequiredUtil$8)return util$e;hasRequiredUtil$8=1,Object.defineProperty(util$e,"__esModule",{value:!0}),util$e.sumOfRange=void 0;return util$e.sumOfRange=function(e,t,r){for(var s=0,n=t;n<=r;n++)s+=e[n];return s},util$e}var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;return hasRequiredAspromise=1,aspromise=function(e,t){var r=new Array(arguments.length-1),s=0,n=2,i=!0;for(;n<arguments.length;)r[s++]=arguments[n++];return new Promise((function(n,a){r[s]=function(e){if(i)if(i=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,a(e))}}))},aspromise}var base64$1={},hasRequiredBase64$1,eventemitter,hasRequiredEventemitter,float,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64$1(){return hasRequiredBase64$1||(hasRequiredBase64$1=1,function(e){var t=base64$1;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),s=new Array(123),n=0;n<64;)s[r[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(e,t,s){for(var n,i=null,a=[],o=0,c=0;t<s;){var u=e[t++];switch(c){case 0:a[o++]=r[u>>2],n=(3&u)<<4,c=1;break;case 1:a[o++]=r[n|u>>4],n=(15&u)<<2,c=2;break;case 2:a[o++]=r[n|u>>6],a[o++]=r[63&u],c=0}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,a)),o=0)}return c&&(a[o++]=r[n],a[o++]=61,1===c&&(a[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,a.slice(0,o))),i.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var i="invalid encoding";t.decode=function(e,t,r){for(var n,a=r,o=0,c=0;c<e.length;){var u=e.charCodeAt(c++);if(61===u&&o>1)break;if(void 0===(u=s[u]))throw Error(i);switch(o){case 0:n=u,o=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,o=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,o=3;break;case 3:t[r++]=(3&n)<<6|u,o=0}}if(1===o)throw Error(i);return r-a},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}()),base64$1}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function e(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=e,e.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],s=0;s<r.length;)r[s].fn===t?r.splice(s,1):++s;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],s=1;s<arguments.length;)r.push(arguments[s++]);for(s=0;s<t.length;)t[s].fn.apply(t[s++].ctx,r)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),s=128===r[3];function n(e,s,n){t[0]=e,s[n]=r[0],s[n+1]=r[1],s[n+2]=r[2],s[n+3]=r[3]}function i(e,s,n){t[0]=e,s[n]=r[3],s[n+1]=r[2],s[n+2]=r[1],s[n+3]=r[0]}function a(e,s){return r[0]=e[s],r[1]=e[s+1],r[2]=e[s+2],r[3]=e[s+3],t[0]}function o(e,s){return r[3]=e[s],r[2]=e[s+1],r[1]=e[s+2],r[0]=e[s+3],t[0]}e.writeFloatLE=s?n:i,e.writeFloatBE=s?i:n,e.readFloatLE=s?a:o,e.readFloatBE=s?o:a}():function(){function i(e,t,r,s){var n=t<0?1:0;if(n&&(t=-t),0===t)e(1/t>0?0:2147483648,r,s);else if(isNaN(t))e(2143289344,r,s);else if(t>34028234663852886e22)e((n<<31|2139095040)>>>0,r,s);else if(t<11754943508222875e-54)e((n<<31|Math.round(t/1401298464324817e-60))>>>0,r,s);else{var i=Math.floor(Math.log(t)/Math.LN2);e((n<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,s)}}function a(e,t,r){var s=e(t,r),n=2*(s>>31)+1,i=s>>>23&255,a=8388607&s;return 255===i?a?NaN:n*(1/0):0===i?1401298464324817e-60*n*a:n*Math.pow(2,i-150)*(a+8388608)}e.writeFloatLE=i.bind(null,t),e.writeFloatBE=i.bind(null,r),e.readFloatLE=a.bind(null,s),e.readFloatBE=a.bind(null,n)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),s=128===r[7];function n(e,s,n){t[0]=e,s[n]=r[0],s[n+1]=r[1],s[n+2]=r[2],s[n+3]=r[3],s[n+4]=r[4],s[n+5]=r[5],s[n+6]=r[6],s[n+7]=r[7]}function i(e,s,n){t[0]=e,s[n]=r[7],s[n+1]=r[6],s[n+2]=r[5],s[n+3]=r[4],s[n+4]=r[3],s[n+5]=r[2],s[n+6]=r[1],s[n+7]=r[0]}function a(e,s){return r[0]=e[s],r[1]=e[s+1],r[2]=e[s+2],r[3]=e[s+3],r[4]=e[s+4],r[5]=e[s+5],r[6]=e[s+6],r[7]=e[s+7],t[0]}function o(e,s){return r[7]=e[s],r[6]=e[s+1],r[5]=e[s+2],r[4]=e[s+3],r[3]=e[s+4],r[2]=e[s+5],r[1]=e[s+6],r[0]=e[s+7],t[0]}e.writeDoubleLE=s?n:i,e.writeDoubleBE=s?i:n,e.readDoubleLE=s?a:o,e.readDoubleBE=s?o:a}():function(){function i(e,t,r,s,n,i){var a=s<0?1:0;if(a&&(s=-s),0===s)e(0,n,i+t),e(1/s>0?0:2147483648,n,i+r);else if(isNaN(s))e(0,n,i+t),e(2146959360,n,i+r);else if(s>17976931348623157e292)e(0,n,i+t),e((a<<31|2146435072)>>>0,n,i+r);else{var o;if(s<22250738585072014e-324)e((o=s/5e-324)>>>0,n,i+t),e((a<<31|o/4294967296)>>>0,n,i+r);else{var c=Math.floor(Math.log(s)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(o=s*Math.pow(2,-c))>>>0,n,i+t),e((a<<31|c+1023<<20|1048576*o&1048575)>>>0,n,i+r)}}}function a(e,t,r,s,n){var i=e(s,n+t),a=e(s,n+r),o=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+i;return 2047===c?u?NaN:o*(1/0):0===c?5e-324*o*u:o*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=i.bind(null,t,0,4),e.writeDoubleBE=i.bind(null,r,4,0),e.readDoubleLE=a.bind(null,s,0,4),e.readDoubleBE=a.bind(null,n,4,0)}(),e}function t(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function r(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function n(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return hasRequiredFloat=1,float=e(e)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}return hasRequiredInquire=1,inquire_1=inquire,inquire_1}var utf8={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal$1,writer$6,hasRequiredWriter$6,writer_buffer,hasRequiredWriter_buffer,reader,hasRequiredReader,reader_buffer,hasRequiredReader_buffer;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(e){var t=e;t.length=function(e){for(var t=0,r=0,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(s+1))?(++s,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var s,n=null,i=[],a=0;t<r;)(s=e[t++])<128?i[a++]=s:s>191&&s<224?i[a++]=(31&s)<<6|63&e[t++]:s>239&&s<365?(s=((7&s)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[a++]=55296+(s>>10),i[a++]=56320+(1023&s)):i[a++]=(15&s)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,i)),a=0);return n?(a&&n.push(String.fromCharCode.apply(String,i.slice(0,a))),n.join("")):String.fromCharCode.apply(String,i.slice(0,a))},t.write=function(e,t,r){for(var s,n,i=r,a=0;a<e.length;++a)(s=e.charCodeAt(a))<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&56320==(64512&(n=e.charCodeAt(a+1)))?(s=65536+((1023&s)<<10)+(1023&n),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128);return r-i}}(utf8)),utf8}function requirePool(){if(hasRequiredPool)return pool_1;return hasRequiredPool=1,pool_1=function(e,t,r){var s=r||8192,n=s>>>1,i=null,a=s;return function(r){if(r<1||r>n)return e(r);a+r>s&&(i=e(s),a=0);var o=t.call(i,a,a+=r);return 7&a&&(a=1+(7|a)),o}}}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal$1();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var s=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return r;var s=e<0;s&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return s&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new t(n,i)},t.from=function(s){if("number"==typeof s)return t.fromNumber(s);if(e.isString(s)){if(!e.Long)return t.fromNumber(parseInt(s,10));s=e.Long.fromString(s)}return s.low||s.high?new t(s.low>>>0,s.high>>>0):r},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var n=String.prototype.charCodeAt;return t.fromHash=function(e){return e===s?r:new t((n.call(e,0)|n.call(e,1)<<8|n.call(e,2)<<16|n.call(e,3)<<24)>>>0,(n.call(e,4)|n.call(e,5)<<8|n.call(e,6)<<16|n.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},longbits}function requireMinimal$1(){return hasRequiredMinimal$1||(hasRequiredMinimal$1=1,function(e){var t=minimal$1;function r(e,t,r){for(var s=Object.keys(t),n=0;n<s.length;++n)void 0!==e[s[n]]&&r||(e[s[n]]=t[s[n]]);return e}function s(e){function t(e,s){if(!(this instanceof t))return new t(e,s);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),s&&r(this,s)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=requireAspromise(),t.base64=requireBase64$1(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var s=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(s.lo,s.hi,r):s.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=s,t.ProtocolError=s("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}()),minimal$1}function requireWriter$6(){if(hasRequiredWriter$6)return writer$6;hasRequiredWriter$6=1,writer$6=c;var e,t=requireMinimal$1(),r=t.LongBits,s=t.base64,n=t.utf8;function i(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function a(){}function o(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function c(){this.len=0,this.head=new i(a,0,0),this.tail=this.head,this.states=null}var u=function(){return t.Buffer?function(){return(c.create=function(){return new e})()}:function(){return new c}};function l(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function d(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function h(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}c.create=u(),c.alloc=function(e){return new t.Array(e)},t.Array!==Array&&(c.alloc=t.pool(c.alloc,t.Array.prototype.subarray)),c.prototype._push=function(e,t,r){return this.tail=this.tail.next=new i(e,t,r),this.len+=t,this},p.prototype=Object.create(i.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},c.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},c.prototype.int32=function(e){return e<0?this._push(d,10,r.fromNumber(e)):this.uint32(e)},c.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},c.prototype.uint64=function(e){var t=r.from(e);return this._push(d,t.length(),t)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(e){var t=r.from(e).zzEncode();return this._push(d,t.length(),t)},c.prototype.bool=function(e){return this._push(l,1,e?1:0)},c.prototype.fixed32=function(e){return this._push(h,4,e>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(e){var t=r.from(e);return this._push(h,4,t.lo)._push(h,4,t.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(e){return this._push(t.float.writeFloatLE,4,e)},c.prototype.double=function(e){return this._push(t.float.writeDoubleLE,8,e)};var f=t.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var s=0;s<e.length;++s)t[r+s]=e[s]};return c.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(l,1,0);if(t.isString(e)){var n=c.alloc(r=s.length(e));s.decode(e,n,0),e=n}return this.uint32(r)._push(f,r,e)},c.prototype.string=function(e){var t=n.length(e);return t?this.uint32(t)._push(n.write,t,e):this._push(l,1,0)},c.prototype.fork=function(){return this.states=new o(this),this.head=this.tail=new i(a,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(a,0,0),this.len=0),this},c.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},c.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},c._configure=function(t){e=t,c.create=u(),e._configure()},writer$6}function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=r;var e=requireWriter$6();(r.prototype=Object.create(e.prototype)).constructor=r;var t=requireMinimal$1();function r(){e.call(this)}function s(e,r,s){e.length<40?t.utf8.write(e,r,s):r.utf8Write?r.utf8Write(e,s):r.write(e,s)}return r._configure=function(){r.alloc=t._Buffer_allocUnsafe,r.writeBytesBuffer=t.Buffer&&t.Buffer.prototype instanceof Uint8Array&&"set"===t.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var s=0;s<e.length;)t[r++]=e[s++]}},r.prototype.bytes=function(e){t.isString(e)&&(e=t._Buffer_from(e,"base64"));var s=e.length>>>0;return this.uint32(s),s&&this._push(r.writeBytesBuffer,s,e),this},r.prototype.string=function(e){var r=t.Buffer.byteLength(e);return this.uint32(r),r&&this._push(s,r,e),this},r._configure(),writer_buffer}function requireReader(){if(hasRequiredReader)return reader;hasRequiredReader=1,reader=i;var e,t=requireMinimal$1(),r=t.LongBits,s=t.utf8;function n(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function i(e){this.buf=e,this.pos=0,this.len=e.length}var a,o="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new i(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new i(e);throw Error("illegal buffer")},c=function(){return t.Buffer?function(r){return(i.create=function(r){return t.Buffer.isBuffer(r)?new e(r):o(r)})(r)}:o};function u(){var e=new r(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw n(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw n(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function l(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw n(this,8);return new r(l(this.buf,this.pos+=4),l(this.buf,this.pos+=4))}return i.create=c(),i.prototype._slice=t.Array.prototype.subarray||t.Array.prototype.slice,i.prototype.uint32=(a=4294967295,function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return a;if((this.pos+=5)>this.len)throw this.pos=this.len,n(this,10);return a}),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw n(this,4);return l(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw n(this,4);return 0|l(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw n(this,4);var e=t.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},i.prototype.double=function(){if(this.pos+8>this.len)throw n(this,4);var e=t.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},i.prototype.bytes=function(){var e=this.uint32(),r=this.pos,s=this.pos+e;if(s>this.len)throw n(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(r,s);if(r===s){var i=t.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,s)},i.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},i.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw n(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw n(this)}while(128&this.buf[this.pos++]);return this},i.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},i._configure=function(r){e=r,i.create=c(),e._configure();var s=t.Long?"toLong":"toNumber";t.merge(i.prototype,{int64:function(){return u.call(this)[s](!1)},uint64:function(){return u.call(this)[s](!0)},sint64:function(){return u.call(this).zzDecode()[s](!1)},fixed64:function(){return p.call(this)[s](!0)},sfixed64:function(){return p.call(this)[s](!1)}})},reader}function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=r;var e=requireReader();(r.prototype=Object.create(e.prototype)).constructor=r;var t=requireMinimal$1();function r(t){e.call(this,t)}return r._configure=function(){t.Buffer&&(r.prototype._slice=t.Buffer.prototype.slice)},r.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},r._configure(),reader_buffer}var rpc={},service,hasRequiredService,hasRequiredRpc,roots,hasRequiredRoots,hasRequiredIndexMinimal,minimal,hasRequiredMinimal,compiled,hasRequiredCompiled,hasRequiredDenseStore;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=t;var e=requireMinimal$1();function t(t,r,s){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");e.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(r),this.responseDelimited=Boolean(s)}return(t.prototype=Object.create(e.EventEmitter.prototype)).constructor=t,t.prototype.rpcCall=function t(r,s,n,i,a){if(!i)throw TypeError("request must be specified");var o=this;if(!a)return e.asPromise(t,o,r,s,n,i);if(o.rpcImpl)try{return o.rpcImpl(r,s[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,t){if(e)return o.emit("error",e,r),a(e);if(null!==t){if(!(t instanceof n))try{t=n[o.responseDelimited?"decodeDelimited":"decode"](t)}catch(e){return o.emit("error",e,r),a(e)}return o.emit("data",t,r),a(null,t)}o.end(!0)}))}catch(e){return o.emit("error",e,r),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},t.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service}function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,function(e){e.Service=requireService()}(rpc)),rpc}function requireRoots(){return hasRequiredRoots?roots:(hasRequiredRoots=1,roots={})}function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,function(e){var t=indexMinimal;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=requireWriter$6(),t.BufferWriter=requireWriter_buffer(),t.Reader=requireReader(),t.BufferReader=requireReader_buffer(),t.util=requireMinimal$1(),t.rpc=requireRpc(),t.roots=requireRoots(),t.configure=r,r()}()),indexMinimal}function requireMinimal(){return hasRequiredMinimal?minimal:(hasRequiredMinimal=1,minimal=requireIndexMinimal())}function requireCompiled(){if(hasRequiredCompiled)return compiled;hasRequiredCompiled=1;var e=requireMinimal(),t=e.Reader,r=e.Writer,s=e.util,n=e.roots.default||(e.roots.default={});return n.DDSketch=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return s.prototype.mapping=null,s.prototype.positiveValues=null,s.prototype.negativeValues=null,s.prototype.zeroCount=0,s.create=function(e){return new s(e)},s.encode=function(e,t){return t||(t=r.create()),null!=e.mapping&&Object.hasOwnProperty.call(e,"mapping")&&n.IndexMapping.encode(e.mapping,t.uint32(10).fork()).ldelim(),null!=e.positiveValues&&Object.hasOwnProperty.call(e,"positiveValues")&&n.Store.encode(e.positiveValues,t.uint32(18).fork()).ldelim(),null!=e.negativeValues&&Object.hasOwnProperty.call(e,"negativeValues")&&n.Store.encode(e.negativeValues,t.uint32(26).fork()).ldelim(),null!=e.zeroCount&&Object.hasOwnProperty.call(e,"zeroCount")&&t.uint32(33).double(e.zeroCount),t},s.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var s=void 0===r?e.len:e.pos+r,i=new n.DDSketch;e.pos<s;){var a=e.uint32();switch(a>>>3){case 1:i.mapping=n.IndexMapping.decode(e,e.uint32());break;case 2:i.positiveValues=n.Store.decode(e,e.uint32());break;case 3:i.negativeValues=n.Store.decode(e,e.uint32());break;case 4:i.zeroCount=e.double();break;default:e.skipType(7&a)}}return i},s.decodeDelimited=function(e){return e instanceof t||(e=new t(e)),this.decode(e,e.uint32())},s.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.mapping&&e.hasOwnProperty("mapping")&&(t=n.IndexMapping.verify(e.mapping)))return"mapping."+t;if(null!=e.positiveValues&&e.hasOwnProperty("positiveValues")&&(t=n.Store.verify(e.positiveValues)))return"positiveValues."+t;if(null!=e.negativeValues&&e.hasOwnProperty("negativeValues")&&(t=n.Store.verify(e.negativeValues)))return"negativeValues."+t;return null!=e.zeroCount&&e.hasOwnProperty("zeroCount")&&"number"!=typeof e.zeroCount?"zeroCount: number expected":null},s.fromObject=function(e){if(e instanceof n.DDSketch)return e;var t=new n.DDSketch;if(null!=e.mapping){if("object"!=typeof e.mapping)throw TypeError(".DDSketch.mapping: object expected");t.mapping=n.IndexMapping.fromObject(e.mapping)}if(null!=e.positiveValues){if("object"!=typeof e.positiveValues)throw TypeError(".DDSketch.positiveValues: object expected");t.positiveValues=n.Store.fromObject(e.positiveValues)}if(null!=e.negativeValues){if("object"!=typeof e.negativeValues)throw TypeError(".DDSketch.negativeValues: object expected");t.negativeValues=n.Store.fromObject(e.negativeValues)}return null!=e.zeroCount&&(t.zeroCount=Number(e.zeroCount)),t},s.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.mapping=null,r.positiveValues=null,r.negativeValues=null,r.zeroCount=0),null!=e.mapping&&e.hasOwnProperty("mapping")&&(r.mapping=n.IndexMapping.toObject(e.mapping,t)),null!=e.positiveValues&&e.hasOwnProperty("positiveValues")&&(r.positiveValues=n.Store.toObject(e.positiveValues,t)),null!=e.negativeValues&&e.hasOwnProperty("negativeValues")&&(r.negativeValues=n.Store.toObject(e.negativeValues,t)),null!=e.zeroCount&&e.hasOwnProperty("zeroCount")&&(r.zeroCount=t.json&&!isFinite(e.zeroCount)?String(e.zeroCount):e.zeroCount),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),n.IndexMapping=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return s.prototype.gamma=0,s.prototype.indexOffset=0,s.prototype.interpolation=0,s.create=function(e){return new s(e)},s.encode=function(e,t){return t||(t=r.create()),null!=e.gamma&&Object.hasOwnProperty.call(e,"gamma")&&t.uint32(9).double(e.gamma),null!=e.indexOffset&&Object.hasOwnProperty.call(e,"indexOffset")&&t.uint32(17).double(e.indexOffset),null!=e.interpolation&&Object.hasOwnProperty.call(e,"interpolation")&&t.uint32(24).int32(e.interpolation),t},s.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var s=void 0===r?e.len:e.pos+r,i=new n.IndexMapping;e.pos<s;){var a=e.uint32();switch(a>>>3){case 1:i.gamma=e.double();break;case 2:i.indexOffset=e.double();break;case 3:i.interpolation=e.int32();break;default:e.skipType(7&a)}}return i},s.decodeDelimited=function(e){return e instanceof t||(e=new t(e)),this.decode(e,e.uint32())},s.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.gamma&&e.hasOwnProperty("gamma")&&"number"!=typeof e.gamma)return"gamma: number expected";if(null!=e.indexOffset&&e.hasOwnProperty("indexOffset")&&"number"!=typeof e.indexOffset)return"indexOffset: number expected";if(null!=e.interpolation&&e.hasOwnProperty("interpolation"))switch(e.interpolation){default:return"interpolation: enum value expected";case 0:case 1:case 2:case 3:}return null},s.fromObject=function(e){if(e instanceof n.IndexMapping)return e;var t=new n.IndexMapping;switch(null!=e.gamma&&(t.gamma=Number(e.gamma)),null!=e.indexOffset&&(t.indexOffset=Number(e.indexOffset)),e.interpolation){case"NONE":case 0:t.interpolation=0;break;case"LINEAR":case 1:t.interpolation=1;break;case"QUADRATIC":case 2:t.interpolation=2;break;case"CUBIC":case 3:t.interpolation=3}return t},s.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.gamma=0,r.indexOffset=0,r.interpolation=t.enums===String?"NONE":0),null!=e.gamma&&e.hasOwnProperty("gamma")&&(r.gamma=t.json&&!isFinite(e.gamma)?String(e.gamma):e.gamma),null!=e.indexOffset&&e.hasOwnProperty("indexOffset")&&(r.indexOffset=t.json&&!isFinite(e.indexOffset)?String(e.indexOffset):e.indexOffset),null!=e.interpolation&&e.hasOwnProperty("interpolation")&&(r.interpolation=t.enums===String?n.IndexMapping.Interpolation[e.interpolation]:e.interpolation),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s.Interpolation=function(){var e={},t=Object.create(e);return t[e[0]="NONE"]=0,t[e[1]="LINEAR"]=1,t[e[2]="QUADRATIC"]=2,t[e[3]="CUBIC"]=3,t}(),s}(),n.Store=function(){function i(e){if(this.binCounts={},this.contiguousBinCounts=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return i.prototype.binCounts=s.emptyObject,i.prototype.contiguousBinCounts=s.emptyArray,i.prototype.contiguousBinIndexOffset=0,i.create=function(e){return new i(e)},i.encode=function(e,t){if(t||(t=r.create()),null!=e.binCounts&&Object.hasOwnProperty.call(e,"binCounts"))for(var s=Object.keys(e.binCounts),n=0;n<s.length;++n)t.uint32(10).fork().uint32(8).sint32(s[n]).uint32(17).double(e.binCounts[s[n]]).ldelim();if(null!=e.contiguousBinCounts&&e.contiguousBinCounts.length){t.uint32(18).fork();for(n=0;n<e.contiguousBinCounts.length;++n)t.double(e.contiguousBinCounts[n]);t.ldelim()}return null!=e.contiguousBinIndexOffset&&Object.hasOwnProperty.call(e,"contiguousBinIndexOffset")&&t.uint32(24).sint32(e.contiguousBinIndexOffset),t},i.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var i,a,o=void 0===r?e.len:e.pos+r,c=new n.Store;e.pos<o;){var u=e.uint32();switch(u>>>3){case 1:c.binCounts===s.emptyObject&&(c.binCounts={});var l=e.uint32()+e.pos;for(i=0,a=0;e.pos<l;){var p=e.uint32();switch(p>>>3){case 1:i=e.sint32();break;case 2:a=e.double();break;default:e.skipType(7&p)}}c.binCounts[i]=a;break;case 2:if(c.contiguousBinCounts&&c.contiguousBinCounts.length||(c.contiguousBinCounts=[]),2==(7&u))for(l=e.uint32()+e.pos;e.pos<l;)c.contiguousBinCounts.push(e.double());else c.contiguousBinCounts.push(e.double());break;case 3:c.contiguousBinIndexOffset=e.sint32();break;default:e.skipType(7&u)}}return c},i.decodeDelimited=function(e){return e instanceof t||(e=new t(e)),this.decode(e,e.uint32())},i.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.binCounts&&e.hasOwnProperty("binCounts")){if(!s.isObject(e.binCounts))return"binCounts: object expected";for(var t=Object.keys(e.binCounts),r=0;r<t.length;++r){if(!s.key32Re.test(t[r]))return"binCounts: integer key{k:sint32} expected";if("number"!=typeof e.binCounts[t[r]])return"binCounts: number{k:sint32} expected"}}if(null!=e.contiguousBinCounts&&e.hasOwnProperty("contiguousBinCounts")){if(!Array.isArray(e.contiguousBinCounts))return"contiguousBinCounts: array expected";for(r=0;r<e.contiguousBinCounts.length;++r)if("number"!=typeof e.contiguousBinCounts[r])return"contiguousBinCounts: number[] expected"}return null!=e.contiguousBinIndexOffset&&e.hasOwnProperty("contiguousBinIndexOffset")&&!s.isInteger(e.contiguousBinIndexOffset)?"contiguousBinIndexOffset: integer expected":null},i.fromObject=function(e){if(e instanceof n.Store)return e;var t=new n.Store;if(e.binCounts){if("object"!=typeof e.binCounts)throw TypeError(".Store.binCounts: object expected");t.binCounts={};for(var r=Object.keys(e.binCounts),s=0;s<r.length;++s)t.binCounts[r[s]]=Number(e.binCounts[r[s]])}if(e.contiguousBinCounts){if(!Array.isArray(e.contiguousBinCounts))throw TypeError(".Store.contiguousBinCounts: array expected");t.contiguousBinCounts=[];for(s=0;s<e.contiguousBinCounts.length;++s)t.contiguousBinCounts[s]=Number(e.contiguousBinCounts[s])}return null!=e.contiguousBinIndexOffset&&(t.contiguousBinIndexOffset=0|e.contiguousBinIndexOffset),t},i.toObject=function(e,t){t||(t={});var r,s={};if((t.arrays||t.defaults)&&(s.contiguousBinCounts=[]),(t.objects||t.defaults)&&(s.binCounts={}),t.defaults&&(s.contiguousBinIndexOffset=0),e.binCounts&&(r=Object.keys(e.binCounts)).length){s.binCounts={};for(var n=0;n<r.length;++n)s.binCounts[r[n]]=t.json&&!isFinite(e.binCounts[r[n]])?String(e.binCounts[r[n]]):e.binCounts[r[n]]}if(e.contiguousBinCounts&&e.contiguousBinCounts.length){s.contiguousBinCounts=[];for(n=0;n<e.contiguousBinCounts.length;++n)s.contiguousBinCounts[n]=t.json&&!isFinite(e.contiguousBinCounts[n])?String(e.contiguousBinCounts[n]):e.contiguousBinCounts[n]}return null!=e.contiguousBinIndexOffset&&e.hasOwnProperty("contiguousBinIndexOffset")&&(s.contiguousBinIndexOffset=e.contiguousBinIndexOffset),s},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),compiled=n}function requireDenseStore(){if(hasRequiredDenseStore)return DenseStore;hasRequiredDenseStore=1;var e=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(DenseStore,"__esModule",{value:!0}),DenseStore.DenseStore=void 0;var t=requireUtil$8(),r=function(){function r(e){void 0===e&&(e=128),this.chunkSize=e,this.bins=[],this.count=0,this.minKey=1/0,this.maxKey=-1/0,this.offset=0}return r.prototype.add=function(e,t){void 0===t&&(t=1);var r=this._getIndex(e);this.bins[r]+=t,this.count+=t},r.prototype.keyAtRank=function(e,t){void 0===t&&(t=!0);for(var r=0,s=0;s<this.length();s++){if(r+=this.bins[s],t&&r>e||!t&&r>=e+1)return s+this.offset}return this.maxKey},r.prototype.merge=function(e){if(0!==e.count)if(0!==this.count){(e.minKey<this.minKey||e.maxKey>this.maxKey)&&this._extendRange(e.minKey,e.maxKey);var r=e.minKey-e.offset,s=Math.min(this.minKey,e.maxKey+1)-e.offset;if(s>r){var n=(0,t.sumOfRange)(e.bins,r,s);this.bins[0]+=n}else s=r;for(var i=s+e.offset;i<e.maxKey+1;i++)this.bins[i-this.offset]+=e.bins[i-e.offset];this.count+=e.count}else this.copy(e)},r.prototype.copy=function(t){this.bins=e([],t.bins,!0),this.count=t.count,this.minKey=t.minKey,this.maxKey=t.maxKey,this.offset=t.offset},r.prototype.length=function(){return this.bins.length},r.prototype._getNewLength=function(e,t){var r=t-e+1;return this.chunkSize*Math.ceil(r/this.chunkSize)},r.prototype._adjust=function(e,t){this._centerBins(e,t),this.minKey=e,this.maxKey=t},r.prototype._shiftBins=function(e){var t,r;e>0?(this.bins=this.bins.slice(0,-e),(t=this.bins).unshift.apply(t,new Array(e).fill(0))):(this.bins=this.bins.slice(Math.abs(e)),(r=this.bins).push.apply(r,new Array(Math.abs(e)).fill(0))),this.offset-=e},r.prototype._centerBins=function(e,t){var r=e+Math.floor((t-e+1)/2);this._shiftBins(Math.floor(this.offset+this.length()/2)-r)},r.prototype._extendRange=function(e,t){var r;t=t||e;var s=Math.min(e,t,this.minKey),n=Math.max(e,t,this.maxKey);if(0===this.length())this.bins=new Array(this._getNewLength(s,n)).fill(0),this.offset=s,this._adjust(s,n);else if(s>=this.minKey&&n<this.offset+this.length())this.minKey=s,this.maxKey=n;else{var i=this._getNewLength(s,n);i>this.length()&&(r=this.bins).push.apply(r,new Array(i-this.length()).fill(0)),this._adjust(s,n)}},r.prototype._getIndex=function(e){return(e<this.minKey||e>this.maxKey)&&this._extendRange(e),e-this.offset},r.prototype.toProto=function(){return requireCompiled().Store.create({contiguousBinCounts:this.bins,contiguousBinIndexOffset:this.offset})},r.fromProto=function(e){if(!e||null==e.contiguousBinCounts||null==e.contiguousBinIndexOffset)throw Error("Failed to decode store from protobuf");var t=new this,r=e.contiguousBinIndexOffset;t.offset=r;for(var s=0,n=e.contiguousBinCounts;s<n.length;s++){var i=n[s];t.add(r,i),r+=1}return t},r}();return DenseStore.DenseStore=r,DenseStore}var CollapsingLowestDenseStore={},hasRequiredCollapsingLowestDenseStore;function requireCollapsingLowestDenseStore(){if(hasRequiredCollapsingLowestDenseStore)return CollapsingLowestDenseStore;hasRequiredCollapsingLowestDenseStore=1;var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(CollapsingLowestDenseStore,"__esModule",{value:!0}),CollapsingLowestDenseStore.CollapsingLowestDenseStore=void 0;var t=requireDenseStore(),r=requireUtil$8(),s=function(t){function s(e,r){var s=t.call(this,r)||this;return s.binLimit=e,s.isCollapsed=!1,s}return e(s,t),s.prototype.merge=function(e){if(0!==e.count)if(0!==this.count){(e.minKey<this.minKey||e.maxKey>this.maxKey)&&this._extendRange(e.minKey,e.maxKey);var t=e.minKey-e.offset,s=Math.min(this.minKey,e.maxKey+1)-e.offset;if(s>t){var n=(0,r.sumOfRange)(e.bins,t,s);this.bins[0]+=n}else s=t;for(var i=s+e.offset;i<e.maxKey+1;i++)this.bins[i-this.offset]+=e.bins[i-e.offset];this.count+=e.count}else this.copy(e)},s.prototype.copy=function(e){t.prototype.copy.call(this,e),this.isCollapsed=e.isCollapsed},s.prototype._getNewLength=function(e,t){var r=t-e+1;return Math.min(this.chunkSize*Math.ceil(r/this.chunkSize),this.binLimit)},s.prototype._adjust=function(e,t){if(t-e+1>this.length()){if((e=t-this.length()+1)>=this.maxKey)this.offset=e,this.minKey=e,this.bins.fill(0),this.bins[0]=this.count;else{var s=this.offset-e;if(s<0){var n=this.minKey-this.offset,i=e-this.offset,a=(0,r.sumOfRange)(this.bins,n,i);this.bins.fill(0,n,i),this.bins[i]+=a,this.minKey=e,this._shiftBins(s)}else this.minKey=e,this._shiftBins(s)}this.maxKey=t,this.isCollapsed=!0}else this._centerBins(e,t),this.minKey=e,this.maxKey=t},s.prototype._getIndex=function(e){if(e<this.minKey){if(this.isCollapsed)return 0;if(this._extendRange(e),this.isCollapsed)return 0}else e>this.maxKey&&this._extendRange(e);return e-this.offset},s}(t.DenseStore);return CollapsingLowestDenseStore.CollapsingLowestDenseStore=s,CollapsingLowestDenseStore}var CollapsingHighestDenseStore={},hasRequiredCollapsingHighestDenseStore,hasRequiredStore;function requireCollapsingHighestDenseStore(){if(hasRequiredCollapsingHighestDenseStore)return CollapsingHighestDenseStore;hasRequiredCollapsingHighestDenseStore=1;var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(CollapsingHighestDenseStore,"__esModule",{value:!0}),CollapsingHighestDenseStore.CollapsingHighestDenseStore=void 0;var t=requireDenseStore(),r=requireUtil$8(),s=function(t){function s(e,r){var s=t.call(this,r)||this;return s.binLimit=e,s.isCollapsed=!1,s}return e(s,t),s.prototype.merge=function(e){if(0!==e.count)if(0!==this.count){(e.minKey<this.minKey||e.maxKey>this.maxKey)&&this._extendRange(e.minKey,e.maxKey);var t=e.maxKey-e.offset+1,s=Math.max(this.maxKey+1,e.minKey)-e.offset;if(t>s){var n=(0,r.sumOfRange)(e.bins,s,t);this.bins[this.length()-1]+=n}else s=t;for(var i=e.minKey;i<s+e.offset;i++)this.bins[i-this.offset]+=e.bins[i-e.offset];this.count+=e.count}else this.copy(e)},s.prototype.copy=function(e){t.prototype.copy.call(this,e),this.isCollapsed=e.isCollapsed},s.prototype._getNewLength=function(e,t){var r=t-e+1;return Math.min(this.chunkSize*Math.ceil(r/this.chunkSize),this.binLimit)},s.prototype._adjust=function(e,t){if(t-e+1>this.length())if((t=e+this.length()+1)<=this.minKey)this.offset=e,this.maxKey=t,this.bins.fill(0),this.bins[this.length()-1]=this.count;else{var s=this.offset-e;if(s>0){var n=t-this.offset+1,i=this.maxKey-this.offset+1,a=(0,r.sumOfRange)(this.bins,n,i);this.bins.fill(0,n,i),this.bins[n-1]+=a,this.maxKey=t,this._shiftBins(s)}else this.maxKey=t,this._shiftBins(s);this.minKey=e,this.isCollapsed=!0}else this._centerBins(e,t),this.minKey=e,this.maxKey=t},s.prototype._getIndex=function(e){if(e<this.minKey){if(this.isCollapsed)return this.length()-1;if(this._extendRange(e),this.isCollapsed)return this.length()-1}else e>this.maxKey&&this._extendRange(e);return e-this.offset},s}(t.DenseStore);return CollapsingHighestDenseStore.CollapsingHighestDenseStore=s,CollapsingHighestDenseStore}function requireStore(){return hasRequiredStore||(hasRequiredStore=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CollapsingHighestDenseStore=e.CollapsingLowestDenseStore=e.DenseStore=void 0;var t=requireDenseStore();Object.defineProperty(e,"DenseStore",{enumerable:!0,get:function(){return t.DenseStore}});var r=requireCollapsingLowestDenseStore();Object.defineProperty(e,"CollapsingLowestDenseStore",{enumerable:!0,get:function(){return r.CollapsingLowestDenseStore}});var s=requireCollapsingHighestDenseStore();Object.defineProperty(e,"CollapsingHighestDenseStore",{enumerable:!0,get:function(){return s.CollapsingHighestDenseStore}})}(store)),store}var mapping={},KeyMapping={},hasRequiredKeyMapping;function requireKeyMapping(){if(hasRequiredKeyMapping)return KeyMapping;hasRequiredKeyMapping=1,Object.defineProperty(KeyMapping,"__esModule",{value:!0}),KeyMapping.KeyMapping=void 0;var e=requireMapping(),t=Math.pow(2,-1023),r=Number.MAX_VALUE,s=function(){function s(e,s){if(void 0===s&&(s=0),e<=0||e>=1)throw Error("Relative accuracy must be between 0 and 1 when initializing a KeyMapping");this.relativeAccuracy=e,this._offset=s;var n=2*e/(1-e);this.gamma=1+n,this._multiplier=1/Math.log1p(n),this.minPossible=t*this.gamma,this.maxPossible=r/this.gamma}return s.fromGammaOffset=function(e,t){return new this((e-1)/(e+1),t)},s.prototype.key=function(e){return Math.ceil(this._logGamma(e))+this._offset},s.prototype.value=function(e){return this._powGamma(e-this._offset)*(2/(1+this.gamma))},s.prototype.toProto=function(){return requireCompiled().IndexMapping.create({gamma:this.gamma,indexOffset:this._offset,interpolation:this._protoInterpolation()})},s.fromProto=function(t){if(!t||null==t.gamma||null==t.indexOffset)throw Error("Failed to decode mapping from protobuf");var r=requireCompiled().IndexMapping.Interpolation,s=t.interpolation,n=t.gamma,i=t.indexOffset;switch(s){case r.NONE:return e.LogarithmicMapping.fromGammaOffset(n,i);case r.LINEAR:return e.LinearlyInterpolatedMapping.fromGammaOffset(n,i);case r.CUBIC:return e.CubicallyInterpolatedMapping.fromGammaOffset(n,i);default:throw Error("Unrecognized mapping when decoding from protobuf")}},s.prototype._logGamma=function(e){return Math.log2(e)*this._multiplier},s.prototype._powGamma=function(e){return Math.pow(2,e/this._multiplier)},s.prototype._protoInterpolation=function(){return requireCompiled().IndexMapping.Interpolation.NONE},s}();return KeyMapping.KeyMapping=s,KeyMapping}var LogarithmicMapping={},hasRequiredLogarithmicMapping;function requireLogarithmicMapping(){if(hasRequiredLogarithmicMapping)return LogarithmicMapping;hasRequiredLogarithmicMapping=1;var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(LogarithmicMapping,"__esModule",{value:!0}),LogarithmicMapping.LogarithmicMapping=void 0;var t=function(t){function r(e,r){void 0===r&&(r=0);var s=t.call(this,e,r)||this;return s._multiplier*=Math.log(2),s}return e(r,t),r.prototype._logGamma=function(e){return Math.log2(e)*this._multiplier},r.prototype._powGamma=function(e){return Math.pow(2,e/this._multiplier)},r.prototype._protoInterpolation=function(){return requireCompiled().IndexMapping.Interpolation.NONE},r}(requireKeyMapping().KeyMapping);return LogarithmicMapping.LogarithmicMapping=t,LogarithmicMapping}var LinearlyInterpolatedMapping={},math={},hasRequiredMath,hasRequiredLinearlyInterpolatedMapping;function requireMath(){if(hasRequiredMath)return math;return hasRequiredMath=1,Object.defineProperty(math,"__esModule",{value:!0}),math.ldexp=math.frexp=void 0,math.frexp=function(e){if(0===e||!Number.isFinite(e))return[e,0];for(var t=Math.abs(e),r=Math.max(-1023,Math.floor(Math.log2(t))+1),s=t*Math.pow(2,-r);s<.5;)s*=2,r--;for(;s>=1;)s*=.5,r++;return e<0&&(s=-s),[s,r]},math.ldexp=function(e,t){for(var r=Math.min(3,Math.ceil(Math.abs(t)/1023)),s=e,n=0;n<r;n++)s*=Math.pow(2,Math.floor((t+n)/r));return s},math}function requireLinearlyInterpolatedMapping(){if(hasRequiredLinearlyInterpolatedMapping)return LinearlyInterpolatedMapping;hasRequiredLinearlyInterpolatedMapping=1;var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(LinearlyInterpolatedMapping,"__esModule",{value:!0}),LinearlyInterpolatedMapping.LinearlyInterpolatedMapping=void 0;var t=requireKeyMapping(),r=requireMath(),s=function(t){function s(e,r){return void 0===r&&(r=0),t.call(this,e,r)||this}return e(s,t),s.prototype._log2Approx=function(e){var t=(0,r.frexp)(e);return 2*t[0]-1+(t[1]-1)},s.prototype._exp2Approx=function(e){var t=Math.floor(e)+1,s=(e-t+2)/2;return(0,r.ldexp)(s,t)},s.prototype._logGamma=function(e){return Math.log2(e)*this._multiplier},s.prototype._powGamma=function(e){return Math.pow(2,e/this._multiplier)},s.prototype._protoInterpolation=function(){return requireCompiled().IndexMapping.Interpolation.LINEAR},s}(t.KeyMapping);return LinearlyInterpolatedMapping.LinearlyInterpolatedMapping=s,LinearlyInterpolatedMapping}var CubicallyInterpolatedMapping={},hasRequiredCubicallyInterpolatedMapping,hasRequiredMapping,hasRequiredDDSketch,hasRequiredDdsketch,hasRequiredDist$1,histogram$1,hasRequiredHistogram,nodeGypBuild,hasRequiredNodeGypBuild,nativeMetrics_1,hasRequiredNativeMetrics,runtime_metrics,hasRequiredRuntime_metrics,sendData_1,hasRequiredSendData,metrics$1,hasRequiredMetrics;function requireCubicallyInterpolatedMapping(){if(hasRequiredCubicallyInterpolatedMapping)return CubicallyInterpolatedMapping;hasRequiredCubicallyInterpolatedMapping=1;var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(CubicallyInterpolatedMapping,"__esModule",{value:!0}),CubicallyInterpolatedMapping.CubicallyInterpolatedMapping=void 0;var t=requireKeyMapping(),r=requireMath(),s=function(t){function s(e,r){void 0===r&&(r=0);var s=t.call(this,e,r)||this;return s.A=6/35,s.B=-.6,s.C=10/7,s._multiplier/=s.C,s}return e(s,t),s.prototype._cubicLog2Approx=function(e){var t=(0,r.frexp)(e),s=t[0],n=t[1],i=2*s-1;return((this.A*i+this.B)*i+this.C)*i+(n-1)},s.prototype._cubicExp2Approx=function(e){var t=Math.floor(e),s=this.B*this.B-3*this.A*this.C,n=2*this.B*this.B*this.B-9*this.A*this.B*this.C-27*this.A*this.A*(e-t),i=Math.cbrt((n-Math.sqrt(n*n-4*s*s*s))/2),a=(-(this.B+i+s/i)/(3*this.A)+1)/2;return(0,r.ldexp)(a,t+1)},s.prototype._logGamma=function(e){return this._cubicLog2Approx(e)*this._multiplier},s.prototype._powGamma=function(e){return this._cubicExp2Approx(e/this._multiplier)},s.prototype._protoInterpolation=function(){return requireCompiled().IndexMapping.Interpolation.CUBIC},s}(t.KeyMapping);return CubicallyInterpolatedMapping.CubicallyInterpolatedMapping=s,CubicallyInterpolatedMapping}function requireMapping(){return hasRequiredMapping||(hasRequiredMapping=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CubicallyInterpolatedMapping=e.LinearlyInterpolatedMapping=e.LogarithmicMapping=e.KeyMapping=void 0;var t=requireKeyMapping();Object.defineProperty(e,"KeyMapping",{enumerable:!0,get:function(){return t.KeyMapping}});var r=requireLogarithmicMapping();Object.defineProperty(e,"LogarithmicMapping",{enumerable:!0,get:function(){return r.LogarithmicMapping}});var s=requireLinearlyInterpolatedMapping();Object.defineProperty(e,"LinearlyInterpolatedMapping",{enumerable:!0,get:function(){return s.LinearlyInterpolatedMapping}});var n=requireCubicallyInterpolatedMapping();Object.defineProperty(e,"CubicallyInterpolatedMapping",{enumerable:!0,get:function(){return n.CubicallyInterpolatedMapping}})}(mapping)),mapping}function requireDDSketch(){if(hasRequiredDDSketch)return DDSketch;hasRequiredDDSketch=1;var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(DDSketch,"__esModule",{value:!0}),DDSketch.LogCollapsingHighestDenseDDSketch=DDSketch.LogCollapsingLowestDenseDDSketch=DDSketch.DDSketch=void 0;var t=requireStore(),r=requireMapping(),s=.01,n=function(){function e(e){var t=e.mapping,r=e.store,s=e.negativeStore,n=e.zeroCount;this.mapping=t,this.store=r,this.negativeStore=s,this.zeroCount=n,this.count=this.negativeStore.count+this.zeroCount+this.store.count,this.min=1/0,this.max=-1/0,this.sum=0}return e.prototype.accept=function(e,t){if(void 0===t&&(t=1),t<=0)throw Error("Weight must be a positive number");if(e>this.mapping.minPossible){var r=this.mapping.key(e);this.store.add(r,t)}else if(e<-this.mapping.minPossible){r=this.mapping.key(-e);this.negativeStore.add(r,t)}else this.zeroCount+=t;this.count+=t,this.sum+=e*t,e<this.min&&(this.min=e),e>this.max&&(this.max=e)},e.prototype.getValueAtQuantile=function(e){if(e<0||e>1||0===this.count)return NaN;var t=e*(this.count-1),r=0;if(t<this.negativeStore.count){var s=this.negativeStore.count-t-1,n=this.negativeStore.keyAtRank(s,!1);r=-this.mapping.value(n)}else{if(t<this.zeroCount+this.negativeStore.count)return 0;n=this.store.keyAtRank(t-this.zeroCount-this.negativeStore.count);r=this.mapping.value(n)}return r},e.prototype.merge=function(e){if(!this.mergeable(e))throw new Error("Cannot merge two DDSketches with different `relativeAccuracy` parameters");0!==e.count&&(0!==this.count?(this.store.merge(e.store),this.zeroCount+=e.zeroCount,this.count+=e.count,this.sum+=e.sum,e.min<this.min&&(this.min=e.min),e.max>this.max&&(this.max=e.max)):this._copy(e))},e.prototype.mergeable=function(e){return this.mapping.gamma===e.mapping.gamma},e.prototype._copy=function(e){this.store.copy(e.store),this.negativeStore.copy(e.negativeStore),this.zeroCount=e.zeroCount,this.min=e.min,this.max=e.max,this.count=e.count,this.sum=e.sum},e.prototype.toProto=function(){var e=requireCompiled().DDSketch,t=e.create({mapping:this.mapping.toProto(),positiveValues:this.store.toProto(),negativeValues:this.negativeStore.toProto(),zeroCount:this.zeroCount});return e.encode(t).finish()},e.fromProto=function(s){var n=requireCompiled().DDSketch.decode(s);return new e({mapping:r.KeyMapping.fromProto(n.mapping),store:t.DenseStore.fromProto(n.positiveValues),negativeStore:t.DenseStore.fromProto(n.negativeValues),zeroCount:n.zeroCount})},e}(),i={relativeAccuracy:s},a=function(n){function a(e){var a=(void 0===e?i:e).relativeAccuracy,o=void 0===a?s:a,c=new r.LogarithmicMapping(o),u=new t.DenseStore,l=new t.DenseStore;return n.call(this,{mapping:c,store:u,negativeStore:l,zeroCount:0})||this}return e(a,n),a}(n);DDSketch.DDSketch=a;var o=function(n){function a(e){var a=void 0===e?i:e,o=a.relativeAccuracy,c=void 0===o?s:o,u=a.binLimit,l=void 0===u?2048:u,p=new r.LogarithmicMapping(c),d=new t.CollapsingLowestDenseStore(l),h=new t.CollapsingLowestDenseStore(l);return n.call(this,{mapping:p,store:d,negativeStore:h,zeroCount:0})||this}return e(a,n),a}(n);DDSketch.LogCollapsingLowestDenseDDSketch=o;var c=function(n){function a(e){var a=void 0===e?i:e,o=a.relativeAccuracy,c=void 0===o?s:o,u=a.binLimit,l=void 0===u?2048:u,p=new r.LogarithmicMapping(c),d=new t.CollapsingHighestDenseStore(l),h=new t.CollapsingHighestDenseStore(l);return n.call(this,{mapping:p,store:d,negativeStore:h,zeroCount:0})||this}return e(a,n),a}(n);return DDSketch.LogCollapsingHighestDenseDDSketch=c,DDSketch}function requireDdsketch(){return hasRequiredDdsketch||(hasRequiredDdsketch=1,function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,r){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(r,s)||t(r,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),r(requireDDSketch(),e)}(ddsketch)),ddsketch}function requireDist$1(){return hasRequiredDist$1||(hasRequiredDist$1=1,function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,r){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(r,s)||t(r,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),r(requireDdsketch(),e)}(dist$1)),dist$1}function requireHistogram(){if(hasRequiredHistogram)return histogram$1;hasRequiredHistogram=1;const{DDSketch:e}=requireDist$1();return histogram$1=class{constructor(){this.reset()}get min(){return this._min}get max(){return this._max}get avg(){return 0===this._count?0:this._sum/this._count}get sum(){return this._sum}get count(){return this._count}get median(){return this.percentile(50)}get p95(){return this.percentile(95)}percentile(e){return this._histogram.getValueAtQuantile(e/100)||0}record(e){0===this._count?this._min=this._max=e:(this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)),this._count++,this._sum+=e,this._histogram.accept(e)}reset(){this._min=0,this._max=0,this._sum=0,this._count=0,this._histogram=new e}}}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function requireNodeGypBuild(){if(hasRequiredNodeGypBuild)return nodeGypBuild;hasRequiredNodeGypBuild=1;var e=require$$0$6,t=require$$0$1,r=require$$0$a,s="function"==typeof __webpack_require__?__non_webpack_require__:commonjsRequire,n=!!process.env.PREBUILDS_ONLY,i=process.versions.modules,a=!(!process.versions||!process.versions.electron)||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":"node",o=r.arch(),c=r.platform(),u=process.env.LIBC||(function(t){return"linux"===t&&e.existsSync("/etc/alpine-release")}(c)?"musl":"glibc"),l=process.env.ARM_VERSION||("arm64"===o?"8":process.config.variables.arm_version)||"";function p(e){return s(p.path(e))}function d(r,s){try{var n=e.readdirSync(r).filter(s);return n[0]&&t.join(r,n[0])}catch(e){return null}}function h(e){return e===a+"-napi.node"}function f(e){return"node-napi.node"===e}function g(e){var t=e.split("-");return t[0]===a&&t[1]===i+".node"}function m(e){return/\.node$/.test(e)}return nodeGypBuild=p,p.path=function(e){e=t.resolve(e||".");try{var r=s(t.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[r+"_PREBUILD"]&&(e=process.env[r+"_PREBUILD"])}catch(e){}if(!n){var p=d(t.join(e,"build/Release"),m);if(p)return p;var _=d(t.join(e,"build/Debug"),m);if(_)return _}var b=[c+"-"+o];u&&b.push(c+u+"-"+o),"arm"!==o&&"arm64"!==o||!l||b.forEach((function(e){b.push(e+"-v"+l)}));for(var y=b.length;y--;){var v=d(t.join(e,"prebuilds/"+b[y]),g);if(v)return v;var S=d(t.join(e,"prebuilds/"+b[y]),h);if(S)return S;var q=d(t.join(e,"prebuilds/"+b[y]),f);if(q)return q}throw new Error("No native build was found for runtime="+a+" abi="+i+" platform="+c+u+" arch="+o)},nodeGypBuild}function requireNativeMetrics(){if(hasRequiredNativeMetrics)return nativeMetrics_1;hasRequiredNativeMetrics=1;const e=requireNodeGypBuild()(__dirname);return nativeMetrics_1=e}function requireRuntime_metrics(){if(hasRequiredRuntime_metrics)return runtime_metrics;hasRequiredRuntime_metrics=1;const e=require$$0$b,t=require$$0$a,{DogStatsDClient:r}=requireDogstatsd(),s=requireLog$2(),n=requireHistogram(),{performance:i}=require$$0$5;let a,o,c,u,l,p,d,h,f=null;function g(){a=null,o=null,c=null,u=null,l={},p={},d={},f=null}g(),runtime_metrics={start(t){const n=r.generateClientConfig(t);try{f=requireNativeMetrics(),f.start()}catch(e){s.error(e),f=null}o=new r(n),c=process.hrtime(),f?a=setInterval((()=>{_(),function(){const e=f.stats(),t=e.heap.spaces,r=process.hrtime(c);c=process.hrtime();const s=1e6*r[0]+r[1]/1e3,n=100*e.cpu.user/s,i=100*e.cpu.system/s,a=n+i;o.gauge("runtime.node.cpu.system",i.toFixed(2)),o.gauge("runtime.node.cpu.user",n.toFixed(2)),o.gauge("runtime.node.cpu.total",a.toFixed(2)),b("runtime.node.event_loop.delay",e.eventLoop),Object.keys(e.gc).forEach((t=>{"all"===t?b("runtime.node.gc.pause",e.gc[t]):b("runtime.node.gc.pause.by.type",e.gc[t],[`gc_type:${t}`])}));for(let e=0,r=t.length;e<r;e++){const r=[`heap_space:${t[e].space_name}`];o.gauge("runtime.node.heap.size.by.space",t[e].space_size,r),o.gauge("runtime.node.heap.used_size.by.space",t[e].space_used_size,r),o.gauge("runtime.node.heap.available_size.by.space",t[e].space_available_size,r),o.gauge("runtime.node.heap.physical_size.by.space",t[e].physical_space_size,r)}}(),o.flush()}),1e4):(u=process.cpuUsage(),a=setInterval((()=>{_(),function(){if(!process.cpuUsage)return;const e=process.hrtime(c),t=process.cpuUsage(u);c=process.hrtime(),u=process.cpuUsage();const r=1e3*e[0]+e[1]/1e6,s=100*t.user/1e3/r,n=100*t.system/1e3/r,i=s+n;o.gauge("runtime.node.cpu.system",n.toFixed(2)),o.gauge("runtime.node.cpu.user",s.toFixed(2)),o.gauge("runtime.node.cpu.total",i.toFixed(2))}(),function(){if(!e.getHeapSpaceStatistics)return;const t=e.getHeapSpaceStatistics();for(let e=0,r=t.length;e<r;e++){const r=[`space:${t[e].space_name}`];o.gauge("runtime.node.heap.size.by.space",t[e].space_size,r),o.gauge("runtime.node.heap.used_size.by.space",t[e].space_used_size,r),o.gauge("runtime.node.heap.available_size.by.space",t[e].space_available_size,r),o.gauge("runtime.node.heap.physical_size.by.space",t[e].physical_space_size,r)}}(),o.flush()}),1e4)),a.unref()},stop(){f&&f.stop(),clearInterval(a),g()},track(e){if(f){const t=f.track(e);return{finish:()=>f.finish(t)}}return{finish:()=>{}}},boolean(e,t,r){this.gauge(e,t?1:0,r)},histogram(e,t,r){o&&(d[e]=d[e]||new Map,d[e].has(r)||d[e].set(r,new n),d[e].get(r).record(t))},count(e,t,r,s=!1){if(!o)return;"boolean"==typeof r&&(s=r,r=void 0);const n=s?p:l;n[e]=n[e]||new Map;const i=n[e].get(r)||0;n[e].set(r,i+t)},gauge(e,t,r){o&&(l[e]=l[e]||new Map,l[e].set(r,t))},increment(e,t,r){this.count(e,1,t,r)},decrement(e,t){this.count(e,-1,t)}};const m="eventLoopUtilization"in i?()=>{h=i.eventLoopUtilization(h),o.gauge("runtime.node.event_loop.utilization",h.utilization)}:()=>{};function _(){!function(){const e=process.memoryUsage();o.gauge("runtime.node.mem.heap_total",e.heapTotal),o.gauge("runtime.node.mem.heap_used",e.heapUsed),o.gauge("runtime.node.mem.rss",e.rss),o.gauge("runtime.node.mem.total",t.totalmem()),o.gauge("runtime.node.mem.free",t.freemem()),e.external&&o.gauge("runtime.node.mem.external",e.external)}(),o.gauge("runtime.node.process.uptime",Math.round(process.uptime())),function(){const t=e.getHeapStatistics();o.gauge("runtime.node.heap.total_heap_size",t.total_heap_size),o.gauge("runtime.node.heap.total_heap_size_executable",t.total_heap_size_executable),o.gauge("runtime.node.heap.total_physical_size",t.total_physical_size),o.gauge("runtime.node.heap.total_available_size",t.total_available_size),o.gauge("runtime.node.heap.heap_size_limit",t.heap_size_limit),t.malloced_memory&&o.gauge("runtime.node.heap.malloced_memory",t.malloced_memory),t.peak_malloced_memory&&o.gauge("runtime.node.heap.peak_malloced_memory",t.peak_malloced_memory)}(),Object.keys(l).forEach((e=>{l[e].forEach(((t,r)=>{o.gauge(e,t,r&&[r])}))})),Object.keys(p).forEach((e=>{p[e].forEach(((t,r)=>{o.increment(e,t,r&&[r])}))})),p={},Object.keys(d).forEach((e=>{d[e].forEach(((t,r)=>{b(e,t,r&&[r]),t.reset()}))})),m()}function b(e,t,r){r=[].concat(r),o.gauge(`${e}.min`,t.min,r),o.gauge(`${e}.max`,t.max,r),o.increment(`${e}.sum`,t.sum,r),o.increment(`${e}.total`,t.sum,r),o.gauge(`${e}.avg`,t.avg,r),o.increment(`${e}.count`,t.count,r),o.gauge(`${e}.median`,t.median,r),o.gauge(`${e}.95percentile`,t.p95,r)}return runtime_metrics}function requireSendData(){if(hasRequiredSendData)return sendData_1;hasRequiredSendData=1;const e=requireRequest(),t=requireLog$2(),{isTrue:r}=requireUtil$9();let s=!0;function n(e,t,r){const s={"content-type":"application/json","dd-telemetry-api-version":"v2","dd-telemetry-request-type":r,"dd-client-library-language":t.language_name,"dd-client-library-version":t.tracer_version};return e.telemetry&&e.telemetry.debug&&(s["dd-telemetry-debug-enabled"]="true"),e.apiKey&&(s["dd-api-key"]=e.apiKey),s}function i(e){return"datad0g.com"===e?"https://all-http-intake.logs.datad0g.com":`https://instrumentation-telemetry-intake.${e}`}let a=0;function o(e){if(Array.isArray(e))return e;{const{logger:t,tags:r,serviceMapping:s,...n}=e;return n}}return sendData_1={sendData:function(c,u,l,p,d={},h=(()=>{})){const{hostname:f,port:g,isCiVisibility:m}=c;let _=c.url;const b=m&&r(process.env.DD_CIVISIBILITY_AGENTLESS_ENABLED);if(b)try{_=_||new URL(i(c.site))}catch(e){return t.error(e),h(e,{payload:d,reqType:p})}const y={url:_,hostname:f,port:g,method:"POST",path:b?"/api/v2/apmtelemetry":"/telemetry/proxy/api/v2/apmtelemetry",headers:n(c,u,p)},v=JSON.stringify({api_version:"v2",naming_schema_version:c.spanAttributeSchema?c.spanAttributeSchema:"",request_type:p,tracer_time:Math.floor(Date.now()/1e3),runtime_id:c.tags["runtime-id"],seq_id:++a,payload:o(d),application:u,host:l});e(v,y,(r=>{if(r&&process.env.DD_API_KEY&&c.site){s&&(t.warn("Agent telemetry failed, started agentless telemetry"),s=!1);const r=i(c.site),n={...y.headers,"DD-API-KEY":process.env.DD_API_KEY},a={...y,url:r,headers:n,path:"/api/v2/apmtelemetry"};r?e(v,a,(e=>{t.error(e)})):t.error("Invalid Telemetry URL")}r||s||(s=!0,t.info("Started agent telemetry")),h(r,{payload:d,reqType:p})}))}},sendData_1}function requireMetrics(){if(hasRequiredMetrics)return metrics$1;hasRequiredMetrics=1;const{sendData:e}=requireSendData();function t(e={}){if(Array.isArray(e))return e;const t=[];for(const[r,s]of Object.entries(e))t.push(`${r}:${s}`.toLowerCase());return t}function r(){return Date.now()/1e3}function s(e){return Array.from(e.values()).map((e=>e.toJSON()))}function n(e){return e.points.length>0}class i{constructor(e,r,s,n){this.namespace=e.toString(),this.metric=s?r:`nodejs.${r}`,this.tags=t(n),s&&this.tags.push(`version:${process.version}`),this.common=s,this.points=[]}toString(){const{namespace:e,metric:t}=this;return`${e}.${t}`}reset(){this.points=[]}track(){throw new Error("not implemented")}toJSON(){const{metric:e,points:t,interval:r,type:s,tags:n,common:i}=this;return{metric:e,points:t,interval:r,type:s,tags:n,common:i}}}class a extends i{get type(){return"count"}inc(e){return this.track(e)}dec(e=-1){return this.track(e)}track(e=1){this.points.length?this.points[0][1]+=e:this.points.push([r(),e])}}class o extends i{get type(){return"distribution"}track(e=1){this.points.push(e)}toJSON(){const{metric:e,points:t,tags:r,common:s}=this;return{metric:e,points:t,common:s,tags:r}}}class c extends i{get type(){return"gauge"}mark(e){return this.track(e)}track(e=1){this.points.push([r(),e])}}class u extends i{constructor(e,t,r,s,n){super(e,t,r,s),this.interval=n,this.rate=0}get type(){return"rate"}reset(){super.reset(),this.rate=0}track(e=1){this.rate+=e;const t=this.interval?this.rate/this.interval:0;this.points=[[r(),t]]}}const l={count:a,distribution:o,gauge:c,rate:u};class p extends Map{constructor(e){super(),this.namespace=e}reset(){for(const e of this.values())e.reset()}toString(){return this.namespace}toJSON(){if(!this.size)return;const e=s(this).filter(n);if(!e.length)return;const{namespace:t}=this;return{namespace:t,series:e}}}function d(e,r,s,n,i){const a=function(e,r,s,n){return`${e}:${r}.${s}:${t(n).sort().join(",")}`}(r,e,s,n);let o=e.get(a);if(o)return o;const c=l[r];if(!c)throw new Error(`Unknown metric type ${r}`);return o=new c(e,s,!0,n,i),e.set(a,o),o}class h{constructor(e){this.distributions=new p(e),this.metrics=new p(e)}reset(){this.metrics.reset(),this.distributions.reset()}count(e,t){return d(this.metrics,"count",e,t)}gauge(e,t){return d(this.metrics,"gauge",e,t)}rate(e,t,r){return d(this.metrics,"rate",e,r,t)}distribution(e,t){return d(this.distributions,"distribution",e,t)}toJSON(){const{distributions:e,metrics:t}=this;return{distributions:e.toJSON(),metrics:t.toJSON()}}}class f extends Map{namespace(e){let t=this.get(e);return t||(t=new h(e),this.set(e,t),t)}toJSON(){return s(this)}send(t,r,s){for(const n of this.values()){const{metrics:i,distributions:a}=n.toJSON();i&&e(t,r,s,"generate-metrics",i),a&&e(t,r,s,"distributions",a),n.reset()}}}const g=new f;return metrics$1={CountMetric:a,DistributionMetric:o,GaugeMetric:c,RateMetric:u,MetricsCollection:p,Namespace:h,NamespaceManager:f,manager:g}}var spanleak={},intersect_1,hasRequiredIntersect,set$1,hasRequiredSet,hasRequiredSpanleak,span$1,hasRequiredSpan$1,constants$2,hasRequiredConstants$2,tags_1,hasRequiredTags$2,kinds$1,hasRequiredKinds,span,hasRequiredSpan,tracer$3,hasRequiredTracer$2,tracer_provider,hasRequiredTracer_provider,proxy$1,hasRequiredProxy$1,extraServices_1,hasRequiredExtraServices,format_1,hasRequiredFormat,formats,hasRequiredFormats,types$1,hasRequiredTypes$1,exporters,hasRequiredExporters,ext$1,hasRequiredExt$1;function requireIntersect(){if(hasRequiredIntersect)return intersect_1;return hasRequiredIntersect=1,intersect_1=function(e){let t,r,s,n,i,a,o;if(!e.length)return[];for(i=e.length-1;i>=0;i--){if(!e[i].length)return[];e[i]=e[i]._head.next[0].next}if(1===e.length)return e[0].toArray({field:"key"});if(2===e.length)return function(e,t){let r=Object.create(null),s=[];for(;e;e=e.next[0].next)r[e.key]=!0;for(;t;t=t.next[0].next)r[t.key]&&s.push(t.key);return s}(e[0],e[1]);if(3===e.length)return function(e,t,r){let s=Object.create(null),n=[];for(;e;e=e.next[0].next)s[e.key]=0;for(;t;t=t.next[0].next)0===s[t.key]&&(s[t.key]=1);for(;r;r=r.next[0].next)1===s[r.key]&&n.push(r.key);return n}(e[0],e[1],e[2]);for(s=Object.create(null),r=e.shift();r;r=r.next[0].next)s[r.key]=0;for(i=0,o=e.length-1;i<o;i++){for(n=0,a=i+1,r=e[i];r;r=r.next[0].next)s[r.key]===i&&(s[r.key]=a,n++);if(!n)return[]}for(t=[],r=e[i];r;r=r.next[0].next)s[r.key]===i&&t.push(r.key);return t},intersect_1}function requireSet(){if(hasRequiredSet)return set$1;hasRequiredSet=1;const e=requireIntersect(),t=Array.prototype.slice,r=1/Math.E;class s{constructor(e={}){this._unique=!!e.unique,this.empty()}static intersect(){return e.call(s,t.call(arguments))}add(e,t){let r;if(null==t)return this.rem(e);if(r=this._map.get(e),void 0!==r){if(t===r)return r;this._remove(e,r)}if(!this._insert(e,t))throw void 0===r||this._insert(e,r),new Error("unique constraint violated");return this._map.set(e,t),void 0===r?null:r}card(){return this.length?this.length:0}count(e,t){if(!this.length)return 0;if(null==e&&(e=-1/0),null==t&&(t=1/0),e<=this._head.next[0].next.value&&t>=this._tail.value)return this.length;if(t<e||e>this._tail.value||t<this._head.next[0].next.value)return 0;let r,s=this._first(e),n=0;if(!s)return 0;for(r=s.next.length-1;r>=0;r-=1)for(;s.next[r].next&&s.next[r].next.value<=t;)n+=s.next[r].span,s=s.next[r].next;return n&&n+1}del(e){return this.rem(e)}empty(){this.length=0,this._level=1,this._map=new Map,this._head=new i(32,null,0),this._tail=null;for(let e=0;e<32;e+=1)this._head.next[e]=new n(null,0)}get(e){return this.score(e)}has(e){return this._map.has(e)}incrBy(e,t){let r=this.score(t);return r?(this.add(t,r+e),r+e):(this.add(t,e),e)}intersect(){let r=t.call(arguments);return r.unshift(this),e.call(this,r)}intersectKeys(){let e=t.call(arguments);return e.unshift(this),intersectKeys.call(this,e)}keys(){if(!this.length)return[];let e,t=new Array(this.length),r=this._head.next[0].next;for(e=0;r;r=r.next[0].next)t[e]=r.key,e+=1;return t}range(e,t,r){if(0===this.length)return[];if(null==e?e=0:e<0&&(e=Math.max(this.length+e,0)),null==t?t=this.length-1:t<0&&(t=this.length+t),e>t||e>=this.length)return[];t>=this.length&&(t=this.length-1),"object"!=typeof r&&(r={withScores:!1});let s,n=0,i=t-e+1;try{s=new Array(i)}catch(r){throw console.log("start",e),console.log("stop",t),console.log("Invalid length",i),r}let a=e>0?this._get(e):this._head.next[0].next;if(r.withScores)for(;i--;a=a.next[0].next)s[n]=[a.key,a.value],n+=1;else for(;i--;a=a.next[0].next)s[n]=a.key,n+=1;return s}rangeByScore(e,t,r){if(!this.length)return[];if("object"!=typeof r&&(r={withScores:!1}),null==e&&(e=-1/0),null==t&&(t=1/0),e<=this._head.next[0].next.value&&t>=this._tail.value)return this.toArray({withScores:r.withScores});if(t<e||e>this._tail.value||t<this._head.next[0].next.value)return[];let s=this._first(e),n=[];if(r.withScores)for(;s&&s.value<=t;s=s.next[0].next)n.push([s.key,s.value]);else for(;s&&s.value<=t;s=s.next[0].next)n.push(s.key);return n}rank(e){let t,r=this._map.get(e);if(void 0===r)return null;let s=this._head,n=null,i=-1;for(t=this._level-1;t>=0;t-=1){for(;(n=s.next[t].next)&&(n.value<r||n.value===r&&n.key<=e);)i+=s.next[t].span,s=n;if(s.key&&s.key===e)return i}return null}rem(e){let t=this._map.get(e);return void 0!==t?(this._remove(e,t),this._map.delete(e),t):null}remRangeByRank(e,t){let r=this.length;if(!r)return 0;if(null==e?e=0:e<0&&(e=Math.max(r+e,0)),null==t?t=r:t<0&&(t=r+t),e>t||e>=r)return 0;if(t>r&&(t=r),0===e&&t===r)return this.empty(),r;let s,n,i=this._head,a=new Array(32),o=-1;for(s=this._level-1;s>=0;s-=1){for(;(n=i.next[s].next)&&o+i.next[s].span<e;)o+=i.next[s].span,i=n;a[s]=i}let c=0;for(o+=1,i=i.next[0].next;i&&o<t;)n=i.next[0].next,this._removeNode(i,a),this._map.delete(i.key),c+=1,o+=1,i=n;return this.length-=c,c}remRangeByScore(e,t){let r,s,n=0;if(!this.length)return 0;if(null==e&&(e=-1/0),null==t&&(t=1/0),e<=this._head.next[0].next.value&&t>=this._tail.value)return n=this.length,this.empty(),n;let i=this._head,a=new Array(32);for(s=this._level-1;s>=0;s-=1){for(;(r=i.next[s].next)&&r.value<e;)i=r;a[s]=i}for(i=i.next[0].next;i&&i.value<=t;)r=i.next[0].next,this._removeNode(i,a),this._map.delete(i.key),n+=1,i=r;return this.length-=n,n}score(e){let t=this._map.get(e);return void 0===t?null:t}set(e,t){return this.add(e,t)}slice(e,t,r){return"number"==typeof t&&0!==t&&(t-=1),this.range(e,t,r)}toArray(e){if(!this.length)return[];let t;"object"!=typeof e&&(e={withScores:!1});let r=new Array(this.length),s=this._head.next[0].next;if(e.withScores)for(t=0;s;s=s.next[0].next)r[t]=[s.key,s.value],t+=1;else for(t=0;s;s=s.next[0].next)r[t]=s.key,t+=1;return r}values(){if(!this.length)return[];let e,t=new Array(this.length),r=this._head.next[0].next;for(e=0;r;r=r.next[0].next)t[e]=r.value,e+=1;return t}_first(e){let t=this._tail;if(!t||t.value<e)return null;t=this._head;for(let r=null,s=this._level-1;s>=0;s-=1)for(;(r=t.next[s].next)&&r.value<e;)t=r;return t.next[0].next}_get(e){let t,r=this._head,s=-1;for(t=this._level-1;t>=0;t-=1){for(;r.next[t].next&&s+r.next[t].span<=e;)s+=r.next[t].span,r=r.next[t].next;if(s===e)return r}return null}_insert(e,t){let s,a=new Array(32),o=new Array(32),c=this._head,u=null;for(s=this._level-1;s>=0;s-=1){for(o[s]=s===this._level-1?0:o[s+1];(u=c.next[s].next)&&u.value<=t;){if(u.value===t){if(this._unique)return null;if(u.key>=e)break}o[s]+=c.next[s].span,c=u}if(this._unique&&c.value===t)return null;a[s]=c}if(this._unique&&c.value===t)return null;let l=function(){let e=1;for(;Math.random()<r;)e+=1;return e<32?e:32}();if(l>this._level){for(s=this._level;s<l;s+=1)o[s]=0,a[s]=this._head,a[s].next[s].span=this.length;this._level=l}for(c=new i(l,e,t),s=0;s<l;s+=1)c.next[s]=new n(a[s].next[s].next,a[s].next[s].span-(o[0]-o[s])),a[s].next[s].next=c,a[s].next[s].span=o[0]-o[s]+1;for(s=l;s<this._level;s+=1)a[s].next[s].span++;return c.prev=a[0]===this._head?null:a[0],c.next[0].next?c.next[0].next.prev=c:this._tail=c,this.length+=1,c}_next(e,t){let r,s;if(!this._tail||this._tail.value<e)return null;for(r=null;(r=t.next[t.next.length-1].next)&&r.value<e;)t=r;if(t.value===e)return t;for(s=t.next.length-1;s>=0;s-=1){for(;(r=t.next[s].next)&&r.value<e;)t=r;if(t.value===e)return t}return t.next[0].next}_remove(e,t){let r,s,n=new Array(32),i=this._head;for(r=this._level-1;r>=0;r-=1){for(;(s=i.next[r].next)&&(s.value<t||s.value===t&&s.key<e);)i=s;n[r]=i}if(i=i.next[0].next,!i||t!==i.value||i.key!==e)return!1;this._removeNode(i,n),this.length-=1}_removeNode(e,t){let r=null,s=0,n=this._level;for(;s<n;s+=1)t[s].next[s].next===e?(t[s].next[s].span+=e.next[s].span-1,t[s].next[s].next=e.next[s].next):t[s].next[s].span-=1;for((r=e.next[0].next)?r.prev=e.prev:this._tail=e.prev;this._level>1&&!this._head.next[this._level-1].next;)this._level-=1}}function n(e,t){this.next=e,this.span=t}function i(e,t,r){this.key=t,this.value=r,this.next=new Array(e),this.prev=null}return set$1=s}function requireSpanleak(){if(hasRequiredSpanleak)return spanleak;hasRequiredSpanleak=1;const e=requireSet(),t={DISABLED:0,LOG:1,GC_AND_LOG:2};spanleak.MODES=t;const r=new e;let s,n=t.DISABLED;function i(){return n>t.DISABLED}return spanleak.disable=function(){n=t.DISABLED},spanleak.enableLogging=function(){n=t.LOG},spanleak.enableGarbageCollection=function(){n=t.GC_AND_LOG},spanleak.startScrubber=function(){i()&&(s=setInterval((()=>{const e=Date.now(),s=r.rangeByScore(0,e);if(!s.length)return;const i=n>=t.GC_AND_LOG,a=Object.create(null);for(const e of s){r.del(e);const t=e.deref();t&&(a[t._name]||(a[t._name]=0),a[t._name]++,i&&(t.context()._tags=Object.create(null)))}console.log("expired spans:"+Object.keys(a).reduce(((e,t)=>`${e} ${t}: ${a[t]}`),""))}),1e3))},spanleak.stopScrubber=function(){clearInterval(s)},spanleak.addSpan=function(e){if(!i())return;const t=Date.now()+6e4,s=new WeakRef(e);r.add(s,t)},spanleak}function requireSpan$1(){if(hasRequiredSpan$1)return span$1;hasRequiredSpan$1=1;const{performance:e}=require$$0$5,t=e.now.bind(e),r=Date.now,s=requireSemver(),n=requireSpan_context$2(),i=requireId(),a=requireTagger$1(),o=requireRuntime_metrics(),c=requireLog$2(),{storage:u}=requireDatadogCore(),l=requireMetrics(),{channel:p}=requireDcPolyfill(),d=requireSpanleak(),h=l.manager.namespace("tracers"),{DD_TRACE_EXPERIMENTAL_STATE_TRACKING:f,DD_TRACE_EXPERIMENTAL_SPAN_COUNTS:g}=process.env,m=E("unfinished"),_=E("finished"),b=!!process.env.DD_TRACE_OTEL_ENABLED,y=["string","number","boolean"],v={span_created:{},span_finished:{}},S=p("dd-trace:span:finish");function q(e,t){const r=v[e];if(t in r)return r[t];const s=h.count(e,[`integration_name:${t.toLowerCase()}`,`otel_enabled:${b}`]);return v[e][t]=s,s}function E(e){if(s.satisfies(process.version,">=14.6"))return new commonjsGlobal.FinalizationRegistry((t=>{o.decrement(`runtime.node.spans.${e}`),o.decrement(`runtime.node.spans.${e}.by.name`,[`span_name:${t}`])}))}return span$1=class{constructor(e,t,r,s,n){const i=s.operationName,a=s.parent||null,c=Object.assign({},s.tags),l=s.hostname;this._parentTracer=e,this._debug=n,this._processor=t,this._prioritySampler=r,this._store=u.getStore(),this._duration=void 0,this._name=i,this._integrationName=s.integrationName||"opentracing",q("span_created",this._integrationName).inc(),this._spanContext=this._createContext(a,s),this._spanContext._name=i,this._spanContext._tags=c,this._spanContext._hostname=l,this._spanContext._trace.started.push(this),this._startTime=s.startTime||this._getTime(),this._links=[],s.links&&s.links.forEach((e=>this.addLink(e.context,e.attributes))),g&&_&&(o.increment("runtime.node.spans.unfinished"),o.increment("runtime.node.spans.unfinished.by.name",`span_name:${i}`),o.increment("runtime.node.spans.open"),o.increment("runtime.node.spans.open.by.name",`span_name:${i}`),m.register(this,i,this)),d.addSpan(this,i)}toString(){const e=this.context(),t=e._tags["resource.name"],r=t.length>100?`${t.substring(0,97)}...`:t;return`Span${JSON.stringify({traceId:e._traceId,spanId:e._spanId,parentId:e._parentId,service:e._tags["service.name"],name:e._name,resource:r})}`}context(){return this._spanContext}tracer(){return this._parentTracer}setOperationName(e){return this._spanContext._name=e,this}setBaggageItem(e,t){return this._spanContext._baggageItems[e]=t,this}getBaggageItem(e){return this._spanContext._baggageItems[e]}setTag(e,t){return this._addTags({[e]:t}),this}addTags(e){return this._addTags(e),this}log(){return this}logEvent(){}addLink(e,t){this._links.push({context:e._ddContext?e._ddContext:e,attributes:this._sanitizeAttributes(t)})}finish(e){void 0===this._duration&&("true"===f&&(this._spanContext._tags["service.name"]||c.error(`Finishing invalid span: ${this}`)),q("span_finished",this._integrationName).inc(),g&&_&&(o.decrement("runtime.node.spans.unfinished"),o.decrement("runtime.node.spans.unfinished.by.name",`span_name:${this._name}`),o.increment("runtime.node.spans.finished"),o.increment("runtime.node.spans.finished.by.name",`span_name:${this._name}`),o.decrement("runtime.node.spans.open"),o.decrement("runtime.node.spans.open.by.name",`span_name:${this._name}`),m.unregister(this),_.register(this,this._name)),e=parseFloat(e)||this._getTime(),this._duration=e-this._startTime,this._spanContext._trace.finished.push(this),this._spanContext._isFinished=!0,S.publish(this),this._processor.process(this))}_sanitizeAttributes(e={}){const t={},r=(e,s)=>{if(Array.isArray(s))for(const t in s)r(`${e}.${t}`,s[t]);else{const r=s;y.includes(typeof r)?t[e]="string"==typeof r?r:String(r):c.warn("Dropping span link attribute. It is not of an allowed type")}};return Object.entries(e).forEach((e=>{const[t,s]=e;r(t,s)})),t}_createContext(e,s){let a,o;if(s.context)a=s.context,a._trace.startTime||(o=r());else if(e)a=new n({traceId:e._traceId,spanId:i(),parentId:e._spanId,sampling:e._sampling,baggageItems:Object.assign({},e._baggageItems),trace:e._trace,tracestate:e._tracestate}),a._trace.startTime||(o=r());else{const e=i();o=r(),a=new n({traceId:e,spanId:e}),a._trace.startTime=o,s.traceId128BitGenerationEnabled&&(a._trace.tags["_dd.p.tid"]=Math.floor(o/1e3).toString(16).padStart(8,"0").padEnd(16,"0"))}return a._trace.ticks=a._trace.ticks||t(),o&&(a._trace.startTime=o),a}_getTime(){const{startTime:e,ticks:r}=this._spanContext._trace;return e+t()-r}_addTags(e){a.add(this._spanContext._tags,e),this._prioritySampler.sample(this,!1)}},span$1}function requireConstants$2(){return hasRequiredConstants$2?constants$2:(hasRequiredConstants$2=1,constants$2={SAMPLING_PRIORITY_KEY:"_sampling_priority_v1",ANALYTICS_KEY:"_dd1.sr.eausr",ORIGIN_KEY:"_dd.origin",HOSTNAME_KEY:"_dd.hostname",TOP_LEVEL_KEY:"_dd.top_level",SAMPLING_RULE_DECISION:"_dd.rule_psr",SAMPLING_LIMIT_DECISION:"_dd.limit_psr",SAMPLING_AGENT_DECISION:"_dd.agent_psr",SAMPLING_MECHANISM_DEFAULT:0,SAMPLING_MECHANISM_AGENT:1,SAMPLING_MECHANISM_RULE:3,SAMPLING_MECHANISM_MANUAL:4,SAMPLING_MECHANISM_APPSEC:5,SAMPLING_MECHANISM_SPAN:8,SPAN_SAMPLING_MECHANISM:"_dd.span_sampling.mechanism",SPAN_SAMPLING_RULE_RATE:"_dd.span_sampling.rule_rate",SPAN_SAMPLING_MAX_PER_SECOND:"_dd.span_sampling.max_per_second",DATADOG_LAMBDA_EXTENSION_PATH:"/opt/extensions/datadog-agent",DECISION_MAKER_KEY:"_dd.p.dm",PROCESS_ID:"process_id",ERROR_TYPE:"error.type",ERROR_MESSAGE:"error.message",ERROR_STACK:"error.stack",COMPONENT:"component",CLIENT_PORT_KEY:"network.destination.port",PEER_SERVICE_KEY:"peer.service",PEER_SERVICE_SOURCE_KEY:"_dd.peer.service.source",PEER_SERVICE_REMAP_KEY:"_dd.peer.service.remapped_from",SCI_REPOSITORY_URL:"_dd.git.repository_url",SCI_COMMIT_SHA:"_dd.git.commit.sha"})}function requireTags$2(){if(hasRequiredTags$2)return tags_1;hasRequiredTags$2=1;const e={SERVICE_NAME:"service.name",RESOURCE_NAME:"resource.name",SPAN_TYPE:"span.type",SPAN_KIND:"span.kind",SAMPLING_PRIORITY:"sampling.priority",ANALYTICS:"_dd1.sr.eausr",ERROR:"error",MANUAL_KEEP:"manual.keep",MANUAL_DROP:"manual.drop",MEASURED:"_dd.measured",BASE_SERVICE:"_dd.base_service",HTTP_URL:"http.url",HTTP_METHOD:"http.method",HTTP_STATUS_CODE:"http.status_code",HTTP_ROUTE:"http.route",HTTP_REQUEST_HEADERS:"http.request.headers",HTTP_RESPONSE_HEADERS:"http.response.headers",HTTP_USERAGENT:"http.useragent",HTTP_CLIENT_IP:"http.client_ip",PATHWAY_HASH:"pathway.hash"};return e.ANALYTICS_SAMPLE_RATE=e.ANALYTICS,tags_1=e}function requireKinds(){return hasRequiredKinds?kinds$1:(hasRequiredKinds=1,kinds$1={SERVER:"server",CLIENT:"client",PRODUCER:"producer",CONSUMER:"consumer",INTERNAL:"internal"})}function requireSpan(){if(hasRequiredSpan)return span;hasRequiredSpan=1;const e=require$$0,{performance:t}=require$$0$5,{timeOrigin:r}=t,{timeInputToHrTime:s}=require$$1,n=requireDdTrace(),i=requireSpan$1(),{ERROR_MESSAGE:a,ERROR_TYPE:o,ERROR_STACK:c}=requireConstants$2(),{SERVICE_NAME:u,RESOURCE_NAME:l}=requireTags$2(),p=requireKinds(),d=requireSpan_context();function h(e){return 1e3*e[0]+e[1]/1e6}const f={[e.SpanKind.INTERNAL]:p.INTERNAL,[e.SpanKind.SERVER]:p.SERVER,[e.SpanKind.CLIENT]:p.CLIENT,[e.SpanKind.PRODUCER]:p.PRODUCER,[e.SpanKind.CONSUMER]:p.CONSUMER};function g(t,r,s){if(t)return t;const n=s["operation.name"];if(n)return n;const{INTERNAL:i,SERVER:a,CLIENT:o}=e.SpanKind;for(const e of["http.method","http.request.method"])if(e in s){if(r===a)return"http.server.request";if(r===o)return"http.client.request"}const c=s["db.system"];if(c&&r===o)return`${c}.query`;const u=s["messaging.system"],l=s["messaging.operation"];if(u&&l&&r!==i)return`${u}.${l}`;const p=s["rpc.system"];if(p){if(r===o)return"aws-api"===p?`aws.${s["rpc.service"]||"client"}.request`:`${p}.client.request`;if(r===a)return`${p}.server.request`}const d=s["faas.invoked_provider"],h=s["faas.invoked_name"],g=s["faas.trigger"];if(r===o&&d&&h)return`${d}.${h}.invoke`;if(r===a&&g)return`${g}.invoke`;if("graphql.operation.type"in s)return"graphql.server.request";const m=s["network.protocol.name"],_=m?`${m}.`:"";return r===a?`${_}server.request`:r===o?`${_}client.request`:f[r]}return span=class{constructor(e,a,o,c,p,d=[],f,m){const{_tracer:_}=n,b=s(f||t.now()+r),y=h(b);this._ddSpan=new i(_,_._processor,_._prioritySampler,{operationName:g(o,p,m),context:c._ddContext,startTime:y,hostname:_._hostname,integrationName:"otel",tags:{[u]:_._service,[l]:o},links:d},_._debug),m&&this.setAttributes(m),this._parentTracer=e,this._context=a,this._hasStatus=!1,this.startTime=b,this.kind=p,this._spanProcessor.onStart(this,a)}get parentSpanId(){const{_parentId:e}=this._ddSpan.context();return e&&e.toString(16)}get resource(){return this._parentTracer.resource}get instrumentationLibrary(){return this._parentTracer.instrumentationLibrary}get _spanProcessor(){return this._parentTracer.getActiveSpanProcessor()}get name(){return this._ddSpan.context()._name}spanContext(){return new d(this._ddSpan.context())}setAttribute(e,t){return this._ddSpan.setTag(e,t),this}setAttributes(e){return this._ddSpan.addTags(e),this}addEvent(t,r,s){return e.diag.warn("Events not supported"),this}addLink(e,t){const r=e._ddContext;return this._ddSpan.addLink(r,t),this}setStatus({code:e,message:t}){return this.ended||this._hasStatus||!e||(this._hasStatus=!0,2===e&&this._ddSpan.addTags({[a]:t})),this}updateName(e){return this.ended||this._ddSpan.setOperationName(e),this}end(n){if(this.ended)return void e.diag.error("You can only call end() on a span once.");const i=h(s(n||t.now()+r));this._ddSpan.finish(i),this._spanProcessor.onEnd(this)}isRecording(){return!1===this.ended}recordException(e){this._ddSpan.addTags({[o]:e.name,[a]:e.message,[c]:e.stack})}get duration(){return this._ddSpan._duration}get ended(){return void 0!==this.duration}},span}function requireTracer$2(){if(hasRequiredTracer$2)return tracer$3;hasRequiredTracer$2=1;const e=require$$0,{sanitizeAttributes:t}=require$$1,r=requireSampler$1(),s=requireSpan(),n=requireId(),i=requireSpan_context();return tracer$3=class{constructor(e,t,s){this._sampler=new r,this._config=t,this._tracerProvider=s,this.instrumentationLibrary=e}get resource(){return this._tracerProvider.resource}startSpan(r,a={},o=e.context.active()){a.root&&(o=e.trace.deleteSpan(o));const c=e.trace.getSpan(o),u=c&&c.spanContext();let l;if(u&&u.traceId){const e=u._ddContext;l=new i({traceId:e._traceId,spanId:n(),parentId:e._spanId,sampling:e._sampling,baggageItems:Object.assign({},e._baggageItems),trace:e._trace,tracestate:e._tracestate})}else l=new i;const p=a.kind||e.SpanKind.INTERNAL,d=(a.links||[]).map((e=>({context:e.context,attributes:t(e.attributes)}))),h=t(a.attributes);return new s(this,o,r,l,p,d,a.startTime,t(h))}startActiveSpan(t,r,s,n){if(2===arguments.length)n=r,s=void 0,r=void 0;else if(3===arguments.length)n=s,s=void 0;else if(4!==arguments.length)return;const i=s||e.context.active(),a=this.startSpan(t,r,i),o=e.trace.setSpan(i,a);return e.context.with(o,n,void 0,a)}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}},tracer$3}function requireTracer_provider(){if(hasRequiredTracer_provider)return tracer_provider;hasRequiredTracer_provider=1;const{trace:e,context:t}=require$$0,r=requireDdTrace(),s=requireContext_manager(),{MultiSpanProcessor:n,NoopSpanProcessor:i}=requireSpan_processor$1(),a=requireTracer$2();return tracer_provider=class{constructor(e={}){this.config=e,this.resource=e.resource,this._processors=[],this._tracers=new Map,this._activeProcessor=new i,this._contextManager=new s}getTracer(e="opentelemetry",t="0.0.0",r){const s=`${e}@${t}`;return this._tracers.has(s)||this._tracers.set(s,new a({...r,name:e,version:t},this.config,this)),this._tracers.get(s)}addSpanProcessor(e){this._processors.length||this._activeProcessor.shutdown(),this._processors.push(e),this._activeProcessor=new n(this._processors)}getActiveSpanProcessor(){return this._activeProcessor}register(r={}){t.setGlobalContextManager(this._contextManager),e.setGlobalTracerProvider(this)||e.getTracerProvider().setDelegate(this)}forceFlush(){const e=r._tracer._exporter;return e?(e._writer.flush(),this._activeProcessor.forceFlush()):Promise.reject(new Error("Not started"))}shutdown(){return this._activeProcessor.shutdown()}},tracer_provider}function requireProxy$1(){if(hasRequiredProxy$1)return proxy$1;hasRequiredProxy$1=1;const e=requireTracer$3(),t=requireNoop(),r=new e,s=new t;return proxy$1=class{constructor(){this._tracer=r,this.appsec=s}init(){return this}use(){return this}profilerStarted(){return Promise.resolve(!1)}trace(e,t,r){if(r||(r=t,t={}),"function"==typeof r)return t=t||{},this._tracer.trace(e,t,r)}wrap(e,t,r){return r||(r=t,t={}),"function"!=typeof r?r:(t=t||{},this._tracer.wrap(e,t,r))}setUrl(){return this._tracer.setUrl.apply(this._tracer,arguments),this}startSpan(){return this._tracer.startSpan.apply(this._tracer,arguments)}inject(){return this._tracer.inject.apply(this._tracer,arguments)}extract(){return this._tracer.extract.apply(this._tracer,arguments)}scope(){return this._tracer.scope.apply(this._tracer,arguments)}getRumData(){return this._tracer.getRumData.apply(this._tracer,arguments)}setUser(e){return this.appsec.setUser(e),this}get TracerProvider(){return requireTracer_provider()}},proxy$1}function requireExtraServices(){if(hasRequiredExtraServices)return extraServices_1;hasRequiredExtraServices=1;const e=new Set;return extraServices_1={registerExtraService:function(t){t&&e.size<64&&e.add(t)},getExtraServices:function(){return[...e]},clear:function(){e.clear()}}}function requireFormat(){if(hasRequiredFormat)return format_1;hasRequiredFormat=1;const e=requireConstants$2(),t=requireTags$2(),r=requireId(),{isError:s}=requireUtil$9(),{registerExtraService:n}=requireExtraServices(),i=e.SAMPLING_PRIORITY_KEY,a=e.SAMPLING_RULE_DECISION,o=e.SAMPLING_LIMIT_DECISION,c=e.SAMPLING_AGENT_DECISION,u=e.SPAN_SAMPLING_MECHANISM,l=e.SPAN_SAMPLING_RULE_RATE,p=e.SPAN_SAMPLING_MAX_PER_SECOND,d=e.SAMPLING_MECHANISM_SPAN,{MEASURED:h,BASE_SERVICE:f,ANALYTICS:g}=t,m=e.ORIGIN_KEY,_=e.HOSTNAME_KEY,b=e.TOP_LEVEL_KEY,y=e.PROCESS_ID,v=e.ERROR_MESSAGE,S=e.ERROR_STACK,q=e.ERROR_TYPE,E={"operation.name":"name","service.name":"service","span.type":"type","resource.name":"resource"};function R(e,t){t&&(e.error=1,s(t)&&(T(e.meta,e.metrics,v,t.message||t.code),T(e.meta,e.metrics,q,t.name),T(e.meta,e.metrics,S,t.stack)))}function T(e,t,r,s,n){switch(typeof s){case"string":if(!s)break;e[r]=s;break;case"number":if(isNaN(s))break;t[r]=s;break;case"boolean":t[r]=s?1:0;break;case"undefined":break;case"object":if(null===s)break;if((i=s).constructor&&"Buffer"===i.constructor.name&&"function"==typeof i.readInt8&&"function"==typeof i.toString||function(e){return e.constructor&&"URL"===e.constructor.name&&"string"==typeof e.href&&"function"==typeof e.toString}(s))t[r]=s.toString();else if(!Array.isArray(s)&&!n)for(const n in s)A(s,n)&&T(e,t,`${r}.${n}`,s[n],!0)}var i}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return format_1=function(e){const t=function(e){const t=e.context();return{trace_id:t._traceId,span_id:t._spanId,parent_id:t._parentId||r("0"),name:String(t._name),resource:String(t._name),error:0,meta:{},metrics:{},start:Math.round(1e6*e._startTime),duration:Math.round(1e6*e._duration),links:[]}}(e);return function(e,t){const r=[];if(t._links)for(const e of t._links){const{context:t,attributes:s}=e,n={};n.trace_id=t.toTraceId(!0),n.span_id=t.toSpanId(!0),s&&Object.keys(s).length>0&&(n.attributes=s),t?._sampling?.priority>=0&&(n.flags=t._sampling.priority>0?1:0),t?._tracestate&&(n.tracestate=t._tracestate.toString()),r.push(n)}r.length>0&&(e.meta["_dd.span_links"]=JSON.stringify(r))}(t,e),function(e,t){const r=t.context(),s=t===r._trace.started[0],n=r._parentId;if(!s||n&&"0"!==n.toString(10))return;T({},e.metrics,a,r._trace[a]),T({},e.metrics,o,r._trace[o]),T({},e.metrics,c,r._trace[c]),T({},e.metrics,b,1)}(t,e),function(e,t){const r=t.context(),s=t===r._trace.started[0];if(!s)return;for(const t in r._trace.tags)T(e.meta,e.metrics,t,r._trace.tags[t])}(t,e),function(e,t){const r=t.context(),s=r._trace.origin,a=r._tags,o=r._hostname,c=r._sampling.priority;a["span.kind"]&&"internal"!==a["span.kind"]&&T({},e.metrics,h,1);const b=t.tracer()._service.toLowerCase();a["service.name"]?.toLowerCase()!==b&&(t.setTag(f,b),n(a["service.name"]));for(const t in a)switch(t){case"operation.name":case"service.name":case"span.type":case"resource.name":T(e,{},E[t],a[t]);break;case"http.status_code":T(e.meta,{},t,a[t]&&String(a[t]));break;case"analytics.event":T({},e.metrics,g,void 0===a[t]||a[t]?1:0);break;case _:case h:T({},e.metrics,t,void 0===a[t]||a[t]?1:0);break;case"error":"fs.operation"!==r._name&&R(e,a[t]);break;case q:case v:case S:if("fs.operation"===r._name)break;e.error=1;default:T(e.meta,e.metrics,t,a[t])}(function(e,t){if(!t)return;T({},e.metrics,u,d),T({},e.metrics,l,t.sampleRate),T({},e.metrics,p,t.maxPerSecond)})(e,r._spanSampling),T(e.meta,e.metrics,"language","javascript"),T(e.meta,e.metrics,y,process.pid),T(e.meta,e.metrics,i,c),T(e.meta,e.metrics,m,s),T(e.meta,e.metrics,_,o)}(t,e),t},format_1}function requireFormats(){return hasRequiredFormats?formats:(hasRequiredFormats=1,formats={TEXT_MAP:"text_map",HTTP_HEADERS:"http_headers",BINARY:"binary",LOG:"log"})}function requireTypes$1(){return hasRequiredTypes$1?types$1:(hasRequiredTypes$1=1,types$1={HTTP:"http",WEB:"web"})}function requireExporters(){return hasRequiredExporters?exporters:(hasRequiredExporters=1,exporters={LOG:"log",AGENT:"agent",DATADOG:"datadog",AGENT_PROXY:"agent_proxy",JEST_WORKER:"jest_worker"})}function requireExt$1(){if(hasRequiredExt$1)return ext$1;hasRequiredExt$1=1;const e=requireFormats(),t=requireKinds(),r=requirePriority(),s=requireTags$2(),n=requireTypes$1(),i=requireExporters();return ext$1={formats:e,kinds:t,priority:r,tags:s,types:n,exporters:i}}var limiter={},tokenBucket,hasRequiredTokenBucket,clock,hasRequiredClock,rateLimiter,hasRequiredRateLimiter,hasRequiredLimiter,rate_limiter,hasRequiredRate_limiter,sampler,hasRequiredSampler,sampling_rule,hasRequiredSampling_rule,span_sampler,hasRequiredSpan_sampler,git_metadata_tagger,hasRequiredGit_metadata_tagger,pkg,hasRequiredPkg;function requireTokenBucket(){if(hasRequiredTokenBucket)return tokenBucket;hasRequiredTokenBucket=1;var e=function(e,t,r,s){if(this.bucketSize=e,this.tokensPerInterval=t,"string"==typeof r)switch(r){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+r)}else this.interval=r;this.parentBucket=s,this.content=0,this.lastDrip=+new Date};return e.prototype={bucketSize:1,tokensPerInterval:1,interval:1e3,parentBucket:null,content:0,lastDrip:0,removeTokens:function(e,t){var r=this;return this.bucketSize?e>this.bucketSize?(process.nextTick(t.bind(null,"Requested tokens "+e+" exceeds bucket size "+this.bucketSize,null)),!1):(this.drip(),e>this.content?s():this.parentBucket?this.parentBucket.removeTokens(e,(function(n,i){return n?t(n,null):e>r.content?s():(r.content-=e,void t(null,Math.min(i,r.content)))})):(this.content-=e,process.nextTick(t.bind(null,null,this.content)),!0)):(process.nextTick(t.bind(null,null,e,Number.POSITIVE_INFINITY)),!0);function s(){var s=Math.ceil((e-r.content)*(r.interval/r.tokensPerInterval));return setTimeout((function(){r.removeTokens(e,t)}),s),!1}},tryRemoveTokens:function(e){return!this.bucketSize||!(e>this.bucketSize)&&(this.drip(),!(e>this.content)&&(!(this.parentBucket&&!this.parentBucket.tryRemoveTokens(e))&&(this.content-=e,!0)))},drip:function(){if(this.tokensPerInterval){var e=+new Date,t=Math.max(e-this.lastDrip,0);this.lastDrip=e;var r=t*(this.tokensPerInterval/this.interval);this.content=Math.min(this.content+r,this.bucketSize)}else this.content=this.bucketSize}},tokenBucket=e}function requireClock(){if(hasRequiredClock)return clock;hasRequiredClock=1;return clock=function(){if("undefined"!=typeof process&&process.hrtime){var e=process.hrtime(),t=e[0],r=e[1];return 1e3*t+Math.floor(r/1e6)}return(new Date).getTime()}}function requireRateLimiter(){if(hasRequiredRateLimiter)return rateLimiter;hasRequiredRateLimiter=1;var e=requireTokenBucket(),t=requireClock(),r=function(r,s,n){this.tokenBucket=new e(r,r,s,null),this.tokenBucket.content=r,this.curIntervalStart=t(),this.tokensThisInterval=0,this.fireImmediately=n};return r.prototype={tokenBucket:null,curIntervalStart:0,tokensThisInterval:0,fireImmediately:!1,removeTokens:function(e,r){if(e>this.tokenBucket.bucketSize)return process.nextTick(r.bind(null,"Requested tokens "+e+" exceeds maximum tokens per interval "+this.tokenBucket.bucketSize,null)),!1;var s=this,n=t();if((n<this.curIntervalStart||n-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=n,this.tokensThisInterval=0),e>this.tokenBucket.tokensPerInterval-this.tokensThisInterval){if(this.fireImmediately)process.nextTick(r.bind(null,null,-1));else{var i=Math.ceil(this.curIntervalStart+this.tokenBucket.interval-n);setTimeout((function(){s.tokenBucket.removeTokens(e,a)}),i)}return!1}return this.tokenBucket.removeTokens(e,a);function a(t,n){if(t)return r(t,null);s.tokensThisInterval+=e,r(null,n)}},tryRemoveTokens:function(e){if(e>this.tokenBucket.bucketSize)return!1;var r=t();if((r<this.curIntervalStart||r-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=r,this.tokensThisInterval=0),e>this.tokenBucket.tokensPerInterval-this.tokensThisInterval)return!1;var s=this.tokenBucket.tryRemoveTokens(e);return s&&(this.tokensThisInterval+=e),s},getTokensRemaining:function(){return this.tokenBucket.drip(),this.tokenBucket.content}},rateLimiter=r}function requireLimiter(){return hasRequiredLimiter||(hasRequiredLimiter=1,limiter.RateLimiter=requireRateLimiter(),limiter.TokenBucket=requireTokenBucket()),limiter}function requireRate_limiter(){if(hasRequiredRate_limiter)return rate_limiter;hasRequiredRate_limiter=1;const e=requireLimiter();return rate_limiter=class{constructor(t){this._rateLimit=parseInt(t),this._limiter=new e.RateLimiter(this._rateLimit,"second"),this._tokensRequested=0,this._prevIntervalTokens=0,this._prevTokensRequested=0}isAllowed(){const e=this._limiter.curIntervalStart,t=this._limiter.tokensThisInterval,r=this._isAllowed();return e!==this._limiter.curIntervalStart?(this._prevIntervalTokens=t,this._prevTokensRequested=this._tokensRequested,this._tokensRequested=1):this._tokensRequested++,r}effectiveRate(){if(this._rateLimit<0)return 1;if(0===this._rateLimit)return 0;if(0===this._tokensRequested)return 1;return(this._prevIntervalTokens+this._limiter.tokensThisInterval)/(this._prevTokensRequested+this._tokensRequested)}_isAllowed(){return this._rateLimit<0||0!==this._rateLimit&&this._limiter.tryRemoveTokens(1)}_currentWindowRate(){return this._rateLimit<0?1:0===this._rateLimit?0:0===this._tokensRequested?1:this._limiter.tokensThisInterval/this._tokensRequested}}}function requireSampler(){if(hasRequiredSampler)return sampler;hasRequiredSampler=1;return sampler=class{constructor(e){this._rate=e}rate(){return this._rate}isSampled(){return 1===this._rate||Math.random()<this._rate}}}function requireSampling_rule(){if(hasRequiredSampling_rule)return sampling_rule;hasRequiredSampling_rule=1;const{globMatch:e}=requireUtil$9(),t=requireRate_limiter(),r=requireSampler();class s{match(){return!0}}class n{constructor(e,t){this.pattern=e,this.locator=t}match(t){const r=this.locator(t);return!!r&&e(this.pattern,r)}}class i{constructor(e,t){this.pattern=e,this.locator=t}match(e){const t=this.locator(e);return!!t&&this.pattern.test(t)}}function a(e,t){return e instanceof RegExp?new i(e,t):"string"==typeof e&&"*"!==e?new n(e,t):new s}function o(e){return t=>t.context()._tags[e]}function c(e){return e.context()._name}function u(e){const{_tags:t}=e.context();return t.service||t["service.name"]||e.tracer()._service}class l{constructor({name:e,service:s,resource:n,tags:i,sampleRate:l=1,maxPerSecond:p}={}){this.matchers=[],e&&this.matchers.push(a(e,c)),s&&this.matchers.push(a(s,u)),n&&this.matchers.push(a(n,o("resource.name")));for(const[e,t]of Object.entries(i||{}))this.matchers.push(a(t,o(e)));this._sampler=new r(l),this._limiter=void 0,Number.isFinite(p)&&(this._limiter=new t(p))}static from(e){return new l(e)}get sampleRate(){return this._sampler.rate()}get effectiveRate(){return this._limiter&&this._limiter.effectiveRate()}get maxPerSecond(){return this._limiter&&this._limiter._rateLimit}match(e){for(const t of this.matchers)if(!t.match(e))return!1;return!0}sample(){return!!this._sampler.isSampled()&&(!this._limiter||this._limiter.isAllowed())}}return sampling_rule=l}function requireSpan_sampler(){if(hasRequiredSpan_sampler)return span_sampler;hasRequiredSpan_sampler=1;const{USER_KEEP:e,AUTO_KEEP:t}=requireExt$1().priority,r=requireSampling_rule();return span_sampler=class{constructor({spanSamplingRules:e=[]}={}){this._rules=e.map(r.from)}findRule(e){for(const t of this._rules)if(t.match(e))return t}sample(r){const s=r._sampling.priority;if(s===e||s===t)return;const{started:n}=r._trace;for(const e of n){const t=this.findRule(e);t&&t.sample()&&(e.context()._spanSampling={sampleRate:t.sampleRate,maxPerSecond:t.maxPerSecond})}}},span_sampler}function requireGit_metadata_tagger(){if(hasRequiredGit_metadata_tagger)return git_metadata_tagger;hasRequiredGit_metadata_tagger=1;const{SCI_COMMIT_SHA:e,SCI_REPOSITORY_URL:t}=requireConstants$2();return git_metadata_tagger=class{constructor(e){this._config=e}tagGitMetadata(r){this._config.gitMetadataEnabled&&(r._trace.tags[e]=this._config.commitSHA,r._trace.tags[t]=this._config.repositoryUrl)}},git_metadata_tagger}function requirePkg(){if(hasRequiredPkg)return pkg;hasRequiredPkg=1;const e=require$$0$6,t=require$$0$1;function r(){return require.main&&require.main.filename?t.dirname(require.main.filename):process.cwd()}function s(r,s,n){for(;;){const i=t.resolve(n,r);if(e.existsSync(i))return i;if(n===s)return;n=t.dirname(n)}}return pkg=Object.assign(function(){const n=r(),i=t.resolve(n),a=t.parse(i);if(!a)return{};const{root:o}=a,c=s("package.json",o,i);try{return JSON.parse(e.readFileSync(c,"utf8"))}catch(e){return{}}}(),{findRoot:r,findUp:s})}var name="dd-trace",version$5="4.28.0",description="Datadog APM tracing client for JavaScript",main$1="index.js",typings="index.d.ts",scripts={preinstall:"node scripts/preinstall.js",bench:"node benchmark","bench:profiler":"node benchmark/profiler","bench:e2e":"SERVICES=mongo yarn services && cd benchmark/e2e && node benchmark-run.js --duration=30","bench:e2e:ci-visibility":"node benchmark/e2e-ci/benchmark-run.js","type:doc":"cd docs && yarn && yarn build","type:test":"cd docs && yarn && yarn test",lint:"node scripts/check_licenses.js && eslint . && yarn audit --groups dependencies",services:"node ./scripts/install_plugin_modules && node packages/dd-trace/test/setup/services",test:"SERVICES=* yarn services && mocha --colors --exit --expose-gc 'packages/dd-trace/test/setup/node.js' 'packages/*/test/**/*.spec.js'","test:appsec":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" --exclude "packages/dd-trace/test/appsec/**/*.plugin.spec.js" "packages/dd-trace/test/appsec/**/*.spec.js"',"test:appsec:ci":'nyc --no-clean --include "packages/dd-trace/src/appsec/**/*.js" --exclude "packages/dd-trace/test/appsec/**/*.plugin.spec.js" -- npm run test:appsec',"test:appsec:plugins":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/dd-trace/test/appsec/**/*.@($(echo $PLUGINS)).plugin.spec.js"',"test:appsec:plugins:ci":'yarn services && nyc --no-clean --include "packages/dd-trace/src/appsec/**/*.js" -- npm run test:appsec:plugins',"test:trace:core":'tap packages/dd-trace/test/*.spec.js "packages/dd-trace/test/{ci-visibility,datastreams,encode,exporters,opentelemetry,opentracing,plugins,service-naming,telemetry}/**/*.spec.js"',"test:trace:core:ci":'npm run test:trace:core -- --coverage --nyc-arg=--include="packages/dd-trace/src/**/*.js"',"test:instrumentations":"mocha --colors -r 'packages/dd-trace/test/setup/mocha.js' 'packages/datadog-instrumentations/test/**/*.spec.js'","test:instrumentations:ci":"nyc --no-clean --include 'packages/datadog-instrumentations/src/**/*.js' -- npm run test:instrumentations","test:core":'tap "packages/datadog-core/test/**/*.spec.js"',"test:core:ci":'npm run test:core -- --coverage --nyc-arg=--include="packages/datadog-core/src/**/*.js"',"test:lambda":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/dd-trace/test/lambda/**/*.spec.js"',"test:lambda:ci":'nyc --no-clean --include "packages/dd-trace/src/lambda/**/*.js" -- npm run test:lambda',"test:plugins":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/datadog-instrumentations/test/@($(echo $PLUGINS)).spec.js" "packages/datadog-plugin-@($(echo $PLUGINS))/test/**/*.spec.js"',"test:plugins:ci":'yarn services && nyc --no-clean --include "packages/datadog-instrumentations/src/@($(echo $PLUGINS)).js" --include "packages/datadog-instrumentations/src/@($(echo $PLUGINS))/**/*.js" --include "packages/datadog-plugin-@($(echo $PLUGINS))/src/**/*.js" -- npm run test:plugins',"test:plugins:upstream":"node ./packages/dd-trace/test/plugins/suite.js","test:profiler":'tap "packages/dd-trace/test/profiling/**/*.spec.js"',"test:profiler:ci":'npm run test:profiler -- --coverage --nyc-arg=--include="packages/dd-trace/src/profiling/**/*.js"',"test:integration":'mocha --colors --timeout 30000 "integration-tests/*.spec.js"',"test:integration:cucumber":'mocha --colors --timeout 30000 "integration-tests/cucumber/*.spec.js"',"test:integration:cypress":'mocha --colors --timeout 30000 "integration-tests/cypress/*.spec.js"',"test:integration:playwright":'mocha --colors --timeout 30000 "integration-tests/playwright/*.spec.js"',"test:integration:profiler":'mocha --colors --timeout 90000 "integration-tests/profiler/*.spec.js"',"test:integration:serverless":'mocha --colors --timeout 30000 "integration-tests/serverless/*.spec.js"',"test:integration:plugins":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/datadog-plugin-@($(echo $PLUGINS))/test/integration-test/**/*.spec.js"',"test:unit:plugins":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/datadog-instrumentations/test/@($(echo $PLUGINS)).spec.js" "packages/datadog-plugin-@($(echo $PLUGINS))/test/**/*.spec.js" --exclude "packages/datadog-plugin-@($(echo $PLUGINS))/test/integration-test/**/*.spec.js"',"test:shimmer":"mocha --colors 'packages/datadog-shimmer/test/**/*.spec.js'","test:shimmer:ci":"nyc --no-clean --include 'packages/datadog-shimmer/src/**/*.js' -- npm run test:shimmer","leak:core":"node ./scripts/install_plugin_modules && (cd packages/memwatch && yarn) && NODE_PATH=./packages/memwatch/node_modules node --no-warnings ./node_modules/.bin/tape 'packages/dd-trace/test/leak/**/*.js'","leak:plugins":'yarn services && (cd packages/memwatch && yarn) && NODE_PATH=./packages/memwatch/node_modules node --no-warnings ./node_modules/.bin/tape "packages/datadog-plugin-@($(echo $PLUGINS))/test/leak.js"'},repository={type:"git",url:"git+https://github.com/DataDog/dd-trace-js.git"},keywords=["datadog","trace","tracing","profile","profiler","profiling","opentracing","apm"],author="Datadog Inc. <info@datadoghq.com>",license="(Apache-2.0 OR BSD-3-Clause)",bugs={url:"https://github.com/DataDog/dd-trace-js/issues"},homepage="https://github.com/DataDog/dd-trace-js#readme",engines={node:">=16"},dependencies$1={"@datadog/native-appsec":"7.0.0","@datadog/native-iast-rewriter":"2.2.3","@datadog/native-iast-taint-tracking":"1.7.0","@datadog/native-metrics":"^2.0.0","@datadog/pprof":"5.0.0","@datadog/sketches-js":"^2.1.0","@opentelemetry/api":"^1.0.0","@opentelemetry/core":"^1.14.0","crypto-randomuuid":"^1.0.0","dc-polyfill":"^0.1.4",ignore:"^5.2.4","import-in-the-middle":"^1.7.3","int64-buffer":"^0.1.9","ipaddr.js":"^2.1.0","istanbul-lib-coverage":"3.2.0","jest-docblock":"^29.7.0",koalas:"^1.0.2",limiter:"1.1.5","lodash.sortby":"^4.7.0","lru-cache":"^7.14.0",methods:"^1.1.2","module-details-from-path":"^1.0.3","msgpack-lite":"^0.1.26","node-abort-controller":"^3.1.1",opentracing:">=0.12.1","path-to-regexp":"^0.1.2","pprof-format":"^2.0.7",protobufjs:"^7.2.5",retry:"^0.13.1",semver:"^7.5.4","shell-quote":"^1.8.1","tlhunter-sorted-set":"^0.1.0"},devDependencies={"@types/node":">=16",autocannon:"^4.5.2","aws-sdk":"^2.1446.0",axios:"^1.6.7",benchmark:"^2.1.4","body-parser":"^1.20.2",chai:"^4.3.7",chalk:"^5.3.0",checksum:"^1.0.0","cli-table3":"^0.6.3",dotenv:"16.3.1",esbuild:"0.16.12",eslint:"^8.23.0","eslint-config-standard":"^11.0.0-beta.0","eslint-plugin-import":"^2.8.0","eslint-plugin-mocha":"^10.1.0","eslint-plugin-n":"^15.7.0","eslint-plugin-node":"^5.2.1","eslint-plugin-promise":"^3.6.0","eslint-plugin-standard":"^3.0.1",express:"^4.18.2","get-port":"^3.2.0",glob:"^7.1.6",graphql:"0.13.2",jszip:"^3.5.0",knex:"^2.4.2",mkdirp:"^3.0.1",mocha:"^9",multer:"^1.4.5-lts.1",nock:"^11.3.3",nyc:"^15.1.0",proxyquire:"^1.8.0",rimraf:"^3.0.0",sinon:"^15.2.0","sinon-chai":"^3.7.0",tap:"^16.3.7",tape:"^5.6.5"},require$$6={name:name,version:version$5,description:description,main:main$1,typings:typings,scripts:scripts,repository:repository,keywords:keywords,author:author,license:license,bugs:bugs,homepage:homepage,engines:engines,dependencies:dependencies$1,devDependencies:devDependencies},tagsProcessors,hasRequiredTagsProcessors,chunk,hasRequiredChunk,koalas_1,hasRequiredKoalas,_0_4,hasRequired_0_4,spanStats$1,hasRequiredSpanStats$1,util$d,hasRequiredUtil$7,writer$5,hasRequiredWriter$5,writer$4,hasRequiredWriter$4,spanStats,hasRequiredSpanStats,span_stats,hasRequiredSpan_stats,span_processor,hasRequiredSpan_processor,startupLog_1,hasRequiredStartupLog,priority_sampler,hasRequiredPriority_sampler,pick,hasRequiredPick,tracestate,hasRequiredTracestate,text_map,hasRequiredText_map,http$1,hasRequiredHttp$1,binary,hasRequiredBinary,log,hasRequiredLog$1,log_1,hasRequiredLog,_0_5,hasRequired_0_5,writer$3,hasRequiredWriter$3,agent$1,hasRequiredAgent$1;function requireTagsProcessors(){if(hasRequiredTagsProcessors)return tagsProcessors;hasRequiredTagsProcessors=1;const e=5e3,t=200,r=25e3,s=t,n="unnamed_operation",i="unnamed-service";return tagsProcessors={truncateSpan:function(n,i=!0){i&&n.resource&&n.resource.length>e&&(n.resource=`${n.resource.slice(0,e)}...`);for(let e in n.meta){const s=n.meta[e];e.length>t&&(delete n.meta[e],e=`${e.slice(0,t)}...`,n.metrics[e]=s),s&&s.length>r&&(n.meta[e]=`${s.slice(0,r)}...`)}for(let e in n.metrics){const t=n.metrics[e];e.length>s&&(delete n.metrics[e],e=`${e.slice(0,s)}...`,n.metrics[e]=t)}return n},normalizeSpan:function(e){return e.service=e.service||i,e.service.length>100&&(e.service=e.service.slice(0,100)),e.name=e.name||n,e.name.length>100&&(e.name=e.name.slice(0,100)),e.resource||(e.resource=e.name),e.type&&e.type.length>100&&(e.type=e.type.slice(0,100)),e},MAX_META_KEY_LENGTH:t,MAX_META_VALUE_LENGTH:r,MAX_METRIC_KEY_LENGTH:s,MAX_NAME_LENGTH:100,MAX_SERVICE_LENGTH:100,MAX_TYPE_LENGTH:100,MAX_RESOURCE_NAME_LENGTH:e,DEFAULT_SPAN_NAME:n,DEFAULT_SERVICE_NAME:i},tagsProcessors}function requireChunk(){if(hasRequiredChunk)return chunk;hasRequiredChunk=1;return chunk=class{constructor(e=2097152){this.buffer=Buffer.allocUnsafe(e),this.length=0,this._minSize=e}write(e){const t=Buffer.byteLength(e),r=this.length;return t<32?(this.reserve(t+1),this.length+=1,this.buffer[r]=160|t):t<4294967296&&(this.reserve(t+5),this.length+=5,this.buffer[r]=219,this.buffer[r+1]=t>>24,this.buffer[r+2]=t>>16,this.buffer[r+3]=t>>8,this.buffer[r+4]=t),this.length+=this.buffer.utf8Write(e,this.length,t),this.length-r}copy(e,t,r){e.set(new Uint8Array(this.buffer.buffer,t,r-t))}set(e){this.reserve(e.length),this.buffer.set(e,this.length),this.length+=e.length}reserve(e){this.length+e>this.buffer.length&&this._resize(this._minSize*Math.ceil((this.length+e)/this._minSize))}_resize(e){const t=this.buffer;this.buffer=Buffer.allocUnsafe(e),t.copy(this.buffer,0,0,this.length)}}}function requireKoalas(){if(hasRequiredKoalas)return koalas_1;return hasRequiredKoalas=1,koalas_1=function(){for(var e,t,r=arguments.length,s=0;s<r;s++)if(null!=(t=e=arguments[s])&&t==t)return e;return e},koalas_1}function require_0_4(){if(hasRequired_0_4)return _0_4;hasRequired_0_4=1;const{truncateSpan:e,normalizeSpan:t}=requireTagsProcessors(),r=requireChunk(),s=requireLog$2(),{isTrue:n}=requireUtil$9(),i=requireKoalas(),a=new Float64Array(1),o=new Uint8Array(a.buffer);a[0]=-1;const c=0===o[7];function u(r){return t(e(r,!1))}return _0_4={AgentEncoder:class{constructor(e,t=8388608){this._limit=t,this._traceBytes=new r,this._stringBytes=new r,this._writer=e,this._reset(),this._debugEncoding=n(i(process.env.DD_TRACE_ENCODING_DEBUG,!1))}count(){return this._traceCount}encode(e){const t=this._traceBytes,r=t.length;this._traceCount++,this._encode(t,e);const n=t.length;this._debugEncoding&&s.debug((()=>`Adding encoded trace to buffer: ${t.buffer.subarray(r,n).toString("hex").match(/../g).join(" ")}`)),(this._traceBytes.length>this._limit||this._stringBytes.length>this._limit)&&(s.debug("Buffer went over soft limit, flushing"),this._writer.flush())}makePayload(){const e=this._traceBytes.length+5,t=Buffer.allocUnsafe(e);return this._writeTraces(t),this._reset(),t}reset(){this._reset()}_encode(e,t){this._encodeArrayPrefix(e,t);for(let r of t)r=u(r),e.reserve(1),r.type?(e.buffer[e.length++]=140,this._encodeString(e,"type"),this._encodeString(e,r.type)):e.buffer[e.length++]=139,this._encodeString(e,"trace_id"),this._encodeId(e,r.trace_id),this._encodeString(e,"span_id"),this._encodeId(e,r.span_id),this._encodeString(e,"parent_id"),this._encodeId(e,r.parent_id),this._encodeString(e,"name"),this._encodeString(e,r.name),this._encodeString(e,"resource"),this._encodeString(e,r.resource),this._encodeString(e,"service"),this._encodeString(e,r.service),this._encodeString(e,"error"),this._encodeInteger(e,r.error),this._encodeString(e,"start"),this._encodeLong(e,r.start),this._encodeString(e,"duration"),this._encodeLong(e,r.duration),this._encodeString(e,"meta"),this._encodeMap(e,r.meta),this._encodeString(e,"metrics"),this._encodeMap(e,r.metrics)}_reset(){this._traceCount=0,this._traceBytes.length=0,this._stringCount=0,this._stringBytes.length=0,this._stringMap={},this._cacheString("")}_encodeArrayPrefix(e,t){const r=t.length,s=e.length;e.reserve(5),e.length+=5,e.buffer[s]=221,e.buffer[s+1]=r>>24,e.buffer[s+2]=r>>16,e.buffer[s+3]=r>>8,e.buffer[s+4]=r}_encodeMapPrefix(e,t){const r=e.length;e.reserve(5),e.length+=5,e.buffer[r]=223,e.buffer[r+1]=t>>24,e.buffer[r+2]=t>>16,e.buffer[r+3]=t>>8,e.buffer[r+4]=t}_encodeByte(e,t){e.reserve(1),e.buffer[e.length++]=t}_encodeId(e,t){const r=e.length;e.reserve(9),e.length+=9,t=t.toArray(),e.buffer[r]=207,e.buffer[r+1]=t[0],e.buffer[r+2]=t[1],e.buffer[r+3]=t[2],e.buffer[r+4]=t[3],e.buffer[r+5]=t[4],e.buffer[r+6]=t[5],e.buffer[r+7]=t[6],e.buffer[r+8]=t[7]}_encodeInteger(e,t){const r=e.length;e.reserve(5),e.length+=5,e.buffer[r]=206,e.buffer[r+1]=t>>24,e.buffer[r+2]=t>>16,e.buffer[r+3]=t>>8,e.buffer[r+4]=t}_encodeLong(e,t){const r=e.length,s=t/Math.pow(2,32)|0,n=t>>>0;e.reserve(9),e.length+=9,e.buffer[r]=207,e.buffer[r+1]=s>>24,e.buffer[r+2]=s>>16,e.buffer[r+3]=s>>8,e.buffer[r+4]=s,e.buffer[r+5]=n>>24,e.buffer[r+6]=n>>16,e.buffer[r+7]=n>>8,e.buffer[r+8]=n}_encodeMap(e,t){const r=Object.keys(t).filter((e=>"string"==typeof t[e]||"number"==typeof t[e]));this._encodeMapPrefix(e,r.length);for(const s of r)this._encodeString(e,s),this._encodeValue(e,t[s])}_encodeValue(e,t){switch(typeof t){case"string":this._encodeString(e,t);break;case"number":this._encodeFloat(e,t)}}_encodeString(e,t=""){this._cacheString(t);const{start:r,end:s}=this._stringMap[t];this._stringBytes.copy(e,r,s)}_encodeFloat(e,t){a[0]=t;const r=e.length;if(e.reserve(9),e.length+=9,e.buffer[r]=203,c)for(let t=0;t<=7;t++)e.buffer[r+t+1]=o[t];else for(let t=7;t>=0;t--)e.buffer[e.length-t-1]=o[t]}_cacheString(e){e in this._stringMap||(this._stringCount++,this._stringMap[e]={start:this._stringBytes.length,end:this._stringBytes.length+this._stringBytes.write(e)})}_writeArrayPrefix(e,t,r){return e[t++]=221,e.writeUInt32BE(r,t),t+4}_writeTraces(e,t=0){return t=this._writeArrayPrefix(e,t,this._traceCount),t+=this._traceBytes.buffer.copy(e,t,0,this._traceBytes.length)}}},_0_4}function requireSpanStats$1(){if(hasRequiredSpanStats$1)return spanStats$1;hasRequiredSpanStats$1=1;const{AgentEncoder:e}=require_0_4(),{MAX_NAME_LENGTH:t,MAX_SERVICE_LENGTH:r,MAX_RESOURCE_NAME_LENGTH:s,MAX_TYPE_LENGTH:n,DEFAULT_SPAN_NAME:i,DEFAULT_SERVICE_NAME:a}=requireTagsProcessors();function o(e,t,r=""){return e&&e.length>t?`${e.slice(0,t)}${r}`:e}return spanStats$1={SpanStatsEncoder:class extends e{_encodeBool(e,t){this._encodeByte(e,t?195:194)}makePayload(){const e=this._traceBytes.length,t=Buffer.allocUnsafe(e);return this._traceBytes.copy(t,0,e),this._reset(),t}_encodeMapPrefix(e,t){const r=e.length;e.reserve(1),e.length+=1,e.buffer[r]=128+t}_encodeBuffer(e,t){const r=t.length,s=e.length;e.reserve(5),e.length+=5,e.buffer[s]=198,e.buffer[s+1]=r>>24,e.buffer[s+2]=r>>16,e.buffer[s+3]=r>>8,e.buffer[s+4]=r,t.copy(e.buffer,s+5),e.length+=r}_encodeStat(e,c){this._encodeMapPrefix(e,12),this._encodeString(e,"Service");const u=c.Service||a;this._encodeString(e,o(u,r)),this._encodeString(e,"Name");const l=c.Name||i;this._encodeString(e,o(l,t)),this._encodeString(e,"Resource"),this._encodeString(e,o(c.Resource,s,"...")),this._encodeString(e,"HTTPStatusCode"),this._encodeInteger(e,c.HTTPStatusCode),this._encodeString(e,"Type"),this._encodeString(e,o(c.Type,n)),this._encodeString(e,"Hits"),this._encodeLong(e,c.Hits),this._encodeString(e,"Errors"),this._encodeLong(e,c.Errors),this._encodeString(e,"Duration"),this._encodeLong(e,c.Duration),this._encodeString(e,"OkSummary"),this._encodeBuffer(e,c.OkSummary),this._encodeString(e,"ErrorSummary"),this._encodeBuffer(e,c.ErrorSummary),this._encodeString(e,"Synthetics"),this._encodeBool(e,c.Synthetics),this._encodeString(e,"TopLevelHits"),this._encodeLong(e,c.TopLevelHits)}_encodeBucket(e,t){this._encodeMapPrefix(e,3),this._encodeString(e,"Start"),this._encodeLong(e,t.Start),this._encodeString(e,"Duration"),this._encodeLong(e,t.Duration),this._encodeString(e,"Stats"),this._encodeArrayPrefix(e,t.Stats);for(const r of t.Stats)this._encodeStat(e,r)}_encode(e,t){this._encodeMapPrefix(e,8),this._encodeString(e,"Hostname"),this._encodeString(e,t.Hostname),this._encodeString(e,"Env"),this._encodeString(e,t.Env),this._encodeString(e,"Version"),this._encodeString(e,t.Version),this._encodeString(e,"Stats"),this._encodeArrayPrefix(e,t.Stats);for(const r of t.Stats)this._encodeBucket(e,r);this._encodeString(e,"Lang"),this._encodeString(e,t.Lang),this._encodeString(e,"TracerVersion"),this._encodeString(e,t.TracerVersion),this._encodeString(e,"RuntimeID"),this._encodeString(e,t.RuntimeID),this._encodeString(e,"Sequence"),this._encodeLong(e,t.Sequence)}}},spanStats$1}function requireUtil$7(){if(hasRequiredUtil$7)return util$d;return hasRequiredUtil$7=1,util$d={safeJSONStringify:function(e){return JSON.stringify(e,((e,t)=>"dd-api-key"!==e?t:void 0),process.env.DD_TRACE_BEAUTIFUL_LOGS?2:void 0)}}}function requireWriter$5(){if(hasRequiredWriter$5)return writer$5;hasRequiredWriter$5=1;const e=requireRequest(),t=requireLog$2(),{safeJSONStringify:r}=requireUtil$7();return writer$5=class{constructor({url:e}){this._url=e}flush(t=(()=>{})){const r=this._encoder.count();if(e.writable)if(r>0){const e=this._encoder.makePayload();this._sendPayload(e,r,t)}else t();else this._encoder.reset(),t()}append(s){e.writable?(t.debug((()=>`Encoding payload: ${r(s)}`)),this._encode(s)):t.debug((()=>`Maximum number of active requests reached. Payload discarded: ${r(s)}`))}_encode(e){this._encoder.encode(e)}setUrl(e){this._url=e}},writer$5}function requireWriter$4(){if(hasRequiredWriter$4)return writer$4;hasRequiredWriter$4=1;const{SpanStatsEncoder:e}=requireSpanStats$1(),t=require$$6,r=requireWriter$5(),s=requireRequest(),n=requireLog$2();return writer$4={Writer:class extends r{constructor({url:t}){super(...arguments),this._url=t,this._encoder=new e(this)}_sendPayload(e,r,i){!function(e,r,i){const a={path:"/v0.6/stats",method:"PUT",headers:{"Datadog-Meta-Lang":"javascript","Datadog-Meta-Tracer-Version":t.version,"Content-Type":"application/msgpack"}};a.protocol=r.protocol,a.hostname=r.hostname,a.port=r.port,n.debug((()=>`Request to the intake: ${JSON.stringify(a)}`)),s(e,a,((e,t)=>{i(e,t)}))}(e,this._url,((e,t)=>{if(e)return n.error(e),void i();n.debug(`Response from the intake: ${t}`),i()}))}}},writer$4}function requireSpanStats(){if(hasRequiredSpanStats)return spanStats;hasRequiredSpanStats=1;const{URL:e,format:t}=require$$0$8,{Writer:r}=requireWriter$4();return spanStats={SpanStatsExporter:class{constructor(s){const{hostname:n="127.0.0.1",port:i=8126,tags:a,url:o}=s;this._url=o||new e(t({protocol:"http:",hostname:n||"localhost",port:i})),this._writer=new r({url:this._url,tags:a})}export(e){this._writer.append(e),this._writer.flush()}}},spanStats}function requireSpan_stats(){if(hasRequiredSpan_stats)return span_stats;hasRequiredSpan_stats=1;const e=require$$0$a,{version:t}=requirePkg(),r=require$$6,{LogCollapsingLowestDenseDDSketch:s}=requireDist$1(),{ORIGIN_KEY:n,TOP_LEVEL_KEY:i}=requireConstants$2(),{MEASURED:a,HTTP_STATUS_CODE:o}=requireTags$2(),{SpanStatsExporter:c}=requireSpanStats(),{DEFAULT_SPAN_NAME:u,DEFAULT_SERVICE_NAME:l}=requireTagsProcessors();class p{constructor(e){this.aggKey=e,this.hits=0,this.topLevelHits=0,this.errors=0,this.duration=0,this.okDistribution=new s(.00775),this.errorDistribution=new s(.00775)}record(e){const t=e.duration;this.hits++,this.duration+=t,e.metrics[i]&&this.topLevelHits++,e.error?(this.errors++,this.errorDistribution.accept(t)):this.okDistribution.accept(t)}toJSON(){const{name:e,service:t,resource:r,type:s,statusCode:n,synthetics:i}=this.aggKey;return{Name:e,Service:t,Resource:r,Type:s,HTTPStatusCode:n,Synthetics:i,Hits:this.hits,TopLevelHits:this.topLevelHits,Errors:this.errors,Duration:this.duration,OkSummary:this.okDistribution.toProto(),ErrorSummary:this.errorDistribution.toProto()}}}class d{constructor(e){this.name=e.name||u,this.service=e.service||l,this.resource=e.resource||"",this.type=e.type||"",this.statusCode=e.meta[o]||0,this.synthetics="synthetics"===e.meta[n]}toString(){return[this.name,this.service,this.resource,this.type,this.statusCode,this.synthetics].join(",")}}class h extends Map{forSpan(e){const t=new d(e),r=t.toString();return this.has(r)||this.set(r,new p(t)),this.get(r)}}class f extends Map{forTime(e){return this.has(e)||this.set(e,new h),this.get(e)}}return span_stats={SpanAggStats:p,SpanAggKey:d,SpanBuckets:h,TimeBuckets:f,SpanStatsProcessor:class{constructor({stats:{enabled:t=!1,interval:r=10},hostname:s,port:n,url:i,env:a,tags:o}={}){this.exporter=new c({hostname:s,port:n,tags:o,url:i}),this.interval=r,this.bucketSizeNs=1e9*r,this.buckets=new f,this.hostname=e.hostname(),this.enabled=t,this.env=a,this.tags=o||{},this.sequence=0,t&&(this.timer=setInterval(this.onInterval.bind(this),1e3*r),this.timer.unref())}onInterval(){const e=this._serializeBuckets();e&&this.exporter.export({Hostname:this.hostname,Env:this.env,Version:t,Stats:e,Lang:"javascript",TracerVersion:r.version,RuntimeID:this.tags["runtime-id"],Sequence:++this.sequence})}onSpanFinished(e){if(!this.enabled)return;if(!e.metrics[i]&&!e.metrics[a])return;const t=e.startTime+e.duration,r=t-t%this.bucketSizeNs;this.buckets.forTime(r).forSpan(e).record(e)}_serializeBuckets(){const{bucketSizeNs:e}=this,t=[];for(const[r,s]of this.buckets.entries()){const n=[];for(const e of s.values())n.push(e.toJSON());t.push({Start:r,Duration:e,Stats:n})}return this.buckets.clear(),t}}},span_stats}function requireSpan_processor(){if(hasRequiredSpan_processor)return span_processor;hasRequiredSpan_processor=1;const e=requireLog$2(),t=requireFormat(),r=requireSpan_sampler(),s=requireGit_metadata_tagger(),{SpanStatsProcessor:n}=requireSpan_stats(),i=new WeakSet,a=new WeakSet;return span_processor=class{constructor(e,t,i){this._exporter=e,this._prioritySampler=t,this._config=i,this._killAll=!1,this._stats=new n(i),this._spanSampler=new r(i.sampler),this._gitMetadataTagger=new s(i)}process(e){const r=e.context(),s=[],n=[],i=r._trace,{flushMinSpans:a,tracing:o}=this._config,{started:c,finished:u}=i;if(!1!==i.record)if(!1!==o){if(c.length===u.length||u.length>=a){this._prioritySampler.sample(r),this._spanSampler.sample(r),this._gitMetadataTagger.tagGitMetadata(r);for(const e of c)if(void 0!==e._duration){const r=t(e);this._stats.onSpanFinished(r),n.push(r)}else s.push(e);0!==n.length&&!1!==i.isRecording&&this._exporter.export(n),this._erase(i,s)}this._killAll&&c.map((e=>{e._finished||e.finish()}))}else this._erase(i,s)}killAll(){this._killAll=!0}_erase(t,r){if("true"===process.env.DD_TRACE_EXPERIMENTAL_STATE_TRACKING){const r=new Set,s=new Set,n=new Set,o=new Set;for(const r of t.finished){const s=r.context(),i=s.toSpanId();n.has(r)?e.error(`Span was already finished in the same trace: ${r}`):(n.add(r),o.has(i)?e.error(`Another span with the same ID was already finished in the same trace: ${r}`):o.add(i),s._trace!==t&&e.error(`A span was finished in the wrong trace: ${r}.`),a.has(r)?e.error(`Span was already finished in a different trace: ${r}`):a.add(r))}for(const a of t.started){const o=a.context(),c=o.toSpanId();r.has(a)?e.error(`Span was already started in the same trace: ${a}`):(r.add(a),s.has(c)?e.error(`Another span with the same ID was already started in the same trace: ${a}`):s.add(c),o._trace!==t&&e.error(`A span was started in the wrong trace: ${a}.`),i.has(a)?e.error(`Span was already started in a different trace: ${a}`):i.add(a)),n.has(a)||e.error(`Span started in one trace but was finished in another trace: ${a}`)}for(const s of t.finished)r.has(s)||e.error(`Span finished in one trace but was started in another trace: ${s}`)}for(const e of t.finished)e.context()._tags={};t.started=r,t.finished=[]}},span_processor}function requireStartupLog(){if(hasRequiredStartupLog)return startupLog_1;hasRequiredStartupLog=1;const{info:e,warn:t}=requireWriter$7(),r=require$$0$a,{inspect:s}=require$$0$3,n=require$$6.version,i={};let a,o,c=[],u=!1;return startupLog_1={startupLog:function({agentError:l}={}){if(!a||!o)return;if(u)return;if(u=!0,!a.startupLogs)return;const p=a.url||`http://${a.hostname||"localhost"}:${a.port}`,d={[s.custom](){return String(this)},toString(){return JSON.stringify(this)}};d.date=(new Date).toISOString(),d.os_name=r.type(),d.os_version=r.release(),d.architecture=r.arch(),d.version=n,d.lang="nodejs",d.lang_version=process.versions.node,d.env=a.env,d.enabled=a.enabled,d.service=a.service,d.agent_url=p,l&&(d.agent_error=l.message),d.debug=!!a.debug,d.sample_rate=a.sampler.sampleRate,d.sampling_rules=c,d.tags=a.tags,a.tags&&a.tags.version&&(d.dd_version=a.tags.version),d.log_injection_enabled=!!a.logInjection,d.runtime_metrics_enabled=!!a.runtimeMetrics,d.profiling_enabled=!!(a.profiling||{}).enabled,Object.assign(d,function(){const e=new Set,t={};for(const t in o._pluginsByName)e.add(t);return t.integrations_loaded=Array.from(e),t}()),d.appsec_enabled=!!a.appsec.enabled,e("DATADOG TRACER CONFIGURATION - "+d),l&&(t("DATADOG TRACER DIAGNOSTIC - Agent Error: "+l.message),i.agentError={code:l.code?l.code:"",message:`Agent Error:${l.message}`}),a=void 0,o=void 0,c=void 0},setStartupLogConfig:function(e){a=e},setStartupLogPluginManager:function(e){o=e},setSamplingRules:function(e){c=e},errors:i},startupLog_1}function requirePriority_sampler(){if(hasRequiredPriority_sampler)return priority_sampler;hasRequiredPriority_sampler=1;const e=requireSampler(),{setSamplingRules:t}=requireStartupLog(),r=requireSampling_rule(),{SAMPLING_MECHANISM_DEFAULT:s,SAMPLING_MECHANISM_AGENT:n,SAMPLING_MECHANISM_RULE:i,SAMPLING_MECHANISM_MANUAL:a,SAMPLING_RULE_DECISION:o,SAMPLING_LIMIT_DECISION:c,SAMPLING_AGENT_DECISION:u,DECISION_MAKER_KEY:l}=requireConstants$2(),{tags:{MANUAL_KEEP:p,MANUAL_DROP:d,SAMPLING_PRIORITY:h,SERVICE_NAME:f},priority:{AUTO_REJECT:g,AUTO_KEEP:m,USER_REJECT:_,USER_KEEP:b}}=requireExt$1(),y="service:,env:",v=new e(m);function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return priority_sampler=class{constructor(e,t){this.configure(e,t),this.update({})}configure(e,{sampleRate:r,rateLimit:s=100,rules:n=[]}={}){this._env=e,this._rules=this._normalizeRules(n,r,s),t(this._rules)}isSampled(e){const t=this._getPriorityFromAuto(e);return t===b||t===m}sample(e,t=!0){if(!e)return;const r=this._getContext(e),s=r._trace.started[0];if(void 0!==r._sampling.priority)return;if(!s)return;const n=this._getPriorityFromTags(r._tags);if(this.validate(n))r._sampling.priority=n,r._sampling.mechanism=a;else{if(!t)return;r._sampling.priority=this._getPriorityFromAuto(s)}this._addDecisionMaker(s)}update(t){const r={};for(const s in t){const n=t[s],i=new e(n);r[s]=i}r[y]=r[y]||v,this._samplers=r}validate(e){switch(e){case _:case b:case g:case m:return!0;default:return!1}}_getContext(e){return"function"==typeof e.context?e.context():e}_getPriorityFromAuto(e){const t=this._getContext(e),r=this._findRule(e);return r?this._getPriorityByRule(t,r):this._getPriorityByAgent(t)}_getPriorityFromTags(e){if(S(e,p)&&!1!==e[p])return b;if(S(e,d)&&!1!==e[d])return _;{const t=parseInt(e[h],10);if(1===t||2===t)return b;if(0===t||-1===t)return _}}_getPriorityByRule(e,t){e._trace[o]=t.sampleRate,e._sampling.mechanism=i;const r=t.sample(),s=r?b:_;return r&&(e._trace[c]=t.effectiveRate),s}_getPriorityByAgent(e){const t=`service:${e._tags[f]},env:${this._env}`,r=this._samplers[t]||this._samplers[y];return e._trace[u]=r.rate(),e._sampling.mechanism=r===v?s:n,r.isSampled(e)?m:g}_addDecisionMaker(e){const t=e.context(),r=t._trace,s=t._sampling.priority,n=t._sampling.mechanism;s>=m?r.tags[l]||(r.tags[l]=`-${n}`):delete r.tags[l]}_normalizeRules(e,t,s){return(e=[].concat(e||[])).concat({sampleRate:t,maxPerSecond:s}).map((e=>({...e,sampleRate:parseFloat(e.sampleRate)}))).filter((e=>!isNaN(e.sampleRate))).map(r.from)}_findRule(e){for(const t of this._rules)if(t.match(e))return t}},priority_sampler}function requirePick(){return hasRequiredPick?pick:(hasRequiredPick=1,pick=(e,t)=>{const r={};return t.forEach((t=>{t in e&&(r[t]=e[t])})),r})}function requireTracestate(){if(hasRequiredTracestate)return tracestate;hasRequiredTracestate=1;const e=/[ \t]*([^=]+)=([ \t]*[^, \t]+)[ \t]*(,|$)/gim,t=/([^:]+):([^;]+)(;|$)/gim;function r(e,t,r){if("string"!=typeof r||!r.length)return new e;const s=[];for(const e of r.matchAll(t))s.unshift(e.slice(1,3));return new e(s)}function s(e,t,r){return Array.from(e.entries()).reverse().map((e=>e.join(t))).join(r)}class n extends Map{constructor(...e){super(...e),this.changed=!1}set(...e){if(!this.has(e[0])||this.get(e[0])!==e[1])return this.changed=!0,super.set(...e)}delete(...e){return this.changed=!0,super.delete(...e)}clear(...e){return this.changed=!0,super.clear(...e)}static fromString(e){return r(n,t,e)}toString(){return s(this,":",";")}}class i extends Map{set(e,t){return this.has(e)&&this.delete(e),super.set(e,t)}forVendor(e,t){const r=super.get(e),s=n.fromString(r),i=t(s);if(s.changed){s.toString()?this.set(e,s.toString()):this.delete(e)}return i}static fromString(t){return r(i,e,t)}toString(){return s(this,"=",",")}}return tracestate=i}function requireText_map(){if(hasRequiredText_map)return text_map;hasRequiredText_map=1;const e=requirePick(),t=requireId(),r=requireSpan_context$2(),s=requireLog$2(),n=requireTracestate(),{AUTO_KEEP:i,AUTO_REJECT:a,USER_KEEP:o}=requirePriority(),c="x-datadog-trace-id",u="x-datadog-parent-id",l="x-datadog-origin",p="x-datadog-sampling-priority",d="x-datadog-tags",h="ot-baggage-",f="x-b3-traceid",g=/^([0-9a-f]{16}){1,2}$/i,m="x-b3-spanid",_=/^[0-9a-f]{16}$/i,b="x-b3-parentspanid",y="x-b3-sampled",v="x-b3-flags",S="b3",q=/^(([0-9a-f]{16}){1,2}-[0-9a-f]{16}(-[01d](-[0-9a-f]{16})?)?|[01d])$/i,E=new RegExp(`^${h}(.+)$`),R=/^_dd\.p\.[\x21-\x2b\x2d-\x7e]+$/,T=/^[\x20-\x2b\x2d-\x7e]*$/,A=[c,u,p,l].concat([f,m,b,y,v,S]),w=/^([a-f0-9]{2})-([a-f0-9]{32})-([a-f0-9]{16})-([a-f0-9]{2})(-.*)?$/i,x="traceparent",I=/[^\x20-\x2b\x2d-\x3a\x3c-\x7d]/g,C=/[^\x21-\x2b\x2d-\x3c\x3e-\x7e]/g,O=/[^\x20-\x2b\x2d-\x3a\x3c-\x7d]/g,$=/^0+$/;return text_map=class{constructor(e){this._config=e}inject(t,r){this._injectBaggageItems(t,r),this._injectDatadog(t,r),this._injectB3MultipleHeaders(t,r),this._injectB3SingleHeader(t,r),this._injectTraceparent(t,r),s.debug((()=>`Inject into carrier: ${JSON.stringify(e(r,A))}.`))}extract(t){const r=this._extractSpanContext(t);return r?(s.debug((()=>`Extract from carrier: ${JSON.stringify(e(t,A))}.`)),r):r}_injectDatadog(e,t){this._hasPropagationStyle("inject","datadog")&&(t[c]=e.toTraceId(),t[u]=e.toSpanId(),this._injectOrigin(e,t),this._injectSamplingPriority(e,t),this._injectTags(e,t))}_injectOrigin(e,t){const r=e._trace.origin;r&&(t[l]=r)}_injectSamplingPriority(e,t){const r=e._sampling.priority;Number.isInteger(r)&&(t[p]=r.toString())}_injectBaggageItems(e,t){e._baggageItems&&Object.keys(e._baggageItems).forEach((r=>{t[h+r]=String(e._baggageItems[r])}))}_injectTags(e,t){const r=e._trace;if(0===this._config.tagsHeaderMaxLength)return void s.debug("Trace tag propagation is disabled, skipping injection.");const n=[];for(const e in r.tags)if(r.tags[e]&&e.startsWith("_dd.p.")){if(!this._validateTagKey(e)||!this._validateTagValue(r.tags[e]))return void s.error("Trace tags from span are invalid, skipping injection.");n.push(`${e}=${r.tags[e]}`)}const i=n.join(",");i.length>this._config.tagsHeaderMaxLength?s.error("Trace tags from span are too large, skipping injection."):i&&(t[d]=i)}_injectB3MultipleHeaders(e,t){const r=this._hasPropagationStyle("inject","b3"),s=this._hasPropagationStyle("inject","b3multi");(r||s)&&(t[f]=this._getB3TraceId(e),t[m]=e._spanId.toString(16),t[y]=e._sampling.priority>=i?"1":"0",e._sampling.priority>i&&(t[v]="1"),e._parentId&&(t[b]=e._parentId.toString(16)))}_injectB3SingleHeader(e,t){if(!this._hasPropagationStyle("inject","b3 single header"))return null;const r=this._getB3TraceId(e),s=e._spanId.toString(16),n=e._sampling.priority>=i?"1":"0";t[S]=`${r}-${s}-${n}`,e._parentId&&(t[S]+="-"+e._parentId.toString(16))}_injectTraceparent(e,t){if(!this._hasPropagationStyle("inject","tracecontext"))return;const{_sampling:{priority:r,mechanism:s},_tracestate:i=new n,_trace:{origin:a,tags:o}}=e;t[x]=e.toTraceparent(),i.forVendor("dd",(e=>{if(e.set("s",r),s&&e.set("t.dm",s),"string"==typeof a){const t=a.replace(I,"_").replace(/[\x3d]/g,"~");e.set("o",t)}for(const t in o){if(!o[t]||!t.startsWith("_dd.p."))continue;const r="t."+t.slice(6).replace(C,"_"),s=o[t].toString().replace(O,"_").replace(/[\x3d]/g,"~");e.set(r,s)}})),t.tracestate=i.toString()}_hasPropagationStyle(e,t){return this._config.tracePropagationStyle[e].includes(t)}_extractSpanContext(e){for(const t of this._config.tracePropagationStyle.extract){let r=null;switch(t){case"datadog":r=this._extractDatadogContext(e);break;case"tracecontext":r=this._extractTraceparentContext(e);break;case"b3":case"b3multi":r=this._extractB3MultiContext(e);break;case"b3 single header":r=this._extractB3SingleContext(e)}if(null!==r)return r}return this._extractSqsdContext(e)}_extractDatadogContext(e){const t=this._extractGenericContext(e,c,u,10);if(!t)return t;if(this._extractOrigin(e,t),this._extractBaggageItems(e,t),this._extractSamplingPriority(e,t),this._extractTags(e,t),this._config.tracePropagationExtractFirst)return t;const r=this._extractTraceparentContext(e);return r&&t._traceId.equals(r._traceId)&&(t._traceparent=r._traceparent,t._tracestate=r._tracestate),t}_extractB3MultiContext(e){const t=this._extractB3MultipleHeaders(e);return t?this._extractB3Context(t):null}_extractB3SingleContext(e){if(!q.test(e[S]))return null;const t=this._extractB3SingleHeader(e);return t?this._extractB3Context(t):null}_extractB3Context(e){const s="1"===e[v],n=this._getPriority(e[y],s),i=this._extractGenericContext(e,f,m,16);if(void 0!==n){if(!i)return new r({traceId:t(),spanId:null,sampling:{priority:n}});i._sampling.priority=n}return this._extract128BitTraceId(e[f],i),i}_extractSqsdContext(e){const t=e["x-aws-sqsd-attr-_datadog"];if(!t)return null;let r;try{r=JSON.parse(t)}catch(e){return null}return this._extractDatadogContext(r)}_extractTraceparentContext(e){const s=e[x];if(!s)return null;const i=s.trim().match(w);if(i.length){const[s,a,o,c,u]=i.slice(1),l={version:s},p=n.fromString(e.tracestate);if($.test(a))return null;if($.test(o))return null;if("ff"===s)return null;if(u&&"00"===s)return null;const d=new r({traceId:t(a,16),spanId:t(o,16),sampling:{priority:1&parseInt(c,10)?1:0},traceparent:l,tracestate:p});return this._extract128BitTraceId(a,d),p.forVendor("dd",(e=>{for(const[t,r]of e.entries())switch(t){case"s":{const e=parseInt(r,10);if(!Number.isInteger(e))continue;(1===d._sampling.priority&&e>0||0===d._sampling.priority&&e<0)&&(d._sampling.priority=e);break}case"o":d._trace.origin=r;break;case"t.dm":{const e=Math.abs(parseInt(r,10));Number.isInteger(e)&&(d._sampling.mechanism=e,d._trace.tags["_dd.p.dm"]=`-${e}`);break}default:if(!t.startsWith("t."))continue;d._trace.tags[`_dd.p.${t.slice(2)}`]=r.replace(/[\x7e]/gm,"=")}})),this._extractBaggageItems(e,d),d}return null}_extractGenericContext(e,s,n,i){return e[s]&&e[n]?$.test(e[s])?null:new r({traceId:t(e[s],i),spanId:t(e[n],i)}):null}_extractB3MultipleHeaders(e){let t=!0;const r={};return g.test(e[f])&&_.test(e[m])&&(r[f]=e[f],r[m]=e[m],t=!1),e[y]&&(r[y]=e[y],t=!1),e[v]&&(r[v]=e[v],t=!1),t?null:r}_extractB3SingleHeader(e){const t=e[S];if(!t)return null;const r=t.split("-");if("d"===r[0])return{[y]:"1",[v]:"1"};if(1===r.length)return{[y]:r[0]};{const e={[f]:r[0],[m]:r[1]};return r[2]&&(e[y]="0"!==r[2]?"1":"0","d"===r[2]&&(e[v]="1")),e}}_extractOrigin(e,t){const r=e[l];"string"==typeof e[l]&&(t._trace.origin=r)}_extractBaggageItems(e,t){Object.keys(e).forEach((r=>{const s=r.match(E);s&&(t._baggageItems[s[1]]=e[r])}))}_extractSamplingPriority(e,t){const r=parseInt(e[p],10);Number.isInteger(r)&&(t._sampling.priority=r)}_extractTags(e,t){if(!e[d])return;const r=t._trace;if(0===this._config.tagsHeaderMaxLength)s.debug("Trace tag propagation is disabled, skipping extraction.");else if(e[d].length>this._config.tagsHeaderMaxLength)s.error("Trace tags from carrier are too large, skipping extraction.");else{const t=e[d].split(","),n={};for(const e of t){const[t,...r]=e.split("="),i=r.join("=");if(!this._validateTagKey(t)||!this._validateTagValue(i))return void s.error("Trace tags from carrier are invalid, skipping extraction.");n[t]=i}Object.assign(r.tags,n)}}_extract128BitTraceId(e,t){if(!t)return;if(16!==t._traceId.toBuffer().length)return;const r=e.substring(0,16);"0000000000000000"!==r&&(t._trace.tags["_dd.p.tid"]=r)}_validateTagKey(e){return R.test(e)}_validateTagValue(e){return T.test(e)}_getPriority(e,t){return t?o:"1"===e?i:"0"===e?a:void 0}_getB3TraceId(e){return e._traceId.toBuffer().length<=8&&e._trace.tags["_dd.p.tid"]?e._trace.tags["_dd.p.tid"]+e._traceId.toString(16):e._traceId.toString(16)}},text_map}function requireHttp$1(){if(hasRequiredHttp$1)return http$1;hasRequiredHttp$1=1;const e=requireText_map();return http$1=class extends e{}}function requireBinary(){if(hasRequiredBinary)return binary;hasRequiredBinary=1;return binary=class{inject(e,t){}extract(e){return null}}}function requireLog$1(){if(hasRequiredLog$1)return log;hasRequiredLog$1=1;const e=requireId(),t=requireSpan_context$2();return log=class{constructor(e){this._config=e}inject(e,t){t&&(t.dd={},e&&(this._config.traceId128BitLoggingEnabled&&e._trace.tags["_dd.p.tid"]?t.dd.trace_id=e._trace.tags["_dd.p.tid"]+e._traceId.toString(16):t.dd.trace_id=e.toTraceId(),t.dd.span_id=e.toSpanId()),this._config.service&&(t.dd.service=this._config.service),this._config.version&&(t.dd.version=this._config.version),this._config.env&&(t.dd.env=this._config.env))}extract(r){if(!(r&&r.dd&&r.dd.trace_id&&r.dd.span_id))return null;if(32===r.dd.trace_id.length){const s=r.dd.trace_id.substring(0,16),n=r.dd.trace_id.substring(16,32),i=new t({traceId:e(n,16),spanId:e(r.dd.span_id,10)});return i._trace.tags["_dd.p.tid"]=s,i}return new t({traceId:e(r.dd.trace_id,10),spanId:e(r.dd.span_id,10)})}},log}function requireLog(){if(hasRequiredLog)return log_1;hasRequiredLog=1;const e=requireLog$2(),t='{"traces":[[',r="]]}\n";return log_1=class{export(t){e.debug((()=>`Adding trace to queue: ${JSON.stringify(t)}`));let r=16,s=[];for(const n of t){const t=JSON.stringify(n);t.length+16>65536?e.debug("Span too large to send to logs, dropping"):(t.length+r>65536&&(this._printSpans(s),s=[],r=16),r+=t.length+1,s.push(t))}s.length>0&&this._printSpans(s)}_printSpans(e){let s=t,n=!0;for(const t of e)n?(n=!1,s+=t):s+=","+t;s+=r,process.stdout.write(s)}},log_1}function require_0_5(){if(hasRequired_0_5)return _0_5;hasRequired_0_5=1;const{truncateSpan:e,normalizeSpan:t}=requireTagsProcessors(),{AgentEncoder:r}=require_0_4();function s(r){return t(e(r,!1))}return _0_5={AgentEncoder:class extends r{makePayload(){const e=this._stringBytes.length+5,t=this._traceBytes.length+5,r=Buffer.allocUnsafe(1+e+t);let s=0;return r[s++]=146,s=this._writeStrings(r,s),s=this._writeTraces(r,s),this._reset(),r}_encode(e,t){this._encodeArrayPrefix(e,t);for(let r of t)r=s(r),this._encodeByte(e,156),this._encodeString(e,r.service),this._encodeString(e,r.name),this._encodeString(e,r.resource),this._encodeId(e,r.trace_id),this._encodeId(e,r.span_id),this._encodeId(e,r.parent_id),this._encodeLong(e,r.start||0),this._encodeLong(e,r.duration||0),this._encodeInteger(e,r.error),this._encodeMap(e,r.meta||{}),this._encodeMap(e,r.metrics||{}),this._encodeString(e,r.type)}_encodeString(e,t=""){this._cacheString(t),this._encodeInteger(e,this._stringMap[t])}_cacheString(e){e in this._stringMap||(this._stringMap[e]=this._stringCount++,this._stringBytes.write(e))}_writeStrings(e,t){return t=this._writeArrayPrefix(e,t,this._stringCount),t+=this._stringBytes.buffer.copy(e,t,0,this._stringBytes.length)}}},_0_5}function requireWriter$3(){if(hasRequiredWriter$3)return writer$3;hasRequiredWriter$3=1;const e=requireRequest(),{startupLog:t}=requireStartupLog(),r=requireRuntime_metrics(),s=requireLog$2(),n=require$$6.version,i=requireWriter$5(),a="datadog.tracer.node.exporter.agent";function o(e,t,r){r&&(e[t]=r)}return writer$3=class extends i{constructor({prioritySampler:e,lookup:t,protocolVersion:r,headers:s}){super(...arguments);const n=function(e){return"0.5"===e?require_0_5().AgentEncoder:require_0_4().AgentEncoder}(r);this._prioritySampler=e,this._lookup=t,this._protocolVersion=r,this._encoder=new n(this),this._headers=s}_sendPayload(i,c,u){r.increment(`${a}.requests`,!0);const{_headers:l,_lookup:p,_protocolVersion:d,_url:h}=this;!function(r,i,a,c,u,l,p,d){const h={path:`/v${r}/traces`,method:"PUT",headers:{...u,"Content-Type":"application/msgpack","Datadog-Meta-Tracer-Version":n,"X-Datadog-Trace-Count":String(a)},lookup:l,url:c};o(h.headers,"Datadog-Meta-Lang","nodejs"),o(h.headers,"Datadog-Meta-Lang-Version",process.version),o(h.headers,"Datadog-Meta-Lang-Interpreter",process.jsEngine||"v8"),s.debug((()=>`Request to the agent: ${JSON.stringify(h)}`)),e(i,h,((e,r,s)=>{t({agentError:404!==s&&200!==s?e:void 0}),d(e,r,s)}))}(d,i,c,h,l,p,0,((e,n,i)=>{if(i?(r.increment(`${a}.responses`,!0),r.increment(`${a}.responses.by.status`,`status:${i}`,!0)):e&&(r.increment(`${a}.errors`,!0),r.increment(`${a}.errors.by.name`,`name:${e.name}`,!0),e.code&&r.increment(`${a}.errors.by.code`,`code:${e.code}`,!0)),t({agentError:e}),e)return s.error(e),void u();s.debug(`Response from the agent: ${n}`);try{this._prioritySampler.update(JSON.parse(n).rate_by_service)}catch(e){s.error(e),r.increment(`${a}.errors`,!0),r.increment(`${a}.errors.by.name`,`name:${e.name}`,!0)}u()}))}},writer$3}function requireAgent$1(){if(hasRequiredAgent$1)return agent$1;hasRequiredAgent$1=1;const{URL:e,format:t}=require$$0$8,r=requireLog$2(),s=requireWriter$3();return agent$1=class{constructor(r,n){this._config=r;const{url:i,hostname:a,port:o,lookup:c,protocolVersion:u,stats:l={}}=r;this._url=i||new e(t({protocol:"http:",hostname:a||"localhost",port:o}));const p={};l.enabled&&(p["Datadog-Client-Computed-Stats"]="yes"),this._writer=new s({url:this._url,prioritySampler:n,lookup:c,protocolVersion:u,headers:p}),this._timer=void 0,process.once("beforeExit",(()=>this._writer.flush()))}setUrl(t){try{t=new e(t),this._url=t,this._writer.setUrl(t)}catch(e){r.warn(e.stack)}}export(e){this._writer.append(e);const{flushInterval:t}=this._config;0===t?this._writer.flush():t>0&&!this._timer&&(this._timer=setTimeout((()=>{this._writer.flush(),this._timer=clearTimeout(this._timer)}),t).unref())}flush(e=(()=>{})){this._writer.flush(e)}},agent$1}var istanbulLibCoverage={exports:{}},percent,hasRequiredPercent,dataProperties,hasRequiredDataProperties,coverageSummary,hasRequiredCoverageSummary,fileCoverage,hasRequiredFileCoverage,coverageMap,hasRequiredCoverageMap,hasRequiredIstanbulLibCoverage,ignore,hasRequiredIgnore,tags$1,hasRequiredTags$1,telemetry$3,hasRequiredTelemetry$3,url,hasRequiredUrl,git,hasRequiredGit,ci,hasRequiredCi,userProvidedGit,hasRequiredUserProvidedGit,env,hasRequiredEnv,test,hasRequiredTest,agentlessCiVisibility,hasRequiredAgentlessCiVisibility,writer$2,hasRequiredWriter$2,formData,hasRequiredFormData,coverageCiVisibility,hasRequiredCoverageCiVisibility,coverageWriter,hasRequiredCoverageWriter,git_metadata,hasRequiredGit_metadata,getLibraryConfiguration_1,hasRequiredGetLibraryConfiguration,getSkippableSuites_1,hasRequiredGetSkippableSuites,getKnownTests_1,hasRequiredGetKnownTests,agentInfoExporter,hasRequiredAgentInfoExporter,ciVisibilityExporter,hasRequiredCiVisibilityExporter,agentless,hasRequiredAgentless,agentProxy,hasRequiredAgentProxy,jsonEncoder,hasRequiredJsonEncoder,writer$1,hasRequiredWriter$1,jestWorker,hasRequiredJestWorker,exporter,hasRequiredExporter,tracer$2,hasRequiredTracer$1,scope,hasRequiredScope;function requirePercent(){return hasRequiredPercent?percent:(hasRequiredPercent=1,percent=function(e,t){let r;return t>0?(r=1e5*e/t,Math.floor(r/10)/100):100})}function requireDataProperties(){return hasRequiredDataProperties?dataProperties:(hasRequiredDataProperties=1,dataProperties=function(e,t){t.forEach((t=>{Object.defineProperty(e.prototype,t,{enumerable:!0,get(){return this.data[t]}})}))})}function requireCoverageSummary(){if(hasRequiredCoverageSummary)return coverageSummary;hasRequiredCoverageSummary=1;const e=requirePercent(),t=requireDataProperties();class r{constructor(e){this.data=e?e instanceof r?e.data:e:{lines:{total:0,covered:0,skipped:0,pct:"Unknown"},statements:{total:0,covered:0,skipped:0,pct:"Unknown"},functions:{total:0,covered:0,skipped:0,pct:"Unknown"},branches:{total:0,covered:0,skipped:0,pct:"Unknown"},branchesTrue:{total:0,covered:0,skipped:0,pct:"Unknown"}},function(e){if(!(e&&e.lines&&e.statements&&e.functions&&e.branches))throw new Error("Invalid summary coverage object, missing keys, found:"+Object.keys(e).join(","))}(this.data)}merge(t){return["lines","statements","branches","functions","branchesTrue"].forEach((r=>{t[r]&&(this[r].total+=t[r].total,this[r].covered+=t[r].covered,this[r].skipped+=t[r].skipped,this[r].pct=e(this[r].covered,this[r].total))})),this}toJSON(){return this.data}isEmpty(){return 0===this.lines.total}}return t(r,["lines","statements","functions","branches","branchesTrue"]),coverageSummary={CoverageSummary:r}}function requireFileCoverage(){if(hasRequiredFileCoverage)return fileCoverage;hasRequiredFileCoverage=1;const e=requirePercent(),t=requireDataProperties(),{CoverageSummary:r}=requireCoverageSummary();const s=({start:e,end:t})=>`${e.line}|${e.column}|${t.line}|${t.column}`,n=(e,t,r,n,i=s)=>{const a={};for(const[r,s]of Object.entries(e)){const e=t[r];a[i(e)]=[s,e]}for(const[e,t]of Object.entries(r)){const r=n[e],s=i(r);if(a[s]){const e=a[s];t.forEach?t.forEach(((t,r)=>{void 0!==e[0][r]?e[0][r]+=t:e[0][r]=t})):e[0]+=t}else a[s]=[t,r]}const o={},c={};return Object.values(a).forEach((([e,t],r)=>{o[r]=e,c[r]=t})),[o,c]};class i{constructor(e,t=!1){if(!e)throw new Error("Coverage must be initialized with a path or an object");if("string"==typeof e)this.data=function(e,t){const r={path:e,statementMap:{},fnMap:{},branchMap:{},s:{},f:{},b:{}};return t&&(r.bT={}),r}(e,t);else if(e instanceof i)this.data=e.data;else{if("object"!=typeof e)throw new Error("Invalid argument to coverage constructor");this.data=e}!function(e){if(!(e&&e.path&&e.statementMap&&e.fnMap&&e.branchMap&&e.s&&e.f&&e.b))throw new Error("Invalid file coverage object, missing keys, found:"+Object.keys(e).join(","))}(this.data)}getLineCoverage(){const e=this.data.statementMap,t=this.data.s,r=Object.create(null);return Object.entries(t).forEach((([t,s])=>{if(!e[t])return;const{line:n}=e[t].start,i=r[n];(void 0===i||i<s)&&(r[n]=s)})),r}getUncoveredLines(){const e=this.getLineCoverage(),t=[];return Object.entries(e).forEach((([e,r])=>{0===r&&t.push(e)})),t}getBranchCoverageByLine(){const e=this.branchMap,t=this.b,r={};return Object.entries(e).forEach((([e,s])=>{const n=s.line||s.loc.start.line,i=t[e];r[n]=r[n]||[],r[n].push(...i)})),Object.entries(r).forEach((([e,t])=>{const s=t.filter((e=>e>0)),n=s.length/t.length*100;r[e]={covered:s.length,total:t.length,coverage:n}})),r}toJSON(){return this.data}merge(e){if(!0===e.all)return;if(!0===this.all)return void(this.data=e.data);let[t,r]=n(this.s,this.statementMap,e.s,e.statementMap);this.data.s=t,this.data.statementMap=r;const i=e=>s(e.locations[0]);[t,r]=n(this.f,this.fnMap,e.f,e.fnMap,(e=>s(e.loc))),this.data.f=t,this.data.fnMap=r,[t,r]=n(this.b,this.branchMap,e.b,e.branchMap,i),this.data.b=t,this.data.branchMap=r,this.bT&&e.bT&&([t,r]=n(this.bT,this.branchMap,e.bT,e.branchMap,i),this.data.bT=t)}computeSimpleTotals(t){let r=this[t];"function"==typeof r&&(r=r.call(this));const s={total:Object.keys(r).length,covered:Object.values(r).filter((e=>!!e)).length,skipped:0};return s.pct=e(s.covered,s.total),s}computeBranchTotals(t){const r=this[t],s={total:0,covered:0,skipped:0};return Object.values(r).forEach((e=>{s.covered+=e.filter((e=>e>0)).length,s.total+=e.length})),s.pct=e(s.covered,s.total),s}resetHits(){const e=this.s,t=this.f,r=this.b,s=this.bT;Object.keys(e).forEach((t=>{e[t]=0})),Object.keys(t).forEach((e=>{t[e]=0})),Object.keys(r).forEach((e=>{r[e].fill(0)})),s&&Object.keys(s).forEach((e=>{s[e].fill(0)}))}toSummary(){const e={};return e.lines=this.computeSimpleTotals("getLineCoverage"),e.functions=this.computeSimpleTotals("f","fnMap"),e.statements=this.computeSimpleTotals("s","statementMap"),e.branches=this.computeBranchTotals("b"),this.bt&&(e.branchesTrue=this.computeBranchTotals("bT")),new r(e)}}return t(i,["path","statementMap","fnMap","branchMap","s","f","b","bT","all"]),fileCoverage={FileCoverage:i}}function requireCoverageMap(){if(hasRequiredCoverageMap)return coverageMap;hasRequiredCoverageMap=1;const{FileCoverage:e}=requireFileCoverage(),{CoverageSummary:t}=requireCoverageSummary();function r(e,t){return e instanceof t?e:new t(e)}class s{constructor(t){this.data=t instanceof s?t.data:function(t){const s=Object.create(null);return t?(Object.entries(t).forEach((([t,n])=>{s[t]=r(n,e)})),s):s}(t)}merge(e){const t=r(e,s);Object.values(t.data).forEach((e=>{this.addFileCoverage(e)}))}filter(e){Object.keys(this.data).forEach((t=>{e(t)||delete this.data[t]}))}toJSON(){return this.data}files(){return Object.keys(this.data)}fileCoverageFor(e){const t=this.data[e];if(!t)throw new Error(`No file coverage available for: ${e}`);return t}addFileCoverage(t){const r=new e(t),{path:s}=r;this.data[s]?this.data[s].merge(r):this.data[s]=r}getCoverageSummary(){const e=new t;return Object.values(this.data).forEach((t=>{e.merge(t.toSummary())})),e}}return coverageMap={CoverageMap:s}}function requireIstanbulLibCoverage(){if(hasRequiredIstanbulLibCoverage)return istanbulLibCoverage.exports;hasRequiredIstanbulLibCoverage=1;const{FileCoverage:e}=requireFileCoverage(),{CoverageMap:t}=requireCoverageMap(),{CoverageSummary:r}=requireCoverageSummary();return istanbulLibCoverage.exports={createCoverageSummary:e=>e&&e instanceof r?e:new r(e),createCoverageMap:e=>e&&e instanceof t?e:new t(e),createFileCoverage:t=>t&&t instanceof e?t:new e(t)},istanbulLibCoverage.exports.classes={FileCoverage:e},istanbulLibCoverage.exports}function requireIgnore(){if(hasRequiredIgnore)return ignore;function e(e){return Array.isArray(e)?e:[e]}hasRequiredIgnore=1;const t=/^\s+$/,r=/(?:[^\\]|^)\\$/,s=/^\\!/,n=/^\\#/,i=/\r?\n/g,a=/^\.*\/|^\.+$/;let o="node-ignore";"undefined"!=typeof Symbol&&(o=Symbol.for("node-ignore"));const c=o,u=/([0-z])-([0-z])/g,l=()=>!1,p=[[/^\uFEFF/,()=>""],[/\\?\s+$/,e=>0===e.indexOf("\\")?" ":""],[/\\\s/g,()=>" "],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,r)=>t+6<r.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(e,t,r)=>t+r.replace(/\\\*/g,"[^\\/]*")],[/\\\\\\(?=[$.|*+(){^])/g,()=>"\\"],[/\\\\/g,()=>"\\"],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,r,s,n)=>"\\"===t?`\\[${r}${(e=>{const{length:t}=e;return e.slice(0,t-t%2)})(s)}${n}`:"]"===n&&s.length%2==0?`[${(e=>e.replace(u,((e,t,r)=>t.charCodeAt(0)<=r.charCodeAt(0)?e:"")))(r)}${s}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(e,t)=>`${t?`${t}[^/]+`:"[^/]*"}(?=$|\\/$)`]],d=Object.create(null),h=e=>"string"==typeof e;class f{constructor(e,t,r,s){this.origin=e,this.pattern=t,this.negative=r,this.regex=s}}const g=(e,t)=>{const r=e;let i=!1;0===e.indexOf("!")&&(i=!0,e=e.substr(1));const a=((e,t)=>{let r=d[e];return r||(r=p.reduce(((t,r)=>t.replace(r[0],r[1].bind(e))),e),d[e]=r),t?new RegExp(r,"i"):new RegExp(r)})(e=e.replace(s,"!").replace(n,"#"),t);return new f(r,e,i,a)},m=(e,t)=>{throw new t(e)},_=(e,t,r)=>{if(!h(e))return r(`path must be a string, but got \`${t}\``,TypeError);if(!e)return r("path must not be empty",TypeError);if(_.isNotRelative(e)){return r(`path should be a ${"`path.relative()`d"} string, but got "${t}"`,RangeError)}return!0},b=e=>a.test(e);_.isNotRelative=b,_.convert=e=>e;class y{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:r=!1}={}){var s,n,i;s=this,n=c,i=!0,Object.defineProperty(s,n,{value:i}),this._rules=[],this._ignoreCase=t,this._allowRelativePaths=r,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(e){if(e&&e[c])return this._rules=this._rules.concat(e._rules),void(this._added=!0);if((e=>e&&h(e)&&!t.test(e)&&!r.test(e)&&0!==e.indexOf("#"))(e)){const t=g(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(t){return this._added=!1,e(h(t)?(e=>e.split(i))(t):t).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,t){let r=!1,s=!1;return this._rules.forEach((n=>{const{negative:i}=n;if(s===i&&r!==s||i&&!r&&!s&&!t)return;n.regex.test(e)&&(r=!i,s=i)})),{ignored:r,unignored:s}}_test(e,t,r,s){const n=e&&_.convert(e);return _(n,e,this._allowRelativePaths?l:m),this._t(n,t,r,s)}_t(e,t,r,s){if(e in t)return t[e];if(s||(s=e.split("/")),s.pop(),!s.length)return t[e]=this._testOne(e,r);const n=this._t(s.join("/")+"/",t,r,s);return t[e]=n.ignored?n:this._testOne(e,r)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(t){return e(t).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}}const v=e=>new y(e);if(v.isPathValid=e=>_(e&&_.convert(e),e,l),v.default=v,ignore=v,"undefined"!=typeof process&&(process.env&&process.env.IGNORE_TEST_WIN32||"win32"===process.platform)){const e=e=>/^\\\\\?\\/.test(e)||/["<>|\u0000-\u001F]+/u.test(e)?e:e.replace(/\\/g,"/");_.convert=e;const t=/^[a-z]:\//i;_.isNotRelative=e=>t.test(e)||b(e)}return ignore}function requireTags$1(){if(hasRequiredTags$1)return tags$1;hasRequiredTags$1=1;return tags$1={GIT_COMMIT_SHA:"git.commit.sha",GIT_BRANCH:"git.branch",GIT_REPOSITORY_URL:"git.repository_url",GIT_TAG:"git.tag",GIT_COMMIT_MESSAGE:"git.commit.message",GIT_COMMIT_COMMITTER_DATE:"git.commit.committer.date",GIT_COMMIT_COMMITTER_EMAIL:"git.commit.committer.email",GIT_COMMIT_COMMITTER_NAME:"git.commit.committer.name",GIT_COMMIT_AUTHOR_DATE:"git.commit.author.date",GIT_COMMIT_AUTHOR_EMAIL:"git.commit.author.email",GIT_COMMIT_AUTHOR_NAME:"git.commit.author.name",CI_PIPELINE_ID:"ci.pipeline.id",CI_PIPELINE_NAME:"ci.pipeline.name",CI_PIPELINE_NUMBER:"ci.pipeline.number",CI_PIPELINE_URL:"ci.pipeline.url",CI_PROVIDER_NAME:"ci.provider.name",CI_WORKSPACE_PATH:"ci.workspace_path",CI_JOB_URL:"ci.job.url",CI_JOB_NAME:"ci.job.name",CI_STAGE_NAME:"ci.stage.name",CI_ENV_VARS:"_dd.ci.env_vars",CI_NODE_NAME:"ci.node.name",CI_NODE_LABELS:"ci.node.labels"}}function requireTelemetry$3(){if(hasRequiredTelemetry$3)return telemetry$3;hasRequiredTelemetry$3=1;const e=requireMetrics().manager.namespace("civisibility"),t={testLevel:"event_type",testFramework:"test_framework",errorType:"error_type",exitCode:"exit_code",isCodeCoverageEnabled:"coverage_enabled",isSuitesSkippingEnabled:"itrskip_enabled",hasCodeOwners:"has_code_owners",isUnsupportedCIProvider:"is_unsupported_ci"};function r(e){return Object.keys(e).reduce(((r,s)=>{const n=t[s]||s;return!0===e[s]?r.push(n):void 0!==e[s]&&null!==e[s]&&r.push(`${n}:${e[s]}`),r}),[])}return telemetry$3={incrementCountMetric:function(t,s={},n=1){e.count(t,r(s)).inc(n)},distributionMetric:function(t,s,n){e.distribution(t,r(s)).track(n)},TELEMETRY_EVENT_CREATED:"event_created",TELEMETRY_EVENT_FINISHED:"event_finished",TELEMETRY_CODE_COVERAGE_STARTED:"code_coverage_started",TELEMETRY_CODE_COVERAGE_FINISHED:"code_coverage_finished",TELEMETRY_ITR_SKIPPED:"itr_skipped",TELEMETRY_ITR_UNSKIPPABLE:"itr_unskippable",TELEMETRY_ITR_FORCED_TO_RUN:"itr_forced_run",TELEMETRY_CODE_COVERAGE_EMPTY:"code_coverage.is_empty",TELEMETRY_CODE_COVERAGE_NUM_FILES:"code_coverage.files",TELEMETRY_EVENTS_ENQUEUED_FOR_SERIALIZATION:"events_enqueued_for_serialization",TELEMETRY_ENDPOINT_PAYLOAD_SERIALIZATION_MS:"endpoint_payload.events_serialization_ms",TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS:"endpoint_payload.requests",TELEMETRY_ENDPOINT_PAYLOAD_BYTES:"endpoint_payload.bytes",TELEMETRY_ENDPOINT_PAYLOAD_EVENTS_COUNT:"endpoint_payload.events_count",TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS_MS:"endpoint_payload.requests_ms",TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS_ERRORS:"endpoint_payload.requests_errors",TELEMETRY_ENDPOINT_PAYLOAD_DROPPED:"endpoint_payload.dropped",TELEMETRY_GIT_COMMAND:"git.command",TELEMETRY_GIT_COMMAND_MS:"git.command_ms",TELEMETRY_GIT_COMMAND_ERRORS:"git.command_errors",TELEMETRY_GIT_REQUESTS_SEARCH_COMMITS:"git_requests.search_commits",TELEMETRY_GIT_REQUESTS_SEARCH_COMMITS_MS:"git_requests.search_commits_ms",TELEMETRY_GIT_REQUESTS_SEARCH_COMMITS_ERRORS:"git_requests.search_commits_errors",TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_NUM:"git_requests.objects_pack_files",TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_BYTES:"git_requests.objects_pack_bytes",TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES:"git_requests.objects_pack",TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_MS:"git_requests.objects_pack_ms",TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_ERRORS:"git_requests.objects_pack_errors",TELEMETRY_GIT_REQUESTS_SETTINGS:"git_requests.settings",TELEMETRY_GIT_REQUESTS_SETTINGS_MS:"git_requests.settings_ms",TELEMETRY_GIT_REQUESTS_SETTINGS_ERRORS:"git_requests.settings_errors",TELEMETRY_GIT_REQUESTS_SETTINGS_RESPONSE:"git_requests.settings_response",TELEMETRY_ITR_SKIPPABLE_TESTS:"itr_skippable_tests.request",TELEMETRY_ITR_SKIPPABLE_TESTS_MS:"itr_skippable_tests.request_ms",TELEMETRY_ITR_SKIPPABLE_TESTS_ERRORS:"itr_skippable_tests.request_errors",TELEMETRY_ITR_SKIPPABLE_TESTS_RESPONSE_SUITES:"itr_skippable_tests.response_suites",TELEMETRY_ITR_SKIPPABLE_TESTS_RESPONSE_TESTS:"itr_skippable_tests.response_tests",TELEMETRY_ITR_SKIPPABLE_TESTS_RESPONSE_BYTES:"itr_skippable_tests.response_bytes",getErrorTypeFromStatusCode:function(e){return e>=400&&e<500?"status_code_4xx_response":e>=500?"status_code_5xx_response":"network"}},telemetry$3}function requireUrl(){if(hasRequiredUrl)return url;hasRequiredUrl=1;const{URL:e}=require$$0$8;return url={filterSensitiveInfoFromRepository:function(t){if(!t)return"";if(t.startsWith("git@"))return t;if(t.startsWith("ssh://")){const e=/^(ssh:\/\/)[^@/]*@/;return t.replace(e,"$1")}try{const{protocol:r,host:s,pathname:n}=new e(t);return`${r}//${s}${"/"===n?"":n}`}catch(e){return""}}}}function requireGit(){if(hasRequiredGit)return git;hasRequiredGit=1;const e=require$$0$c,t=require$$0$a,r=require$$0$1,s=require$$0$6,n=requireLog$2(),{GIT_COMMIT_SHA:i,GIT_BRANCH:a,GIT_REPOSITORY_URL:o,GIT_TAG:c,GIT_COMMIT_MESSAGE:u,GIT_COMMIT_COMMITTER_DATE:l,GIT_COMMIT_COMMITTER_EMAIL:p,GIT_COMMIT_COMMITTER_NAME:d,GIT_COMMIT_AUTHOR_DATE:h,GIT_COMMIT_AUTHOR_EMAIL:f,GIT_COMMIT_AUTHOR_NAME:g,CI_WORKSPACE_PATH:m}=requireTags$1(),{incrementCountMetric:_,distributionMetric:b,TELEMETRY_GIT_COMMAND:y,TELEMETRY_GIT_COMMAND_MS:v,TELEMETRY_GIT_COMMAND_ERRORS:S}=requireTelemetry$3(),{filterSensitiveInfoFromRepository:q}=requireUrl(),{storage:E}=requireDatadogCore(),R=8388608;function T(t,r,s,i,a){const o=E.getStore();let c;E.enterWith({noop:!0}),s&&_(s.name,s.tags),i&&(c=Date.now());try{const s=e.execFileSync(t,r,{stdio:"pipe"}).toString().replace(/(\r\n|\n|\r)/gm,"");return i&&b(i.name,i.tags,Date.now()-c),s}catch(e){return a&&_(a.name,{...a.tags,exitCode:e.status}),n.error(e),""}finally{E.enterWith(o)}}return git={getGitMetadata:function(e){const{commitSHA:t,branch:r,repositoryUrl:s,tag:n,commitMessage:_,authorName:b,authorEmail:y,ciWorkspacePath:v}=e,[S,E,R,A,w,x]=T("git",["show","-s","--format=%an,%ae,%aI,%cn,%ce,%cI"]).split(",");return{[o]:q(s||T("git",["ls-remote","--get-url"])),[u]:_||T("git",["show","-s","--format=%s"]),[h]:R,[g]:b||S,[f]:y||E,[l]:x,[d]:A,[p]:w,[a]:r||T("git",["rev-parse","--abbrev-ref","HEAD"]),[i]:t||T("git",["rev-parse","HEAD"]),[c]:n,[m]:v||T("git",["rev-parse","--show-toplevel"])}},getLatestCommits:function(){_(y,{command:"get_local_commits"});const t=Date.now();try{const r=e.execFileSync("git",["log","--format=%H","-n 1000",'--since="1 month ago"'],{stdio:"pipe"}).toString().split("\n").filter((e=>e));return b(v,{command:"get_local_commits"},Date.now()-t),r}catch(e){return n.error(`Get latest commits failed: ${e.message}`),_(S,{command:"get_local_commits",errorType:e.status}),[]}},getRepositoryUrl:function(){return T("git",["config","--get","remote.origin.url"],{name:y,tags:{command:"get_repository"}},{name:v,tags:{command:"get_repository"}},{name:S,tags:{command:"get_repository"}})},generatePackFilesForCommits:function(i){let a=[];const o=t.tmpdir();if(!function(e){try{return s.statSync(e).isDirectory()}catch(e){return!1}}(o))return n.error(new Error("Provided path to generate packfiles is not a directory")),[];const c=String(Math.floor(1e4*Math.random())),u=r.join(o,c),l=r.join(process.cwd(),c);_(y,{command:"pack_objects"});const p=Date.now();function d(t){return e.execFileSync("git",["pack-objects","--compression=9","--max-pack-size=3m",t],{stdio:"pipe",input:i.join("\n")}).toString().split("\n").filter((e=>e)).map((e=>`${t}-${e}.pack`))}try{a=d(u)}catch(e){n.error(e),_(S,{command:"pack_objects",errorType:e.status});try{a=d(l)}catch(e){n.error(e),_(S,{command:"pack_objects",errorType:e.status})}}return b(v,{command:"pack_objects"},Date.now()-p),a},getCommitsRevList:function(t,r){let s=[];const i=t.map((e=>`^${e}`));_(y,{command:"get_objects"});const a=Date.now();try{s=e.execFileSync("git",["rev-list","--objects","--no-object-names","--filter=blob:none",'--since="1 month ago"',...i,...r],{stdio:"pipe",maxBuffer:R}).toString().split("\n").filter((e=>e))}catch(e){n.error(`Get commits to upload failed: ${e.message}`),_(S,{command:"get_objects",errorType:e.status})}return b(v,{command:"get_objects"},Date.now()-a),s},GIT_REV_LIST_MAX_BUFFER:R,isShallowRepository:function(){return"true"===T("git",["rev-parse","--is-shallow-repository"],{name:y,tags:{command:"check_shallow"}},{name:v,tags:{command:"check_shallow"}},{name:S,tags:{command:"check_shallow"}})},unshallowRepository:function(){const t=function(){const e=T("git",["version"]).match(/git version (\d+)\.(\d+)\.(\d+)/);try{return{major:parseInt(e[1]),minor:parseInt(e[2]),patch:parseInt(e[3])}}catch(e){return null}}();if(!t)return void n.warn("Git version could not be extracted, so git unshallow will not proceed");if(t.major<2||2===t.major&&t.minor<27)return void n.warn("Git version is <2.27, so git unshallow will not proceed");const r=T("git",["config","--default","origin","--get","clone.defaultRemoteName"]),s=T("git",["rev-parse","HEAD"]),i=["fetch",'--shallow-since="1 month ago"',"--update-shallow","--filter=blob:none","--recurse-submodules=no",r];_(y,{command:"unshallow"});const a=Date.now();try{e.execFileSync("git",[...i,s],{stdio:"pipe"})}catch(t){n.error(t),_(S,{command:"unshallow",exitCode:t.status});const r=T("git",["rev-parse","--abbrev-ref","--symbolic-full-name","@{upstream}"]);try{e.execFileSync("git",[...i,r],{stdio:"pipe"})}catch(e){n.error(e),_(S,{command:"unshallow",exitCode:e.status}),T("git",i,null,null,{name:S,tags:{command:"unshallow"}})}}b(v,{command:"unshallow"},Date.now()-a)}}}function requireCi(){if(hasRequiredCi)return ci;hasRequiredCi=1;const{GIT_BRANCH:e,GIT_COMMIT_SHA:t,GIT_TAG:r,GIT_COMMIT_AUTHOR_EMAIL:s,GIT_COMMIT_AUTHOR_NAME:n,GIT_COMMIT_MESSAGE:i,GIT_COMMIT_AUTHOR_DATE:a,GIT_REPOSITORY_URL:o,CI_PIPELINE_ID:c,CI_PIPELINE_NAME:u,CI_PIPELINE_NUMBER:l,CI_PIPELINE_URL:p,CI_PROVIDER_NAME:d,CI_WORKSPACE_PATH:h,CI_JOB_URL:f,CI_JOB_NAME:g,CI_STAGE_NAME:m,CI_ENV_VARS:_,GIT_COMMIT_COMMITTER_NAME:b,GIT_COMMIT_COMMITTER_EMAIL:y,CI_NODE_LABELS:v,CI_NODE_NAME:S}=requireTags$1(),{filterSensitiveInfoFromRepository:q}=requireUrl();function E(e,t,r){e[t]&&(e[t]=r(e[t]))}function R(e){return e?e.replace(/origin\/|refs\/heads\/|tags\//gm,""):e}function T(e){return e&&"string"==typeof e?"~"!==e[0]||"/"!==e[1]&&1!==e.length?e:e.replace("~",process.env.HOME):""}return ci={normalizeRef:R,getCIMetadata(){const{env:A}=process;let w={};if(A.JENKINS_URL){const{WORKSPACE:s,BUILD_TAG:n,JOB_NAME:i,BUILD_NUMBER:a,BUILD_URL:f,GIT_BRANCH:g,GIT_COMMIT:m,GIT_URL:b,GIT_URL_1:y,DD_CUSTOM_TRACE_ID:q,NODE_NAME:E,NODE_LABELS:T}=A;if(w={[c]:n,[l]:a,[p]:f,[d]:"jenkins",[t]:m,[o]:b||y,[h]:s,[_]:JSON.stringify({DD_CUSTOM_TRACE_ID:q}),[S]:E},T){let e;try{e=JSON.stringify(T.split(" ")),w[v]=e}catch(e){}}const x=g&&g.includes("tags/")?r:e,I=R(g);w[x]=I;let C="";if(i){const e=i.split("/");C=e.length>1&&e[1].includes("=")?e[0]:i.replace(`/${I}`,""),w[u]=C}}if(A.GITLAB_CI){const{CI_PIPELINE_ID:b,CI_PROJECT_PATH:y,CI_PIPELINE_IID:q,CI_PIPELINE_URL:E,CI_PROJECT_DIR:R,CI_COMMIT_REF_NAME:T,CI_COMMIT_TAG:x,CI_COMMIT_SHA:I,CI_REPOSITORY_URL:C,CI_JOB_URL:O,CI_JOB_STAGE:$,CI_JOB_NAME:k,CI_COMMIT_MESSAGE:P,CI_COMMIT_TIMESTAMP:N,CI_COMMIT_AUTHOR:L,CI_PROJECT_URL:M,CI_JOB_ID:D,CI_RUNNER_ID:j,CI_RUNNER_TAGS:U}=A,{name:B,email:G}=function(e){if(!e)return{name:"",email:""};let t="",r="";const s=e.match(/(?:"?([^"]*)"?\s)?(?:<?(.+@[^>]+)>?)/);return s&&(t=s[1],r=s[2]),{name:t,email:r}}(L);w={[c]:b,[u]:y,[l]:q,[d]:"gitlab",[t]:I,[o]:C,[f]:O,[r]:x,[e]:T,[h]:R,[p]:E,[m]:$,[g]:k,[i]:P,[n]:B,[s]:G,[a]:N,[_]:JSON.stringify({CI_PROJECT_URL:M,CI_PIPELINE_ID:b,CI_JOB_ID:D}),[v]:U,[S]:j}}if(A.CIRCLECI){const{CIRCLE_WORKFLOW_ID:s,CIRCLE_PROJECT_REPONAME:n,CIRCLE_BUILD_URL:i,CIRCLE_WORKING_DIRECTORY:a,CIRCLE_BRANCH:l,CIRCLE_TAG:m,CIRCLE_SHA1:b,CIRCLE_REPOSITORY_URL:y,CIRCLE_JOB:v,CIRCLE_BUILD_NUM:S}=A,q=`https://app.circleci.com/pipelines/workflows/${s}`;w={[c]:s,[u]:n,[p]:q,[g]:v,[d]:"circleci",[t]:b,[o]:y,[f]:i,[h]:a,[r]:m,[e]:l,[_]:JSON.stringify({CIRCLE_WORKFLOW_ID:s,CIRCLE_BUILD_NUM:S})}}if(A.GITHUB_ACTIONS||A.GITHUB_ACTION){const{GITHUB_RUN_ID:s,GITHUB_WORKFLOW:n,GITHUB_RUN_NUMBER:i,GITHUB_WORKSPACE:a,GITHUB_HEAD_REF:m,GITHUB_REF:b,GITHUB_SHA:y,GITHUB_REPOSITORY:v,GITHUB_SERVER_URL:S,GITHUB_RUN_ATTEMPT:E,GITHUB_JOB:R}=A,T=`${S}/${v}.git`;let x=`${S}/${v}/actions/runs/${s}`;E&&(x=`${x}/attempts/${E}`);const I=`${S}/${v}/commit/${y}/checks`,C=m||b||"",O=C.includes("tags/")?r:e;w={[c]:s,[u]:n,[l]:i,[p]:q(x),[d]:"github",[t]:y,[o]:T,[f]:q(I),[g]:R,[h]:a,[O]:C,[_]:JSON.stringify({GITHUB_SERVER_URL:q(S),GITHUB_REPOSITORY:v,GITHUB_RUN_ID:s,GITHUB_RUN_ATTEMPT:E})}}if(A.APPVEYOR){const{APPVEYOR_REPO_NAME:a,APPVEYOR_REPO_PROVIDER:g,APPVEYOR_BUILD_FOLDER:m,APPVEYOR_BUILD_ID:_,APPVEYOR_BUILD_NUMBER:b,APPVEYOR_REPO_COMMIT:y,APPVEYOR_PULL_REQUEST_HEAD_REPO_BRANCH:v,APPVEYOR_REPO_BRANCH:S,APPVEYOR_REPO_TAG_NAME:q,APPVEYOR_REPO_COMMIT_AUTHOR:E,APPVEYOR_REPO_COMMIT_AUTHOR_EMAIL:R,APPVEYOR_REPO_COMMIT_MESSAGE:T,APPVEYOR_REPO_COMMIT_MESSAGE_EXTENDED:x}=A,I=`https://ci.appveyor.com/project/${a}/builds/${_}`;w={[d]:"appveyor",[p]:I,[c]:_,[u]:a,[l]:b,[f]:I,[h]:m,[n]:E,[s]:R,[i]:T+"\n"+x},"github"===g&&(w={...w,[o]:`https://github.com/${a}.git`,[t]:y,[r]:q,[e]:v||S})}if(A.TF_BUILD){const{BUILD_SOURCESDIRECTORY:a,BUILD_BUILDID:b,BUILD_DEFINITIONNAME:y,SYSTEM_TEAMFOUNDATIONSERVERURI:v,SYSTEM_TEAMPROJECTID:S,SYSTEM_JOBID:q,SYSTEM_TASKINSTANCEID:E,SYSTEM_PULLREQUEST_SOURCEBRANCH:R,BUILD_SOURCEBRANCH:T,BUILD_SOURCEBRANCHNAME:x,SYSTEM_PULLREQUEST_SOURCECOMMITID:I,SYSTEM_PULLREQUEST_SOURCEREPOSITORYURI:C,BUILD_REPOSITORY_URI:O,BUILD_SOURCEVERSION:$,BUILD_REQUESTEDFORID:k,BUILD_REQUESTEDFOREMAIL:P,BUILD_SOURCEVERSIONMESSAGE:N,SYSTEM_STAGEDISPLAYNAME:L,SYSTEM_JOBDISPLAYNAME:M}=A,D=R||T||x,j=(D||"").includes("tags/")?r:e;if(w={[d]:"azurepipelines",[c]:b,[u]:y,[l]:b,[t]:I||$,[h]:a,[o]:C||O,[j]:D,[n]:k,[s]:P,[i]:N,[m]:L,[g]:M,[_]:JSON.stringify({SYSTEM_TEAMPROJECTID:S,BUILD_BUILDID:b,SYSTEM_JOBID:q})},v&&S&&b){const e=`${v}${S}/_build/results?buildId=${b}`,t=e,r=`${e}&view=logs&j=${q}&t=${E}`;w={...w,[p]:t,[f]:r}}}if(A.BITBUCKET_COMMIT){const{BITBUCKET_REPO_FULL_NAME:s,BITBUCKET_BUILD_NUMBER:n,BITBUCKET_BRANCH:i,BITBUCKET_COMMIT:a,BITBUCKET_GIT_SSH_ORIGIN:g,BITBUCKET_GIT_HTTP_ORIGIN:m,BITBUCKET_TAG:_,BITBUCKET_PIPELINE_UUID:b,BITBUCKET_CLONE_DIR:y}=A,v=`https://bitbucket.org/${s}/addon/pipelines/home#!/results/${n}`;w={[d]:"bitbucket",[t]:a,[l]:n,[u]:s,[f]:v,[p]:v,[e]:i,[r]:_,[o]:g||m,[h]:y,[c]:b&&b.replace(/{|}/gm,"")}}if(A.BITRISE_BUILD_SLUG){const{BITRISE_GIT_COMMIT:s,GIT_CLONE_COMMIT_HASH:n,BITRISEIO_GIT_BRANCH_DEST:a,BITRISE_GIT_BRANCH:f,BITRISE_BUILD_SLUG:g,BITRISE_TRIGGERED_WORKFLOW_ID:m,BITRISE_BUILD_NUMBER:_,BITRISE_BUILD_URL:b,BITRISE_SOURCE_DIR:y,GIT_REPOSITORY_URL:v,BITRISE_GIT_TAG:S,BITRISE_GIT_MESSAGE:q}=A;w={[d]:"bitrise",[c]:g,[u]:m,[l]:_,[p]:b,[t]:s||n,[o]:v,[h]:y,[r]:S,[e]:a||f,[i]:q}}if(A.BUILDKITE){const{BUILDKITE_BRANCH:a,BUILDKITE_COMMIT:g,BUILDKITE_REPO:m,BUILDKITE_TAG:b,BUILDKITE_BUILD_ID:y,BUILDKITE_PIPELINE_SLUG:q,BUILDKITE_BUILD_NUMBER:E,BUILDKITE_BUILD_URL:R,BUILDKITE_JOB_ID:T,BUILDKITE_BUILD_CHECKOUT_PATH:x,BUILDKITE_BUILD_AUTHOR:I,BUILDKITE_BUILD_AUTHOR_EMAIL:C,BUILDKITE_MESSAGE:O,BUILDKITE_AGENT_ID:$}=A,k=Object.keys(A).filter((e=>e.startsWith("BUILDKITE_AGENT_META_DATA_"))).map((e=>`${e.replace("BUILDKITE_AGENT_META_DATA_","").toLowerCase()}:${A[e]}`));w={[d]:"buildkite",[c]:y,[u]:q,[l]:E,[p]:R,[f]:`${R}#${T}`,[t]:g,[h]:x,[o]:m,[r]:b,[e]:a,[n]:I,[s]:C,[i]:O,[_]:JSON.stringify({BUILDKITE_BUILD_ID:y,BUILDKITE_JOB_ID:T}),[S]:$,[v]:JSON.stringify(k)}}if(A.TRAVIS){const{TRAVIS_PULL_REQUEST_BRANCH:s,TRAVIS_BRANCH:n,TRAVIS_COMMIT:a,TRAVIS_REPO_SLUG:g,TRAVIS_TAG:m,TRAVIS_JOB_WEB_URL:_,TRAVIS_BUILD_ID:b,TRAVIS_BUILD_NUMBER:y,TRAVIS_BUILD_WEB_URL:v,TRAVIS_BUILD_DIR:S,TRAVIS_COMMIT_MESSAGE:q}=A;w={[d]:"travisci",[f]:_,[c]:b,[u]:g,[l]:y,[p]:v,[t]:a,[o]:`https://github.com/${g}.git`,[h]:S,[r]:m,[e]:s||n,[i]:q}}if(A.BUDDY){const{BUDDY_EXECUTION_BRANCH:s,BUDDY_EXECUTION_ID:n,BUDDY_EXECUTION_REVISION:a,BUDDY_EXECUTION_REVISION_COMMITTER_EMAIL:h,BUDDY_EXECUTION_REVISION_COMMITTER_NAME:f,BUDDY_EXECUTION_REVISION_MESSAGE:g,BUDDY_EXECUTION_TAG:m,BUDDY_EXECUTION_URL:_,BUDDY_PIPELINE_ID:v,BUDDY_PIPELINE_NAME:S,BUDDY_SCM_URL:q}=A;w={[d]:"buddy",[c]:`${v}/${n}`,[u]:S,[l]:n,[p]:_,[t]:a,[o]:q,[e]:s,[r]:m,[i]:g,[b]:f,[y]:h}}if(A.TEAMCITY_VERSION){const{BUILD_URL:e,TEAMCITY_BUILDCONF_NAME:t,DATADOG_BUILD_ID:r}=A;w={[d]:"teamcity",[f]:e,[g]:t,[_]:JSON.stringify({DATADOG_BUILD_ID:r})}}if(A.CF_BUILD_ID){const{CF_BUILD_ID:t,CF_PIPELINE_NAME:s,CF_BUILD_URL:n,CF_STEP_NAME:i,CF_BRANCH:a}=A;w={[d]:"codefresh",[c]:t,[u]:s,[p]:n,[g]:i,[_]:JSON.stringify({CF_BUILD_ID:t})};const o=a&&a.includes("tags/")?r:e,l=R(a);w[o]=l}if(A.CODEBUILD_INITIATOR?.startsWith("codepipeline/")){const{CODEBUILD_BUILD_ARN:e,DD_ACTION_EXECUTION_ID:t,DD_PIPELINE_EXECUTION_ID:r}=A;w={[d]:"awscodepipeline",[c]:r,[_]:JSON.stringify({CODEBUILD_BUILD_ARN:e,DD_PIPELINE_EXECUTION_ID:r,DD_ACTION_EXECUTION_ID:t})}}return E(w,h,T),E(w,o,q),E(w,e,R),E(w,r,R),function(e){return Object.keys(e).reduce(((t,r)=>e[r]?{...t,[r]:e[r]}:t),{})}(w)}},ci}function requireUserProvidedGit(){if(hasRequiredUserProvidedGit)return userProvidedGit;hasRequiredUserProvidedGit=1;const{GIT_COMMIT_SHA:e,GIT_BRANCH:t,GIT_REPOSITORY_URL:r,GIT_TAG:s,GIT_COMMIT_MESSAGE:n,GIT_COMMIT_COMMITTER_DATE:i,GIT_COMMIT_COMMITTER_EMAIL:a,GIT_COMMIT_COMMITTER_NAME:o,GIT_COMMIT_AUTHOR_DATE:c,GIT_COMMIT_AUTHOR_EMAIL:u,GIT_COMMIT_AUTHOR_NAME:l}=requireTags$1(),{normalizeRef:p}=requireCi(),{filterSensitiveInfoFromRepository:d}=requireUrl();return userProvidedGit={getUserProviderGitMetadata:function(){const{DD_GIT_COMMIT_SHA:h,DD_GIT_BRANCH:f,DD_GIT_REPOSITORY_URL:g,DD_GIT_TAG:m,DD_GIT_COMMIT_MESSAGE:_,DD_GIT_COMMIT_COMMITTER_NAME:b,DD_GIT_COMMIT_COMMITTER_EMAIL:y,DD_GIT_COMMIT_COMMITTER_DATE:v,DD_GIT_COMMIT_AUTHOR_NAME:S,DD_GIT_COMMIT_AUTHOR_EMAIL:q,DD_GIT_COMMIT_AUTHOR_DATE:E}=process.env,R=p(f);let T=p(m);return((f||"").includes("origin/tags")||(f||"").includes("refs/heads/tags"))&&(T=p(f)),function(e){return Object.keys(e).reduce(((t,r)=>e[r]?{...t,[r]:e[r]}:t),{})}({[e]:h,[t]:R,[r]:d(g),[s]:T,[n]:_,[o]:b,[i]:v,[a]:y,[l]:S,[u]:q,[c]:E})},validateGitRepositoryUrl:function(e){return/(?:git|ssh|https?|git@[-\w.]+):(\/\/)?(.*?)(\/?|#[-\d\w._]+?)$/.test(e)},validateGitCommitSha:function(e){const t=/^[0-9a-f]{40}$/.test(e),r=/^[0-9a-f]{64}$/.test(e);return t||r}},userProvidedGit}function requireEnv(){if(hasRequiredEnv)return env;hasRequiredEnv=1;const e=require$$0$a,t="os.platform",r="os.version",s="os.architecture",n="runtime.name",i="runtime.version";return env={getRuntimeAndOSMetadata:function(){return{[i]:process.version,[s]:process.arch,[t]:process.platform,[n]:"node",[r]:e.release()}},OS_PLATFORM:t,OS_VERSION:r,OS_ARCHITECTURE:s,RUNTIME_NAME:n,RUNTIME_VERSION:i}}function requireTest(){if(hasRequiredTest)return test;hasRequiredTest=1;const e=require$$0$1,t=require$$0$6,{URL:r}=require$$0$8,s=requireLog$2(),n=requireIstanbulLibCoverage(),i=requireIgnore(),{getGitMetadata:a}=requireGit(),{getUserProviderGitMetadata:o,validateGitRepositoryUrl:c,validateGitCommitSha:u}=requireUserProvidedGit(),{getCIMetadata:l}=requireCi(),{getRuntimeAndOSMetadata:p}=requireEnv(),{GIT_BRANCH:d,GIT_COMMIT_SHA:h,GIT_REPOSITORY_URL:f,GIT_TAG:g,GIT_COMMIT_AUTHOR_EMAIL:m,GIT_COMMIT_AUTHOR_NAME:_,GIT_COMMIT_MESSAGE:b,CI_WORKSPACE_PATH:y,CI_PIPELINE_URL:v}=requireTags$1(),S=requireId(),{SPAN_TYPE:q,RESOURCE_NAME:E,SAMPLING_PRIORITY:R}=requireTags$2(),{SAMPLING_RULE_DECISION:T}=requireConstants$2(),{AUTO_KEEP:A}=requirePriority(),{version:w}=require$$6,x="test.framework",I="test.framework_version",C="test.type",O="test.name",$="test.suite",k="library_version",P="test.command",N="test.module",L="test.toolchain",M="_dd.ci.itr.tests_skipped",D="test.itr.tests_skipping.enabled",j="test.itr.tests_skipping.type",U="test.itr.tests_skipping.count",B="test.code_coverage.enabled",G="test.itr.unskippable",F="test.itr.forced_run",z="test.code_coverage.lines_pct",V="Retried by Datadog's Early Flake Detection",H=new RegExp(V+" \\(#\\d+\\): ","g");function W(){try{return process.env.npm_config_user_agent.split(" ")[0].replace("/","-")}catch(e){return""}}function K(e){return Object.keys(e).reduce(((t,n)=>n!==f||c(e[f])?n!==h||u(e[h])?n!==v||function(e){try{const t=new r(e);return"https:"===t.protocol||"http:"===t.protocol}catch(e){return!1}}(e[v])?(t[n]=e[n],t):t:(s.error(`Git commit SHA must be a full-length git SHA: ${e[h]}.`),t):(s.error(`Repository URL is not a valid repository URL: ${e[f]}.`),t)),{})}function Y(e){return"playwright"===e||"cypress"===e?"browser":"test"}test={TEST_CODE_OWNERS:"test.codeowners",TEST_FRAMEWORK:x,TEST_FRAMEWORK_VERSION:I,JEST_TEST_RUNNER:"test.jest.test_runner",TEST_TYPE:C,TEST_NAME:O,TEST_SUITE:$,TEST_STATUS:"test.status",TEST_PARAMETERS:"test.parameters",TEST_SKIP_REASON:"test.skip_reason",TEST_IS_RUM_ACTIVE:"test.is_rum_active",TEST_SOURCE_FILE:"test.source.file",CI_APP_ORIGIN:"ciapp-test",LIBRARY_VERSION:k,JEST_WORKER_TRACE_PAYLOAD_CODE:60,JEST_WORKER_COVERAGE_PAYLOAD_CODE:61,TEST_SOURCE_START:"test.source.start",TEST_SKIPPED_BY_ITR:"test.skipped_by_itr",TEST_CONFIGURATION_BROWSER_NAME:"test.configuration.browser_name",TEST_IS_NEW:"test.is_new",TEST_EARLY_FLAKE_IS_RETRY:"test.early_flake.is_retry",TEST_EARLY_FLAKE_IS_ENABLED:"test.early_flake.is_enabled",getTestEnvironmentMetadata:function(e,t){const r=l(),{[h]:s,[d]:n,[f]:i,[g]:c,[_]:u,[m]:v,[b]:S,[y]:q}=r,E=a({commitSHA:s,branch:n,repositoryUrl:i,tag:c,authorName:u,authorEmail:v,commitMessage:S,ciWorkspacePath:q}),R=o(),T=p(),A={[x]:e,...E,...r,...R,...T};t&&t.service&&(A["service.name"]=t.service);return K(A)},getTestParametersString:function(e,t){if(!e[t])return"";try{const r=e[t].shift();return JSON.stringify({arguments:r,metadata:{}})}catch(e){return""}},finishAllTraceSpans:function(e){e.context()._trace.started.forEach((t=>{t!==e&&t.finish()}))},getTestParentSpan:function(e){return e.extract("text_map",{"x-datadog-trace-id":S().toString(10),"x-datadog-parent-id":"0000000000000000"})},getTestSuitePath:function(t,r){if(!t)return r;return(t===r?t:e.relative(r,t)).replace(e.sep,"/")},getCodeOwnersFileEntries:function(e){let t,r=e,s=!1;const n=process.cwd();r&&r!==n||(r=n,s=!0);t=X(r),t||s||(t=X(n));if(!t)return null;const i=[],a=t.split("\n");for(const e of a){const[t]=e.split("#"),r=t.trim();if(""===r)continue;const[s,...n]=r.split(/\s+/);i.push({pattern:s,owners:n})}return i.reverse()},getCodeOwnersForFilename:function(e,t){if(!t)return null;for(const r of t)try{if(i().add(r.pattern).ignores(e))return JSON.stringify(r.owners)}catch(e){return null}return null},getTestCommonTags:function(e,t,r,s){return{[q]:"test",[C]:Y(s),[T]:1,[R]:A,[O]:e,[$]:t,[E]:`${t}.${e}`,[I]:r,[k]:w}},getTestSessionCommonTags:function(e,t,r){return{[q]:"test_session_end",[E]:`test_session.${e}`,[N]:r,[L]:W(),...Q(e,t,r)}},getTestModuleCommonTags:function(e,t,r){return{[q]:"test_module_end",[E]:`test_module.${e}`,[N]:r,...Q(e,t,r)}},getTestSuiteCommonTags:function(e,t,r,s){return{[q]:"test_suite_end",[E]:`test_suite.${r}`,[N]:s,[$]:r,...Q(e,t,s)}},TEST_COMMAND:P,TEST_TOOLCHAIN:L,TEST_SESSION_ID:"test_session_id",TEST_MODULE_ID:"test_module_id",TEST_SUITE_ID:"test_suite_id",TEST_ITR_TESTS_SKIPPED:M,TEST_MODULE:N,TEST_ITR_SKIPPING_ENABLED:D,TEST_ITR_SKIPPING_TYPE:j,TEST_ITR_SKIPPING_COUNT:U,TEST_CODE_COVERAGE_ENABLED:B,TEST_CODE_COVERAGE_LINES_PCT:z,TEST_ITR_UNSKIPPABLE:G,TEST_ITR_FORCED_RUN:F,ITR_CORRELATION_ID:"itr_correlation_id",addIntelligentTestRunnerSpanTags:function(e,t,{isSuitesSkipped:r,isSuitesSkippingEnabled:s,isCodeCoverageEnabled:n,testCodeCoverageLinesTotal:i,skippingCount:a,skippingType:o="suite",hasUnskippableSuites:c,hasForcedToRunSuites:u}){e.setTag(M,r?"true":"false"),e.setTag(D,s?"true":"false"),e.setTag(j,o),e.setTag(U,a),e.setTag(B,n?"true":"false"),t.setTag(M,r?"true":"false"),t.setTag(D,s?"true":"false"),t.setTag(j,o),t.setTag(U,a),t.setTag(B,n?"true":"false"),c&&(e.setTag(G,"true"),t.setTag(G,"true"));u&&(e.setTag(F,"true"),t.setTag(F,"true"));void 0!==i&&(e.setTag(z,i),t.setTag(z,i))},getCoveredFilenamesFromCoverage:function(e){const t=n.createCoverageMap(e);return t.files().filter((e=>{const r=t.fileCoverageFor(e).getLineCoverage();return Object.entries(r).some((([,e])=>!!e))}))},resetCoverage:function(e){const t=n.createCoverageMap(e);return t.files().forEach((e=>{t.fileCoverageFor(e).resetHits()}))},mergeCoverage:function(e,t){const r=n.createCoverageMap(e);return r.files().forEach((e=>{const s=r.fileCoverageFor(e);t.data[e]||t.addFileCoverage(n.createFileCoverage(e)),t.addFileCoverage(s);const i=t.fileCoverageFor(e);Object.entries(i.data.b).forEach((([e,t])=>{i.data.b[e]=[...t]}))}))},fromCoverageMapToCoverage:function(e){return Object.entries(e.data).reduce(((e,[t,r])=>(e[t]=r.data,e)),{})},getTestLineStart:function(e,t){if(!e.stack)return null;const r=e.stack.split("\n").find((e=>e.includes(t)));try{const e=r.match(/at (?:(.+?)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);return parseInt(e[3],10)||null}catch(e){return null}},getCallSites:function(){const e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;const t={},r=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t},Error.captureStackTrace(t);const s=t.stack;return Error.prepareStackTrace=r,Error.stackTraceLimit=e,s},removeInvalidMetadata:K,parseAnnotations:function(e){return e.reduce(((e,t)=>{if(!t?.type)return e;const{type:r,description:s}=t;if(r.startsWith("DD_TAGS")){const t=/\[(.*?)\]/.exec(r);let n="";t&&(n=t[1]),n&&(e[n]=s)}return e}),{})},EFD_STRING:V,EFD_TEST_NAME_REGEX:H,removeEfdStringFromTestName:function(e){return e.replace(H,"")},addEfdStringToTestName:function(e,t){return`${V} (#${t}): ${e}`}};const J=["CODEOWNERS",".github/CODEOWNERS","docs/CODEOWNERS",".gitlab/CODEOWNERS"];function X(r){for(const s of J)try{return t.readFileSync(e.join(r,s)).toString()}catch(e){}return""}function Q(e,t,r){return{[I]:t,[k]:w,[P]:e,[C]:Y(r)}}return test}function requireAgentlessCiVisibility(){if(hasRequiredAgentlessCiVisibility)return agentlessCiVisibility;hasRequiredAgentlessCiVisibility=1;const{truncateSpan:e,normalizeSpan:t}=requireTagsProcessors(),{AgentEncoder:r}=require_0_4(),{version:s}=require$$6,{ITR_CORRELATION_ID:n}=requireTest(),i=requireId(),{distributionMetric:a,TELEMETRY_ENDPOINT_PAYLOAD_SERIALIZATION_MS:o,TELEMETRY_ENDPOINT_PAYLOAD_EVENTS_COUNT:c}=requireTelemetry$3(),u=["test_session_end","test_module_end","test_suite_end","test"];function l(r){let s=1;return"test"===r.type&&r.meta&&r.meta.test_session_id&&(s=2),{type:u.includes(r.type)?r.type:"span",version:s,content:t(e(r))}}return agentlessCiVisibility={AgentlessCiVisibilityEncoder:class extends r{constructor(e,{runtimeId:t,service:r,env:s}){super(e,2097152),this.runtimeId=t,this.service=r,this.env=s,this._eventCount=0,this.reset()}_encodeTestSuite(e,t){let r=12;const s=t.meta[n];s&&r++,this._encodeMapPrefix(e,r),this._encodeString(e,"type"),this._encodeString(e,t.type),this._encodeString(e,"test_session_id"),this._encodeId(e,t.trace_id),this._encodeString(e,"test_module_id"),this._encodeId(e,t.parent_id),this._encodeString(e,"test_suite_id"),this._encodeId(e,t.span_id),s&&(this._encodeString(e,n),this._encodeString(e,s),delete t.meta[n]),this._encodeString(e,"error"),this._encodeNumber(e,t.error),this._encodeString(e,"name"),this._encodeString(e,t.name),this._encodeString(e,"service"),this._encodeString(e,t.service),this._encodeString(e,"resource"),this._encodeString(e,t.resource),this._encodeString(e,"start"),this._encodeNumber(e,t.start),this._encodeString(e,"duration"),this._encodeNumber(e,t.duration),this._encodeString(e,"meta"),this._encodeMap(e,t.meta),this._encodeString(e,"metrics"),this._encodeMap(e,t.metrics)}_encodeTestModule(e,t){this._encodeMapPrefix(e,11),this._encodeString(e,"type"),this._encodeString(e,t.type),this._encodeString(e,"test_session_id"),this._encodeId(e,t.trace_id),this._encodeString(e,"test_module_id"),this._encodeId(e,t.span_id),this._encodeString(e,"error"),this._encodeNumber(e,t.error),this._encodeString(e,"name"),this._encodeString(e,t.name),this._encodeString(e,"service"),this._encodeString(e,t.service),this._encodeString(e,"resource"),this._encodeString(e,t.resource),this._encodeString(e,"start"),this._encodeNumber(e,t.start),this._encodeString(e,"duration"),this._encodeNumber(e,t.duration),this._encodeString(e,"meta"),this._encodeMap(e,t.meta),this._encodeString(e,"metrics"),this._encodeMap(e,t.metrics)}_encodeTestSession(e,t){this._encodeMapPrefix(e,10),this._encodeString(e,"type"),this._encodeString(e,t.type),this._encodeString(e,"test_session_id"),this._encodeId(e,t.trace_id),this._encodeString(e,"error"),this._encodeNumber(e,t.error),this._encodeString(e,"name"),this._encodeString(e,t.name),this._encodeString(e,"service"),this._encodeString(e,t.service),this._encodeString(e,"resource"),this._encodeString(e,t.resource),this._encodeString(e,"start"),this._encodeNumber(e,t.start),this._encodeString(e,"duration"),this._encodeNumber(e,t.duration),this._encodeString(e,"meta"),this._encodeMap(e,t.meta),this._encodeString(e,"metrics"),this._encodeMap(e,t.metrics)}_encodeEventContent(e,t){let r=11;t.meta.test_session_id&&(r+=1),t.meta.test_module_id&&(r+=1),t.meta.test_suite_id&&(r+=1);const s=t.meta[n];s&&(r+=1),t.type&&(r+=1),this._encodeMapPrefix(e,r),t.type&&(this._encodeString(e,"type"),this._encodeString(e,t.type)),this._encodeString(e,"trace_id"),this._encodeId(e,t.trace_id),this._encodeString(e,"span_id"),this._encodeId(e,t.span_id),this._encodeString(e,"parent_id"),this._encodeId(e,t.parent_id),this._encodeString(e,"name"),this._encodeString(e,t.name),this._encodeString(e,"resource"),this._encodeString(e,t.resource),this._encodeString(e,"service"),this._encodeString(e,t.service),this._encodeString(e,"error"),this._encodeNumber(e,t.error),this._encodeString(e,"start"),this._encodeNumber(e,t.start),this._encodeString(e,"duration"),this._encodeNumber(e,t.duration),t.meta.test_session_id&&(this._encodeString(e,"test_session_id"),this._encodeId(e,i(t.meta.test_session_id,10)),delete t.meta.test_session_id),t.meta.test_module_id&&(this._encodeString(e,"test_module_id"),this._encodeId(e,i(t.meta.test_module_id,10)),delete t.meta.test_module_id),t.meta.test_suite_id&&(this._encodeString(e,"test_suite_id"),this._encodeId(e,i(t.meta.test_suite_id,10)),delete t.meta.test_suite_id),s&&(this._encodeString(e,n),this._encodeString(e,s),delete t.meta[n]),this._encodeString(e,"meta"),this._encodeMap(e,t.meta),this._encodeString(e,"metrics"),this._encodeMap(e,t.metrics)}_encodeEvent(e,t){this._encodeMapPrefix(e,Object.keys(t).length),this._encodeString(e,"type"),this._encodeString(e,t.type),this._encodeString(e,"version"),this._encodeNumber(e,t.version),this._encodeString(e,"content"),"span"===t.type||"test"===t.type?this._encodeEventContent(e,t.content):"test_suite_end"===t.type?this._encodeTestSuite(e,t.content):"test_module_end"===t.type?this._encodeTestModule(e,t.content):"test_session_end"===t.type&&this._encodeTestSession(e,t.content)}_encodeNumber(e,t){return Math.floor(t)!==t?this._encodeFloat(e,t):this._encodeLong(e,t)}_encodeLong(e,t){const r=t>=0,s=r?t/Math.pow(2,32)|0:Math.floor(t/Math.pow(2,32)),n=t>>>0,i=r?207:211,a=e.length;e.reserve(9),e.length+=9,e.buffer[a]=i,e.buffer[a+1]=s>>24,e.buffer[a+2]=s>>16,e.buffer[a+3]=s>>8,e.buffer[a+4]=s,e.buffer[a+5]=n>>24,e.buffer[a+6]=n>>16,e.buffer[a+7]=n>>8,e.buffer[a+8]=n}_encode(e,t){const r=Date.now(),s=t.map(l),n=s.filter((e=>"test_session_end"===e.type||"test_suite_end"===e.type||"test_module_end"===e.type)),i=!!n.length?n:s;this._eventCount+=i.length;for(const t of i)this._encodeEvent(e,t);a(o,{endpoint:"test_cycle"},Date.now()-r)}makePayload(){a(c,{endpoint:"test_cycle"},this._eventCount);const e=this._traceBytes,t=this._eventsOffset,r=this._eventCount;e.buffer[t]=221,e.buffer[t+1]=r>>24,e.buffer[t+2]=r>>16,e.buffer[t+3]=r>>8,e.buffer[t+4]=r;const s=e.length,n=Buffer.allocUnsafe(s);return e.buffer.copy(n,0,0,s),this.reset(),n}_encodePayloadStart(e){const t={version:1,metadata:{"*":{language:"javascript",library_version:s}},events:[]};this.env&&(t.metadata["*"].env=this.env),this.runtimeId&&(t.metadata["*"]["runtime-id"]=this.runtimeId),this._encodeMapPrefix(e,Object.keys(t).length),this._encodeString(e,"version"),this._encodeNumber(e,t.version),this._encodeString(e,"metadata"),this._encodeMapPrefix(e,Object.keys(t.metadata).length),this._encodeString(e,"*"),this._encodeMap(e,t.metadata["*"]),this._encodeString(e,"events"),this._eventsOffset=e.length,e.reserve(5),e.length+=5}reset(){this._reset(),this._eventCount=0,this._encodePayloadStart(this._traceBytes)}}},agentlessCiVisibility}function requireWriter$2(){if(hasRequiredWriter$2)return writer$2;hasRequiredWriter$2=1;const e=requireRequest(),{safeJSONStringify:t}=requireUtil$7(),r=requireLog$2(),{AgentlessCiVisibilityEncoder:s}=requireAgentlessCiVisibility(),n=requireWriter$5(),{incrementCountMetric:i,distributionMetric:a,TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS:o,TELEMETRY_ENDPOINT_PAYLOAD_BYTES:c,TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS_MS:u,TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS_ERRORS:l,TELEMETRY_ENDPOINT_PAYLOAD_DROPPED:p,getErrorTypeFromStatusCode:d}=requireTelemetry$3();return writer$2=class extends n{constructor({url:e,tags:t,evpProxyPrefix:r=""}){super(...arguments);const{"runtime-id":n,env:i,service:a}=t;this._url=e,this._encoder=new s(this,{runtimeId:n,env:i,service:a}),this._evpProxyPrefix=r}_sendPayload(s,n,h){const f={path:"/api/v2/citestcycle",method:"POST",headers:{"dd-api-key":process.env.DATADOG_API_KEY||process.env.DD_API_KEY,"Content-Type":"application/msgpack"},timeout:15e3,url:this._url};this._evpProxyPrefix&&(f.path=`${this._evpProxyPrefix}/api/v2/citestcycle`,delete f.headers["dd-api-key"],f.headers["X-Datadog-EVP-Subdomain"]="citestcycle-intake"),r.debug((()=>`Request to the intake: ${t(f)}`));const g=Date.now();i(o,{endpoint:"test_cycle"}),a(c,{endpoint:"test_cycle"},s.length),e(s,f,((e,t,s)=>{if(a(u,{endpoint:"test_cycle"},Date.now()-g),e){const t=d(s);return i(l,{endpoint:"test_cycle",errorType:t}),i(p,{endpoint:"test_cycle"}),r.error(e),void h()}r.debug(`Response from the intake: ${t}`),h()}))}},writer$2}function requireFormData(){if(hasRequiredFormData)return formData;hasRequiredFormData=1;const{Readable:e}=require$$0$7,t=requireId();return formData=class extends e{constructor(){super(),this._boundary=t().toString(),this._data=[]}append(e,t,r={}){this._appendBoundary(),r.filename?this._appendFile(e,t,r):this._appendMetadata(e,t,r)}size(){return this._data.reduce(((e,t)=>e+t.length),0)}getHeaders(){return{"Content-Type":"multipart/form-data; boundary="+this._boundary}}_appendBoundary(){this._data.push(`--${this._boundary}\r\n`)}_appendMetadata(e,t){this._data.push(`Content-Disposition: form-data; name="${e}"\r\n\r\n${t}\r\n`)}_appendFile(e,t,{filename:r,contentType:s="application/octet-stream"}){this._data.push(`Content-Disposition: form-data; name="${e}"; filename="${r}"\r\n`),this._data.push(`Content-Type: ${s}\r\n\r\n`),this._data.push(t),this._data.push("\r\n")}_read(){this.push(this._data.shift()),0===this._data.length&&(this.push(`--${this._boundary}--\r\n`),this.push(null))}},formData}function requireCoverageCiVisibility(){if(hasRequiredCoverageCiVisibility)return coverageCiVisibility;hasRequiredCoverageCiVisibility=1;const{AgentEncoder:e}=require_0_4(),t=requireChunk(),{distributionMetric:r,TELEMETRY_ENDPOINT_PAYLOAD_SERIALIZATION_MS:s,TELEMETRY_ENDPOINT_PAYLOAD_EVENTS_COUNT:n}=requireTelemetry$3(),i=requireFormData();return coverageCiVisibility={CoverageCIVisibilityEncoder:class extends e{constructor(){super(...arguments),this._coverageBytes=new t,this.form=new i,this._coveragesCount=0,this.reset()}count(){return this._coveragesCount}encode(e){const t=Date.now();this._coveragesCount++,this.encodeCodeCoverage(this._coverageBytes,e),r(s,{endpoint:"code_coverage"},Date.now()-t)}encodeCodeCoverage(e,t){t.testId?this._encodeMapPrefix(e,4):this._encodeMapPrefix(e,3),this._encodeString(e,"test_session_id"),this._encodeId(e,t.sessionId),this._encodeString(e,"test_suite_id"),this._encodeId(e,t.suiteId),t.testId&&(this._encodeString(e,"span_id"),this._encodeId(e,t.testId)),this._encodeString(e,"files"),this._encodeArrayPrefix(e,t.files);for(const r of t.files)this._encodeMapPrefix(e,1),this._encodeString(e,"filename"),this._encodeString(e,r)}reset(){this._reset(),this._coverageBytes&&(this._coverageBytes.length=0),this._coveragesCount=0,this._encodePayloadStart(this._coverageBytes)}_encodePayloadStart(e){const t=2;this._encodeMapPrefix(e,2),this._encodeString(e,"version"),this._encodeInteger(e,t),this._encodeString(e,"coverages"),this._coveragesOffset=e.length,e.reserve(5),e.length+=5}makePayload(){r(n,{endpoint:"code_coverage"},this._coveragesCount);const e=this._coverageBytes,t=this._coveragesOffset,s=this._coveragesCount;e.buffer[t]=221,e.buffer[t+1]=s>>24,e.buffer[t+2]=s>>16,e.buffer[t+3]=s>>8,e.buffer[t+4]=s;const a=e.length,o=Buffer.allocUnsafe(a);e.buffer.copy(o,0,0,e.length),this.form.append("coverage1",o,{filename:"coverage1.msgpack",contentType:"application/msgpack"}),this.form.append("event",JSON.stringify({dummy:!0}),{filename:"event.json",contentType:"application/json"});const c=this.form;return this.form=new i,this.reset(),c}}},coverageCiVisibility}function requireCoverageWriter(){if(hasRequiredCoverageWriter)return coverageWriter;hasRequiredCoverageWriter=1;const e=requireRequest(),t=requireLog$2(),{safeJSONStringify:r}=requireUtil$7(),{CoverageCIVisibilityEncoder:s}=requireCoverageCiVisibility(),n=requireWriter$5(),{incrementCountMetric:i,distributionMetric:a,TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS:o,TELEMETRY_ENDPOINT_PAYLOAD_BYTES:c,TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS_MS:u,TELEMETRY_ENDPOINT_PAYLOAD_REQUESTS_ERRORS:l,TELEMETRY_ENDPOINT_PAYLOAD_DROPPED:p,getErrorTypeFromStatusCode:d}=requireTelemetry$3();return coverageWriter=class extends n{constructor({url:e,evpProxyPrefix:t=""}){super(...arguments),this._url=e,this._encoder=new s(this),this._evpProxyPrefix=t}_sendPayload(s,n,h){const f={path:"/api/v2/citestcov",method:"POST",headers:{"dd-api-key":process.env.DATADOG_API_KEY||process.env.DD_API_KEY,...s.getHeaders()},timeout:15e3,url:this._url};this._evpProxyPrefix&&(f.path=`${this._evpProxyPrefix}/api/v2/citestcov`,delete f.headers["dd-api-key"],f.headers["X-Datadog-EVP-Subdomain"]="citestcov-intake"),t.debug((()=>`Request to the intake: ${r(f)}`));const g=Date.now();i(o,{endpoint:"code_coverage"}),a(c,{endpoint:"code_coverage"},s.size()),e(s,f,((e,r,s)=>{if(a(u,{endpoint:"code_coverage"},Date.now()-g),e){const r=d(s);return i(l,{endpoint:"code_coverage",errorType:r}),i(p,{endpoint:"code_coverage"}),t.error(e),void h()}t.debug(`Response from the intake: ${r}`),h()}))}},coverageWriter}function requireGit_metadata(){if(hasRequiredGit_metadata)return git_metadata;hasRequiredGit_metadata=1;const e=require$$0$6,t=require$$0$1,r=requireFormData(),s=requireRequest(),n=requireLog$2(),{getLatestCommits:i,getRepositoryUrl:a,generatePackFilesForCommits:o,getCommitsRevList:c,isShallowRepository:u,unshallowRepository:l}=requireGit(),{incrementCountMetric:p,distributionMetric:d,TELEMETRY_GIT_REQUESTS_SEARCH_COMMITS:h,TELEMETRY_GIT_REQUESTS_SEARCH_COMMITS_MS:f,TELEMETRY_GIT_REQUESTS_SEARCH_COMMITS_ERRORS:g,TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_NUM:m,TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES:_,TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_MS:b,TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_ERRORS:y,TELEMETRY_GIT_REQUESTS_OBJECT_PACKFILES_BYTES:v,getErrorTypeFromStatusCode:S}=requireTelemetry$3(),q=e=>/^[0-9a-f]{40}$/.test(e),E=e=>/^[0-9a-f]{64}$/.test(e);function R(e){return{method:"POST",headers:{"dd-api-key":process.env.DATADOG_API_KEY||process.env.DD_API_KEY},timeout:15e3,url:e}}function T({url:e,repositoryUrl:t,latestCommits:r,isEvpProxy:i,evpProxyPrefix:a},o){const u=R(e),l={...u,headers:{...u.headers,"Content-Type":"application/json"},path:"/api/v2/git/repository/search_commits"};i&&(l.path=`${a}/api/v2/git/repository/search_commits`,l.headers["X-Datadog-EVP-Subdomain"]="api",delete l.headers["dd-api-key"]);const m=JSON.stringify({meta:{repository_url:t},data:r.map((e=>({id:e,type:"commit"})))});p(h);const _=Date.now();s(m,l,((e,t,s)=>{if(d(f,{},Date.now()-_),e){const t=S(s);p(g,{errorType:t});const r=new Error(`Error fetching commits to exclude: ${e.message}`);return o(r)}let i;try{a=JSON.parse(t).data,i=a.map((({id:e,type:t})=>{if("commit"!==t)throw new Error("Invalid commit type response");if(q(e)||E(e))return e.replace(/[^0-9a-f]+/g,"");throw new Error("Invalid commit format")}))}catch(e){return p(g,{errorType:"network"}),o(new Error(`Can't parse commits to exclude response: ${e.message}`))}var a;n.debug(`There are ${i.length} commits to exclude.`);const u=r.filter((e=>!i.includes(e)));if(n.debug(`There are ${u.length} commits to include.`),!u.length)return o(null,[]);const l=c(i,u);o(null,l)}))}function A({url:n,isEvpProxy:i,evpProxyPrefix:a,packFileToUpload:o,repositoryUrl:c,headCommit:u},l){const h=new r,f=JSON.stringify({data:{id:u,type:"commit"},meta:{repository_url:c}});h.append("pushedSha",f,{contentType:"application/json"});try{const r=e.readFileSync(o),[,s]=t.basename(o).split("-");h.append("packfile",r,{filename:s,contentType:"application/octet-stream"})}catch(e){return void l(new Error(`Could not read "${o}"`))}const g=R(n),m={...g,path:"/api/v2/git/repository/packfile",headers:{...g.headers,...h.getHeaders()}};i&&(m.path=`${a}/api/v2/git/repository/packfile`,m.headers["X-Datadog-EVP-Subdomain"]="api",delete m.headers["dd-api-key"]),p(_);const v=h.size(),q=Date.now();s(h,m,((e,t,r)=>{if(d(b,{},Date.now()-q),e){const t=S(r);p(y,{errorType:t});const s=new Error(`Could not upload packfiles: status code ${r}: ${e.message}`);return l(s,v)}l(null,v)}))}return git_metadata={sendGitMetadata:function(e,{isEvpProxy:t,evpProxyPrefix:r},s,c){let p=s;if(p||(p=a()),n.debug(`Uploading git history for repository ${p}`),!p)return c(new Error("Repository URL is empty"));const h=i();n.debug(`There were ${h.length} commits since last month.`);const[f]=h,g=s=>(i,a)=>i?c(i):a.length?s||!u()?function({url:e,isEvpProxy:t,evpProxyPrefix:r,commitsToUpload:s,repositoryUrl:i,headCommit:a},c){n.debug(`There are ${s.length} commits to upload`);const u=o(s);if(n.debug(`Uploading ${u.length} packfiles.`),!u.length)return c(new Error("Failed to generate packfiles"));d(m,{},u.length);let l=0,p=0;const h=(s,n)=>(p+=n,s||l===u.length?(d(v,{},p),c(s)):A({packFileToUpload:u[l++],url:e,isEvpProxy:t,evpProxyPrefix:r,repositoryUrl:i,headCommit:a},h));A({packFileToUpload:u[l++],url:e,isEvpProxy:t,evpProxyPrefix:r,repositoryUrl:i,headCommit:a},h)}({url:e,isEvpProxy:t,evpProxyPrefix:r,commitsToUpload:a,repositoryUrl:p,headCommit:f},c):(n.debug("It is shallow clone, unshallowing..."),l(),void T({url:e,repositoryUrl:p,latestCommits:h,isEvpProxy:t,evpProxyPrefix:r},g(!0))):(n.debug("No commits to upload"),c(null));T({url:e,repositoryUrl:p,latestCommits:h,isEvpProxy:t,evpProxyPrefix:r},g(!1))}},git_metadata}function requireGetLibraryConfiguration(){if(hasRequiredGetLibraryConfiguration)return getLibraryConfiguration_1;hasRequiredGetLibraryConfiguration=1;const e=requireRequest(),t=requireId(),r=requireLog$2(),{incrementCountMetric:s,distributionMetric:n,TELEMETRY_GIT_REQUESTS_SETTINGS:i,TELEMETRY_GIT_REQUESTS_SETTINGS_MS:a,TELEMETRY_GIT_REQUESTS_SETTINGS_ERRORS:o,TELEMETRY_GIT_REQUESTS_SETTINGS_RESPONSE:c,getErrorTypeFromStatusCode:u}=requireTelemetry$3();return getLibraryConfiguration_1={getLibraryConfiguration:function({url:l,isEvpProxy:p,evpProxyPrefix:d,env:h,service:f,repositoryUrl:g,sha:m,osVersion:_,osPlatform:b,osArchitecture:y,runtimeName:v,runtimeVersion:S,branch:q,testLevel:E="suite",custom:R},T){const A={path:"/api/v2/libraries/tests/services/setting",method:"POST",headers:{"Content-Type":"application/json"},url:l,timeout:2e4};if(p)A.path=`${d}/api/v2/libraries/tests/services/setting`,A.headers["X-Datadog-EVP-Subdomain"]="api";else{const e=process.env.DATADOG_API_KEY||process.env.DD_API_KEY;if(!e)return T(new Error("Request to settings endpoint was not done because Datadog API key is not defined."));A.headers["dd-api-key"]=e}const w=JSON.stringify({data:{id:t().toString(10),type:"ci_app_test_service_libraries_settings",attributes:{test_level:E,configurations:{"os.platform":b,"os.version":_,"os.architecture":y,"runtime.name":v,"runtime.version":S,custom:R},service:f,env:h,repository_url:g,sha:m,branch:q}}});s(i);const x=Date.now();e(w,A,((e,t,i)=>{if(n(a,{},Date.now()-x),e){const t=u(i);s(o,{errorType:t}),T(e)}else try{const{data:{attributes:{code_coverage:e,tests_skipping:n,itr_enabled:i,require_git:a,early_flake_detection:o}}}=JSON.parse(t),u={isCodeCoverageEnabled:e,isSuitesSkippingEnabled:n,isItrEnabled:i,requireGit:a,isEarlyFlakeDetectionEnabled:o?.enabled??!1,earlyFlakeDetectionNumRetries:o?.slow_test_retries?.["5s"]||2};r.debug((()=>`Remote settings: ${JSON.stringify(u)}`)),process.env.DD_CIVISIBILITY_DANGEROUSLY_FORCE_COVERAGE&&(u.isCodeCoverageEnabled=!0,r.debug((()=>"Dangerously set code coverage to true"))),process.env.DD_CIVISIBILITY_DANGEROUSLY_FORCE_TEST_SKIPPING&&(u.isSuitesSkippingEnabled=!0,r.debug((()=>"Dangerously set test skipping to true"))),s(c,u),T(null,u)}catch(e){T(e)}}))}},getLibraryConfiguration_1}function requireGetSkippableSuites(){if(hasRequiredGetSkippableSuites)return getSkippableSuites_1;hasRequiredGetSkippableSuites=1;const e=requireRequest(),t=requireLog$2(),{incrementCountMetric:r,distributionMetric:s,TELEMETRY_ITR_SKIPPABLE_TESTS:n,TELEMETRY_ITR_SKIPPABLE_TESTS_MS:i,TELEMETRY_ITR_SKIPPABLE_TESTS_ERRORS:a,TELEMETRY_ITR_SKIPPABLE_TESTS_RESPONSE_SUITES:o,TELEMETRY_ITR_SKIPPABLE_TESTS_RESPONSE_TESTS:c,TELEMETRY_ITR_SKIPPABLE_TESTS_RESPONSE_BYTES:u,getErrorTypeFromStatusCode:l}=requireTelemetry$3();return getSkippableSuites_1={getSkippableSuites:function({url:p,isEvpProxy:d,evpProxyPrefix:h,isGzipCompatible:f,env:g,service:m,repositoryUrl:_,sha:b,osVersion:y,osPlatform:v,osArchitecture:S,runtimeName:q,runtimeVersion:E,custom:R,testLevel:T="suite"},A){const w={path:"/api/v2/ci/tests/skippable",method:"POST",headers:{"Content-Type":"application/json"},timeout:2e4,url:p};if(f&&(w.headers["accept-encoding"]="gzip"),d)w.path=`${h}/api/v2/ci/tests/skippable`,w.headers["X-Datadog-EVP-Subdomain"]="api";else{const e=process.env.DATADOG_API_KEY||process.env.DD_API_KEY;if(!e)return A(new Error("Skippable suites were not fetched because Datadog API key is not defined."));w.headers["dd-api-key"]=e}const x=JSON.stringify({data:{type:"test_params",attributes:{test_level:T,configurations:{"os.platform":v,"os.version":y,"os.architecture":S,"runtime.name":q,"runtime.version":E,custom:R},service:m,env:g,repository_url:_,sha:b}}});r(n);const I=Date.now();e(x,w,((e,n,p)=>{if(s(i,{},Date.now()-I),e){const t=l(p);r(a,{errorType:t}),A(e)}else{let i=[];try{const e=JSON.parse(n);i=e.data.filter((({type:e})=>e===T)).map((({attributes:{suite:e,name:t}})=>"suite"===T?e:{suite:e,name:t}));const{meta:{correlation_id:a}}=e;r("test"===T?c:o,{},i.length),s(u,{},n.length),t.debug((()=>`Number of received skippable ${T}s: ${i.length}`)),A(null,i,a)}catch(e){A(e)}}}))}},getSkippableSuites_1}function requireGetKnownTests(){if(hasRequiredGetKnownTests)return getKnownTests_1;hasRequiredGetKnownTests=1;const e=requireRequest(),t=requireId(),r=requireLog$2();return getKnownTests_1={getKnownTests:function({url:s,isEvpProxy:n,evpProxyPrefix:i,isGzipCompatible:a,env:o,service:c,repositoryUrl:u,sha:l,osVersion:p,osPlatform:d,osArchitecture:h,runtimeName:f,runtimeVersion:g,custom:m},_){const b={path:"/api/v2/ci/libraries/tests",method:"POST",headers:{"Content-Type":"application/json"},timeout:2e4,url:s};if(a&&(b.headers["accept-encoding"]="gzip"),n)b.path=`${i}/api/v2/ci/libraries/tests`,b.headers["X-Datadog-EVP-Subdomain"]="api";else{const e=process.env.DATADOG_API_KEY||process.env.DD_API_KEY;if(!e)return _(new Error("Known tests were not fetched because Datadog API key is not defined."));b.headers["dd-api-key"]=e}const y=JSON.stringify({data:{id:t().toString(10),type:"ci_app_libraries_tests_request",attributes:{configurations:{"os.platform":d,"os.version":p,"os.architecture":h,"runtime.name":f,"runtime.version":g,custom:m},service:c,env:o,repository_url:u,sha:l}}});e(y,b,((e,t)=>{if(e)_(e);else try{const{data:{attributes:{test_full_names:e}}}=JSON.parse(t);r.debug((()=>`Number of received known tests: ${Object.keys(e).length}`)),_(null,e)}catch(e){_(e)}}))}},getKnownTests_1}function requireAgentInfoExporter(){if(hasRequiredAgentInfoExporter)return agentInfoExporter;hasRequiredAgentInfoExporter=1;const{URL:e,format:t}=require$$0$8,r=requireRequest(),{incrementCountMetric:s,TELEMETRY_EVENTS_ENQUEUED_FOR_SERIALIZATION:n}=requireTelemetry$3();return agentInfoExporter=class{constructor(r){this._config=r;const{url:s,hostname:n,port:i}=this._config;this._url=s||new e(t({protocol:"http:",hostname:n||"localhost",port:i})),this._traceBuffer=[],this._isInitialized=!1}getAgentInfo(e){!function(e,t){r("",{path:"/info",url:e},((e,r)=>{if(e)return t(e);try{const e=JSON.parse(r);return t(null,e)}catch(e){return t(e)}}))}(this._url,e)}export(e){this._isInitialized?this._export(e):this._traceBuffer.push(e)}_export(e,t=this._writer,r="_timer"){this._config.isCiVisibility&&s(n,{},e.length),t.append(e);const{flushInterval:i}=this._config;0===i?t.flush():i>0&&!this[r]&&(this[r]=setTimeout((()=>{t.flush(),this[r]=clearTimeout(this[r])}),i).unref())}getUncodedTraces(){return this._traceBuffer}exportUncodedTraces(){this.getUncodedTraces().forEach((e=>{this.export(e)})),this.resetUncodedTraces()}resetUncodedTraces(){this._traceBuffer=[]}},agentInfoExporter}function requireCiVisibilityExporter(){if(hasRequiredCiVisibilityExporter)return ciVisibilityExporter;hasRequiredCiVisibilityExporter=1;const e=require$$0$8.URL,{sendGitMetadata:t}=requireGit_metadata(),{getLibraryConfiguration:r}=requireGetLibraryConfiguration(),{getSkippableSuites:s}=requireGetSkippableSuites(),{getKnownTests:n}=requireGetKnownTests(),i=requireLog$2(),a=requireAgentInfoExporter();function o(e){return e?Object.keys(e).reduce(((t,r)=>{if(r.startsWith("test.configuration.")){const[,s]=r.split("test.configuration.");t[s]=e[r]}return t}),{}):{}}return ciVisibilityExporter=class extends a{constructor(e){super(e),this._timer=void 0,this._coverageTimer=void 0,this._coverageBuffer=[],this._canUseCiVisProtocol=!1;const t=setTimeout((()=>{this._resolveGit(new Error("Timeout while uploading git metadata"))}),6e4).unref(),r=setTimeout((()=>{this._resolveCanUseCiVisProtocol(!1)}),6e4).unref();this._gitUploadPromise=new Promise((e=>{this._resolveGit=r=>{clearTimeout(t),e(r)}})),this._canUseCiVisProtocolPromise=new Promise((e=>{this._resolveCanUseCiVisProtocol=t=>{clearTimeout(r),this._canUseCiVisProtocol=t,e(t)}})),process.once("beforeExit",(()=>{this._writer&&this._writer.flush(),this._coverageWriter&&this._coverageWriter.flush()}))}shouldRequestSkippableSuites(){return!!(this._config.isIntelligentTestRunnerEnabled&&this._canUseCiVisProtocol&&this._libraryConfig?.isSuitesSkippingEnabled)}shouldRequestKnownTests(){return!!(this._config.isEarlyFlakeDetectionEnabled&&this._canUseCiVisProtocol&&this._libraryConfig?.isEarlyFlakeDetectionEnabled)}shouldRequestLibraryConfiguration(){return this._config.isIntelligentTestRunnerEnabled}canReportSessionTraces(){return this._canUseCiVisProtocol}canReportCodeCoverage(){return this._canUseCiVisProtocol}getRequestConfiguration(e){return{url:this._getApiUrl(),env:this._config.env,service:this._config.service,isEvpProxy:!!this._isUsingEvpProxy,isGzipCompatible:this._isGzipCompatible,evpProxyPrefix:this.evpProxyPrefix,custom:o(this._config.tags),...e}}getSkippableSuites(e,t){if(!this.shouldRequestSkippableSuites())return t(null,[]);this._gitUploadPromise.then((r=>{if(r)return t(r,[]);s(this.getRequestConfiguration(e),t)}))}getKnownTests(e,t){if(!this.shouldRequestKnownTests())return t(null);n(this.getRequestConfiguration(e),t)}getLibraryConfiguration(e,t){const{repositoryUrl:s}=e;if(this.sendGitMetadata(s),!this.shouldRequestLibraryConfiguration())return t(null,{});this._canUseCiVisProtocolPromise.then((s=>{if(!s)return t(null,{});const n=this.getRequestConfiguration(e);r(n,((e,s)=>{this._libraryConfig=this.filterConfiguration(s),e?t(e,{}):s?.requireGit?this._gitUploadPromise.then((e=>{if(e)return t(e,{});r(n,((e,r)=>{this._libraryConfig=this.filterConfiguration(r),t(e,this._libraryConfig)}))})):t(null,this._libraryConfig)}))}))}filterConfiguration(e){if(!e)return{};const{isCodeCoverageEnabled:t,isSuitesSkippingEnabled:r,isItrEnabled:s,requireGit:n,isEarlyFlakeDetectionEnabled:i,earlyFlakeDetectionNumRetries:a}=e;return{isCodeCoverageEnabled:t,isSuitesSkippingEnabled:r,isItrEnabled:s,requireGit:n,isEarlyFlakeDetectionEnabled:i&&this._config.isEarlyFlakeDetectionEnabled,earlyFlakeDetectionNumRetries:a}}sendGitMetadata(e){this._config.isGitUploadEnabled&&this._canUseCiVisProtocolPromise.then((r=>{r&&t(this._getApiUrl(),{isEvpProxy:!!this._isUsingEvpProxy,evpProxyPrefix:this.evpProxyPrefix},e,(e=>{e?i.error(`Error uploading git metadata: ${e.message}`):i.debug("Successfully uploaded git metadata"),this._resolveGit(e)}))}))}export(e){this._isInitialized?!this.canReportSessionTraces()&&function(e){return e.some((e=>"test_session_end"===e.type||"test_suite_end"===e.type||"test_module_end"===e.type))}(e)||this._export(e):this._traceBuffer.push(e)}exportCoverage(e){this._isInitialized?this.canReportCodeCoverage()&&this._export(e,this._coverageWriter,"_coverageTimer"):this._coverageBuffer.push(e)}flush(e=(()=>{})){if(!this._isInitialized)return e();this._writer.flush((()=>{this._coverageWriter?this._coverageWriter.flush(e):e()}))}exportUncodedCoverages(){this._coverageBuffer.forEach((e=>{this.exportCoverage(e)})),this._coverageBuffer=[]}_setUrl(t,r=t){try{t=new e(t),r=new e(r),this._url=t,this._coverageUrl=r,this._writer.setUrl(t),this._coverageWriter.setUrl(r)}catch(e){i.error(e)}}_getApiUrl(){return this._url}},ciVisibilityExporter}function requireAgentless(){if(hasRequiredAgentless)return agentless;hasRequiredAgentless=1;const e=require$$0$8.URL,t=requireWriter$2(),r=requireCoverageWriter(),s=requireCiVisibilityExporter(),n=requireLog$2();return agentless=class extends s{constructor(s){super(s);const{tags:n,site:i,url:a}=s;this._isInitialized=!0,this._resolveCanUseCiVisProtocol(!0),this._url=a||new e(`https://citestcycle-intake.${i}`),this._writer=new t({url:this._url,tags:n}),this._coverageUrl=a||new e(`https://citestcov-intake.${i}`),this._coverageWriter=new r({url:this._coverageUrl}),this._apiUrl=a||new e(`https://api.${i}`),this._isGzipCompatible=!0}setUrl(t,r=t,s=t){this._setUrl(t,r);try{s=new e(s),this._apiUrl=s}catch(e){n.error(e)}}_getApiUrl(){return this._apiUrl}},agentless}function requireAgentProxy(){if(hasRequiredAgentProxy)return agentProxy;hasRequiredAgentProxy=1;const e=requireWriter$3(),t=requireWriter$2(),r=requireCoverageWriter(),s=requireCiVisibilityExporter(),n="/evp_proxy/v",i=/\/evp_proxy\/v(\d+)\/?/;return agentProxy=class extends s{constructor(s){super(s);const{tags:a,prioritySampler:o,lookup:c,protocolVersion:u,headers:l}=s;this.getAgentInfo(((s,p)=>{this._isInitialized=!0;const d=function(e,t){return e?0:t.endpoints.reduce(((e,t)=>{if(t.includes(n)){const r=Number(t.replace(i,"$1"));return isNaN(r)?e:r>e?r:e}return e}),0)}(s,p),h=d>=2,f=d>=4,g=`${n}${d}`;h?(this._isUsingEvpProxy=!0,this.evpProxyPrefix=g,this._writer=new t({url:this._url,tags:a,evpProxyPrefix:g}),this._coverageWriter=new r({url:this._url,evpProxyPrefix:g})):(this._writer=new e({url:this._url,prioritySampler:o,lookup:c,protocolVersion:u,headers:l}),this._coverageBuffer=[]),this._resolveCanUseCiVisProtocol(h),this.exportUncodedTraces(),this.exportUncodedCoverages(),this._isGzipCompatible=f}))}setUrl(e,t){this._setUrl(e,t)}},agentProxy}function requireJsonEncoder(){if(hasRequiredJsonEncoder)return jsonEncoder;hasRequiredJsonEncoder=1;return jsonEncoder={JSONEncoder:class{constructor(){this.payloads=[]}encode(e){this.payloads.push(e)}count(){return this.payloads.length}reset(){this.payloads=[]}makePayload(){const e=JSON.stringify(this.payloads);return this.reset(),e}}}}function requireWriter$1(){if(hasRequiredWriter$1)return writer$1;hasRequiredWriter$1=1;const{JSONEncoder:e}=requireJsonEncoder();return writer$1=class{constructor(t){this._encoder=new e,this._interprocessCode=t}flush(){if(this._encoder.count()>0){const e=this._encoder.makePayload();this._sendPayload(e)}}append(e){this._encoder.encode(e)}_sendPayload(e){process.send&&process.send([this._interprocessCode,e])}}}function requireJestWorker(){if(hasRequiredJestWorker)return jestWorker;hasRequiredJestWorker=1;const e=requireWriter$1(),{JEST_WORKER_COVERAGE_PAYLOAD_CODE:t,JEST_WORKER_TRACE_PAYLOAD_CODE:r}=requireTest();return jestWorker=class{constructor(){this._writer=new e(r),this._coverageWriter=new e(t)}export(e){this._writer.append(e)}exportCoverage(e){this._coverageWriter.append(e)}flush(){this._writer.flush(),this._coverageWriter.flush()}}}function requireExporter(){if(hasRequiredExporter)return exporter;hasRequiredExporter=1;const e=requireExporters(),t=require$$0$6,r=requireConstants$2();return exporter=s=>{const n=void 0!==process.env.AWS_LAMBDA_FUNCTION_NAME,i=n&&t.existsSync(r.DATADOG_LAMBDA_EXTENSION_PATH);switch(s){case e.LOG:return requireLog();case e.AGENT:return requireAgent$1();case e.DATADOG:return requireAgentless();case e.AGENT_PROXY:return requireAgentProxy();case e.JEST_WORKER:return requireJestWorker();default:return n&&!i?requireLog():requireAgent$1()}},exporter}function requireTracer$1(){if(hasRequiredTracer$1)return tracer$2;hasRequiredTracer$1=1;const e=require$$0$a,t=requireSpan$1(),r=requireSpan_processor(),s=requirePriority_sampler(),n=requireText_map(),i=requireHttp$1(),a=requireBinary(),o=requireLog$1(),c=requireFormats(),u=requireLog$2(),l=requireRuntime_metrics(),p=requireExporter(),d=requireSpan_context$2(),h="child_of",f="follows_from";return tracer$2=class{constructor(t){const u=p(t.experimental.exporter);this._config=t,this._service=t.service,this._version=t.version,this._env=t.env,this._logInjection=t.logInjection,this._debug=t.debug,this._prioritySampler=new s(t.env,t.sampler),this._exporter=new u(t,this._prioritySampler),this._processor=new r(this._exporter,this._prioritySampler,t),this._url=this._exporter._url,this._enableGetRumData=t.experimental.enableGetRumData,this._traceId128BitGenerationEnabled=t.traceId128BitGenerationEnabled,this._propagators={[c.TEXT_MAP]:new n(t),[c.HTTP_HEADERS]:new i(t),[c.BINARY]:new a(t),[c.LOG]:new o(t)},t.reportHostname&&(this._hostname=e.hostname())}startSpan(e,r={}){const s=r.childOf?function(e){e instanceof t&&(e=e.context());e instanceof d||(e=null);return e}(r.childOf):function(e=[]){let t=null;for(let r=0;r<e.length;r++){const s=e[r],n=s.type();if(n===h){t=s.referencedContext();break}n===f&&(t||(t=s.referencedContext()))}return t}(r.references),n={"service.name":this._service},i=new t(this,this._processor,this._prioritySampler,{operationName:r.operationName||e,parent:s,tags:n,startTime:r.startTime,hostname:this._hostname,traceId128BitGenerationEnabled:this._traceId128BitGenerationEnabled,integrationName:r.integrationName,links:r.links},this._debug);return i.addTags(this._config.tags),i.addTags(r.tags),i}inject(e,r,s){e instanceof t&&(e=e.context());try{this._prioritySampler.sample(e),this._propagators[r].inject(e,s)}catch(e){u.error(e),l.increment("datadog.tracer.node.inject.errors",!0)}}extract(e,t){try{return this._propagators[e].extract(t)}catch(e){return u.error(e),l.increment("datadog.tracer.node.extract.errors",!0),null}}},tracer$2}function requireScope(){if(hasRequiredScope)return scope;hasRequiredScope=1;const{storage:e}=requireDatadogCore(),t=new WeakMap;return scope=class{active(){const t=e.getStore();return t&&t.span||null}activate(t,r){if("function"!=typeof r)return r;const s=e.getStore(),n=t?t._store:s;e.enterWith({...n,span:t});try{return r()}catch(e){throw t&&"function"==typeof t.setTag&&t.setTag("error",e),e}finally{e.enterWith(s)}}bind(e,r){if("function"!=typeof e)return e;const s=this,n=this._spanOrActive(r),i=function(){return s.activate(n,(()=>e.apply(this,arguments)))};return t.set(i,e),i}_spanOrActive(e){return void 0!==e?e:this.active()}_isPromise(e){return e&&"function"==typeof e.then}},scope}var int64Buffer={},hasRequiredInt64Buffer,encoding,hasRequiredEncoding,lruCache$1,hasRequiredLruCache$1,pathway,hasRequiredPathway;function requireInt64Buffer(){return hasRequiredInt64Buffer||(hasRequiredInt64Buffer=1,function(e){!function(e){var t,r="undefined",s=r!==typeof Buffer&&Buffer,n=r!==typeof Uint8Array&&Uint8Array,i=r!==typeof ArrayBuffer&&ArrayBuffer,a=[0,0,0,0,0,0,0,0],o=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},c=4294967296;function u(o,u,v){var S=u?0:4,q=u?4:0,E=u?0:3,R=u?1:2,T=u?2:1,A=u?3:0,w=u?m:b,x=u?_:y,I=$.prototype,C="is"+o,O="_"+C;return I.buffer=void 0,I.offset=0,I[O]=!0,I.toNumber=k,I.toString=function(e){var t=this.buffer,r=this.offset,s=N(t,r+S),n=N(t,r+q),i="",a=!v&&2147483648&s;a&&(s=~s,n=c-n);e=e||10;for(;;){var o=s%e*c+n;if(s=Math.floor(s/e),n=Math.floor(o/e),i=(o%e).toString(e)+i,!s&&!n)break}a&&(i="-"+i);return i},I.toJSON=k,I.toArray=l,s&&(I.toBuffer=p),n&&(I.toArrayBuffer=d),$[C]=function(e){return!(!e||!e[O])},e[o]=$,$;function $(e,s,o,u){return this instanceof $?function(e,s,o,u,l){n&&i&&(s instanceof i&&(s=new n(s)),u instanceof i&&(u=new n(u)));if(!(s||o||u||t))return void(e.buffer=g(a,0));if(!h(s,o)){l=o,u=s,o=0,s=new(t||Array)(8)}if(e.buffer=s,e.offset=o|=0,r===typeof u)return;"string"==typeof u?function(e,t,r,s){var n=0,i=r.length,a=0,o=0;"-"===r[0]&&n++;var u=n;for(;n<i;){var l=parseInt(r[n++],s);if(!(l>=0))break;o=o*s+l,a=a*s+Math.floor(o/c),o%=c}u&&(a=~a,o?o=c-o:a++);P(e,t+S,a),P(e,t+q,o)}(s,o,u,l||10):h(u,l)?f(s,o,u,l):"number"==typeof l?(P(s,o+S,u),P(s,o+q,l)):u>0?w(s,o,u):u<0?x(s,o,u):f(s,o,a,0)}(this,e,s,o,u):new $(e,s,o,u)}function k(){var e=this.buffer,t=this.offset,r=N(e,t+S),s=N(e,t+q);return v||(r|=0),r?r*c+s:s}function P(e,t,r){e[t+A]=255&r,r>>=8,e[t+T]=255&r,r>>=8,e[t+R]=255&r,r>>=8,e[t+E]=255&r}function N(e,t){return 16777216*e[t+E]+(e[t+R]<<16)+(e[t+T]<<8)+e[t+A]}}function l(e){var r=this.buffer,s=this.offset;return t=null,!1!==e&&0===s&&8===r.length&&o(r)?r:g(r,s)}function p(e){var r=this.buffer,n=this.offset;if(t=s,!1!==e&&0===n&&8===r.length&&Buffer.isBuffer(r))return r;var i=new s(8);return f(i,0,r,n),i}function d(e){var r=this.buffer,s=this.offset,a=r.buffer;if(t=n,!1!==e&&0===s&&a instanceof i&&8===a.byteLength)return a;var o=new n(8);return f(o,0,r,s),o.buffer}function h(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function f(e,t,r,s){t|=0,s|=0;for(var n=0;n<8;n++)e[t++]=255&r[s++]}function g(e,t){return Array.prototype.slice.call(e,t,t+8)}function m(e,t,r){for(var s=t+8;s>t;)e[--s]=255&r,r/=256}function _(e,t,r){var s=t+8;for(r++;s>t;)e[--s]=255&-r^255,r/=256}function b(e,t,r){for(var s=t+8;t<s;)e[t++]=255&r,r/=256}function y(e,t,r){var s=t+8;for(r++;t<s;)e[t++]=255&-r^255,r/=256}u("Uint64BE",!0,!0),u("Int64BE",!0,!1),u("Uint64LE",!1,!0),u("Int64LE",!1,!1)}("string"!=typeof e.nodeName?e:commonjsGlobal||{})}(int64Buffer)),int64Buffer}function requireEncoding(){if(hasRequiredEncoding)return encoding;hasRequiredEncoding=1;const e=9;return encoding={encodeVarint:function(t){const r=t>=0?0:1,s=2*Math.abs(t);if(s>Number.MAX_SAFE_INTEGER)return;return function(t,r){const s=new Uint8Array(e);let n=0;for(;(0!==r||t<0||t>128)&&n<e-1;)s[n]=127&t|128,t>>>=7,t|=(127&r)<<25,r>>>=7,n++;return s[n]=127&t,s.slice(0,n+1)}(4294967295&s|r,Math.floor(s/4294967296))},decodeVarint:function(t){const[r,s,n]=function(t){let r=0,s=0,n=0;for(let i=0;;i++){if(t.length<=i)return[void 0,void 0,t.slice(t.length)];const a=t[i];if(a<128||i===e-1)return n<32&&(r|=a<<n),n>0&&(s|=n-32>0?a<<n-32:a>>32-n),[r,s,t=t.slice(i+1)];n<32&&(r|=(127&a)<<n),n>0&&(s|=n-32>0?(127&a)<<n-32:(127&a)>>32-n),n+=7}}(t);if(void 0===r||void 0===s)return[void 0,n];const i=(r>>>1)+2147483648*s;return[!(1&r)?i:-i,n]}}}function requireLruCache$1(){if(hasRequiredLruCache$1)return lruCache$1;hasRequiredLruCache$1=1;const e="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,t="function"==typeof AbortController?AbortController:class{constructor(){this.signal=new n}abort(e=new Error("This operation was aborted")){this.signal.reason=this.signal.reason||e,this.signal.aborted=!0,this.signal.dispatchEvent({type:"abort",target:this.signal})}},r="function"==typeof AbortSignal,s="function"==typeof t.AbortSignal,n=r?AbortSignal:s?t.AbortController:class{constructor(){this.reason=void 0,this.aborted=!1,this._listeners=[]}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,this.onabort(e),this._listeners.forEach((t=>t(e)),this))}onabort(){}addEventListener(e,t){"abort"===e&&this._listeners.push(t)}removeEventListener(e,t){"abort"===e&&(this._listeners=this._listeners.filter((e=>e!==t)))}},i=new Set,a=(e,t)=>{const r=`LRU_CACHE_OPTION_${e}`;u(r)&&l(r,`${e} option`,`options.${t}`,g)},o=(e,t)=>{const r=`LRU_CACHE_METHOD_${e}`;if(u(r)){const{prototype:s}=g,{get:n}=Object.getOwnPropertyDescriptor(s,e);l(r,`${e} method`,`cache.${t}()`,n)}},c=(...e)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...e):console.error(...e)},u=e=>!i.has(e),l=(e,t,r,s)=>{i.add(e);c(`The ${t} is deprecated. Please use ${r} instead.`,"DeprecationWarning",e,s)},p=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),d=e=>p(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?h:null:null;class h extends Array{constructor(e){super(e),this.fill(0)}}class f{constructor(e){if(0===e)return[];const t=d(e);this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class g{constructor(e={}){const{max:t=0,ttl:r,ttlResolution:s=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:l,allowStale:h,dispose:m,disposeAfter:_,noDisposeOnSet:b,noUpdateTTL:y,maxSize:v=0,maxEntrySize:S=0,sizeCalculation:q,fetchMethod:E,fetchContext:R,noDeleteOnFetchRejection:T,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:x,ignoreFetchAbort:I}=e,{length:C,maxAge:O,stale:$}=e instanceof g?{}:e;if(0!==t&&!p(t))throw new TypeError("max option must be a nonnegative integer");const k=t?d(t):Array;if(!k)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=v,this.maxEntrySize=S||this.maxSize,this.sizeCalculation=q||C,this.sizeCalculation){if(!this.maxSize&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=E||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=R,!this.fetchMethod&&void 0!==R)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new k(t),this.prev=new k(t),this.head=0,this.tail=0,this.free=new f(t),this.initialFill=1,this.size=0,"function"==typeof m&&(this.dispose=m),"function"==typeof _?(this.disposeAfter=_,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!b,this.noUpdateTTL=!!y,this.noDeleteOnFetchRejection=!!T,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!x,this.ignoreFetchAbort=!!I,0!==this.maxEntrySize){if(0!==this.maxSize&&!p(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");if(!p(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!h||!!$,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!l,this.ttlResolution=p(s)||0===s?s:1,this.ttlAutopurge=!!n,this.ttl=r||O||0,this.ttl){if(!p(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(u(e)){i.add(e);c("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,g)}}$&&a("stale","allowStale"),O&&a("maxAge","ttl"),C&&a("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new h(this.max),this.starts=new h(this.max),this.setItemTTL=(t,r,s=e.now())=>{if(this.starts[t]=0!==r?s:0,this.ttls[t]=r,0!==r&&this.ttlAutopurge){const e=setTimeout((()=>{this.isStale(t)&&this.delete(this.keyList[t])}),r+1);e.unref&&e.unref()}},this.updateItemAge=t=>{this.starts[t]=0!==this.ttls[t]?e.now():0},this.statusTTL=(e,s)=>{e&&(e.ttl=this.ttls[s],e.start=this.starts[s],e.now=t||r(),e.remainingTTL=e.now+e.ttl-e.start)};let t=0;const r=()=>{const r=e.now();if(this.ttlResolution>0){t=r;const e=setTimeout((()=>t=0),this.ttlResolution);e.unref&&e.unref()}return r};this.getRemainingTTL=e=>{const s=this.keyMap.get(e);return void 0===s?0:0===this.ttls[s]||0===this.starts[s]?1/0:this.starts[s]+this.ttls[s]-(t||r())},this.isStale=e=>0!==this.ttls[e]&&0!==this.starts[e]&&(t||r())-this.starts[e]>this.ttls[e]}updateItemAge(e){}statusTTL(e,t){}setItemTTL(e,t,r){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new h(this.max),this.removeItemSize=e=>{this.calculatedSize-=this.sizes[e],this.sizes[e]=0},this.requireSize=(e,t,r,s)=>{if(this.isBackgroundFetch(t))return 0;if(!p(r)){if(!s)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof s)throw new TypeError("sizeCalculation must be a function");if(r=s(t,e),!p(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.addItemSize=(e,t,r)=>{if(this.sizes[e]=t,this.maxSize){const t=this.maxSize-this.sizes[e];for(;this.calculatedSize>t;)this.evict(!0)}this.calculatedSize+=this.sizes[e],r&&(r.entrySize=t,r.totalCalculatedSize=this.calculatedSize)}}removeItemSize(e){}addItemSize(e,t){}requireSize(e,t,r,s){if(r||s)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return void 0!==e&&this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())void 0===this.valList[e]||void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield[this.keyList[e],this.valList[e]])}*rentries(){for(const e of this.rindexes())void 0===this.valList[e]||void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield[this.keyList[e],this.valList[e]])}*keys(){for(const e of this.indexes())void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.keyList[e])}*rkeys(){for(const e of this.rindexes())void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.keyList[e])}*values(){for(const e of this.indexes())void 0===this.valList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.valList[e])}*rvalues(){for(const e of this.rindexes())void 0===this.valList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.valList[e])}[Symbol.iterator](){return this.entries()}find(e,t){for(const r of this.indexes()){const s=this.valList[r],n=this.isBackgroundFetch(s)?s.__staleWhileFetching:s;if(void 0!==n&&e(n,this.keyList[r],this))return this.get(this.keyList[r],t)}}forEach(e,t=this){for(const r of this.indexes()){const s=this.valList[r],n=this.isBackgroundFetch(s)?s.__staleWhileFetching:s;void 0!==n&&e.call(t,n,this.keyList[r],this)}}rforEach(e,t=this){for(const r of this.rindexes()){const s=this.valList[r],n=this.isBackgroundFetch(s)?s.__staleWhileFetching:s;void 0!==n&&e.call(t,n,this.keyList[r],this)}}get prune(){return o("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const t=[];for(const r of this.indexes({allowStale:!0})){const s=this.keyList[r],n=this.valList[r],i=this.isBackgroundFetch(n)?n.__staleWhileFetching:n;if(void 0===i)continue;const a={value:i};if(this.ttls){a.ttl=this.ttls[r];const t=e.now()-this.starts[r];a.start=Math.floor(Date.now()-t)}this.sizes&&(a.size=this.sizes[r]),t.unshift([s,a])}return t}load(t){this.clear();for(const[r,s]of t){if(s.start){const t=Date.now()-s.start;s.start=e.now()-t}this.set(r,s.value,s)}}dispose(e,t,r){}set(e,t,{ttl:r=this.ttl,start:s,noDisposeOnSet:n=this.noDisposeOnSet,size:i=0,sizeCalculation:a=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL,status:c}={}){if(i=this.requireSize(e,t,i,a),this.maxEntrySize&&i>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(e),this;let u=0===this.size?void 0:this.keyMap.get(e);if(void 0===u)u=this.newIndex(),this.keyList[u]=e,this.valList[u]=t,this.keyMap.set(e,u),this.next[this.tail]=u,this.prev[u]=this.tail,this.tail=u,this.size++,this.addItemSize(u,i,c),c&&(c.set="add"),o=!1;else{this.moveToTail(u);const r=this.valList[u];if(t!==r){if(this.isBackgroundFetch(r)?r.__abortController.abort(new Error("replaced")):n||(this.dispose(r,e,"set"),this.disposeAfter&&this.disposed.push([r,e,"set"])),this.removeItemSize(u),this.valList[u]=t,this.addItemSize(u,i,c),c){c.set="replace";const e=r&&this.isBackgroundFetch(r)?r.__staleWhileFetching:r;void 0!==e&&(c.oldValue=e)}}else c&&(c.set="update")}if(0===r||0!==this.ttl||this.ttls||this.initializeTTLTracking(),o||this.setItemTTL(u,r,s),this.statusTTL(c,u),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max&&0!==this.max?this.evict(!1):0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(!0),e}}evict(e){const t=this.head,r=this.keyList[t],s=this.valList[t];return this.isBackgroundFetch(s)?s.__abortController.abort(new Error("evicted")):(this.dispose(s,r,"evict"),this.disposeAfter&&this.disposed.push([s,r,"evict"])),this.removeItemSize(t),e&&(this.keyList[t]=null,this.valList[t]=null,this.free.push(t)),this.head=this.next[t],this.keyMap.delete(r),this.size--,t}has(e,{updateAgeOnHas:t=this.updateAgeOnHas,status:r}={}){const s=this.keyMap.get(e);if(void 0!==s){if(!this.isStale(s))return t&&this.updateItemAge(s),r&&(r.has="hit"),this.statusTTL(r,s),!0;r&&(r.has="stale",this.statusTTL(r,s))}else r&&(r.has="miss");return!1}peek(e,{allowStale:t=this.allowStale}={}){const r=this.keyMap.get(e);if(void 0!==r&&(t||!this.isStale(r))){const e=this.valList[r];return this.isBackgroundFetch(e)?e.__staleWhileFetching:e}}backgroundFetch(e,r,s,n){const i=void 0===r?void 0:this.valList[r];if(this.isBackgroundFetch(i))return i;const a=new t;s.signal&&s.signal.addEventListener("abort",(()=>a.abort(s.signal.reason)));const o={signal:a.signal,options:s,context:n},c=(t,n=!1)=>{const{aborted:i}=a.signal,c=s.ignoreFetchAbort&&void 0!==t;return s.status&&(i&&!n?(s.status.fetchAborted=!0,s.status.fetchError=a.signal.reason,c&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),!i||c||n?(this.valList[r]===l&&(void 0===t?l.__staleWhileFetching?this.valList[r]=l.__staleWhileFetching:this.delete(e):(s.status&&(s.status.fetchUpdated=!0),this.set(e,t,o.options))),t):u(a.signal.reason)},u=t=>{const{aborted:n}=a.signal,i=n&&s.allowStaleOnFetchAbort,o=i||s.allowStaleOnFetchRejection,c=o||s.noDeleteOnFetchRejection;if(this.valList[r]===l){!c||void 0===l.__staleWhileFetching?this.delete(e):i||(this.valList[r]=l.__staleWhileFetching)}if(o)return s.status&&void 0!==l.__staleWhileFetching&&(s.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw t};s.status&&(s.status.fetchDispatched=!0);const l=new Promise(((t,r)=>{this.fetchMethod(e,i,o).then((e=>t(e)),r),a.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(t(),s.allowStaleOnFetchAbort&&(t=e=>c(e,!0)))}))})).then(c,(e=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=e),u(e))));return l.__abortController=a,l.__staleWhileFetching=i,l.__returned=null,void 0===r?(this.set(e,l,{...o.options,status:void 0}),r=this.keyMap.get(e)):this.valList[r]=l,l}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(e,"__returned")&&(e.__returned===e||null===e.__returned)}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:n=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:a=0,sizeCalculation:o=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:l=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:d=this.allowStaleOnFetchAbort,fetchContext:h=this.fetchContext,forceRefresh:f=!1,status:g,signal:m}={}){if(!this.fetchMethod)return g&&(g.fetch="get"),this.get(e,{allowStale:t,updateAgeOnGet:r,noDeleteOnStaleGet:s,status:g});const _={allowStale:t,updateAgeOnGet:r,noDeleteOnStaleGet:s,ttl:n,noDisposeOnSet:i,size:a,sizeCalculation:o,noUpdateTTL:c,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:l,allowStaleOnFetchAbort:d,ignoreFetchAbort:p,status:g,signal:m};let b=this.keyMap.get(e);if(void 0===b){g&&(g.fetch="miss");const t=this.backgroundFetch(e,b,_,h);return t.__returned=t}{const s=this.valList[b];if(this.isBackgroundFetch(s)){const e=t&&void 0!==s.__staleWhileFetching;return g&&(g.fetch="inflight",e&&(g.returnedStale=!0)),e?s.__staleWhileFetching:s.__returned=s}const n=this.isStale(b);if(!f&&!n)return g&&(g.fetch="hit"),this.moveToTail(b),r&&this.updateItemAge(b),this.statusTTL(g,b),s;const i=this.backgroundFetch(e,b,_,h),a=void 0!==i.__staleWhileFetching,o=a&&t;return g&&(g.fetch=a&&n?"stale":"refresh",o&&n&&(g.returnedStale=!0)),o?i.__staleWhileFetching:i.__returned=i}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:n}={}){const i=this.keyMap.get(e);if(void 0!==i){const a=this.valList[i],o=this.isBackgroundFetch(a);return this.statusTTL(n,i),this.isStale(i)?(n&&(n.get="stale"),o?(n&&(n.returnedStale=t&&void 0!==a.__staleWhileFetching),t?a.__staleWhileFetching:void 0):(s||this.delete(e),n&&(n.returnedStale=t),t?a:void 0)):(n&&(n.get="hit"),o?a.__staleWhileFetching:(this.moveToTail(i),r&&this.updateItemAge(i),a))}n&&(n.get="miss")}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return o("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const r=this.keyMap.get(e);if(void 0!==r)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(r);const t=this.valList[r];this.isBackgroundFetch(t)?t.__abortController.abort(new Error("deleted")):(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[r]=null,this.valList[r]=null,r===this.tail?this.tail=this.prev[r]:r===this.head?this.head=this.next[r]:(this.next[this.prev[r]]=this.next[r],this.prev[this.next[r]]=this.prev[r]),this.size--,this.free.push(r)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort(new Error("deleted"));else{const r=this.keyList[e];this.dispose(t,r,"delete"),this.disposeAfter&&this.disposed.push([t,r,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return o("reset","clear"),this.clear}get length(){return((e,t)=>{const r=`LRU_CACHE_PROPERTY_${e}`;if(u(r)){const{prototype:s}=g,{get:n}=Object.getOwnPropertyDescriptor(s,e);l(r,`${e} property`,`cache.${t}`,n)}})("length","size"),this.size}static get AbortController(){return t}static get AbortSignal(){return n}}return lruCache$1=g}function requirePathway(){if(hasRequiredPathway)return pathway;hasRequiredPathway=1;const e=require$$0$2,{encodeVarint:t,decodeVarint:r}=requireEncoding(),s=new(requireLruCache$1())({max:500});function n(t){const r=e.createHash("md5").update(t).digest("hex").slice(0,16);return Buffer.from(r,"hex")}return pathway={computePathwayHash:function(e,t,r,i){const a=`${e}${t}`+r.join("")+i.toString();if(s.get(a))return s.get(a);const o=n(`${e}${t}`+r.join("")),c=n(Buffer.concat([o,i],16).toString());return s.set(a,c),c},encodePathwayContext:function(e){return Buffer.concat([e.hash,Buffer.from(t(Math.round(e.pathwayStartNs/1e6))),Buffer.from(t(Math.round(e.edgeStartNs/1e6)))],20)},decodePathwayContext:function(e){if(null==e||e.length<8)return null;const t=e.subarray(0,8),s=e.subarray(8),[n,i]=r(s);if(void 0===n)return null;const[a]=r(i);return void 0===a?null:{hash:t,pathwayStartNs:1e6*n,edgeStartNs:1e6*a}}},pathway}var msgpackLite={},encode={},encodeBuffer={},writeCore={},extBuffer={},bufferish={},bufferGlobal,hasRequiredBufferGlobal,isarray,hasRequiredIsarray;function requireBufferGlobal(){if(hasRequiredBufferGlobal)return bufferGlobal;function e(e){return e&&e.isBuffer&&e}return hasRequiredBufferGlobal=1,bufferGlobal=e("undefined"!=typeof Buffer&&Buffer)||e(commonjsGlobal.Buffer)||e("undefined"!=typeof window&&window.Buffer)||commonjsGlobal.Buffer}function requireIsarray(){if(hasRequiredIsarray)return isarray;hasRequiredIsarray=1;var e={}.toString;return isarray=Array.isArray||function(t){return"[object Array]"==e.call(t)}}var bufferishArray={exports:{}},hasRequiredBufferishArray;function requireBufferishArray(){if(hasRequiredBufferishArray)return bufferishArray.exports;hasRequiredBufferishArray=1;var e=requireBufferish(),t=bufferishArray.exports=r(0);function r(e){return new Array(e)}return t.alloc=r,t.concat=e.concat,t.from=function(r){if(!e.isBuffer(r)&&e.isView(r))r=e.Uint8Array.from(r);else if(e.isArrayBuffer(r))r=new Uint8Array(r);else{if("string"==typeof r)return e.from.call(t,r);if("number"==typeof r)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(r)},bufferishArray.exports}var bufferishBuffer={exports:{}},hasRequiredBufferishBuffer;function requireBufferishBuffer(){if(hasRequiredBufferishBuffer)return bufferishBuffer.exports;hasRequiredBufferishBuffer=1;var e=requireBufferish(),t=e.global,r=bufferishBuffer.exports=e.hasBuffer?s(0):[];function s(e){return new t(e)}return r.alloc=e.hasBuffer&&t.alloc||s,r.concat=e.concat,r.from=function(s){if(!e.isBuffer(s)&&e.isView(s))s=e.Uint8Array.from(s);else if(e.isArrayBuffer(s))s=new Uint8Array(s);else{if("string"==typeof s)return e.from.call(r,s);if("number"==typeof s)throw new TypeError('"value" argument must not be a number')}return t.from&&1!==t.from.length?t.from(s):new t(s)},bufferishBuffer.exports}var bufferishUint8array={exports:{}},hasRequiredBufferishUint8array;function requireBufferishUint8array(){if(hasRequiredBufferishUint8array)return bufferishUint8array.exports;hasRequiredBufferishUint8array=1;var e=requireBufferish(),t=bufferishUint8array.exports=e.hasArrayBuffer?r(0):[];function r(e){return new Uint8Array(e)}return t.alloc=r,t.concat=e.concat,t.from=function(r){if(e.isView(r)){var s=r.byteOffset,n=r.byteLength;(r=r.buffer).byteLength!==n&&(r.slice?r=r.slice(s,s+n):(r=new Uint8Array(r)).byteLength!==n&&(r=Array.prototype.slice.call(r,s,s+n)))}else{if("string"==typeof r)return e.from.call(t,r);if("number"==typeof r)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(r)},bufferishUint8array.exports}var bufferishProto={},bufferLite={},hasRequiredBufferLite,hasRequiredBufferishProto,hasRequiredBufferish,hasRequiredExtBuffer;function requireBufferLite(){if(hasRequiredBufferLite)return bufferLite;return hasRequiredBufferLite=1,bufferLite.copy=function(e,t,r,s){var n;r||(r=0);s||0===s||(s=this.length);t||(t=0);var i=s-r;if(e===this&&r<t&&t<s)for(n=i-1;n>=0;n--)e[n+t]=this[n+r];else for(n=0;n<i;n++)e[n+t]=this[n+r];return i},bufferLite.toString=function(e,t,r){var s=this,n=0|t;r||(r=s.length);var i="",a=0;for(;n<r;)(a=s[n++])<128?i+=String.fromCharCode(a):(192==(224&a)?a=(31&a)<<6|63&s[n++]:224==(240&a)?a=(15&a)<<12|(63&s[n++])<<6|63&s[n++]:240==(248&a)&&(a=(7&a)<<18|(63&s[n++])<<12|(63&s[n++])<<6|63&s[n++]),a>=65536?(a-=65536,i+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):i+=String.fromCharCode(a));return i},bufferLite.write=function(e,t){var r=this,s=t||(t|=0),n=e.length,i=0,a=0;for(;a<n;)(i=e.charCodeAt(a++))<128?r[s++]=i:i<2048?(r[s++]=192|i>>>6,r[s++]=128|63&i):i<55296||i>57343?(r[s++]=224|i>>>12,r[s++]=128|i>>>6&63,r[s++]=128|63&i):(i=65536+(i-55296<<10|e.charCodeAt(a++)-56320),r[s++]=240|i>>>18,r[s++]=128|i>>>12&63,r[s++]=128|i>>>6&63,r[s++]=128|63&i);return s-t},bufferLite}function requireBufferishProto(){if(hasRequiredBufferishProto)return bufferishProto;hasRequiredBufferishProto=1;var e,t=requireBufferLite();bufferishProto.copy=a,bufferishProto.slice=o,bufferishProto.toString=function(e,s,i){return(!n&&r.isBuffer(this)?this.toString:t.toString).apply(this,arguments)},bufferishProto.write=(e="write",function(){return(this[e]||t[e]).apply(this,arguments)});var r=requireBufferish(),s=r.global,n=r.hasBuffer&&"TYPED_ARRAY_SUPPORT"in s,i=n&&!s.TYPED_ARRAY_SUPPORT;function a(e,s,n,a){var c=r.isBuffer(this),u=r.isBuffer(e);if(c&&u)return this.copy(e,s,n,a);if(i||c||u||!r.isView(this)||!r.isView(e))return t.copy.call(this,e,s,n,a);var l=n||null!=a?o.call(this,n,a):this;return e.set(l,s),l.length}function o(e,t){var s=this.slice||!i&&this.subarray;if(s)return s.call(this,e,t);var n=r.alloc.call(this,t-e);return a.call(this,n,0,e,t),n}return bufferishProto}function requireBufferish(){return hasRequiredBufferish||(hasRequiredBufferish=1,function(e){var t=e.global=requireBufferGlobal(),r=e.hasBuffer=t&&!!t.isBuffer,s=e.hasArrayBuffer="undefined"!=typeof ArrayBuffer,n=e.isArray=requireIsarray();e.isArrayBuffer=s?function(e){return e instanceof ArrayBuffer||d(e)}:g;var i=e.isBuffer=r?t.isBuffer:g,a=e.isView=s?ArrayBuffer.isView||m("ArrayBuffer","buffer"):g;e.alloc=p,e.concat=function(t,r){r||(r=0,Array.prototype.forEach.call(t,(function(e){r+=e.length})));var s=this!==e&&this||t[0],n=p.call(s,r),i=0;return Array.prototype.forEach.call(t,(function(e){i+=l.copy.call(e,n,i)})),n},e.from=function(e){return"string"==typeof e?h.call(this,e):f(this).from(e)};var o=e.Array=requireBufferishArray(),c=e.Buffer=requireBufferishBuffer(),u=e.Uint8Array=requireBufferishUint8array(),l=e.prototype=requireBufferishProto();function p(e){return f(this).alloc(e)}var d=m("ArrayBuffer");function h(e){var t=3*e.length,r=p.call(this,t),s=l.write.call(r,e);return t!==s&&(r=l.slice.call(r,0,s)),r}function f(e){return i(e)?c:a(e)?u:n(e)?o:r?c:s?u:o}function g(){return!1}function m(e,t){return e="[object "+e+"]",function(r){return null!=r&&{}.toString.call(t?r[t]:r)===e}}}(bufferish)),bufferish}function requireExtBuffer(){if(hasRequiredExtBuffer)return extBuffer;hasRequiredExtBuffer=1,extBuffer.ExtBuffer=function t(r,s){if(!(this instanceof t))return new t(r,s);this.buffer=e.from(r),this.type=s};var e=requireBufferish();return extBuffer}var extPacker={},hasRequiredExtPacker;function requireExtPacker(){if(hasRequiredExtPacker)return extPacker;hasRequiredExtPacker=1,extPacker.setExtPackers=function(e){e.addExtPacker(14,Error,[c,i]),e.addExtPacker(1,EvalError,[c,i]),e.addExtPacker(2,RangeError,[c,i]),e.addExtPacker(3,ReferenceError,[c,i]),e.addExtPacker(4,SyntaxError,[c,i]),e.addExtPacker(5,TypeError,[c,i]),e.addExtPacker(6,URIError,[c,i]),e.addExtPacker(10,RegExp,[o,i]),e.addExtPacker(11,Boolean,[a,i]),e.addExtPacker(12,String,[a,i]),e.addExtPacker(13,Date,[Number,i]),e.addExtPacker(15,Number,[a,i]),"undefined"!=typeof Uint8Array&&(e.addExtPacker(17,Int8Array,s),e.addExtPacker(18,Uint8Array,s),e.addExtPacker(19,Int16Array,s),e.addExtPacker(20,Uint16Array,s),e.addExtPacker(21,Int32Array,s),e.addExtPacker(22,Uint32Array,s),e.addExtPacker(23,Float32Array,s),"undefined"!=typeof Float64Array&&e.addExtPacker(24,Float64Array,s),"undefined"!=typeof Uint8ClampedArray&&e.addExtPacker(25,Uint8ClampedArray,s),e.addExtPacker(26,ArrayBuffer,s),e.addExtPacker(29,DataView,s));t.hasBuffer&&e.addExtPacker(27,r,t.from)};var e,t=requireBufferish(),r=t.global,s=t.Uint8Array.from,n={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function i(t){return e||(e=requireEncode().encode),e(t)}function a(e){return e.valueOf()}function o(e){(e=RegExp.prototype.toString.call(e).split("/")).shift();var t=[e.pop()];return t.unshift(e.join("/")),t}function c(e){var t={};for(var r in n)t[r]=e[r];return t}return extPacker}var writeType={},writeToken={},ieee754={},hasRequiredIeee754;function requireIeee754(){return hasRequiredIeee754||(hasRequiredIeee754=1,ieee754.read=function(e,t,r,s,n){var i,a,o=8*n-s-1,c=(1<<o)-1,u=c>>1,l=-7,p=r?n-1:0,d=r?-1:1,h=e[t+p];for(p+=d,i=h&(1<<-l)-1,h>>=-l,l+=o;l>0;i=256*i+e[t+p],p+=d,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=s;l>0;a=256*a+e[t+p],p+=d,l-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,s),i-=u}return(h?-1:1)*a*Math.pow(2,i-s)},ieee754.write=function(e,t,r,s,n,i){var a,o,c,u=8*i-n-1,l=(1<<u)-1,p=l>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,h=s?0:i-1,f=s?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+p>=1?d/c:d*Math.pow(2,1-p))*c>=2&&(a++,c/=2),a+p>=l?(o=0,a=l):a+p>=1?(o=(t*c-1)*Math.pow(2,n),a+=p):(o=t*Math.pow(2,p-1)*Math.pow(2,n),a=0));n>=8;e[r+h]=255&o,h+=f,o/=256,n-=8);for(a=a<<n|o,u+=n;u>0;e[r+h]=255&a,h+=f,a/=256,u-=8);e[r+h-f]|=128*g}),ieee754}var writeUint8={},hasRequiredWriteUint8,hasRequiredWriteToken,hasRequiredWriteType;function requireWriteUint8(){if(hasRequiredWriteUint8)return writeUint8;hasRequiredWriteUint8=1;for(var e=writeUint8.uint8=new Array(256),t=0;t<=255;t++)e[t]=r(t);function r(e){return function(t){var r=t.reserve(1);t.buffer[r]=e}}return writeUint8}function requireWriteToken(){if(hasRequiredWriteToken)return writeToken;hasRequiredWriteToken=1;var e=requireIeee754(),t=requireInt64Buffer(),r=t.Uint64BE,s=t.Int64BE,n=requireWriteUint8().uint8,i=requireBufferish(),a=i.global,o=i.hasBuffer&&"TYPED_ARRAY_SUPPORT"in a&&!a.TYPED_ARRAY_SUPPORT,c=i.hasBuffer&&a.prototype||{};function u(){var e=n.slice();return e[196]=l(196),e[197]=p(197),e[198]=d(198),e[199]=l(199),e[200]=p(200),e[201]=d(201),e[202]=h(202,4,c.writeFloatBE||m,!0),e[203]=h(203,8,c.writeDoubleBE||_,!0),e[204]=l(204),e[205]=p(205),e[206]=d(206),e[207]=h(207,8,f),e[208]=l(208),e[209]=p(209),e[210]=d(210),e[211]=h(211,8,g),e[217]=l(217),e[218]=p(218),e[219]=d(219),e[220]=p(220),e[221]=d(221),e[222]=p(222),e[223]=d(223),e}function l(e){return function(t,r){var s=t.reserve(2),n=t.buffer;n[s++]=e,n[s]=r}}function p(e){return function(t,r){var s=t.reserve(3),n=t.buffer;n[s++]=e,n[s++]=r>>>8,n[s]=r}}function d(e){return function(t,r){var s=t.reserve(5),n=t.buffer;n[s++]=e,n[s++]=r>>>24,n[s++]=r>>>16,n[s++]=r>>>8,n[s]=r}}function h(e,t,r,s){return function(n,i){var a=n.reserve(t+1);n.buffer[a++]=e,r.call(n.buffer,i,a,s)}}function f(e,t){new r(this,t,e)}function g(e,t){new s(this,t,e)}function m(t,r){e.write(this,t,r,!1,23,4)}function _(t,r){e.write(this,t,r,!1,52,8)}return writeToken.getWriteToken=function(e){return e&&e.uint8array?((t=u())[202]=h(202,4,m),t[203]=h(203,8,_),t):o||i.hasBuffer&&e&&e.safe?function(){var e=n.slice();return e[196]=h(196,1,a.prototype.writeUInt8),e[197]=h(197,2,a.prototype.writeUInt16BE),e[198]=h(198,4,a.prototype.writeUInt32BE),e[199]=h(199,1,a.prototype.writeUInt8),e[200]=h(200,2,a.prototype.writeUInt16BE),e[201]=h(201,4,a.prototype.writeUInt32BE),e[202]=h(202,4,a.prototype.writeFloatBE),e[203]=h(203,8,a.prototype.writeDoubleBE),e[204]=h(204,1,a.prototype.writeUInt8),e[205]=h(205,2,a.prototype.writeUInt16BE),e[206]=h(206,4,a.prototype.writeUInt32BE),e[207]=h(207,8,f),e[208]=h(208,1,a.prototype.writeInt8),e[209]=h(209,2,a.prototype.writeInt16BE),e[210]=h(210,4,a.prototype.writeInt32BE),e[211]=h(211,8,g),e[217]=h(217,1,a.prototype.writeUInt8),e[218]=h(218,2,a.prototype.writeUInt16BE),e[219]=h(219,4,a.prototype.writeUInt32BE),e[220]=h(220,2,a.prototype.writeUInt16BE),e[221]=h(221,4,a.prototype.writeUInt32BE),e[222]=h(222,2,a.prototype.writeUInt16BE),e[223]=h(223,4,a.prototype.writeUInt32BE),e}():u();var t},writeToken}function requireWriteType(){if(hasRequiredWriteType)return writeType;hasRequiredWriteType=1;var e=requireIsarray(),t=requireInt64Buffer(),r=t.Uint64BE,s=t.Int64BE,n=requireBufferish(),i=requireBufferishProto(),a=requireWriteToken(),o=requireWriteUint8().uint8,c=requireExtBuffer().ExtBuffer,u="undefined"!=typeof Uint8Array,l="undefined"!=typeof Map,p=[];return p[1]=212,p[2]=213,p[4]=214,p[8]=215,p[16]=216,writeType.getWriteType=function(t){var d=a.getWriteToken(t),h=t&&t.useraw,f=u&&t&&t.binarraybuffer,g=f?n.isArrayBuffer:n.isBuffer,m=f?function(e,t){S(e,new Uint8Array(t))}:S,_=l&&t&&t.usemap?function(e,t){if(!(t instanceof Map))return q(e,t);var r=t.size;d[r<16?128+r:r<=65535?222:223](e,r);var s=e.codec.encode;t.forEach((function(t,r,n){s(e,r),s(e,t)}))}:q,b={boolean:function(e,t){d[t?195:194](e,t)},function:v,number:function(e,t){var r,s=0|t;if(t!==s)return void d[r=203](e,t);r=-32<=s&&s<=127?255&s:0<=s?s<=255?204:s<=65535?205:206:-128<=s?208:-32768<=s?209:210;d[r](e,s)},object:h?function(e,t){if(g(t))return function(e,t){var r=t.length;d[r<32?160+r:r<=65535?218:219](e,r),e.send(t)}(e,t);y(e,t)}:y,string:function(e){return t;function t(t,r){var s=r.length,n=5+3*s;t.offset=t.reserve(n);var a=t.buffer,o=e(s),c=t.offset+o;s=i.write.call(a,r,c);var u=e(s);if(o!==u){var l=c+u-o,p=c+s;i.copy.call(a,a,l,c,p)}d[1===u?160+s:u<=3?215+u:219](t,s),t.offset+=s}}(h?function(e){return e<32?1:e<=65535?3:5}:function(e){return e<32?1:e<=255?2:e<=65535?3:5}),symbol:v,undefined:v};return b;function y(t,n){if(null===n)return v(t,n);if(g(n))return m(t,n);if(e(n))return function(e,t){var r=t.length;d[r<16?144+r:r<=65535?220:221](e,r);for(var s=e.codec.encode,n=0;n<r;n++)s(e,t[n])}(t,n);if(r.isUint64BE(n))return function(e,t){d[207](e,t.toArray())}(t,n);if(s.isInt64BE(n))return function(e,t){d[211](e,t.toArray())}(t,n);var i=t.codec.getExtPacker(n);if(i&&(n=i(n)),n instanceof c)return function(e,t){var r=t.buffer,s=r.length,n=p[s]||(s<255?199:s<=65535?200:201);d[n](e,s),o[t.type](e),e.send(r)}(t,n);_(t,n)}function v(e,t){d[192](e,t)}function S(e,t){var r=t.length;d[r<255?196:r<=65535?197:198](e,r),e.send(t)}function q(e,t){var r=Object.keys(t),s=r.length;d[s<16?128+s:s<=65535?222:223](e,s);var n=e.codec.encode;r.forEach((function(r){n(e,r),n(e,t[r])}))}},writeType}var codecBase={},hasRequiredCodecBase,hasRequiredWriteCore;function requireCodecBase(){if(hasRequiredCodecBase)return codecBase;hasRequiredCodecBase=1;var e=requireIsarray();codecBase.createCodec=n,codecBase.install=function(e){for(var t in e)r.prototype[t]=s(r.prototype[t],e[t])},codecBase.filter=function(t){return e(t)?function(e){return e=e.slice(),function(r){return e.reduce(t,r)};function t(e,t){return t(e)}}(t):t};var t=requireBufferish();function r(e){if(!(this instanceof r))return new r(e);this.options=e,this.init()}function s(e,t){return e&&t?function(){return e.apply(this,arguments),t.apply(this,arguments)}:e||t}function n(e){return new r(e)}return r.prototype.init=function(){var e=this.options;return e&&e.uint8array&&(this.bufferish=t.Uint8Array),this},codecBase.preset=n({preset:!0}),codecBase}function requireWriteCore(){if(hasRequiredWriteCore)return writeCore;hasRequiredWriteCore=1;var e=requireExtBuffer().ExtBuffer,t=requireExtPacker(),r=requireWriteType(),s=requireCodecBase();function n(){var e=this.options;return this.encode=function(e){var t=r.getWriteType(e);return function(e,r){var s=t[typeof r];if(!s)throw new Error('Unsupported type "'+typeof r+'": '+r);s(e,r)}}(e),e&&e.preset&&t.setExtPackers(this),this}return s.install({addExtPacker:function(t,r,n){n=s.filter(n);var i=r.name;if(i&&"Object"!==i){(this.extPackers||(this.extPackers={}))[i]=a}else{(this.extEncoderList||(this.extEncoderList=[])).unshift([r,a])}function a(r){return n&&(r=n(r)),new e(r,t)}},getExtPacker:function(e){var t=this.extPackers||(this.extPackers={}),r=e.constructor,s=r&&r.name&&t[r.name];if(s)return s;for(var n=this.extEncoderList||(this.extEncoderList=[]),i=n.length,a=0;a<i;a++){var o=n[a];if(r===o[0])return o[1]}},init:n}),writeCore.preset=n.call(s.preset),writeCore}var flexBuffer={},hasRequiredFlexBuffer,hasRequiredEncodeBuffer,hasRequiredEncode;function requireFlexBuffer(){if(hasRequiredFlexBuffer)return flexBuffer;hasRequiredFlexBuffer=1,flexBuffer.FlexDecoder=r,flexBuffer.FlexEncoder=s;var e=requireBufferish(),t="BUFFER_SHORTAGE";function r(){if(!(this instanceof r))return new r}function s(){if(!(this instanceof s))return new s}function n(){throw new Error("method not implemented: write()")}function i(){throw new Error("method not implemented: fetch()")}function a(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function o(e){(this.buffers||(this.buffers=[])).push(e)}function c(){return(this.buffers||(this.buffers=[])).shift()}function u(e){return function(t){for(var r in e)t[r]=e[r];return t}}return r.mixin=u({bufferish:e,write:function(t){var r=this.offset?e.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=r?t?this.bufferish.concat([r,t]):r:t,this.offset=0},fetch:i,flush:function(){for(;this.offset<this.buffer.length;){var e,r=this.offset;try{e=this.fetch()}catch(e){if(e&&e.message!=t)throw e;this.offset=r;break}this.push(e)}},push:o,pull:c,read:a,reserve:function(e){var r=this.offset,s=r+e;if(s>this.buffer.length)throw new Error(t);return this.offset=s,r},offset:0}),r.mixin(r.prototype),s.mixin=u({bufferish:e,write:n,fetch:function(){var t=this.start;if(t<this.offset){var r=this.start=this.offset;return e.prototype.slice.call(this.buffer,t,r)}},flush:function(){for(;this.start<this.offset;){var e=this.fetch();e&&this.push(e)}},push:o,pull:function(){var e=this.buffers||(this.buffers=[]),t=e.length>1?this.bufferish.concat(e):e[0];return e.length=0,t},read:a,reserve:function(e){var t=0|e;if(this.buffer){var r=this.buffer.length,s=0|this.offset,n=s+t;if(n<r)return this.offset=n,s;this.flush(),e=Math.max(e,Math.min(2*r,this.maxBufferSize))}return e=Math.max(e,this.minBufferSize),this.buffer=this.bufferish.alloc(e),this.start=0,this.offset=t,0},send:function(t){var r=t.length;if(r>this.minBufferSize)this.flush(),this.push(t);else{var s=this.reserve(r);e.prototype.copy.call(t,this.buffer,s)}},maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}),s.mixin(s.prototype),flexBuffer}function requireEncodeBuffer(){if(hasRequiredEncodeBuffer)return encodeBuffer;hasRequiredEncodeBuffer=1,encodeBuffer.EncodeBuffer=t;var e=requireWriteCore().preset;function t(e){if(!(this instanceof t))return new t(e);if(e&&(this.options=e,e.codec)){var r=this.codec=e.codec;r.bufferish&&(this.bufferish=r.bufferish)}}return requireFlexBuffer().FlexEncoder.mixin(t.prototype),t.prototype.codec=e,t.prototype.write=function(e){this.codec.encode(this,e)},encodeBuffer}function requireEncode(){if(hasRequiredEncode)return encode;hasRequiredEncode=1,encode.encode=function(t,r){var s=new e(r);return s.write(t),s.read()};var e=requireEncodeBuffer().EncodeBuffer;return encode}var decode={},decodeBuffer={},readCore={},extUnpacker={},hasRequiredExtUnpacker;function requireExtUnpacker(){if(hasRequiredExtUnpacker)return extUnpacker;hasRequiredExtUnpacker=1,extUnpacker.setExtUnpackers=function(e){e.addExtUnpacker(14,[n,a(Error)]),e.addExtUnpacker(1,[n,a(EvalError)]),e.addExtUnpacker(2,[n,a(RangeError)]),e.addExtUnpacker(3,[n,a(ReferenceError)]),e.addExtUnpacker(4,[n,a(SyntaxError)]),e.addExtUnpacker(5,[n,a(TypeError)]),e.addExtUnpacker(6,[n,a(URIError)]),e.addExtUnpacker(10,[n,i]),e.addExtUnpacker(11,[n,o(Boolean)]),e.addExtUnpacker(12,[n,o(String)]),e.addExtUnpacker(13,[n,o(Date)]),e.addExtUnpacker(15,[n,o(Number)]),"undefined"!=typeof Uint8Array&&(e.addExtUnpacker(17,o(Int8Array)),e.addExtUnpacker(18,o(Uint8Array)),e.addExtUnpacker(19,[c,o(Int16Array)]),e.addExtUnpacker(20,[c,o(Uint16Array)]),e.addExtUnpacker(21,[c,o(Int32Array)]),e.addExtUnpacker(22,[c,o(Uint32Array)]),e.addExtUnpacker(23,[c,o(Float32Array)]),"undefined"!=typeof Float64Array&&e.addExtUnpacker(24,[c,o(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&e.addExtUnpacker(25,o(Uint8ClampedArray)),e.addExtUnpacker(26,c),e.addExtUnpacker(29,[c,o(DataView)]));t.hasBuffer&&e.addExtUnpacker(27,o(r))};var e,t=requireBufferish(),r=t.global,s={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function n(t){return e||(e=requireDecode().decode),e(t)}function i(e){return RegExp.apply(null,e)}function a(e){return function(t){var r=new e;for(var n in s)r[n]=t[n];return r}}function o(e){return function(t){return new e(t)}}function c(e){return new Uint8Array(e).buffer}return extUnpacker}var readFormat={},hasRequiredReadFormat;function requireReadFormat(){if(hasRequiredReadFormat)return readFormat;hasRequiredReadFormat=1;var e=requireIeee754(),t=requireInt64Buffer(),r=t.Uint64BE,s=t.Int64BE;readFormat.getReadFormat=function(e){var t=n.hasArrayBuffer&&e&&e.binarraybuffer,r=e&&e.int64,s={map:a&&e&&e.usemap?u:c,array:l,str:p,bin:t?h:d,ext:f,uint8:g,uint16:_,uint32:y,uint64:S(8,r?R:q),int8:m,int16:b,int32:v,int64:S(8,r?T:E),float32:S(4,A),float64:S(8,w)};return s},readFormat.readUint8=g;var n=requireBufferish(),i=requireBufferishProto(),a="undefined"!=typeof Map,o=!0;function c(e,t){var r,s={},n=new Array(t),i=new Array(t),a=e.codec.decode;for(r=0;r<t;r++)n[r]=a(e),i[r]=a(e);for(r=0;r<t;r++)s[n[r]]=i[r];return s}function u(e,t){var r,s=new Map,n=new Array(t),i=new Array(t),a=e.codec.decode;for(r=0;r<t;r++)n[r]=a(e),i[r]=a(e);for(r=0;r<t;r++)s.set(n[r],i[r]);return s}function l(e,t){for(var r=new Array(t),s=e.codec.decode,n=0;n<t;n++)r[n]=s(e);return r}function p(e,t){var r=e.reserve(t),s=r+t;return i.toString.call(e.buffer,"utf-8",r,s)}function d(e,t){var r=e.reserve(t),s=r+t,a=i.slice.call(e.buffer,r,s);return n.from(a)}function h(e,t){var r=e.reserve(t),s=r+t,a=i.slice.call(e.buffer,r,s);return n.Uint8Array.from(a).buffer}function f(e,t){var r=e.reserve(t+1),s=e.buffer[r++],n=r+t,a=e.codec.getExtUnpacker(s);if(!a)throw new Error("Invalid ext type: "+(s?"0x"+s.toString(16):s));return a(i.slice.call(e.buffer,r,n))}function g(e){var t=e.reserve(1);return e.buffer[t]}function m(e){var t=e.reserve(1),r=e.buffer[t];return 128&r?r-256:r}function _(e){var t=e.reserve(2),r=e.buffer;return r[t++]<<8|r[t]}function b(e){var t=e.reserve(2),r=e.buffer,s=r[t++]<<8|r[t];return 32768&s?s-65536:s}function y(e){var t=e.reserve(4),r=e.buffer;return 16777216*r[t++]+(r[t++]<<16)+(r[t++]<<8)+r[t]}function v(e){var t=e.reserve(4),r=e.buffer;return r[t++]<<24|r[t++]<<16|r[t++]<<8|r[t]}function S(e,t){return function(r){var s=r.reserve(e);return t.call(r.buffer,s,o)}}function q(e){return new r(this,e).toNumber()}function E(e){return new s(this,e).toNumber()}function R(e){return new r(this,e)}function T(e){return new s(this,e)}function A(t){return e.read(this,t,!1,23,4)}function w(t){return e.read(this,t,!1,52,8)}return readFormat}var readToken={},hasRequiredReadToken,hasRequiredReadCore,hasRequiredDecodeBuffer,hasRequiredDecode;function requireReadToken(){if(hasRequiredReadToken)return readToken;hasRequiredReadToken=1;var e=requireReadFormat();function t(e){var t,i=new Array(256);for(t=0;t<=127;t++)i[t]=r(t);for(t=128;t<=143;t++)i[t]=n(t-128,e.map);for(t=144;t<=159;t++)i[t]=n(t-144,e.array);for(t=160;t<=191;t++)i[t]=n(t-160,e.str);for(i[192]=r(null),i[193]=null,i[194]=r(!1),i[195]=r(!0),i[196]=s(e.uint8,e.bin),i[197]=s(e.uint16,e.bin),i[198]=s(e.uint32,e.bin),i[199]=s(e.uint8,e.ext),i[200]=s(e.uint16,e.ext),i[201]=s(e.uint32,e.ext),i[202]=e.float32,i[203]=e.float64,i[204]=e.uint8,i[205]=e.uint16,i[206]=e.uint32,i[207]=e.uint64,i[208]=e.int8,i[209]=e.int16,i[210]=e.int32,i[211]=e.int64,i[212]=n(1,e.ext),i[213]=n(2,e.ext),i[214]=n(4,e.ext),i[215]=n(8,e.ext),i[216]=n(16,e.ext),i[217]=s(e.uint8,e.str),i[218]=s(e.uint16,e.str),i[219]=s(e.uint32,e.str),i[220]=s(e.uint16,e.array),i[221]=s(e.uint32,e.array),i[222]=s(e.uint16,e.map),i[223]=s(e.uint32,e.map),t=224;t<=255;t++)i[t]=r(t-256);return i}function r(e){return function(){return e}}function s(e,t){return function(r){var s=e(r);return t(r,s)}}function n(e,t){return function(r){return t(r,e)}}return readToken.getReadToken=function(r){var s=e.getReadFormat(r);return r&&r.useraw?function(e){var r,s=t(e).slice();for(s[217]=s[196],s[218]=s[197],s[219]=s[198],r=160;r<=191;r++)s[r]=n(r-160,e.bin);return s}(s):t(s)},readToken}function requireReadCore(){if(hasRequiredReadCore)return readCore;hasRequiredReadCore=1;var e=requireExtBuffer().ExtBuffer,t=requireExtUnpacker(),r=requireReadFormat().readUint8,s=requireReadToken(),n=requireCodecBase();function i(){var e=this.options;return this.decode=function(e){var t=s.getReadToken(e);return function(e){var s=r(e),n=t[s];if(!n)throw new Error("Invalid type: "+(s?"0x"+s.toString(16):s));return n(e)}}(e),e&&e.preset&&t.setExtUnpackers(this),this}return n.install({addExtUnpacker:function(e,t){(this.extUnpackers||(this.extUnpackers=[]))[e]=n.filter(t)},getExtUnpacker:function(t){return(this.extUnpackers||(this.extUnpackers=[]))[t]||function(r){return new e(r,t)}},init:i}),readCore.preset=i.call(n.preset),readCore}function requireDecodeBuffer(){if(hasRequiredDecodeBuffer)return decodeBuffer;hasRequiredDecodeBuffer=1,decodeBuffer.DecodeBuffer=t;var e=requireReadCore().preset;function t(e){if(!(this instanceof t))return new t(e);if(e&&(this.options=e,e.codec)){var r=this.codec=e.codec;r.bufferish&&(this.bufferish=r.bufferish)}}return requireFlexBuffer().FlexDecoder.mixin(t.prototype),t.prototype.codec=e,t.prototype.fetch=function(){return this.codec.decode(this)},decodeBuffer}function requireDecode(){if(hasRequiredDecode)return decode;hasRequiredDecode=1,decode.decode=function(t,r){var s=new e(r);return s.write(t),s.read()};var e=requireDecodeBuffer().DecodeBuffer;return decode}var encoder={},eventLite={exports:{}},hasRequiredEventLite,hasRequiredEncoder;function requireEventLite(){return hasRequiredEventLite||(hasRequiredEventLite=1,e=eventLite,function(t){e.exports=t;var r="listeners",s={on:function(e,t){return a(this,e).push(t),this},once:function(e,t){var r=this;return s.originalListener=t,a(r,e).push(s),r;function s(){i.call(r,e,s),t.apply(this,arguments)}},off:i,emit:function(e,t){var r=this,s=a(r,e,!0);if(!s)return!1;var n=arguments.length;if(1===n)s.forEach((function(e){e.call(r)}));else if(2===n)s.forEach((function(e){e.call(r,t)}));else{var i=Array.prototype.slice.call(arguments,1);s.forEach((function(e){e.apply(r,i)}))}return!!s.length}};function n(e){for(var t in s)e[t]=s[t];return e}function i(e,t){var s,n=this;if(arguments.length){if(t){if(s=a(n,e,!0)){if(s=s.filter((function(e){return e!==t&&e.originalListener!==t})),!s.length)return i.call(n,e);n[r][e]=s}}else if((s=n[r])&&(delete s[e],!Object.keys(s).length))return i.call(n)}else delete n[r];return n}function a(e,t,s){if(!s||e[r]){var n=e[r]||(e[r]={});return n[t]||(n[t]=[])}}n(t.prototype),t.mixin=n}((function e(){if(!(this instanceof e))return new e}))),eventLite.exports;var e}function requireEncoder(){if(hasRequiredEncoder)return encoder;hasRequiredEncoder=1,encoder.Encoder=r;var e=requireEventLite(),t=requireEncodeBuffer().EncodeBuffer;function r(e){if(!(this instanceof r))return new r(e);t.call(this,e)}return r.prototype=new t,e.mixin(r.prototype),r.prototype.encode=function(e){this.write(e),this.emit("data",this.read())},r.prototype.end=function(e){arguments.length&&this.encode(e),this.flush(),this.emit("end")},encoder}var decoder={},hasRequiredDecoder;function requireDecoder(){if(hasRequiredDecoder)return decoder;hasRequiredDecoder=1,decoder.Decoder=r;var e=requireEventLite(),t=requireDecodeBuffer().DecodeBuffer;function r(e){if(!(this instanceof r))return new r(e);t.call(this,e)}return r.prototype=new t,e.mixin(r.prototype),r.prototype.decode=function(e){arguments.length&&this.write(e),this.flush()},r.prototype.push=function(e){this.emit("data",e)},r.prototype.end=function(e){this.decode(e),this.emit("end")},decoder}var encodeStream={},hasRequiredEncodeStream;function requireEncodeStream(){if(hasRequiredEncodeStream)return encodeStream;hasRequiredEncodeStream=1,encodeStream.createEncodeStream=n;var e=require$$0$3,t=require$$0$7.Transform,r=requireEncodeBuffer().EncodeBuffer;e.inherits(n,t);var s={objectMode:!0};function n(e){if(!(this instanceof n))return new n(e);e?e.objectMode=!0:e=s,t.call(this,e);var i=this;(this.encoder=new r(e)).push=function(e){i.push(e)}}return n.prototype._transform=function(e,t,r){this.encoder.write(e),r&&r()},n.prototype._flush=function(e){this.encoder.flush(),e&&e()},encodeStream}var decodeStream={},hasRequiredDecodeStream;function requireDecodeStream(){if(hasRequiredDecodeStream)return decodeStream;hasRequiredDecodeStream=1,decodeStream.createDecodeStream=n;var e=require$$0$3,t=require$$0$7.Transform,r=requireDecodeBuffer().DecodeBuffer;e.inherits(n,t);var s={objectMode:!0};function n(e){if(!(this instanceof n))return new n(e);e?e.objectMode=!0:e=s,t.call(this,e);var i=this;(this.decoder=new r(e)).push=function(e){i.push(e)}}return n.prototype._transform=function(e,t,r){this.decoder.write(e),this.decoder.flush(),r&&r()},decodeStream}var ext={},hasRequiredExt;function requireExt(){return hasRequiredExt||(hasRequiredExt=1,requireReadCore(),requireWriteCore(),ext.createCodec=requireCodecBase().createCodec),ext}var codec={},hasRequiredCodec,hasRequiredMsgpackLite,writer,hasRequiredWriter,processor,hasRequiredProcessor,version$4,hasRequiredVersion,data_streams_context,hasRequiredData_streams_context,tracer$1,hasRequiredTracer,validators,hasRequiredValidators,polyfill,hasRequiredPolyfill,cryptoRandomuuid,hasRequiredCryptoRandomuuid,git_properties,hasRequiredGit_properties;function requireCodec(){return hasRequiredCodec||(hasRequiredCodec=1,requireReadCore(),requireWriteCore(),codec.codec={preset:requireCodecBase().preset}),codec}function requireMsgpackLite(){return hasRequiredMsgpackLite||(hasRequiredMsgpackLite=1,msgpackLite.encode=requireEncode().encode,msgpackLite.decode=requireDecode().decode,msgpackLite.Encoder=requireEncoder().Encoder,msgpackLite.Decoder=requireDecoder().Decoder,msgpackLite.createEncodeStream=requireEncodeStream().createEncodeStream,msgpackLite.createDecodeStream=requireDecodeStream().createDecodeStream,msgpackLite.createCodec=requireExt().createCodec,msgpackLite.codec=requireCodec().codec),msgpackLite}function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1;const e=require$$6,t=requireLog$2(),r=requireRequest(),{URL:s,format:n}=require$$0$8,i=requireMsgpackLite(),a=require$$5,o=i.createCodec({int64:!0});return writer={DataStreamsWriter:class{constructor(e){const{hostname:t="127.0.0.1",port:r=8126,url:i}=e;this._url=i||new s(n({protocol:"http:",hostname:t||"localhost",port:r}))}flush(s){if(!r.writable)return void t.debug((()=>`Maximum number of active requests reached. Payload discarded: ${JSON.stringify(s)}`));const n=i.encode(s,{codec:o});a.gzip(n,{level:1},((s,n)=>{s?t.error(s):function(s,n,i){const a={path:"/v0.1/pipeline_stats",method:"POST",headers:{"Datadog-Meta-Lang":"javascript","Datadog-Meta-Tracer-Version":e.version,"Content-Type":"application/msgpack","Content-Encoding":"gzip"},url:n};t.debug((()=>`Request to the intake: ${JSON.stringify(a)}`)),r(s,a,((e,t)=>{i(e,t)}))}(n,this._url,((e,r)=>{t.debug(`Response from the agent: ${r}`),e&&t.error(e)}))}))}setUrl(e){try{e=new s(e),this._url=e}catch(e){t.warn(e.stack)}}}},writer}function requireProcessor(){if(hasRequiredProcessor)return processor;hasRequiredProcessor=1;const e=require$$0$a,t=require$$6,r=requireInt64Buffer().Uint64BE,{LogCollapsingLowestDenseDDSketch:s}=requireDist$1(),{encodePathwayContext:n}=requirePathway(),{DataStreamsWriter:i}=requireWriter(),{computePathwayHash:a}=requirePathway(),{types:o}=require$$0$3,{PATHWAY_HASH:c}=requireTags$2(),u=Buffer.from("0000000000000000","hex"),l=.0075,p="dd-pathway-ctx";class d{constructor(e,t,n){this.hash=new r(e),this.parentHash=new r(t),this.edgeTags=n,this.edgeLatency=new s(l),this.pathwayLatency=new s(l),this.payloadSize=new s(l)}addLatencies(e){const t=e.edgeLatencyNs/1e9,r=e.pathwayLatencyNs/1e9;this.edgeLatency.accept(t),this.pathwayLatency.accept(r),this.payloadSize.accept(e.payloadSize)}encode(){return{Hash:this.hash,ParentHash:this.parentHash,EdgeTags:this.edgeTags,EdgeLatency:this.edgeLatency.toProto(),PathwayLatency:this.pathwayLatency.toProto(),PayloadSize:this.payloadSize.toProto()}}}class h{constructor({offset:e,...t}){this._tags=Object.keys(t).sort().map((e=>`${e}:${t[e]}`)),this._hash=this._tags.join(","),this._offset=e}get hash(){return this._hash}get offset(){return this._offset}get tags(){return this._tags}encode(){return{Tags:this.tags,Value:this.offset}}}class f{constructor(){this._checkpoints=new Map,this._backlogs=new Map}get checkpoints(){return this._checkpoints}get backlogs(){return this._backlogs}forCheckpoint(e){const t=e.hash;return this._checkpoints.has(t)||this._checkpoints.set(t,new d(e.hash,e.parentHash,e.edgeTags)),this._checkpoints.get(t)}forBacklog(e){const t=new h(e),r=this._backlogs.get(t.hash);return void 0!==r&&r.offset>t.offset?r:(this._backlogs.set(t.hash,t),t)}}function g(e){if("string"==typeof e)return Buffer.from(e,"utf-8").length;if(o.isArrayBuffer(e))return e.byteLength;if(Buffer.isBuffer(e))return e.length;if(Array.isArray(e)&&e.length>0){if("number"==typeof e[0])return Buffer.from(e).length;let t=0;return e.forEach((e=>{t+=g(e)})),t}if("object"==typeof e)try{return m(e)}catch{}return 0}function m(e){return void 0===e?0:Object.entries(e).reduce(((e,[t,r])=>g(t)+g(r)+e),0)}class _ extends Map{forTime(e){return this.has(e)||this.set(e,new f),this.get(e)}}return processor={DataStreamsProcessor:class{constructor({dsmEnabled:t,hostname:r,port:s,url:n,env:a,tags:o,version:c,service:u,flushInterval:l}={}){this.writer=new i({hostname:r,port:s,url:n}),this.bucketSizeNs=1e10,this.buckets=new _,this.hostname=e.hostname(),this.enabled=t,this.env=a,this.tags=o||{},this.service=u||"unnamed-nodejs-service",this.version=c||"",this.sequence=0,this.flushInterval=l,this.enabled&&(this.timer=setInterval(this.onInterval.bind(this),l),this.timer.unref()),process.once("beforeExit",(()=>this.onInterval()))}onInterval(){const{Stats:e}=this._serializeBuckets();if(0===e.length)return;const r={Env:this.env,Service:this.service,Stats:e,TracerVersion:t.version,Version:this.version,Lang:"javascript"};this.writer.flush(r)}bucketFromTimestamp(e){const t=Math.round(e-e%this.bucketSizeNs);return this.buckets.forTime(t)}recordCheckpoint(e,t=null){this.enabled&&(this.bucketFromTimestamp(e.currentTimestamp).forCheckpoint(e).addLatencies(e),t&&t.setTag(c,e.hash.readBigUInt64BE(0).toString()))}setCheckpoint(e,t,r=null,s=0){if(!this.enabled)return null;const i=1e6*Date.now(),o=e.find((e=>e.startsWith("direction:")));let c=i,l=i,d=u,h=u,f=i;null!=r&&(c=r.pathwayStartNs,l=r.edgeStartNs,d=r.hash,h=r.closestOppositeDirectionHash||u,f=r.closestOppositeDirectionEdgeStart||i,o===r.previousDirection?(d=r.closestOppositeDirectionHash,d===u?(l=i,c=i):l=r.closestOppositeDirectionEdgeStart):(h=d,f=l));const m=a(this.service,this.env,e,d),_=i-l,b=i-c,y={hash:m,edgeStartNs:l,pathwayStartNs:c,previousDirection:o,closestOppositeDirectionHash:h,closestOppositeDirectionEdgeStart:f};if("direction:out"===o){const e={};e[p]=n(y).toJSON(),s+=g(JSON.stringify(e))-1}const v={currentTimestamp:i,parentHash:d,hash:m,edgeTags:e,edgeLatencyNs:_,pathwayLatencyNs:b,payloadSize:s};return this.recordCheckpoint(v,t),y}recordOffset({timestamp:e,...t}){if(this.enabled)return this.bucketFromTimestamp(e).forBacklog(t)}setOffset(e){if(!this.enabled)return;const t={...e,timestamp:1e6*Date.now()};this.recordOffset(t)}_serializeBuckets(){const e=[];for(const[t,s]of this.buckets.entries()){const n=[];for(const e of s._checkpoints.values())n.push(e.encode());const i=[];for(const e of s._backlogs.values())i.push(e.encode());e.push({Start:new r(t),Duration:new r(this.bucketSizeNs),Stats:n,Backlogs:i})}return this.buckets.clear(),{Stats:e}}setUrl(e){this.writer.setUrl(e)}},StatsPoint:d,StatsBucket:f,Backlog:h,TimeBuckets:_,getMessageSize:function(e){const{key:t,value:r,headers:s}=e;return g(t)+g(r)+m(s)},getHeadersSize:m,getSizeOrZero:g,getAmqpMessageSize:function(e){const{headers:t,content:r}=e;return g(r)+m(t)},ENTRY_PARENT_HASH:u,CONTEXT_PROPAGATION_KEY:p},processor}function requireVersion(){if(hasRequiredVersion)return version$4;hasRequiredVersion=1;const e=require$$6.version.match(/^(\d+)\.(\d+)\.(\d+)/),t=process.versions.node.match(/^(\d+)\.(\d+)\.(\d+)/);return version$4={DD_MAJOR:parseInt(e[1]),DD_MINOR:parseInt(e[2]),DD_PATCH:parseInt(e[3]),NODE_MAJOR:parseInt(t[1]),NODE_MINOR:parseInt(t[2]),NODE_PATCH:parseInt(t[3])}}function requireData_streams_context(){if(hasRequiredData_streams_context)return data_streams_context;hasRequiredData_streams_context=1;const{storage:e}=requireDatadogCore();return data_streams_context={getDataStreamsContext:function(){const t=e.getStore();return t&&t.dataStreamsContext||null},setDataStreamsContext:function(t){e.enterWith({...e.getStore(),dataStreamsContext:t})}},data_streams_context}function requireTracer(){if(hasRequiredTracer)return tracer$1;hasRequiredTracer=1;const e=requireTracer$1(),t=requireTags$2(),r=requireScope(),{storage:s}=requireDatadogCore(),{isError:n}=requireUtil$9(),{setStartupLogConfig:i}=requireStartupLog(),{ERROR_MESSAGE:a,ERROR_TYPE:o,ERROR_STACK:c}=requireConstants$2(),{DataStreamsProcessor:u}=requireProcessor(),{decodePathwayContext:l}=requirePathway(),{DD_MAJOR:p}=requireVersion(),d=requireData_streams_context(),h=t.SPAN_TYPE,f=t.RESOURCE_NAME,g=t.SERVICE_NAME,m=t.MEASURED;function _(e,t){n(t)&&e.addTags({[o]:t.name,[a]:t.message,[c]:t.stack})}return tracer$1=class extends e{constructor(e){super(e),this._dataStreamsProcessor=new u(e),this._scope=new r,i(e)}configure({env:e,sampler:t}){this._prioritySampler.configure(e,t)}setCheckpoint(e,t,r=0){const s=this._dataStreamsProcessor.setCheckpoint(e,t,d.getDataStreamsContext(),r);return d.setDataStreamsContext(s),s}decodeDataStreamsContext(e){const t=l(e);return d.setDataStreamsContext(t),t}setOffset(e){return this._dataStreamsProcessor.setOffset(e)}trace(e,t,r){if(!(t=Object.assign({childOf:this.scope().active()},t)).childOf&&!1===t.orphanable&&p<4)return r(null,(()=>{}));const s=this.startSpan(e,t);!function(e,t){const r={};t.type&&(r[h]=t.type);t.service&&(r[g]=t.service);t.resource&&(r[f]=t.resource);r[m]=t.measured,e.addTags(r)}(s,t);try{if(r.length>1)return this.scope().activate(s,(()=>r(s,(e=>{_(s,e),s.finish()}))));const e=this.scope().activate(s,(()=>r(s)));return e&&"function"==typeof e.then?e.then((e=>(s.finish(),e)),(e=>{throw _(s,e),s.finish(),e})):(s.finish(),e)}catch(e){throw _(s,e),s.finish(),e}}wrap(e,t,r){const n=this;return function(){const i=s.getStore();if(i&&i.noop)return r.apply(this,arguments);let a=t;if("function"==typeof a&&"function"==typeof r&&(a=a.apply(this,arguments)),a&&!1===a.orphanable&&!n.scope().active()&&p<4)return r.apply(this,arguments);const o=arguments.length-1,c=arguments[o];if("function"==typeof c){const t=n.scope().bind(c);return n.trace(e,a,((e,s)=>(arguments[o]=function(e){return s(e),t.apply(this,arguments)},r.apply(this,arguments))))}return n.trace(e,a,(()=>r.apply(this,arguments)))}}setUrl(e){this._exporter.setUrl(e),this._dataStreamsProcessor.setUrl(e)}scope(){return this._scope}getRumData(){if(!this._enableGetRumData)return"";return`<meta name="dd-trace-id" content="${this.scope().active().context().toTraceId()}" /><meta name="dd-trace-time" content="${Date.now()}" />`}},tracer$1}function requireValidators(){if(hasRequiredValidators)return validators;hasRequiredValidators=1;const e=require$$0$d,t=require$$0$3,r=["string","function","number","object","Function","Object","boolean","bigint","symbol"];class s extends TypeError{constructor(e){super(`Operation failed: ${e}`),this.code=this.constructor.name,Object.defineProperties(this,{toString:{value(){return`${this.name} [${this.code}]: ${this.message}`},enumerable:!1,writable:!0,configurable:!0}})}}class n extends TypeError{constructor(s,n,i){super(),e("string"==typeof s,"'name' must be a string"),Array.isArray(n)||(n=[n]);let a="The ";if(s.endsWith(" argument"))a+=`${s} `;else{const e=s.includes(".")?"property":"argument";a+=`"${s}" ${e} `}a+="must be ";const o=[],c=[],u=[];for(const t of n)e("string"==typeof t,"All expected entries have to be of type string"),r.includes(t)?o.push(t.toLowerCase()):classRegExp.test(t)?c.push(t):(e("object"!==t,'The value "object" should be written as "Object"'),u.push(t));if(c.length>0){const e=o.indexOf("object");-1!==e&&(o.splice(e,1),c.push("Object"))}if(o.length>0){if(o.length>2){const e=o.pop();a+=`one of type ${o.join(", ")}, or ${e}`}else 2===o.length?a+=`one of type ${o[0]} or ${o[1]}`:a+=`of type ${o[0]}`;(c.length>0||u.length>0)&&(a+=" or ")}if(c.length>0){if(c.length>2){const e=c.pop();a+=`an instance of ${c.join(", ")}, or ${e}`}else a+=`an instance of ${c[0]}`,2===c.length&&(a+=` or ${c[1]}`);u.length>0&&(a+=" or ")}if(u.length>0)if(u.length>2){const e=u.pop();a+=`one of ${u.join(", ")}, or ${e}`}else 2===u.length?a+=`one of ${u[0]} or ${u[1]}`:(u[0].toLowerCase()!==u[0]&&(a+="an "),a+=`${u[0]}`);if(null==i)a+=`. Received ${i}`;else if("function"==typeof i&&i.name)a+=`. Received function ${i.name}`;else if("object"==typeof i)if(i.constructor&&i.constructor.name)a+=`. Received an instance of ${i.constructor.name}`;else{a+=`. Received ${t.inspect(i,{depth:-1})}`}else{let e=t.inspect(i,{colors:!1});e.length>25&&(e=`${e.slice(0,25)}...`),a+=`. Received type ${typeof i} (${e})`}this.code=this.constructor.name,Object.defineProperties(this,{message:{value:a,enumerable:!1,writable:!0,configurable:!0},toString:{value(){return`${this.name} [${this.code}]: ${this.message}`},enumerable:!1,writable:!0,configurable:!0}})}}return validators={validateBoolean:function(e,t){if("boolean"!=typeof e)throw new n(t,"boolean",e)},validateObject:function(e,t,{nullable:r=!1,allowArray:s=!1,allowFunction:i=!1}={}){if(!r&&null===e||!s&&Array.isArray(e)||"object"!=typeof e&&(!i||"function"!=typeof e))throw new n(t,"Object",e)},codes:{ERR_OPERATION_FAILED:s}},validators}function requirePolyfill(){if(hasRequiredPolyfill)return polyfill;hasRequiredPolyfill=1;const e=require$$0$2,{validateBoolean:t,validateObject:r,codes:{ERR_OPERATION_FAILED:s}}=requireValidators(),{randomFillSync:n}=e;function i(e){const t=Buffer.alloc(e);return n(t)}const a=128;let o,c,u,l=0;function p(e,t=0){const r=function(){if(void 0===u){u=new Array(256);for(let e=0;e<u.length;e++){const t=e.toString(16);u[e]=t.padStart(2,"0")}}return u}();return r[e[t]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[15&e[t+6]|64]+r[e[t+7]]+"-"+r[63&e[t+8]|128]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]}return polyfill=function(e){void 0!==e&&r(e,"options");const{disableEntropyCache:u=!1}=e||{};return t(u,"options.disableEntropyCache"),u?function(){if(c||(c=i(16*a)),void 0===c)throw new s("Out of memory");return n(c),p(c)}():function(){if(o||(o=i(16*a)),void 0===o)throw new s("Out of memory");return 0===l&&n(o),l=(l+1)%a,p(o,16*l)}()}}function requireCryptoRandomuuid(){if(hasRequiredCryptoRandomuuid)return cryptoRandomuuid;hasRequiredCryptoRandomuuid=1;const e=require$$0$2;return cryptoRandomuuid="function"==typeof e.randomUUID?e.randomUUID:requirePolyfill()}function requireGit_properties(){if(hasRequiredGit_properties)return git_properties;hasRequiredGit_properties=1;const e=/git\.commit\.sha=([a-f\d]{40})/,t=/git\.repository_url=([\w\d:@/.-]+)/;function r(e){try{const t=new URL(e);return t.username||t.password?`${t.origin}${t.pathname}`:e}catch(t){return e}}return git_properties={getGitMetadataFromGitProperties:function(s){if(!s)return{};const n=s.match(e),i=s.match(t),a=i?i[1]:void 0;return{commitSHA:n?n[1]:void 0,repositoryUrl:r(a)}},removeUserSensitiveInfo:r}}var dependencies={exports:{}},moduleDetailsFromPath,hasRequiredModuleDetailsFromPath,requirePackageJson_1,hasRequiredRequirePackageJson,hasRequiredDependencies,logCollector_1,hasRequiredLogCollector,logs,hasRequiredLogs,telemetry$2,hasRequiredTelemetry$2,serverless,hasRequiredServerless,config$1,hasRequiredConfig$1,plugin$1,hasRequiredPlugin$1;function requireModuleDetailsFromPath(){if(hasRequiredModuleDetailsFromPath)return moduleDetailsFromPath;hasRequiredModuleDetailsFromPath=1;var e=require$$0$1;return moduleDetailsFromPath=function(t){var r=t.split(e.sep),s=r.lastIndexOf("node_modules");if(-1!==s&&r[s+1]){var n="@"===r[s+1][0],i=n?3:2;return{name:n?r[s+1]+"/"+r[s+2]:r[s+1],basedir:r.slice(0,s+i).join(e.sep),path:r.slice(s+i).join(e.sep)}}},moduleDetailsFromPath}function requireRequirePackageJson(){if(hasRequiredRequirePackageJson)return requirePackageJson_1;hasRequiredRequirePackageJson=1;const e=require$$0$1,t=require$$0$6;return requirePackageJson_1=function(r,s){if(e.isAbsolute(r)){const s=e.join(r,"package.json");return JSON.parse(t.readFileSync(s,"utf8"))}for(const n of s.paths){const s=e.join(n,r,"package.json");try{return JSON.parse(t.readFileSync(s,"utf8"))}catch(e){continue}}throw new Error(`could not find ${r}/package.json`)},requirePackageJson_1}function requireDependencies(){return hasRequiredDependencies||(hasRequiredDependencies=1,function(e){const t=require$$0$1,r=requireModuleDetailsFromPath(),s=requireRequirePackageJson(),{sendData:n}=requireSendData(),i=requireDcPolyfill(),{fileURLToPath:a}=require$$0$8,{isTrue:o}=requireUtil$9(),c=new Set,u=new Set,l=new Set,p="file://",d=i.channel("dd-trace:moduleLoadStart");let h,f,g,m,_,b,y,v=!0;function S(e,t,r){h||(h=setImmediate((()=>{if(h=null,c.size>0){const s=Array.from(c.values()).filter((t=>{const r=o(t.split(" ")[2])||e.telemetry?.dependencyCollection;return r||c.delete(t),r})).splice(0,2e3).map((e=>{c.delete(e);const[t,r]=e.split(" ");return{name:t,version:r}}));let i;const a=b();if(a)i={reqType:"app-dependencies-loaded",payload:{dependencies:s}};else{if(!s.length)return;i={dependencies:s}}const u=a?function(e){const t=[];return e.map((e=>{t.push({request_type:e.reqType,payload:e.payload})})),t}([i,a]):i;n(e,t,r,a?"message-batch":"app-dependencies-loaded",u,y),c.size>0&&S(e,t,r)}})),h.unref())}function q(n){if(v&&(v=!1,require.cache&&Object.keys(require.cache).forEach((e=>{q({filename:e})}))),n){let i=n.filename;if(i&&i.startsWith(p))try{i=a(i)}catch(e){}const o=i&&r(i),d=n.request||o&&o.name,h=o&&o.basedir?o.basedir:d;if(i&&d&&function(e,r){const s=E(e,r,"/");if(s&&"win32"===process.platform)return E(e,r,t.sep);return s}(i,d)&&!u.has(h)&&(u.add(h),o)){const{name:t,basedir:r}=o;if(r)try{const{version:n}=s(r,e),i=`${t} ${n}`;l.has(i)||(c.add(`${i} ${_}`),l.add(i),S(f,g,m))}catch(e){}}}}function E(e,t,r){return 0!==t.indexOf(`..${r}`)&&0!==t.indexOf(`.${r}`)&&0!==t.indexOf(r)&&1!==t.indexOf(`:${r}`)}e.exports={start:function(e={},t,r,s,n){f=e,g=t,m=r,_=!0,b=s,y=n,d.subscribe(q),queueMicrotask((()=>{_=!1}))},stop:function(){f=null,g=null,m=null,u.clear(),c.clear(),l.clear(),d.hasSubscribers&&d.unsubscribe(q)}}}(dependencies)),dependencies.exports}function requireLogCollector(){if(hasRequiredLogCollector)return logCollector_1;hasRequiredLogCollector=1;const e=requireLog$2(),t=new Map;let r=1e4,s=0;function n(e){let t=0;const r=e.length;for(let s=0;s<r;s++)t=(31*t|0)+e.charCodeAt(s)|0;return t}const i={add(i){try{if(!function(e){return e?.level&&e.message}(i))return!1;if(t.size>=r)return void s++;const e=function(e){let t=e.level?n(e.level):0;return t=(31*t|0)+(e.message?n(e.message):0)|0,t=(31*t|0)+(e.stack_trace?n(e.stack_trace):0)|0,t}(i);if(!t.has(e))return t.set(e,i),!0}catch(t){e.error(`Unable to add log to logCollector: ${t.message}`)}return!1},drain(){if(0===t.size)return;const e=[...t.values()];return s>0&&e.push({message:`Omitted ${s} entries due to overflowing`,level:"ERROR"}),this.reset(),e},reset(e){t.clear(),s=0,e&&(r=e)}};return i.reset(),logCollector_1=i}function requireLogs(){if(hasRequiredLogs)return logs;hasRequiredLogs=1;const e=requireDcPolyfill(),t=requireLogCollector(),{sendData:r}=requireSendData(),s=e.channel("datadog:telemetry:log");let n=!1;function i(e){var r;r=e?.level?.toUpperCase(),function(e){switch(e){case"ERROR":case"WARN":return!0;default:return!1}}(r)&&t.add(e)}return logs={start:function(e){e.telemetry.logCollection&&!n&&(n=!0,s.subscribe(i))},stop:function(){n=!1,s.hasSubscribers&&s.unsubscribe(i)},send:function(e,s,i){if(!n)return;const a=t.drain();a&&r(e,s,i,"logs",{logs:a})}},logs}function requireTelemetry$2(){if(hasRequiredTelemetry$2)return telemetry$2;hasRequiredTelemetry$2=1;const e=require$$6.version,t=requireDcPolyfill(),r=require$$0$a,s=requireDependencies(),{sendData:n}=requireSendData(),{errors:i}=requireStartupLog(),{manager:a}=requireMetrics(),o=requireLogs(),c=t.channel("datadog:telemetry:start"),u=t.channel("datadog:telemetry:stop");let l,p,d,h,f,g,m,_,b=null;const y={},v=new Set;function S(){return b}function q(e,t){if(e)if("message-batch"===t.reqType){const e=t.payload[0].payload,r=t.payload[0].request_type;b={payload:e,reqType:r};const s=t.payload[1].payload,n=t.payload[1].request_type;"app-integrations-change"===n&&(y.integrations?y.integrations.push(s):y.integrations=[s]),"app-dependencies-loaded"===n&&(y.dependencies?y.dependencies.push(s):y.dependencies=[s])}else b=t;else b=null}function E(){const e=[];for(const t in p._pluginsByName)v.has(t)||(e.push({name:t,enabled:p._pluginsByName[t]._enabled,auto_enabled:!0}),v.add(t));return e}function R(t){const r={appsec:{enabled:t.appsec.enabled},profiler:{version:e,enabled:t.profiling.enabled}};return i.profilingError&&(r.profiler.error=i.profilingError,i.profilingError={}),r}function T(e,t=[],r=[],s=null){if(!(s=s||new WeakSet).has(e)){s.add(e);for(const[n,i]of Object.entries(e))"object"==typeof i&&null!==i?T(i,t,[...r,n],s):t.push({name:[...r,n].join("."),value:i,origin:"unknown"});return t}}function A(e){const t={products:R(e),configuration:T(e)},r=function(e){const{installSignature:t}=e;if(t&&(t.id||t.time||t.type))return{install_id:t.id,install_time:t.time,install_type:t.type}}(e);return r&&(t.install_signature=r),t}function w(){if(!l?.telemetry?.enabled)return;const{reqType:e,payload:t}=$("app-closing");n(l,d,h,e,t),l.isCiVisibility&&a.send(l,d,h)}function x(){process.removeListener("beforeExit",x),w()}function I(t){return{service_name:t.service,env:t.env,service_version:t.version,tracer_version:e,language_name:"nodejs",language_version:process.versions.node}}function C(){const e=r.type();return"Linux"===e||"Darwin"===e?{hostname:r.hostname(),os:e,architecture:r.arch(),kernel_version:r.version(),kernel_release:r.release(),kernel_name:e}:"Windows_NT"===e?{hostname:r.hostname(),os:e,architecture:r.arch(),os_version:r.version()}:{hostname:r.hostname(),os:e}}function O(){return{config:l,application:d,host:h,heartbeatInterval:g}}function $(e,t={}){if(S()){const r=function(e){const t=[];return e.map((e=>{t.push({request_type:e.reqType,payload:e.payload})})),t}([{reqType:e,payload:t},b]);return{reqType:"message-batch",payload:r}}return{reqType:e,payload:t}}function k(e,t,r){return f=setTimeout((()=>{a.send(e,t,r),o.send(e,t,r);const{reqType:s,payload:i}=$("app-heartbeat");n(e,t,r,s,i,q),k(e,t,r)}),g).unref(),f}return telemetry$2={start:function(e,t){e.telemetry.enabled&&(l=e,p=t,d=I(l),h=C(),g=l.telemetry.heartbeatInterval,_=E(),s.start(l,d,h,S,q),o.start(l),n(l,d,h,"app-started",A(l)),_.length>0&&n(l,d,h,"app-integrations-change",{integrations:_},q),k(l,d,h),function(e){m=setInterval((()=>{const t={...A(e),...y};n(e,d,h,"app-extended-heartbeat",t),Object.keys(y).forEach((e=>delete y[e]))}),864e5).unref()}(l),process.on("beforeExit",x),c.publish(O()))},stop:function(){l&&(clearInterval(m),clearTimeout(f),process.removeListener("beforeExit",x),u.publish(O()),l=void 0)},updateIntegrations:function(){if(!l||!l.telemetry.enabled)return;const e=E();if(0===e.length)return;const{reqType:t,payload:r}=$("app-integrations-change",{integrations:e});n(l,d,h,t,r,q)},updateConfig:function(e,t){if(!t.telemetry.enabled)return;if(0===e.length)return;if("1"!==process.env.DD_INTERNAL_TELEMETRY_V2_ENABLED)return;const r=I(t),s=C(),i={sampleRate:"DD_TRACE_SAMPLE_RATE",logInjection:"DD_LOG_INJECTION",headerTags:"DD_TRACE_HEADER_TAGS",tags:"DD_TAGS"},a=[];for(const t of e){if(!i.hasOwnProperty(t.name))continue;const e=i[t.name],{origin:r,value:s}=t,n={name:e,origin:r,value:s};Array.isArray(s)?n.value=s.join(","):"DD_TAGS"===e&&(n.value=Object.entries(s).map((([e,t])=>`${e}:${t}`))),a.push(n)}const{reqType:o,payload:c}=$("app-client-configuration-change",{configuration:a});n(t,r,s,o,c,q)},appClosing:w},telemetry$2}function requireServerless(){if(hasRequiredServerless)return serverless;hasRequiredServerless=1;const e=requireLog$2();function t(e){if(void 0!==process.env.DD_MINI_AGENT_PATH)return process.env.DD_MINI_AGENT_PATH;return`${e.isGCPFunction?"/workspace":"/home/site/wwwroot"}/node_modules/@datadog/sma/${"win32"===process.platform?"datadog-serverless-agent-windows-amd64":"datadog-serverless-agent-linux-amd64"}/datadog-serverless-trace-mini-agent${"win32"===process.platform?".exe":""}`}return serverless={maybeStartServerlessMiniAgent:function(r){if("win32"!==process.platform&&"linux"!==process.platform)return void e.error("Serverless Mini Agent is only supported on Windows and Linux.");const s=t(r),n=require$$0$6;if(e.debug(`Trying to spawn the Serverless Mini Agent at path: ${s}`),n.existsSync(s))try{require("child_process").spawn(s,{stdio:"inherit"})}catch(t){e.error(`Error spawning mini agent process: ${t}`)}else e.error("Serverless Mini Agent did not start. Could not find mini agent binary.")},getIsGCPFunction:function(){const e=void 0!==process.env.FUNCTION_NAME&&void 0!==process.env.GCP_PROJECT,t=void 0!==process.env.K_SERVICE&&void 0!==process.env.FUNCTION_TARGET;return e||t},getIsAzureFunctionConsumptionPlan:function(){const e=void 0!==process.env.FUNCTIONS_EXTENSION_VERSION&&void 0!==process.env.FUNCTIONS_WORKER_RUNTIME,t=process.env.WEBSITE_SKU;return e&&(void 0===t||"Dynamic"===t)},getRustBinaryPath:t},serverless}function requireConfig$1(){if(hasRequiredConfig$1)return config$1;hasRequiredConfig$1=1;const e=require$$0$6,t=require$$0$a,r=requireCryptoRandomuuid(),s=require$$0$8.URL,n=requireLog$2(),i=requirePkg(),a=requireKoalas(),o=requireTagger$1(),{isTrue:c,isFalse:u}=requireUtil$9(),{GIT_REPOSITORY_URL:l,GIT_COMMIT_SHA:p}=requireTags$1(),{getGitMetadataFromGitProperties:d,removeUserSensitiveInfo:h}=requireGit_properties(),{updateConfig:f}=requireTelemetry$2(),{getIsGCPFunction:g,getIsAzureFunctionConsumptionPlan:m}=requireServerless(),{ORIGIN_KEY:_}=requireConstants$2(),b=Object.fromEntries||(e=>e.reduce(((e,[t,r])=>Object.assign(e,{[t]:r})),{}));function y(t){if(t)try{return e.readFileSync(t,"utf8")}catch(e){return void n.error(e)}}function v(e){try{return JSON.parse(e)}catch(e){return}}const S=["v0","v1"],q="v0";function E(e,t){if(!e)return;const r={};for(const[s,n]of Object.entries(e))r[s in t?t[s]:s]=n;return r}function R(e,t,r){if("object"!=typeof t||Array.isArray(t)||(t=t[e]),Array.isArray(t))return t.map((e=>e.toLowerCase()));void 0!==t&&n.warn("Unexpected input for config.tracePropagationStyle");const s=`DD_TRACE_PROPAGATION_STYLE_${e.toUpperCase()}`,i=a(process.env[s],process.env.DD_TRACE_PROPAGATION_STYLE);return void 0!==i?i.split(",").filter((e=>""!==e)).map((e=>e.trim().toLowerCase())):r}return config$1=class{constructor(i){i=i||{},this.debug=c(a(process.env.DD_TRACE_DEBUG,!1)),this.logger=i.logger,this.logLevel=a(i.logLevel,process.env.DD_TRACE_LOG_LEVEL,"debug"),n.use(this.logger),n.toggle(this.debug,this.logLevel,this);const f=a(i.profiling,process.env.DD_EXPERIMENTAL_PROFILING_ENABLED,process.env.DD_PROFILING_ENABLED,!1),T=a(process.env.DD_PROFILING_EXPORTERS,"agent"),A=process.env.DD_PROFILING_SOURCE_MAP,w=a(i.runtimeMetrics,process.env.DD_RUNTIME_METRICS_ENABLED,!1),x=a(i.dbmPropagationMode,process.env.DD_DBM_PROPAGATION_MODE,"disabled"),I=a(i.dsmEnabled,process.env.DD_DATA_STREAMS_ENABLED,!1),C=a(i.hostname,process.env.DD_AGENT_HOST,process.env.DD_TRACE_AGENT_HOSTNAME,"127.0.0.1"),O=a(i.port,process.env.DD_TRACE_AGENT_PORT,"8126"),$=a(i.url,process.env.DD_TRACE_AGENT_URL,process.env.DD_TRACE_URL,null),k=a(i.isCiVisibility,!1),P=process.env.DD_CIVISIBILITY_AGENTLESS_URL,N=a(process.env.DD_CIVISIBILITY_ITR_ENABLED,!0),L=a(process.env.DD_CIVISIBILITY_MANUAL_API_ENABLED,!1),M=a(process.env.DD_CIVISIBILITY_EARLY_FLAKE_DETECTION_ENABLED,!0),D=a(process.env.DD_TRACE_MEMCACHED_COMMAND_ENABLED,!1),j=a(i.serviceMapping,process.env.DD_SERVICE_MAPPING?b(process.env.DD_SERVICE_MAPPING.split(",").map((e=>e.trim().split(":")))):{}),U=a(i.startupLogs,process.env.DD_TRACE_STARTUP_LOGS,!1),B=a(i.openAiLogsEnabled,process.env.DD_OPENAI_LOGS_ENABLED,!1),G=a(process.env.DATADOG_API_KEY,process.env.DD_API_KEY),F=void 0!==process.env.AWS_LAMBDA_FUNCTION_NAME,z=g(),V=m(),H=F||z||V,W=a(process.env.DD_TRACE_TELEMETRY_ENABLED,process.env.DD_INSTRUMENTATION_TELEMETRY_ENABLED,!H),K=process.env.DD_TELEMETRY_HEARTBEAT_INTERVAL?Math.floor(1e3*parseFloat(process.env.DD_TELEMETRY_HEARTBEAT_INTERVAL)):6e4,Y=process.env.DD_OPENAI_SPAN_CHAR_LIMIT?parseInt(process.env.DD_OPENAI_SPAN_CHAR_LIMIT):128,J=a(process.env.DD_TELEMETRY_DEBUG,!1),X=a(process.env.DD_TELEMETRY_METRICS_ENABLED,!0),Q=a(i.protocolVersion,process.env.DD_TRACE_AGENT_PROTOCOL_VERSION,"0.4"),Z=a(parseInt(i.flushMinSpans),parseInt(process.env.DD_TRACE_PARTIAL_FLUSH_MIN_SPANS),1e3),ee=a(process.env.DD_TRACE_OBFUSCATION_QUERY_STRING_REGEXP,'(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?|access_?|secret_?)key(?:_?id)?|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)?|auth(?:entication|orization)?)(?:(?:\\s|%20)*(?:=|%3D)[^&]+|(?:"|%22)(?:\\s|%20)*(?::|%3A)(?:\\s|%20)*(?:"|%22)(?:%2[^2]|%[^2]|[^"%])+(?:"|%22))|bearer(?:\\s|%20)+[a-z0-9\\._\\-]+|token(?::|%3A)[a-z0-9]{13}|gh[opsu]_[0-9a-zA-Z]{36}|ey[I-L](?:[\\w=-]|%3D)+\\.ey[I-L](?:[\\w=-]|%3D)+(?:\\.(?:[\\w.+\\/=-]|%3D|%2F|%2B)+)?|[\\-]{5}BEGIN(?:[a-z\\s]|%20)+PRIVATE(?:\\s|%20)KEY[\\-]{5}[^\\-]+[\\-]{5}END(?:[a-z\\s]|%20)+PRIVATE(?:\\s|%20)KEY|ssh-rsa(?:\\s|%20)*(?:[a-z0-9\\/\\.+]|%2F|%5C|%2B){100,}'),te=a(i.clientIpEnabled,process.env.DD_TRACE_CLIENT_IP_ENABLED&&c(process.env.DD_TRACE_CLIENT_IP_ENABLED),!1),re=a(i.clientIpHeader,process.env.DD_TRACE_CLIENT_IP_HEADER,null),se=a(i.experimental&&i.experimental.b3,process.env.DD_TRACE_EXPERIMENTAL_B3_ENABLED,!1),ne=["datadog","tracecontext"];c(se)&&(ne.push("b3"),ne.push("b3 single header")),process.env.DD_TRACE_PROPAGATION_STYLE&&(process.env.DD_TRACE_PROPAGATION_STYLE_INJECT||process.env.DD_TRACE_PROPAGATION_STYLE_EXTRACT)&&n.warn("Use either the DD_TRACE_PROPAGATION_STYLE environment variable or separate DD_TRACE_PROPAGATION_STYLE_INJECT and DD_TRACE_PROPAGATION_STYLE_EXTRACT environment variables");const ie=R("inject",i.tracePropagationStyle,ne),ae=R("extract",i.tracePropagationStyle,ne),oe=a(process.env.DD_TRACE_PROPAGATION_EXTRACT_FIRST,!1),ce=a(i.experimental&&i.experimental.runtimeId,process.env.DD_TRACE_EXPERIMENTAL_RUNTIME_ID_ENABLED,!1),ue=a(i.experimental&&i.experimental.exporter,process.env.DD_TRACE_EXPERIMENTAL_EXPORTER),le=a(i.experimental&&i.experimental.enableGetRumData,process.env.DD_TRACE_EXPERIMENTAL_GET_RUM_DATA_ENABLED,!1),pe=(de=a(i.spanAttributeSchema,process.env.DD_TRACE_SPAN_ATTRIBUTE_SCHEMA))?S.includes(de)?de:(n.warn(`Unexpected input for config.spanAttributeSchema, picked default ${q}`),q):q;var de;const he=a(i.peerServiceMapping,process.env.DD_TRACE_PEER_SERVICE_MAPPING?b(process.env.DD_TRACE_PEER_SERVICE_MAPPING.split(",").map((e=>e.trim().split(":")))):{}),fe=i.hasOwnProperty("spanComputePeerService")||process.env.hasOwnProperty("DD_TRACE_PEER_SERVICE_DEFAULTS_ENABLED"),ge=a(i.spanComputePeerService,process.env.DD_TRACE_PEER_SERVICE_DEFAULTS_ENABLED),me="v0"===pe?fe&&c(ge):!fe||!u(ge),_e=a(i.spanRemoveIntegrationFromService,c(process.env.DD_TRACE_REMOVE_INTEGRATION_SERVICE_NAMES_ENABLED)),be=a(process.env.DD_TRACE_X_DATADOG_TAGS_MAX_LENGTH,"512"),ye=a(i.stats,process.env.DD_TRACE_STATS_COMPUTATION_ENABLED,z||V),ve=a(i.traceId128BitGenerationEnabled,process.env.DD_TRACE_128_BIT_TRACEID_GENERATION_ENABLED,!0),Se=a(i.traceId128BitLoggingEnabled,process.env.DD_TRACE_128_BIT_TRACEID_LOGGING_ENABLED,!1);let qe=null!=i.appsec?i.appsec:i.experimental&&i.experimental.appsec;"boolean"==typeof qe?qe={enabled:qe}:null==qe&&(qe={});const Ee=a(qe.enabled,process.env.DD_APPSEC_ENABLED&&c(process.env.DD_APPSEC_ENABLED)),Re=a(qe.rules,process.env.DD_APPSEC_RULES),Te=a(parseInt(qe.rateLimit),parseInt(process.env.DD_APPSEC_TRACE_RATE_LIMIT),100),Ae=a(parseInt(qe.wafTimeout),parseInt(process.env.DD_APPSEC_WAF_TIMEOUT),5e3),we=a(qe.obfuscatorKeyRegex,process.env.DD_APPSEC_OBFUSCATION_PARAMETER_KEY_REGEXP,"(?i)(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?)key)|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)|bearer|authorization"),xe=a(qe.obfuscatorValueRegex,process.env.DD_APPSEC_OBFUSCATION_PARAMETER_VALUE_REGEXP,'(?i)(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?|access_?|secret_?)key(?:_?id)?|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)?|auth(?:entication|orization)?)(?:\\s*=[^;]|"\\s*:\\s*"[^"]+")|bearer\\s+[a-z0-9\\._\\-]+|token:[a-z0-9]{13}|gh[opsu]_[0-9a-zA-Z]{36}|ey[I-L][\\w=-]+\\.ey[I-L][\\w=-]+(?:\\.[\\w.+\\/=-]+)?|[\\-]{5}BEGIN[a-z\\s]+PRIVATE\\sKEY[\\-]{5}[^\\-]+[\\-]{5}END[a-z\\s]+PRIVATE\\sKEY|ssh-rsa\\s*[a-z0-9\\/\\.+]{100,}'),Ie=a(y(qe.blockedTemplateHtml),y(process.env.DD_APPSEC_HTTP_BLOCKED_TEMPLATE_HTML)),Ce=a(y(qe.blockedTemplateJson),y(process.env.DD_APPSEC_HTTP_BLOCKED_TEMPLATE_JSON)),Oe=a(y(qe.blockedTemplateGraphql),y(process.env.DD_APPSEC_GRAPHQL_BLOCKED_TEMPLATE_JSON)),$e=a(qe.eventTracking&&qe.eventTracking.mode,process.env.DD_APPSEC_AUTOMATED_USER_EVENTS_TRACKING,"safe").toLowerCase(),ke=a(qe?.apiSecurity?.enabled,process.env.DD_API_SECURITY_ENABLED&&c(process.env.DD_API_SECURITY_ENABLED),process.env.DD_EXPERIMENTAL_API_SECURITY_ENABLED&&c(process.env.DD_EXPERIMENTAL_API_SECURITY_ENABLED),!0),Pe=a(qe?.apiSecurity?.requestSampling,parseFloat(process.env.DD_API_SECURITY_REQUEST_SAMPLE_RATE),.1),Ne=i.remoteConfig||{},Le=a(process.env.DD_REMOTE_CONFIGURATION_ENABLED&&c(process.env.DD_REMOTE_CONFIGURATION_ENABLED),!H),Me=a(parseFloat(Ne.pollInterval),parseFloat(process.env.DD_REMOTE_CONFIG_POLL_INTERVAL_SECONDS),5),De=i?.experimental?.iast,je=a(De&&(!0===De||!0===De.enabled),process.env.DD_IAST_ENABLED,!1),Ue=a(process.env.DD_TELEMETRY_LOG_COLLECTION_ENABLED,je),Be=a(process.env.DD_TELEMETRY_DEPENDENCY_COLLECTION_ENABLED,!0),Ge=a(parseInt(De?.requestSampling),parseInt(process.env.DD_IAST_REQUEST_SAMPLING),30),Fe=Ge<0||Ge>100?30:Ge,ze=a(parseInt(De?.maxConcurrentRequests),parseInt(process.env.DD_IAST_MAX_CONCURRENT_REQUESTS),2),Ve=a(parseInt(De?.maxContextOperations),parseInt(process.env.DD_IAST_MAX_CONTEXT_OPERATIONS),2),He=a(De?.deduplicationEnabled,process.env.DD_IAST_DEDUPLICATION_ENABLED&&c(process.env.DD_IAST_DEDUPLICATION_ENABLED),!0),We=a(De?.redactionEnabled,!u(process.env.DD_IAST_REDACTION_ENABLED),!0),Ke=a(De?.redactionNamePattern,process.env.DD_IAST_REDACTION_NAME_PATTERN,null),Ye=a(De?.redactionValuePattern,process.env.DD_IAST_REDACTION_VALUE_PATTERN,null),Je=a(De?.telemetryVerbosity,process.env.DD_IAST_TELEMETRY_VERBOSITY,"INFORMATION"),Xe=a(process.env.DD_CIVISIBILITY_GIT_UPLOAD_ENABLED,!0),Qe=a(process.env.DD_TRACE_GIT_METADATA_ENABLED,!0),Ze=a(process.env.DD_TRACE_SPAN_LEAK_DEBUG,0),et=a(process.env.DD_INSTRUMENTATION_INSTALL_ID,null),tt=a(process.env.DD_INSTRUMENTATION_INSTALL_TIME,null),rt=a(process.env.DD_INSTRUMENTATION_INSTALL_TYPE,null),st=i.ingestion||{},nt=a(i.dogstatsd,{}),it={rateLimit:a(i.rateLimit,process.env.DD_TRACE_RATE_LIMIT,st.rateLimit),rules:a(i.samplingRules,v(process.env.DD_TRACE_SAMPLING_RULES),[]).map((e=>E(e,{sample_rate:"sampleRate"}))),spanSamplingRules:a(i.spanSamplingRules,v(y(process.env.DD_SPAN_SAMPLING_RULES_FILE)),v(process.env.DD_SPAN_SAMPLING_RULES),[]).map((e=>E(e,{sample_rate:"sampleRate",max_per_second:"maxPerSecond"})))},at=F?0:2e3;if(this.dbmPropagationMode=x,this.dsmEnabled=c(I),this.openAiLogsEnabled=B,this.apiKey=G,this.url=P?new s(P):function(r,n){if(r)return new s(r);if("Windows_NT"===t.type())return;if(!n.hostname&&!n.port&&!process.env.DD_AGENT_HOST&&!process.env.DD_TRACE_AGENT_HOSTNAME&&!process.env.DD_TRACE_AGENT_PORT&&e.existsSync("/var/run/datadog/apm.socket"))return new s("unix:///var/run/datadog/apm.socket")}($,i),this.site=a(i.site,process.env.DD_SITE,"datadoghq.com"),this.hostname=C||this.url&&this.url.hostname,this.port=String(O||this.url&&this.url.port),this.flushInterval=a(parseInt(i.flushInterval,10),at),this.flushMinSpans=Z,this.queryStringObfuscation=ee,this.clientIpEnabled=te,this.clientIpHeader=re,this.plugins=!!a(i.plugins,!0),this.serviceMapping=j,this.dogstatsd={hostname:a(nt.hostname,process.env.DD_DOGSTATSD_HOSTNAME,this.hostname),port:String(a(nt.port,process.env.DD_DOGSTATSD_PORT,8125))},this.runtimeMetrics=c(w),this.tracePropagationStyle={inject:ie,extract:ae},this.tracePropagationExtractFirst=c(oe),this.experimental={runtimeId:c(ce),exporter:ue,enableGetRumData:c(le)},this.sampler=it,this.reportHostname=c(a(i.reportHostname,process.env.DD_TRACE_REPORT_HOSTNAME,!1)),this.scope=process.env.DD_TRACE_SCOPE,this.profiling={enabled:c(f),sourceMap:!u(A),exporters:T},this.spanAttributeSchema=pe,this.spanComputePeerService=me,this.spanRemoveIntegrationFromService=_e,this.peerServiceMapping=he,this.lookup=i.lookup,this.startupLogs=c(U),this.telemetry={enabled:c(W),heartbeatInterval:K,debug:c(J),logCollection:c(Ue),metrics:c(X),dependencyCollection:Be},this.protocolVersion=Q,this.tagsHeaderMaxLength=parseInt(be),this.appsec={enabled:Ee,rules:Re,customRulesProvided:!!Re,rateLimit:Te,wafTimeout:Ae,obfuscatorKeyRegex:we,obfuscatorValueRegex:xe,blockedTemplateHtml:Ie,blockedTemplateJson:Ce,blockedTemplateGraphql:Oe,eventTracking:{enabled:["extended","safe"].includes($e),mode:$e},apiSecurity:{enabled:ke,requestSampling:Math.min(1,Math.max(0,Pe))}},this.remoteConfig={enabled:Le,pollInterval:Me},this.iast={enabled:c(je),requestSampling:Fe,maxConcurrentRequests:ze,maxContextOperations:Ve,deduplicationEnabled:He,redactionEnabled:We,redactionNamePattern:Ke,redactionValuePattern:Ye,telemetryVerbosity:Je},this.isCiVisibility=c(k),this.isIntelligentTestRunnerEnabled=this.isCiVisibility&&c(N),this.isGitUploadEnabled=this.isCiVisibility&&this.isIntelligentTestRunnerEnabled&&!u(Xe),this.gitMetadataEnabled=c(Qe),this.isManualApiEnabled=this.isCiVisibility&&c(L),this.isEarlyFlakeDetectionEnabled=this.isCiVisibility&&c(M),this.openaiSpanCharLimit=Y,this.memcachedCommandEnabled=c(D),this.stats={enabled:c(ye)},this.traceId128BitGenerationEnabled=c(ve),this.traceId128BitLoggingEnabled=c(Se),this.isGCPFunction=z,this.isAzureFunctionConsumptionPlan=V,this.spanLeakDebug=Number(Ze),this.installSignature={id:et,time:tt,type:rt},this._applyDefaults(),this._applyEnvironment(),this._applyOptions(i),this._applyRemote({}),this._merge(),o.add(this.tags,{service:this.service,env:this.env,version:this.version,"runtime-id":r()}),this.isCiVisibility&&o.add(this.tags,{[_]:"ciapp-test"}),this.gitMetadataEnabled&&(this.repositoryUrl=h(a(process.env.DD_GIT_REPOSITORY_URL,this.tags[l])),this.commitSHA=a(process.env.DD_GIT_COMMIT_SHA,this.tags[p]),!this.repositoryUrl||!this.commitSHA)){const t=a(process.env.DD_GIT_PROPERTIES_FILE,`${process.cwd()}/git.properties`);let r;try{r=e.readFileSync(t,"utf8")}catch(e){process.env.DD_GIT_PROPERTIES_FILE&&n.error(e)}if(r){const{commitSHA:e,repositoryUrl:t}=d(r);this.commitSHA=this.commitSHA||e,this.repositoryUrl=this.repositoryUrl||t}}}configure(e,t){t?this._applyRemote(e):this._applyOptions(e),this._merge()}_applyDefaults(){const{AWS_LAMBDA_FUNCTION_NAME:e,FUNCTION_NAME:t,K_SERVICE:r,WEBSITE_SITE_NAME:s}=process.env,n=e||t||r||s||i.name||"node",a=this._defaults={};this._setValue(a,"service",n),this._setValue(a,"env",void 0),this._setValue(a,"version",i.version),this._setUnit(a,"sampleRate",void 0),this._setBoolean(a,"logInjection",!1),this._setArray(a,"headerTags",[]),this._setValue(a,"tags",{}),this._setBoolean(a,"tracing",!0)}_applyEnvironment(){const{DD_ENV:e,DD_LOGS_INJECTION:t,DD_SERVICE:r,DD_SERVICE_NAME:s,DD_TAGS:n,DD_TRACE_GLOBAL_TAGS:i,DD_TRACE_HEADER_TAGS:a,DD_TRACE_SAMPLE_RATE:c,DD_TRACE_TAGS:u,DD_TRACING_ENABLED:l,DD_VERSION:p}=process.env,d={},h=this._env={};o.add(d,n),o.add(d,u),o.add(d,i),this._setString(h,"service",r||s||d.service),this._setString(h,"env",e||d.env),this._setString(h,"version",p||d.version),this._setUnit(h,"sampleRate",c),this._setBoolean(h,"logInjection",t),this._setArray(h,"headerTags",a),this._setTags(h,"tags",d),this._setBoolean(h,"tracing",l)}_applyOptions(e){const t=this._options=this._options||{},r={};e=Object.assign({ingestion:{}},e,t),o.add(r,e.tags),this._setString(t,"service",e.service||r.service),this._setString(t,"env",e.env||r.env),this._setString(t,"version",e.version||r.version),this._setUnit(t,"sampleRate",a(e.sampleRate,e.ingestion.sampleRate)),this._setBoolean(t,"logInjection",e.logInjection),this._setArray(t,"headerTags",e.headerTags),this._setTags(t,"tags",r)}_applyRemote(e){const t=this._remote=this._remote||{},r={},s=e.tracing_header_tags?e.tracing_header_tags.map((e=>e.tag_name?`${e.header}:${e.tag_name}`:e.header)):void 0;o.add(r,e.tracing_tags),this._setUnit(t,"sampleRate",e.tracing_sampling_rate),this._setBoolean(t,"logInjection",e.log_injection_enabled),this._setArray(t,"headerTags",s),this._setTags(t,"tags",r),this._setBoolean(t,"tracing",e.tracing_enabled)}_setBoolean(e,t,r){null==r?this._setValue(e,t,r):c(r)?this._setValue(e,t,!0):u(r)&&this._setValue(e,t,!1)}_setUnit(e,t,r){if(null==r)return this._setValue(e,t,r);r=parseFloat(r),isNaN(r)||this._setValue(e,t,Math.min(Math.max(r,0),1))}_setArray(e,t,r){if(null==r)return this._setValue(e,t,null);"string"==typeof r&&(r=r&&r.split(",")),Array.isArray(r)&&this._setValue(e,t,r)}_setString(e,t,r){e[t]=r||void 0}_setTags(e,t,r){if(!r||0===Object.keys(r).length)return this._setValue(e,t,null);this._setValue(e,t,r)}_setValue(e,t,r){e[t]=r}_merge(){const e=[this._remote,this._options,this._env,this._defaults],t=["remote_config","code","env_var","default"],r=[];for(const s in this._defaults)for(let n=0;n<e.length;n++){const i=e[n],a=t[n];if(null!==i[s]&&void 0!==i[s]||i===this._defaults){if(this[s]===i[s]&&this.hasOwnProperty(s))break;const e=this[s]=i[s];r.push({name:s,value:e,origin:a});break}}this.sampler.sampleRate=this.sampleRate,f(r,this)}},config$1}function requirePlugin$1(){if(hasRequiredPlugin$1)return plugin$1;hasRequiredPlugin$1=1;const e=requireDcPolyfill(),{storage:t}=requireDatadogCore();class r{constructor(r,s){this._channel=e.channel(r),this._handler=(e,r)=>{const n=t.getStore();n&&n.noop||s(e,r)}}enable(){this._channel.subscribe(this._handler)}disable(){this._channel.unsubscribe(this._handler)}}class s{constructor(r,s){this._channel=e.channel(r),this._transform=e=>{const r=t.getStore();return r&&r.noop?r:s(e)}}enable(){this._channel.bindStore(t,this._transform)}disable(){this._channel.unbindStore(t,this._transform)}}return plugin$1=class{constructor(e,t){this._subscriptions=[],this._bindings=[],this._enabled=!1,this._tracer=e,this.config={},this._tracerConfig=t}get tracer(){return this._tracer._tracer}enter(e,r){r=r||t.getStore(),t.enterWith({...r,span:e})}skip(){t.enterWith({noop:!0})}addSub(e,t){this._subscriptions.push(new r(e,t))}addBind(e,t){this._bindings.push(new s(e,t))}addError(e){const r=t.getStore();r&&r.span&&(r.span._spanContext._tags.error||r.span.setTag("error",e||1))}configure(e){"boolean"==typeof e&&(e={enabled:e}),this.config=e,e.enabled&&!this._enabled?(this._enabled=!0,this._subscriptions.forEach((e=>e.enable())),this._bindings.forEach((e=>e.enable()))):!e.enabled&&this._enabled&&(this._enabled=!1,this._subscriptions.forEach((e=>e.disable())),this._bindings.forEach((e=>e.disable())))}},plugin$1}dependencies.exports;var services$1={},analytics_sampler,hasRequiredAnalytics_sampler,definition,hasRequiredDefinition,util$c,hasRequiredUtil$6,messaging_1$1,hasRequiredMessaging$1,storage_1$1,hasRequiredStorage$2,graphql_1$1,hasRequiredGraphql$3,web_1$2,hasRequiredWeb$2,v0,hasRequiredV0,messaging_1,hasRequiredMessaging,storage_1,hasRequiredStorage$1,graphql_1,hasRequiredGraphql$2,web_1$1,hasRequiredWeb$1,v1,hasRequiredV1,schemas,hasRequiredSchemas,serviceNaming,hasRequiredServiceNaming,tracing,hasRequiredTracing,outbound,hasRequiredOutbound,client$a,hasRequiredClient$a,base,hasRequiredBase,cloudwatchlogs,hasRequiredCloudwatchlogs,dynamodb,hasRequiredDynamodb,eventbridge,hasRequiredEventbridge,kinesis,hasRequiredKinesis,lambda$1,hasRequiredLambda$1,redshift,hasRequiredRedshift,s3,hasRequiredS3,sns,hasRequiredSns,sqs,hasRequiredSqs,_default,hasRequired_default,hasRequiredServices$1,src$S,hasRequiredSrc$S,ci_plugin,hasRequiredCi_plugin,src$R,hasRequiredSrc$R,src$Q,hasRequiredSrc$Q,storage,hasRequiredStorage,database,hasRequiredDatabase,src$P,hasRequiredSrc$P,producer$5,hasRequiredProducer$5,producer$4,hasRequiredProducer$4,inbound,hasRequiredInbound,consumer$5,hasRequiredConsumer$5,consumer$4,hasRequiredConsumer$4,client$9,hasRequiredClient$9,composite,hasRequiredComposite,src$O,hasRequiredSrc$O,server$9,hasRequiredServer$9,util$b,hasRequiredUtil$5,server$8,hasRequiredServer$8,client$8,hasRequiredClient$8,src$N,hasRequiredSrc$N,uniq,hasRequiredUniq,urlfilter,hasRequiredUrlfilter;function requireAnalytics_sampler(){if(hasRequiredAnalytics_sampler)return analytics_sampler;hasRequiredAnalytics_sampler=1;const{MEASURED:e}=requireTags$2();return analytics_sampler={sample(t,r,s){"object"==typeof r?this.sample(t,r[t.context()._name],s):void 0!==r?t.setTag(e,!!r):s&&t.setTag(e,!0)}},analytics_sampler}function requireDefinition(){if(hasRequiredDefinition)return definition;hasRequiredDefinition=1;return definition=class{constructor(e){this.schema=e}getSchemaItem(e,t,r){const s=this.schema;if(s&&s[e]&&s[e][t]&&s[e][t][r])return s[e][t][r]}getOpName(e,t,r,s){return this.getSchemaItem(e,t,r).opName(s)}getServiceName(e,t,r,s){return this.getSchemaItem(e,t,r).serviceName(s)}},definition}function requireUtil$6(){if(hasRequiredUtil$6)return util$c;return hasRequiredUtil$6=1,util$c={identityService:function({tracerService:e}){return e},httpPluginClientService:function({tracerService:e,pluginConfig:t,sessionDetails:r}){return t.splitByDomain?function({host:e,port:t}){return[e,t].filter((e=>e)).join(":")}(r):t.service?t.service:e},awsServiceV0:function({tracerService:e,awsService:t}){return`${e}-aws-${t}`}}}function requireMessaging$1(){if(hasRequiredMessaging$1)return messaging_1$1;hasRequiredMessaging$1=1;const{identityService:e,awsServiceV0:t}=requireUtil$6();function r({tracerService:e}){return`${e}-amqp`}return messaging_1$1={producer:{amqplib:{opName:()=>"amqp.command",serviceName:r},amqp10:{opName:()=>"amqp.send",serviceName:r},"google-cloud-pubsub":{opName:()=>"pubsub.request",serviceName:({tracerService:e})=>`${e}-pubsub`},kafkajs:{opName:()=>"kafka.produce",serviceName:({tracerService:e})=>`${e}-kafka`},rhea:{opName:()=>"amqp.send",serviceName:({tracerService:e})=>`${e}-amqp-producer`},sqs:{opName:()=>"aws.request",serviceName:t},sns:{opName:()=>"aws.request",serviceName:t}},consumer:{amqplib:{opName:()=>"amqp.command",serviceName:r},amqp10:{opName:()=>"amqp.receive",serviceName:r},"google-cloud-pubsub":{opName:()=>"pubsub.receive",serviceName:e},kafkajs:{opName:()=>"kafka.consume",serviceName:({tracerService:e})=>`${e}-kafka`},rhea:{opName:()=>"amqp.receive",serviceName:e},sqs:{opName:()=>"aws.request",serviceName:t}},client:{amqplib:{opName:()=>"amqp.command",serviceName:r},"google-cloud-pubsub":{opName:()=>"pubsub.request",serviceName:({tracerService:e})=>`${e}-pubsub`}}}}function requireStorage$2(){if(hasRequiredStorage$2)return storage_1$1;function e(e,t){return t?`${e}-${t}`:void 0}function t({tracerService:t,pluginConfig:r,dbConfig:s,system:n}){return"function"==typeof r.service?r.service(s):r.service||e(t,n)}function r(e){return({tracerService:t,pluginConfig:r,params:s})=>"function"==typeof r.service?r.service(s):r.service||`${t}-${e}`}hasRequiredStorage$2=1;const s={opName:()=>"redis.command",serviceName:({tracerService:t,pluginConfig:r,system:s,connectionName:n})=>function(e,t){return e.splitByInstance&&t?e.service?`${e.service}-${t}`:t:e.service}(r,n)||e(t,s)},n={client:{aerospike:{opName:()=>"aerospike.command",serviceName:({tracerService:e,pluginConfig:t})=>t.service||`${e}-aerospike`},"cassandra-driver":{opName:()=>"cassandra.query",serviceName:({tracerService:t,pluginConfig:r,system:s})=>r.service||e(t,s)},couchbase:{opName:({operation:e})=>`couchbase.${e}`,serviceName:({tracerService:e,pluginConfig:t})=>t.service||`${e}-couchbase`},elasticsearch:{opName:()=>"elasticsearch.query",serviceName:({tracerService:e,pluginConfig:t})=>t.service||`${e}-elasticsearch`},ioredis:s,mariadb:{opName:()=>"mariadb.query",serviceName:t},memcached:{opName:()=>"memcached.command",serviceName:({tracerService:t,pluginConfig:r,system:s})=>r.service||e(t,s)},"mongodb-core":{opName:()=>"mongodb.query",serviceName:({tracerService:e,pluginConfig:t})=>t.service||`${e}-mongodb`},mysql:{opName:()=>"mysql.query",serviceName:t},mysql2:{opName:()=>"mysql.query",serviceName:t},opensearch:{opName:()=>"opensearch.query",serviceName:({tracerService:e,pluginConfig:t})=>t.service||`${e}-opensearch`},oracledb:{opName:()=>"oracle.query",serviceName:r("oracle")},pg:{opName:()=>"pg.query",serviceName:r("postgres")},redis:s,tedious:{opName:()=>"tedious.request",serviceName:({tracerService:t,pluginConfig:r,system:s})=>r.service||e(t,s)}}};return storage_1$1=n}function requireGraphql$3(){if(hasRequiredGraphql$3)return graphql_1$1;hasRequiredGraphql$3=1;const{identityService:e}=requireUtil$6();return graphql_1$1={server:{graphql:{opName:()=>"graphql.execute",serviceName:e}}}}function requireWeb$2(){if(hasRequiredWeb$2)return web_1$2;hasRequiredWeb$2=1;const{identityService:e,httpPluginClientService:t,awsServiceV0:r}=requireUtil$6(),{DD_MAJOR:s}=requireVersion();return web_1$2={client:{grpc:{opName:()=>s<=2?"grpc.request":"grpc.client",serviceName:e},moleculer:{opName:()=>"moleculer.call",serviceName:e},http:{opName:()=>"http.request",serviceName:t},fetch:{opName:()=>"http.request",serviceName:t},http2:{opName:()=>"http.request",serviceName:t},aws:{opName:()=>"aws.request",serviceName:r},lambda:{opName:()=>"aws.request",serviceName:r}},server:{grpc:{opName:()=>s<=2?"grpc.request":"grpc.server",serviceName:e},moleculer:{opName:()=>"moleculer.action",serviceName:e},http:{opName:()=>"web.request",serviceName:e},http2:{opName:()=>"web.request",serviceName:e},next:{opName:()=>"next.request",serviceName:e}}}}function requireV0(){if(hasRequiredV0)return v0;hasRequiredV0=1;const e=requireDefinition(),t=requireMessaging$1(),r=requireStorage$2(),s=requireGraphql$3(),n=requireWeb$2();return v0=new e({messaging:t,storage:r,web:n,graphql:s})}function requireMessaging(){if(hasRequiredMessaging)return messaging_1;hasRequiredMessaging=1;const{identityService:e}=requireUtil$6(),t={opName:()=>"amqp.process",serviceName:e},r={opName:()=>"amqp.send",serviceName:e};return messaging_1={producer:{amqplib:r,amqp10:r,"google-cloud-pubsub":{opName:()=>"gcp.pubsub.send",serviceName:e},kafkajs:{opName:()=>"kafka.send",serviceName:e},rhea:r,sqs:{opName:()=>"aws.sqs.send",serviceName:e},sns:{opName:()=>"aws.sns.send",serviceName:e}},consumer:{amqplib:t,amqp10:t,"google-cloud-pubsub":{opName:()=>"gcp.pubsub.process",serviceName:e},kafkajs:{opName:()=>"kafka.process",serviceName:e},rhea:t,sqs:{opName:()=>"aws.sqs.process",serviceName:e}},client:{amqplib:{opName:()=>"amqp.command",serviceName:e},"google-cloud-pubsub":{opName:()=>"gcp.pubsub.request",serviceName:e}}}}function requireStorage$1(){if(hasRequiredStorage$1)return storage_1;function e({tracerService:e,pluginConfig:t}){return t.service||e}hasRequiredStorage$1=1;const t={opName:()=>"redis.command",serviceName:e},r={opName:()=>"mysql.query",serviceName:s};function s({tracerService:t,pluginConfig:r,params:s}){return"function"==typeof r.service?r.service(s):e({tracerService:t,pluginConfig:r})}return storage_1={client:{aerospike:{opName:()=>"aerospike.command",serviceName:e},"cassandra-driver":{opName:()=>"cassandra.query",serviceName:e},couchbase:{opName:()=>"couchbase.query",serviceName:e},elasticsearch:{opName:()=>"elasticsearch.query",serviceName:e},ioredis:t,mariadb:{opName:()=>"mariadb.query",serviceName:s},memcached:{opName:()=>"memcached.command",serviceName:e},"mongodb-core":{opName:()=>"mongodb.query",serviceName:e},mysql:r,mysql2:r,opensearch:{opName:()=>"opensearch.query",serviceName:e},oracledb:{opName:()=>"oracle.query",serviceName:s},pg:{opName:()=>"postgresql.query",serviceName:s},redis:t,tedious:{opName:()=>"mssql.query",serviceName:e}}}}function requireGraphql$2(){if(hasRequiredGraphql$2)return graphql_1;hasRequiredGraphql$2=1;const{identityService:e}=requireUtil$6();return graphql_1={server:{graphql:{opName:()=>"graphql.server.request",serviceName:e}}}}function requireWeb$1(){if(hasRequiredWeb$1)return web_1$1;hasRequiredWeb$1=1;const{identityService:e,httpPluginClientService:t}=requireUtil$6();return web_1$1={client:{grpc:{opName:()=>"grpc.client.request",serviceName:e},moleculer:{opName:()=>"moleculer.client.request",serviceName:e},http:{opName:()=>"http.client.request",serviceName:t},fetch:{opName:()=>"http.client.request",serviceName:t},http2:{opName:()=>"http.client.request",serviceName:t},aws:{opName:({awsService:e})=>`aws.${e}.request`,serviceName:e},lambda:{opName:()=>"aws.lambda.invoke",serviceName:e}},server:{grpc:{opName:()=>"grpc.server.request",serviceName:e},moleculer:{opName:()=>"moleculer.server.request",serviceName:e},http:{opName:()=>"http.server.request",serviceName:e},http2:{opName:()=>"http.server.request",serviceName:e},next:{opName:()=>"http.server.request",serviceName:e}}}}function requireV1(){if(hasRequiredV1)return v1;hasRequiredV1=1;const e=requireDefinition(),t=requireMessaging(),r=requireStorage$1(),s=requireGraphql$2(),n=requireWeb$1();return v1=new e({messaging:t,storage:r,web:n,graphql:s})}function requireSchemas(){if(hasRequiredSchemas)return schemas;hasRequiredSchemas=1;const e=requireV0(),t=requireV1();return schemas={schemaDefinitions:{v0:e,v1:t}}}function requireServiceNaming(){if(hasRequiredServiceNaming)return serviceNaming;hasRequiredServiceNaming=1;const{schemaDefinitions:e}=requireSchemas();return serviceNaming=new class{constructor(){this.schemas=e,this.config={spanAttributeSchema:"v0",spanRemoveIntegrationFromService:!1}}get schema(){return this.schemas[this.version]}get version(){return this.config.spanAttributeSchema}get shouldUseConsistentServiceNaming(){return this.config.spanRemoveIntegrationFromService&&"v0"===this.version}opName(e,t,r,s){return this.schema.getOpName(e,t,r,s)}serviceName(e,t,r,s){return(this.shouldUseConsistentServiceNaming?this.schemas.v1:this.schema).getServiceName(e,t,r,{...s,tracerService:this.config.service})}configure(e={}){this.config=e}},serviceNaming}function requireTracing(){if(hasRequiredTracing)return tracing;hasRequiredTracing=1;const e=requirePlugin$1(),{storage:t}=requireDatadogCore(),r=requireAnalytics_sampler(),{COMPONENT:s}=requireConstants$2(),n=requireServiceNaming();return tracing=class extends e{constructor(...e){super(...e),this.component=this.constructor.component||this.constructor.id,this.operation=this.constructor.operation,this.addTraceSubs()}get activeSpan(){const e=t.getStore();return e&&e.span}serviceName(e={}){const{type:t=this.constructor.type,id:r=this.constructor.id,kind:s=this.constructor.kind}=e;return n.serviceName(t,s,r,e)}operationName(e={}){const{type:t=this.constructor.type,id:r=this.constructor.id,kind:s=this.constructor.kind}=e;return n.opName(t,s,r,e)}configure(e){return super.configure({...e,hooks:{[this.operation]:()=>{},...e.hooks}})}start(){}finish(){this.activeSpan?.finish()}error(e){this.addError(e)}addTraceSubs(){const e=["start","end","asyncStart","asyncEnd","error","finish"];for(const t of e){const e=`bind${t.charAt(0).toUpperCase()}${t.slice(1)}`;this[t]&&this.addTraceSub(t,(e=>{this[t](e)})),this[e]&&this.addTraceBind(t,(t=>this[e](t)))}}addTraceSub(e,t){const r=this.constructor.prefix||`apm:${this.component}:${this.operation}`;this.addSub(`${r}:${e}`,t)}addTraceBind(e,t){const r=this.constructor.prefix||`apm:${this.component}:${this.operation}`;this.addBind(`${r}:${e}`,t)}addError(e,t=this.activeSpan){t._spanContext._tags.error||(e=e&&e.error||e,t.setTag("error",e||1))}startSpan(e,{childOf:n,kind:i,meta:a,metrics:o,service:c,resource:u,type:l}={},p=!0){const d=t.getStore();d&&void 0===n&&(n=d.span);const h=this.tracer.startSpan(e,{childOf:n,tags:{[s]:this.component,"service.name":c||this.tracer._service,"resource.name":u,"span.kind":i,"span.type":l,...a,...o},integrationName:l});return r.sample(h,this.config.measured),p&&t.enterWith({...d,span:h}),h}},tracing}function requireOutbound(){if(hasRequiredOutbound)return outbound;hasRequiredOutbound=1;const{CLIENT_PORT_KEY:e,PEER_SERVICE_KEY:t,PEER_SERVICE_SOURCE_KEY:r,PEER_SERVICE_REMAP_KEY:s}=requireConstants$2(),n=requireTracing(),i=["net.peer.name","out.host"];return outbound=class extends n{static get peerServicePrecursors(){return[]}constructor(...e){super(...e),this.addTraceSub("connect",(e=>{this.connect(e)}))}getPeerService(e){if(void 0!==e[t])return{[t]:e[t],[r]:t};const s=[...this.constructor.peerServicePrecursors,...i];for(const n of s)if(e[n])return{[t]:e[n],[r]:n}}getPeerServiceRemap(e){const r=e[t],n=this._tracerConfig.peerServiceMapping?.[r];return r&&n?{...e,[t]:n,[s]:r}:e}finish(){this.tagPeerService(this.activeSpan),super.finish(...arguments)}tagPeerService(e){if(this._tracerConfig.spanComputePeerService){const t=this.getPeerService(e.context()._tags);void 0!==t&&e.addTags(this.getPeerServiceRemap(t))}}connect(e){this.addHost(e.hostname,e.port)}addHost(t,r){const s=this.activeSpan;s&&s.addTags({"out.host":t,[e]:r})}},outbound}function requireClient$a(){if(hasRequiredClient$a)return client$a;hasRequiredClient$a=1;const e=requireOutbound();return client$a=class extends e{static get operation(){return"request"}static get kind(){return"client"}static get type(){return"web"}}}function requireBase(){if(hasRequiredBase)return base;hasRequiredBase=1;const e=requireAnalytics_sampler(),t=requireClient$a(),{storage:r}=requireDatadogCore(),{isTrue:s}=requireUtil$9();return base=class extends t{static get id(){return"aws"}get serviceIdentifier(){const e=this.constructor.id.toLowerCase();return Object.defineProperty(this,"serviceIdentifier",{configurable:!0,writable:!0,enumerable:!0,value:e}),e}constructor(...t){super(...t),this.addSub(`apm:aws:request:start:${this.serviceIdentifier}`,(({request:t,operation:s,awsRegion:n,awsService:i})=>{if(!this.isEnabled(t))return;const a=this.tracer.scope().active(),o={"span.kind":"client","service.name":this.serviceName(),"aws.operation":s,"aws.region":n,region:n,aws_service:i,"aws.service":i,component:"aws-sdk"};this.requestTags&&this.requestTags.set(t,o);const c=this.tracer.startSpan(this.operationFromRequest(t),{childOf:a,tags:o});e.sample(c,this.config.measured),this.requestInject(c,t);const u=r.getStore();this.enter(c,u)})),this.addSub(`apm:aws:request:region:${this.serviceIdentifier}`,(e=>{const t=r.getStore();if(!t)return;const{span:s}=t;s&&(s.setTag("aws.region",e),s.setTag("region",e))})),this.addSub(`apm:aws:request:complete:${this.serviceIdentifier}`,(({response:e})=>{const t=r.getStore();if(!t)return;const{span:s}=t;s&&(this.addResponseTags(s,e),this.finish(s,e,e.error))}))}requestInject(e,t){}operationFromRequest(e){return this.operationName({id:"aws",type:"web",kind:"client",awsService:this.serviceIdentifier})}serviceName(){return this.config.service||super.serviceName({id:"aws",type:"web",kind:"client",awsService:this.serviceIdentifier})}isEnabled(e){const t=this.serviceIdentifier.toUpperCase(),r=process.env[`DD_TRACE_AWS_SDK_${t}_ENABLED`];return!r||s(r)}addResponseTags(e,t){if(!e||!t.request)return;const r=t.request.params,s=t.request.operation,n=this.generateTags(r,s,t)||{},i=Object.assign({"aws.response.request_id":t.requestId,"resource.name":s,"span.kind":"client"},n);e.addTags(i)}generateTags(){}finish(e,t,r){r&&(e.setTag("error",r),r.requestId&&e.addTags({"aws.response.request_id":r.requestId})),t&&this.config.hooks.request(e,t),super.finish()}configure(e){super.configure(function(e,t){const r=function(e){const t=()=>{},r=e.hooks&&e.hooks.request||t;return{request:r}}(e);let s=e[t];switch(typeof s){case"undefined":s={};break;case"boolean":s={enabled:s}}return Object.assign({},e,s,{splitByAwsService:!1!==e.splitByAwsService,hooks:r})}(e,this.serviceIdentifier))}},base}function requireCloudwatchlogs(){if(hasRequiredCloudwatchlogs)return cloudwatchlogs;hasRequiredCloudwatchlogs=1;const e=requireBase();return cloudwatchlogs=class extends e{static get id(){return"cloudwatchlogs"}generateTags(e,t){const r={};return e&&e.logGroupName?Object.assign(r,{"resource.name":`${t} ${e.logGroupName}`,"aws.cloudwatch.logs.log_group_name":e.logGroupName,loggroupname:e.logGroupName}):r}},cloudwatchlogs}function requireDynamodb(){if(hasRequiredDynamodb)return dynamodb;hasRequiredDynamodb=1;const e=requireBase();return dynamodb=class extends e{static get id(){return"dynamodb"}static get peerServicePrecursors(){return["tablename"]}generateTags(e,t,r){const s={};if(e&&(e.TableName&&Object.assign(s,{"resource.name":`${t} ${e.TableName}`,"aws.dynamodb.table_name":e.TableName,tablename:e.TableName}),e.RequestItems&&"object"==typeof e.RequestItems&&1===Object.keys(e.RequestItems).length)){const r=Object.keys(e.RequestItems)[0];Object.assign(s,{"resource.name":`${t} ${r}`,"aws.dynamodb.table_name":r,tablename:r})}return Object.assign(s,{"span.type":"dynamodb"}),s}},dynamodb}function requireEventbridge(){if(hasRequiredEventbridge)return eventbridge;hasRequiredEventbridge=1;const e=requireLog$2(),t=requireBase();return eventbridge=class extends t{static get id(){return"eventbridge"}generateTags(e,t,r){if(!e||!e.source)return{};const s=e.Name?e.Name:"";return{"resource.name":t?`${t} ${e.source}`:e.source,"aws.eventbridge.source":`${e.source}`,rulename:`${s}`}}requestInject(t,r){if("putEvents"===r.operation&&r.params&&r.params.Entries&&r.params.Entries.length>0&&r.params.Entries[0].Detail)try{const s=JSON.parse(r.params.Entries[0].Detail);s._datadog={},this.tracer.inject(t,"text_map",s._datadog);const n=JSON.stringify(s);if(Buffer.byteLength(n)>=262144)return void e.info("Payload size too large to pass context");r.params.Entries[0].Detail=n}catch(t){e.error(t)}}},eventbridge}function requireKinesis(){if(hasRequiredKinesis)return kinesis;hasRequiredKinesis=1;const{CONTEXT_PROPAGATION_KEY:e,getSizeOrZero:t}=requireProcessor(),{encodePathwayContext:r}=requirePathway(),s=requireLog$2(),n=requireBase(),{storage:i}=requireDatadogCore();return kinesis=class extends n{static get id(){return"kinesis"}static get peerServicePrecursors(){return["streamname"]}constructor(...e){super(...e),this.requestTags=new WeakMap,this.addSub("apm:aws:response:start:kinesis",(e=>{const{request:t,response:r}=e,s=i.getStore(),n=this;if("getShardIterator"!==t.operation&&"listShards"!==t.operation){if("getRecords"===t.operation){let a;const o=this.responseExtract(t.params,t.operation,r);if(o&&o.maybeChildOf){e.needsFinish=!0;const r={childOf:o.maybeChildOf,tags:Object.assign({},this.requestTags.get(t)||{},{"span.kind":"server"})};a=n.tracer.startSpan("aws.response",r),this.enter(a,s)}const{streamName:c}=i.getStore();this.responseExtractDSMContext(t.operation,r,a??null,c)}}else this.storeStreamName(t.params,t.operation,s)})),this.addSub("apm:aws:response:finish:kinesis",(e=>{const{span:t}=i.getStore();this.finish(t,null,e)}))}generateTags(e,t,r){return e&&e.StreamName?{"resource.name":`${t} ${e.StreamName}`,"aws.kinesis.stream_name":e.StreamName,streamname:e.StreamName}:{}}storeStreamName(e,t,r){if(!t||"getShardIterator"!==t&&"listShards"!==t)return;if(!e||!e.StreamName)return;const s=e.StreamName;i.enterWith({...r,streamName:s})}responseExtract(e,t,r){if("getRecords"!==t)return;if(e.Limit&&1!==e.Limit)return;if(!r||!r.Records||!r.Records[0])return;const n=r.Records[0];try{const e=JSON.parse(Buffer.from(n.Data).toString());return{maybeChildOf:this.tracer.extract("text_map",e._datadog),parsedAttributes:e._datadog}}catch(e){s.error(e)}}responseExtractDSMContext(r,s,n,i){this.config.dsmEnabled&&"getRecords"===r&&s&&s.Records&&s.Records[0]&&(n=s.Records.length>1?null:n,s.Records.forEach((r=>{const s=JSON.parse(Buffer.from(r.Data).toString());if(s&&s._datadog&&s._datadog[e]&&i){const a=t(r.Data);this.tracer.decodeDataStreamsContext(Buffer.from(s._datadog[e])),this.tracer.setCheckpoint(["direction:in",`topic:${i}`,"type:kinesis"],n,a)}})))}_tryParse(e){try{return JSON.parse(e)}catch(e){s.info("Not JSON string. Trying Base64 encoded JSON string")}try{return JSON.parse(Buffer.from(e,"base64").toString("ascii"),!0)}catch(e){return null}}requestInject(t,n){const i=n.operation;if("putRecord"===i||"putRecords"===i){if(!n.params)return;const i={};let a;if(this.tracer.inject(t,"text_map",i),n.params.Records&&n.params.Records.length>0)a=n.params.Records[0];else{if(!n.params.Data)return void s.error("No valid payload passed, unable to pass trace context");a=n.params}const o=this._tryParse(a.Data);if(o){if(o._datadog=i,this.config.dsmEnabled){const s=Buffer.from(JSON.stringify(o)).byteLength;let i;n.params&&n.params.StreamArn?i=n.params.StreamArn:n.params&&n.params.StreamName&&(i=n.params.StreamName);const a=this.tracer.setCheckpoint(["direction:out",`topic:${i}`,"type:kinesis"],t,s);if(a){const t=r(a);o._datadog[e]=t.toJSON()}}const c=Buffer.from(JSON.stringify(o));if(c.length>=1048576)return void s.info("Payload size too large to pass context");a.Data=c}else s.error("Unable to parse payload, unable to pass trace context")}}},kinesis}function requireLambda$1(){if(hasRequiredLambda$1)return lambda$1;hasRequiredLambda$1=1;const e=requireLog$2(),t=requireBase();return lambda$1=class extends t{static get id(){return"lambda"}generateTags(e,t,r){const s={};return e&&e.FunctionName?Object.assign(s,{"resource.name":`${t} ${e.FunctionName}`,functionname:e.FunctionName,"aws.lambda":e.FunctionName}):s}requestInject(t,r){if("invoke"===r.operation){r.params||(r.params={});if(!r.params.InvocationType||"RequestResponse"===r.params.InvocationType)try{let e={};if(r.params.ClientContext){const t=Buffer.from(r.params.ClientContext,"base64").toString("utf-8");e=JSON.parse(t)}e.custom||(e.custom={}),this.tracer.inject(t,"text_map",e.custom);const s=Buffer.from(JSON.stringify(e)).toString("base64");r.params.ClientContext=s}catch(t){e.error(t)}}}operationFromRequest(e){return"invoke"===e.operation?this.operationName({type:"web",kind:"client"}):this.operationName({id:"aws",type:"web",kind:"client",awsService:"lambda"})}},lambda$1}function requireRedshift(){if(hasRequiredRedshift)return redshift;hasRequiredRedshift=1;const e=requireBase();return redshift=class extends e{static get id(){return"redshift"}generateTags(e,t,r){const s={};return e&&e.ClusterIdentifier?Object.assign(s,{"resource.name":`${t} ${e.ClusterIdentifier}`,"aws.redshift.cluster_identifier":e.ClusterIdentifier,clusteridentifier:e.ClusterIdentifier}):s}},redshift}function requireS3(){if(hasRequiredS3)return s3;hasRequiredS3=1;const e=requireBase();return s3=class extends e{static get id(){return"s3"}static get peerServicePrecursors(){return["bucketname"]}generateTags(e,t,r){const s={};return e&&e.Bucket?Object.assign(s,{"resource.name":`${t} ${e.Bucket}`,"aws.s3.bucket_name":e.Bucket,bucketname:e.Bucket}):s}},s3}function requireSns(){if(hasRequiredSns)return sns;hasRequiredSns=1;const{CONTEXT_PROPAGATION_KEY:e,getHeadersSize:t}=requireProcessor(),{encodePathwayContext:r}=requirePathway(),s=requireLog$2(),n=requireBase();return sns=class extends n{static get id(){return"sns"}static get peerServicePrecursors(){return["topicname"]}generateTags(e,t,r){if(!e)return{};if(!(e.TopicArn||r.data&&r.data.TopicArn))return{};const s=e.TopicArn||r.data.TopicArn,n=s.split(":"),i=n[n.length-1];return{"resource.name":`${t} ${e.TopicArn||r.data.TopicArn}`,"aws.sns.topic_arn":s,topicname:i}}operationFromRequest(e){switch(e.operation){case"publish":case"publishBatch":return this.operationName({type:"messaging",kind:"producer"})}return this.operationName({id:"aws",type:"web",kind:"client",awsService:"sns"})}requestInject(e,t){const{operation:r,params:s}=t;if(s)switch(r){case"publish":this._injectMessageAttributes(e,s);break;case"publishBatch":s.PublishBatchRequestEntries&&s.PublishBatchRequestEntries.length>0&&this._injectMessageAttributes(e,s.PublishBatchRequestEntries[0])}}_injectMessageAttributes(n,i){if(i.MessageAttributes||(i.MessageAttributes={}),Object.keys(i.MessageAttributes).length>=10)return void s.info("Message attributes full, skipping trace context injection");const a={};if(this.tracer.inject(n,"text_map",a),i.MessageAttributes._datadog={DataType:"Binary",BinaryValue:a},this.config.dsmEnabled){const s=t({Message:i.Message,MessageAttributes:i.MessageAttributes}),o=this.tracer.setCheckpoint(["direction:out",`topic:${i.TopicArn}`,"type:sns"],n,s);if(o){const t=r(o);a[e]=t.toJSON()}}i.MessageAttributes._datadog.BinaryValue=Buffer.from(JSON.stringify(a))}},sns}function requireSqs(){if(hasRequiredSqs)return sqs;hasRequiredSqs=1;const e=requireLog$2(),t=requireBase(),{storage:r}=requireDatadogCore(),{CONTEXT_PROPAGATION_KEY:s,getHeadersSize:n}=requireProcessor(),{encodePathwayContext:i}=requirePathway();return sqs=class extends t{static get id(){return"sqs"}static get peerServicePrecursors(){return["queuename"]}constructor(...e){super(...e),this.requestTags=new WeakMap,this.addSub("apm:aws:response:start:sqs",(e=>{const{request:t,response:s}=e,n=r.getStore(),i=this,a=this.responseExtract(t.params,t.operation,s);let o,c;if(a&&a.datadogContext){e.needsFinish=!0;const r={childOf:a.datadogContext,tags:Object.assign({},this.requestTags.get(t)||{},{"span.kind":"server"})};c=a.parsedAttributes,o=i.tracer.startSpan("aws.response",r),this.enter(o,n)}this.responseExtractDSMContext(t.operation,t.params,s,o??null,c??null)})),this.addSub("apm:aws:response:finish:sqs",(e=>{const{span:t}=r.getStore();this.finish(t,null,e)}))}operationFromRequest(e){switch(e.operation){case"receiveMessage":return this.operationName({type:"messaging",kind:"consumer"});case"sendMessage":case"sendMessageBatch":return this.operationName({type:"messaging",kind:"producer"})}return this.operationName({id:"aws",type:"web",kind:"client",awsService:"sqs"})}isEnabled(e){const t=this.config;switch(e.operation){case"receiveMessage":return!1!==t.consumer;case"sendMessage":case"sendMessageBatch":return!1!==t.producer;default:return!0}}generateTags(e,t,r){const s={};if(!e||!e.QueueName&&!e.QueueUrl)return s;let n=e.QueueName;switch(e.QueueUrl&&(n=e.QueueUrl.split("/")[e.QueueUrl.split("/").length-1]),Object.assign(s,{"resource.name":`${t} ${e.QueueName||e.QueueUrl}`,"aws.sqs.queue_name":e.QueueName||e.QueueUrl,queuename:n}),t){case"receiveMessage":s["span.type"]="worker",s["span.kind"]="consumer";break;case"sendMessage":case"sendMessageBatch":s["span.kind"]="producer"}return s}responseExtract(e,t,r){if("receiveMessage"!==t)return;if(e.MaxNumberOfMessages&&1!==e.MaxNumberOfMessages)return;if(!r||!r.Messages||!r.Messages[0])return;let s=r.Messages[0];if(s.Body)try{const e=JSON.parse(s.Body);"Notification"===e.Type&&(s=e)}catch(e){}if(!s.MessageAttributes||!s.MessageAttributes._datadog)return;const n=s.MessageAttributes._datadog,i=this.parseDatadogAttributes(n);return i?{datadogContext:this.tracer.extract("text_map",i),parsedAttributes:i}:void 0}parseDatadogAttributes(t){try{if(t.StringValue){const e=t.StringValue;return JSON.parse(e)}if("Binary"===t.Type){const e=Buffer.from(t.Value,"base64");return JSON.parse(e)}}catch(t){e.error(t)}}responseExtractDSMContext(e,t,r,i,a){this.config.dsmEnabled&&"receiveMessage"===e&&r&&r.Messages&&r.Messages[0]&&(i=r.Messages.length>1?null:i,r.Messages.forEach((e=>{if(!a){if(e.Body)try{const t=JSON.parse(e.Body);"Notification"===t.Type&&(e=t)}catch(e){}e.MessageAttributes&&e.MessageAttributes._datadog&&(a=this.parseDatadogAttributes(e.MessageAttributes._datadog))}if(a&&a[s]){const r=n({Body:e.Body,MessageAttributes:e.MessageAttributes}),o=t.QueueUrl.split("/").pop();this.tracer.decodeDataStreamsContext(Buffer.from(a[s])),this.tracer.setCheckpoint(["direction:in",`topic:${o}`,"type:sqs"],i,r)}})))}requestInject(e,t){if("sendMessage"===t.operation){if(t.params||(t.params={}),t.params.MessageAttributes){if(Object.keys(t.params.MessageAttributes).length>=10)return}else t.params.MessageAttributes={};const r={};if(this.tracer.inject(e,"text_map",r),t.params.MessageAttributes._datadog={DataType:"String",StringValue:JSON.stringify(r)},this.config.dsmEnabled){const a=n({Body:t.params.MessageBody,MessageAttributes:t.params.MessageAttributes}),o=t.params.QueueUrl.split("/").pop(),c=this.tracer.setCheckpoint(["direction:out",`topic:${o}`,"type:sqs"],e,a);if(c){const e=i(c);r[s]=e.toJSON()}}t.params.MessageAttributes._datadog.StringValue=JSON.stringify(r)}}},sqs}function require_default(){if(hasRequired_default)return _default;hasRequired_default=1;const e=requireBase();return _default=class extends e{}}function requireServices$1(){return hasRequiredServices$1||(hasRequiredServices$1=1,services$1.cloudwatchlogs=requireCloudwatchlogs(),services$1.dynamodb=requireDynamodb(),services$1.eventbridge=requireEventbridge(),services$1.kinesis=requireKinesis(),services$1.lambda=requireLambda$1(),services$1.redshift=requireRedshift(),services$1.s3=requireS3(),services$1.sns=requireSns(),services$1.sqs=requireSqs(),services$1.default=require_default()),services$1}function requireSrc$S(){if(hasRequiredSrc$S)return src$S;hasRequiredSrc$S=1;const e=requirePlugin$1(),t=requireServices$1();return src$S=class extends e{static get id(){return"aws-sdk"}constructor(...e){super(...e),this.services={};for(const r in t){const s=t[r];this.services[r]=new s(...e)}}configure(e){for(const t of Object.values(this.services))t.configure(e)}},src$S}function requireCi_plugin(){if(hasRequiredCi_plugin)return ci_plugin;hasRequiredCi_plugin=1;const{getTestEnvironmentMetadata:e,getCodeOwnersFileEntries:t,getTestParentSpan:r,getTestCommonTags:s,getCodeOwnersForFilename:n,TEST_CODE_OWNERS:i,CI_APP_ORIGIN:a,getTestSessionCommonTags:o,getTestModuleCommonTags:c,TEST_SUITE_ID:u,TEST_MODULE_ID:l,TEST_SESSION_ID:p,TEST_COMMAND:d,TEST_MODULE:h,getTestSuiteCommonTags:f,TEST_STATUS:g,TEST_SKIPPED_BY_ITR:m,ITR_CORRELATION_ID:_}=requireTest(),b=requirePlugin$1(),{COMPONENT:y}=requireConstants$2(),v=requireLog$2(),{incrementCountMetric:S,distributionMetric:q,TELEMETRY_EVENT_CREATED:E,TELEMETRY_ITR_SKIPPED:R}=requireTelemetry$3(),{CI_PROVIDER_NAME:T,GIT_REPOSITORY_URL:A,GIT_COMMIT_SHA:w,GIT_BRANCH:x,CI_WORKSPACE_PATH:I}=requireTags$1(),{OS_VERSION:C,OS_PLATFORM:O,OS_ARCHITECTURE:$,RUNTIME_NAME:k,RUNTIME_VERSION:P}=requireEnv();return ci_plugin=class extends b{constructor(...e){super(...e),this.rootDir=process.cwd(),this.addSub(`ci:${this.constructor.id}:library-configuration`,(({onDone:e})=>{if(!this.tracer._exporter||!this.tracer._exporter.getLibraryConfiguration)return e({err:new Error("CI Visibility was not initialized correctly")});this.tracer._exporter.getLibraryConfiguration(this.testConfiguration,((t,r)=>{t?v.error(`Intelligent Test Runner configuration could not be fetched. ${t.message}`):this.libraryConfig=r,e({err:t,libraryConfig:r})}))})),this.addSub(`ci:${this.constructor.id}:test-suite:skippable`,(({onDone:e})=>{if(!this.tracer._exporter?.getSkippableSuites)return e({err:new Error("CI Visibility was not initialized correctly")});this.tracer._exporter.getSkippableSuites(this.testConfiguration,((t,r,s)=>{t?v.error(`Skippable suites could not be fetched. ${t.message}`):this.itrCorrelationId=s,e({err:t,skippableSuites:r,itrCorrelationId:s})}))})),this.addSub(`ci:${this.constructor.id}:session:start`,(({command:e,frameworkVersion:t,rootDir:s})=>{const n=r(this.tracer),i=o(e,t,this.constructor.id),a=c(e,t,this.constructor.id);this.command=e,this.frameworkVersion=t,this.rootDir=s,this.testSessionSpan=this.tracer.startSpan(`${this.constructor.id}.test_session`,{childOf:n,tags:{[y]:this.constructor.id,...this.testEnvironmentMetadata,...i}}),this.telemetry.ciVisEvent(E,"session"),this.testModuleSpan=this.tracer.startSpan(`${this.constructor.id}.test_module`,{childOf:this.testSessionSpan,tags:{[y]:this.constructor.id,...this.testEnvironmentMetadata,...a}}),this.telemetry.ciVisEvent(E,"module")})),this.addSub(`ci:${this.constructor.id}:itr:skipped-suites`,(({skippedSuites:e,frameworkVersion:t})=>{const r=this.testSessionSpan.context()._tags[d];e.forEach((e=>{const s=f(r,t,e,this.constructor.id);this.itrCorrelationId&&(s[_]=this.itrCorrelationId),this.tracer.startSpan(`${this.constructor.id}.test_suite`,{childOf:this.testModuleSpan,tags:{[y]:this.constructor.id,...this.testEnvironmentMetadata,...s,[g]:"skip",[m]:"true"}}).finish()})),this.telemetry.count(R,{testLevel:"suite"},e.length)})),this.addSub(`ci:${this.constructor.id}:known-tests`,(({onDone:e})=>{if(!this.tracer._exporter?.getKnownTests)return e({err:new Error("CI Visibility was not initialized correctly")});this.tracer._exporter.getKnownTests(this.testConfiguration,((t,r)=>{t&&v.error(`Known tests could not be fetched. ${t.message}`),e({err:t,knownTests:r})}))}))}get telemetry(){const e=this.constructor.id;return{ciVisEvent:function(t,r,s={}){S(t,{testLevel:r,testFramework:e,isUnsupportedCIProvider:this.isUnsupportedCIProvider,...s})},count:function(e,t,r=1){S(e,t,r)},distribution:function(e,t,r){q(e,t,r)}}}configure(r){super.configure(r),this.testEnvironmentMetadata=e(this.constructor.id,this.config);const{[A]:s,[w]:n,[C]:i,[O]:a,[$]:o,[k]:c,[P]:u,[x]:l,[T]:p,[I]:d}=this.testEnvironmentMetadata;this.repositoryRoot=d||process.cwd(),this.codeOwnersEntries=t(d),this.isUnsupportedCIProvider=!p,this.testConfiguration={repositoryUrl:s,sha:n,osVersion:i,osPlatform:a,osArchitecture:o,runtimeName:c,runtimeVersion:u,branch:l,testLevel:"suite"}}startTestSpan(e,t,o,c={}){const f=r(this.tracer);let g={...s(e,t,this.frameworkVersion,this.constructor.id),[y]:this.constructor.id,...c};const m=n(t,this.codeOwnersEntries);if(m&&(g[i]=m),o){f._trace.startTime=o.context()._trace.startTime,f._trace.ticks=o.context()._trace.ticks;const e={[u]:o.context().toSpanId(),[p]:o.context().toTraceId(),[d]:o.context()._tags[d],[h]:this.constructor.id};o.context()._parentId&&(e[l]=o.context()._parentId.toString(10)),g={...g,...e}}this.telemetry.ciVisEvent(E,"test",{hasCodeOwners:!!m});const _=this.tracer.startSpan(`${this.constructor.id}.test`,{childOf:f,tags:{...this.testEnvironmentMetadata,...g}});return _.context()._trace.origin=a,_}},ci_plugin}function requireSrc$R(){if(hasRequiredSrc$R)return src$R;hasRequiredSrc$R=1;const e=requireCi_plugin(),{storage:t}=requireDatadogCore(),{TEST_SKIP_REASON:r,TEST_STATUS:s,TEST_SOURCE_START:n,finishAllTraceSpans:i,getTestSuitePath:a,getTestSuiteCommonTags:o,addIntelligentTestRunnerSpanTags:c,TEST_ITR_UNSKIPPABLE:u,TEST_ITR_FORCED_RUN:l,TEST_CODE_OWNERS:p,ITR_CORRELATION_ID:d,TEST_SOURCE_FILE:h}=requireTest(),{RESOURCE_NAME:f}=requireTags$2(),{COMPONENT:g,ERROR_MESSAGE:m}=requireConstants$2(),{TELEMETRY_EVENT_CREATED:_,TELEMETRY_EVENT_FINISHED:b,TELEMETRY_CODE_COVERAGE_STARTED:y,TELEMETRY_CODE_COVERAGE_FINISHED:v,TELEMETRY_ITR_FORCED_TO_RUN:S,TELEMETRY_CODE_COVERAGE_EMPTY:q,TELEMETRY_ITR_UNSKIPPABLE:E,TELEMETRY_CODE_COVERAGE_NUM_FILES:R}=requireTelemetry$3();return src$R=class extends e{static get id(){return"cucumber"}constructor(...e){super(...e),this.sourceRoot=process.cwd(),this.addSub("ci:cucumber:session:finish",(({status:e,isSuitesSkipped:t,numSkippedSuites:r,testCodeCoverageLinesTotal:n,hasUnskippableSuites:a,hasForcedToRunSuites:o})=>{const{isSuitesSkippingEnabled:u,isCodeCoverageEnabled:l}=this.libraryConfig||{};c(this.testSessionSpan,this.testModuleSpan,{isSuitesSkipped:t,isSuitesSkippingEnabled:u,isCodeCoverageEnabled:l,testCodeCoverageLinesTotal:n,skippingCount:r,skippingType:"suite",hasUnskippableSuites:a,hasForcedToRunSuites:o}),this.testSessionSpan.setTag(s,e),this.testModuleSpan.setTag(s,e),this.testModuleSpan.finish(),this.telemetry.ciVisEvent(b,"module"),this.testSessionSpan.finish(),this.telemetry.ciVisEvent(b,"session"),i(this.testSessionSpan),this.libraryConfig=null,this.tracer._exporter.flush()})),this.addSub("ci:cucumber:test-suite:start",(({testSuitePath:e,isUnskippable:t,isForcedToRun:r,itrCorrelationId:s})=>{const n=o(this.command,this.frameworkVersion,e,"cucumber");t&&(this.telemetry.count(E,{testLevel:"suite"}),n[u]="true"),r&&(this.telemetry.count(S,{testLevel:"suite"}),n[l]="true"),s&&(n[d]=s),this.testSuiteSpan=this.tracer.startSpan("cucumber.test_suite",{childOf:this.testModuleSpan,tags:{[g]:this.constructor.id,...this.testEnvironmentMetadata,...n}}),this.telemetry.ciVisEvent(_,"suite"),this.libraryConfig?.isCodeCoverageEnabled&&this.telemetry.ciVisEvent(y,"suite",{library:"istanbul"})})),this.addSub("ci:cucumber:test-suite:finish",(e=>{this.testSuiteSpan.setTag(s,e),this.testSuiteSpan.finish(),this.telemetry.ciVisEvent(b,"suite")})),this.addSub("ci:cucumber:test-suite:code-coverage",(({coverageFiles:e,suiteFile:t})=>{if(!this.libraryConfig?.isCodeCoverageEnabled)return;e.length||this.telemetry.count(q);const r=[...e,t].map((e=>a(e,this.repositoryRoot)));this.telemetry.distribution(R,{},r.length);const s={sessionId:this.testSuiteSpan.context()._traceId,suiteId:this.testSuiteSpan.context()._spanId,files:r};this.tracer._exporter.exportCoverage(s),this.telemetry.ciVisEvent(v,"suite",{library:"istanbul"})})),this.addSub("ci:cucumber:test:start",(({testName:e,testFileAbsolutePath:r,testSourceLine:s})=>{const n=t.getStore(),i=a(r,this.sourceRoot),o=a(r,this.repositoryRoot),c=this.startTestSpan(e,i,o,s);this.enter(c,n)})),this.addSub("ci:cucumber:test-step:start",(({resource:e})=>{const r=t.getStore(),s=r?r.span:r,n=this.tracer.startSpan("cucumber.step",{childOf:s,tags:{[g]:this.constructor.id,"cucumber.step":e,[f]:e}});this.enter(n,r)})),this.addSub("ci:cucumber:test:finish",(({isStep:e,status:n,skipReason:a,errorMessage:o})=>{const c=t.getStore().span,u=e?"step.status":s;c.setTag(u,n),a&&c.setTag(r,a),o&&c.setTag(m,o),c.finish(),e||(this.telemetry.ciVisEvent(b,"test",{hasCodeOwners:!!c.context()._tags[p]}),i(c))})),this.addSub("ci:cucumber:error",(e=>{if(e){t.getStore().span.setTag("error",e)}}))}startTestSpan(e,t,r,s){return super.startTestSpan(e,t,this.testSuiteSpan,{[n]:s,[h]:r})}},src$R}function requireSrc$Q(){if(hasRequiredSrc$Q)return src$Q;hasRequiredSrc$Q=1;const{storage:e}=requireDatadogCore(),t=requireCi_plugin(),{TEST_STATUS:r,finishAllTraceSpans:s,getTestSuitePath:n,getTestSuiteCommonTags:i,TEST_SOURCE_START:a,TEST_CODE_OWNERS:o,TEST_SOURCE_FILE:c,TEST_CONFIGURATION_BROWSER_NAME:u}=requireTest(),{RESOURCE_NAME:l}=requireTags$2(),{COMPONENT:p}=requireConstants$2(),{TELEMETRY_EVENT_CREATED:d,TELEMETRY_EVENT_FINISHED:h}=requireTelemetry$3(),{appClosing:f}=requireTelemetry$2();return src$Q=class extends t{static get id(){return"playwright"}constructor(...t){super(...t),this._testSuites=new Map,this.addSub("ci:playwright:session:finish",(({status:e,onDone:t})=>{this.testModuleSpan.setTag(r,e),this.testSessionSpan.setTag(r,e),this.testModuleSpan.finish(),this.telemetry.ciVisEvent(h,"module"),this.testSessionSpan.finish(),this.telemetry.ciVisEvent(h,"session"),s(this.testSessionSpan),f(),this.tracer._exporter.flush(t)})),this.addSub("ci:playwright:test-suite:start",(t=>{const r=e.getStore(),s=n(t,this.rootDir),a=i(this.command,this.frameworkVersion,s,"playwright"),o=this.tracer.startSpan("playwright.test_suite",{childOf:this.testModuleSpan,tags:{[p]:this.constructor.id,...this.testEnvironmentMetadata,...a}});this.telemetry.ciVisEvent(d,"suite"),this.enter(o,r),this._testSuites.set(s,o)})),this.addSub("ci:playwright:test-suite:finish",(t=>{const s=e.getStore(),n=s&&s.span;n&&(n.setTag(r,t),n.finish(),this.telemetry.ciVisEvent(h,"suite"))})),this.addSub("ci:playwright:test:start",(({testName:t,testSuiteAbsolutePath:r,testSourceLine:s,browserName:i})=>{const a=e.getStore(),o=n(r,this.rootDir),c=n(r,this.repositoryRoot),u=this.startTestSpan(t,o,c,s,i);this.enter(u,a)})),this.addSub("ci:playwright:test:finish",(({testStatus:t,steps:n,error:i,extraTags:a})=>{const c=e.getStore(),u=c&&c.span;u&&(u.setTag(r,t),i&&u.setTag("error",i),a&&u.addTags(a),n.forEach((e=>{const t=e.startTime.getTime(),r=this.tracer.startSpan("playwright.step",{childOf:u,startTime:t,tags:{[p]:this.constructor.id,"playwright.step":e.title,[l]:e.title}});e.error&&r.setTag("error",e.error),r.finish(t+e.duration)})),u.finish(),this.telemetry.ciVisEvent(h,"test",{hasCodeOwners:!!u.context()._tags[o]}),s(u))}))}startTestSpan(e,t,r,s,n){const i=this._testSuites.get(t),o={[a]:s};return r&&(o[c]=r||t),n&&(o[u]=n),super.startTestSpan(e,t,i,o)}},src$Q}function requireStorage(){if(hasRequiredStorage)return storage;hasRequiredStorage=1;const e=requireClient$a();return storage=class extends e{static get type(){return"storage"}constructor(...e){super(...e),this.system=this.constructor.system||this.component}startSpan(e,t){return!t.service&&this.system&&(t.service=`${this.tracer._service}-${this.system}`),super.startSpan(e,t)}},storage}function requireDatabase(){if(hasRequiredDatabase)return database;hasRequiredDatabase=1;const e=requireStorage(),{PEER_SERVICE_KEY:t}=requireConstants$2();return database=class extends e{static get operation(){return"query"}static get peerServicePrecursors(){return["db.name"]}constructor(...e){super(...e),this.serviceTags={dddbs:"",encodedDddbs:"",dde:"",encodedDde:"",ddps:"",encodedDdps:"",ddpv:"",encodedDdpv:""}}encodingServiceTags(e,t,r){e!==r&&(this.serviceTags[e]=r,this.serviceTags[t]=encodeURIComponent(r))}createDBMPropagationCommentService(e){this.encodingServiceTags("dddbs","encodedDddbs",e),this.encodingServiceTags("dde","encodedDde",this.tracer._env),this.encodingServiceTags("ddps","encodedDdps",this.tracer._service),this.encodingServiceTags("ddpv","encodedDdpv",this.tracer._version);const{encodedDddbs:t,encodedDde:r,encodedDdps:s,encodedDdpv:n}=this.serviceTags;return`dddbs='${t}',dde='${r}',ddps='${s}',ddpv='${n}'`}getDbmServiceName(e,r){if(this._tracerConfig.spanComputePeerService){const s=this.getPeerService(e.context()._tags);return this.getPeerServiceRemap(s)[t]||r}return r}injectDbmQuery(e,t,r,s=!1){const n=this.config.dbmPropagationMode,i=this.getDbmServiceName(e,r);if("disabled"===n)return t;const a=this.createDBMPropagationCommentService(i);if(s||"service"===n)return`/*${a}*/ ${t}`;if("full"===n){e.setTag("_dd.dbm_trace_injected","true");return`/*${a},traceparent='${e._spanContext.toTraceparent()}'*/ ${t}`}}maybeTruncate(e){const t="number"==typeof this.config.truncate?this.config.truncate:5e3;return this.config.truncate&&e&&e.length>t&&(e=`${e.slice(0,t-3)}...`),e}},database}function requireSrc$P(){if(hasRequiredSrc$P)return src$P;hasRequiredSrc$P=1;const e=requireDatabase();return src$P=class extends e{static get id(){return"elasticsearch"}start({params:e}){const t=function(e){return e&&JSON.stringify(e)}(e.body||e.bulkBody);var r;this.startSpan(this.operationName(),{service:this.serviceName({pluginConfig:this.config}),resource:`${e.method} ${r=e.path,r&&r.replace(/[0-9]+/g,"?")}`,type:"elasticsearch",kind:"client",meta:{"db.type":this.system,[`${this.system}.url`]:e.path,[`${this.system}.method`]:e.method,[`${this.system}.body`]:t,[`${this.system}.params`]:JSON.stringify(e.querystring||e.query)}})}finish({params:e}){const t=this.activeSpan;this.config.hooks.query(t,e),super.finish({params:e})}},src$P}function requireProducer$5(){if(hasRequiredProducer$5)return producer$5;hasRequiredProducer$5=1;const e=requireOutbound();return producer$5=class extends e{static get operation(){return"publish"}static get kind(){return"producer"}static get type(){return"messaging"}startSpan(e){const t={kind:this.constructor.kind};return e.service||(e.service=this.config.service||this.serviceName()),Object.keys(t).forEach((r=>{e[r]||(e[r]=t[r])})),super.startSpan(this.operationName(),e)}}}function requireProducer$4(){if(hasRequiredProducer$4)return producer$4;hasRequiredProducer$4=1;const e=requireProducer$5();return producer$4=class extends e{static get id(){return"google-cloud-pubsub"}static get operation(){return"request"}start({request:e,api:t,projectId:r}){if("publish"!==t)return;const s=e.messages||[],n=e.topic,i=this.startSpan({resource:`${t} ${n}`,meta:{"gcloud.project_id":r,"pubsub.method":t,"pubsub.topic":n}});for(const e of s)e.attributes||(e.attributes={}),this.tracer.inject(i,"text_map",e.attributes)}},producer$4}function requireInbound(){if(hasRequiredInbound)return inbound;hasRequiredInbound=1;const e=requireTracing();return inbound=class extends e{}}function requireConsumer$5(){if(hasRequiredConsumer$5)return consumer$5;hasRequiredConsumer$5=1;const e=requireInbound();return consumer$5=class extends e{static get operation(){return"receive"}static get kind(){return"consumer"}static get type(){return"messaging"}startSpan(e){return e.service||(e.service=this.config.service||this.serviceName()),e.kind||(e.kind=this.constructor.kind),super.startSpan(this.operationName(),e)}}}function requireConsumer$4(){if(hasRequiredConsumer$4)return consumer$4;hasRequiredConsumer$4=1;const e=requireConsumer$5();return consumer$4=class extends e{static get id(){return"google-cloud-pubsub"}static get operation(){return"receive"}start({message:e}){const t=e._subscriber._subscription,r=t.metadata&&t.metadata.topic,s=this.tracer.extract("text_map",e.attributes)||null;this.startSpan({childOf:s,resource:r,type:"worker",meta:{"gcloud.project_id":t.pubsub.projectId,"pubsub.topic":r},metrics:{"pubsub.ack":0}})}finish(e){const t=this.activeSpan;t&&(e.message._handled&&t.setTag("pubsub.ack",1),super.finish())}},consumer$4}function requireClient$9(){if(hasRequiredClient$9)return client$9;hasRequiredClient$9=1;const e=requireClient$a();return client$9=class extends e{static get id(){return"google-cloud-pubsub"}static get type(){return"messaging"}static get operation(){return"request"}start({request:e,api:t,projectId:r}){"publish"!==t&&this.startSpan(this.operationName(),{service:this.config.service||this.serviceName(),resource:[t,e.name].filter((e=>e)).join(" "),kind:this.constructor.kind,meta:{"pubsub.method":t,"gcloud.project_id":r}})}}}function requireComposite(){if(hasRequiredComposite)return composite;hasRequiredComposite=1;const e=requirePlugin$1();return composite=class extends e{constructor(...e){super(...e);for(const[t,r]of Object.entries(this.constructor.plugins))this[t]=new r(...e)}configure(e){for(const t in this.constructor.plugins){const r=!1!==e[t]&&{...e,...e[t]};this[t].configure(r)}}},composite}function requireSrc$O(){if(hasRequiredSrc$O)return src$O;hasRequiredSrc$O=1;const e=requireProducer$4(),t=requireConsumer$4(),r=requireClient$9(),s=requireComposite();return src$O=class extends s{static get id(){return"google-cloud-pubsub"}static get plugins(){return{producer:e,consumer:t,client:r}}}}function requireServer$9(){if(hasRequiredServer$9)return server$9;hasRequiredServer$9=1;const e=requireInbound();return server$9=class extends e{static get operation(){return"request"}static get kind(){return"server"}static get type(){return"web"}}}function requireUtil$5(){if(hasRequiredUtil$5)return util$b;hasRequiredUtil$5=1;const e=requirePick(),t=requireLog$2();return util$b={getMethodMetadata(e,t){const r={path:e,kind:t,name:"",service:"",package:""};if("string"!=typeof e)return r;const s=e.split("/");if(s.length>2){const e=s[1].split("."),t=s[2],n=e.pop(),i=e.join(".");r.name=t,r.service=n,r.package=i}else r.name=s[s.length-1];return r},addMetadataTags(e,t,r,s){if(!t||"function"!=typeof t.getMap)return;const n=r(t.getMap());for(const t in n)e.setTag(`grpc.${s}.metadata.${t}`,n[t])},getFilter:(r,s)=>"function"==typeof r[s]?r[s]:r[s]instanceof Array?t=>e(t,r[s]):(r.hasOwnProperty(s)&&t.error(`Expected '${s}' to be an array or function.`),()=>({}))},util$b}function requireServer$8(){if(hasRequiredServer$8)return server$8;hasRequiredServer$8=1;const{storage:e}=requireDatadogCore(),t=requireServer$9(),{TEXT_MAP:r}=requireFormats(),{addMetadataTags:s,getFilter:n,getMethodMetadata:i}=requireUtil$5();return server$8=class extends t{static get id(){return"grpc"}static get operation(){return"server:request"}static get prefix(){return"apm:grpc:server:request"}constructor(...e){super(...e),this.addTraceSub("update",(({code:e})=>{const t=this.activeSpan;t&&this.addCode(t,e)})),this.addTraceBind("emit",(({currentStore:e})=>e))}bindStart(t){const n=e.getStore(),{name:a,metadata:o,type:c}=t,u=this.config.metadataFilter,l=function(e,t){return t&&"function"==typeof t.getMap?e.extract(r,t.getMap()):null}(this.tracer,o),p=i(a,c),d=this.startSpan(this.operationName(),{childOf:l,service:this.config.service||this.serviceName(),resource:a,kind:"server",type:"web",meta:{component:"grpc","grpc.method.kind":p.kind,"grpc.method.path":p.path,"grpc.method.name":p.name,"grpc.method.service":p.service,"grpc.method.package":p.package},metrics:{"grpc.status.code":0}});return s(d,o,u,"request"),t.span=d,t.parentStore=n,t.currentStore={...n,span:d},t.currentStore}bindAsyncStart({parentStore:e}){return e}error({error:e}){const t=this.activeSpan;t&&(this.addCode(t,e.code),this.addError(e))}finish({span:e,code:t,trailer:r}){if(!e)return;const n=this.config.metadataFilter;this.addCode(e,t),r&&n&&s(e,r,n,"response"),e.finish()}configure(e){const t=n(e,"metadata");return super.configure({...e,metadataFilter:t})}addCode(e,t){void 0!==t&&e.setTag("grpc.status.code",t)}},server$8}function requireClient$8(){if(hasRequiredClient$8)return client$8;hasRequiredClient$8=1;const{storage:e}=requireDatadogCore(),t=requireClient$a(),{TEXT_MAP:r}=requireFormats(),{addMetadataTags:s,getFilter:n,getMethodMetadata:i}=requireUtil$5();return client$8=class extends t{static get id(){return"grpc"}static get operation(){return"client:request"}static get prefix(){return"apm:grpc:client:request"}static get peerServicePrecursors(){return["rpc.service"]}constructor(...e){super(...e),this.addTraceBind("emit",(({parentStore:e})=>e))}bindStart(t){const n=e.getStore(),{metadata:a,path:o,type:c}=t,u=this.config.metadataFilter,l=i(o,c),p=this.startSpan(this.operationName(),{service:this.config.service||this.serviceName(),resource:o,kind:"client",type:"http",meta:{component:"grpc","grpc.method.kind":l.kind,"grpc.method.path":l.path,"grpc.method.name":l.name,"grpc.method.service":l.service,"grpc.method.package":l.package},metrics:{"grpc.status.code":0}},!1);return l.service&&l.package&&p.setTag("rpc.service",l.package+"."+l.service),a&&(s(p,a,u,"request"),function(e,t,s){if("function"!=typeof s.set)return;const n={};e.inject(t,r,n);for(const e in n)s.set(e,n[e])}(this.tracer,p,a)),t.span=p,t.parentStore=n,t.currentStore={...n,span:p},t.currentStore}bindAsyncStart({parentStore:e}){return e}error({span:e,error:t}){this.addCode(e,t.code),this.addError(t,e)}finish({span:e,result:t,peer:r}){if(!e)return;const{code:n,metadata:i}=t||{},a=this.config.metadataFilter;if(this.addCode(e,n),i&&a&&s(e,i,a,"response"),r){const t=r.split(":");if(t[t.length-1].match(/^\d+/)){const r=t[t.length-1],s=t.slice(0,-1).join(":");e.setTag("network.destination.ip",s),e.setTag("network.destination.port",r)}else e.setTag("network.destination.ip",r)}this.tagPeerService(e),e.finish()}configure(e){const t=n(e,"metadata");return super.configure({...e,metadataFilter:t})}addCode(e,t){void 0!==t&&e.setTag("grpc.status.code",t)}},client$8}function requireSrc$N(){if(hasRequiredSrc$N)return src$N;hasRequiredSrc$N=1;const e=requireServer$8(),t=requireClient$8(),r=requireComposite();return src$N=class extends r{static get id(){return"grpc"}static get plugins(){return{server:e,client:t}}}}function requireUniq(){return hasRequiredUniq?uniq:(hasRequiredUniq=1,uniq=function(e){return[...new Set(e)]})}function requireUrlfilter(){if(hasRequiredUrlfilter)return urlfilter;hasRequiredUrlfilter=1;const e=requireLog$2(),t={getFilter(t){if("function"==typeof t.filter)return t.filter;t.hasOwnProperty("filter")&&e.error("Expected `filter` to be a function. Overriding filter property to default.");const r=t.allowlist||t.whitelist||/.*/,s=t.blocklist||t.blacklist||[];return e=>{const t=n(r,e),i=n(s,e);return t&&!i};function n(e,t){return"function"==typeof e?e(t):e instanceof RegExp?e.test(t):e instanceof Array?e.some((e=>n(e,t))):e===t}}};return urlfilter=t}var ip_blocklist={exports:{}},ipaddr={exports:{}},hasRequiredIpaddr,hasRequiredIp_blocklist,ip_extractor,hasRequiredIp_extractor,web_1,hasRequiredWeb,src$M,hasRequiredSrc$M,src$L,hasRequiredSrc$L,src$K,hasRequiredSrc$K,src$J,hasRequiredSrc$J,src$I,hasRequiredSrc$I,cache,hasRequiredCache,src$H,hasRequiredSrc$H,src$G,hasRequiredSrc$G,src$F,hasRequiredSrc$F,util$a,hasRequiredUtil$4,producer$3,hasRequiredProducer$3,consumer$3,hasRequiredConsumer$3,src$E,hasRequiredSrc$E,util$9,hasRequiredUtil$3,producer$2,hasRequiredProducer$2,consumer$2,hasRequiredConsumer$2,client$7,hasRequiredClient$7,src$D,hasRequiredSrc$D,log_plugin,hasRequiredLog_plugin,src$C,hasRequiredSrc$C,src$B,hasRequiredSrc$B,parse$1,hasRequiredParse$1,scrubCmdParams,hasRequiredScrubCmdParams,src$A,hasRequiredSrc$A,src$z,hasRequiredSrc$z,src$y,hasRequiredSrc$y,src$x,hasRequiredSrc$x,lookup,hasRequiredLookup,lookup_service,hasRequiredLookup_service,resolve$1,hasRequiredResolve$1,reverse,hasRequiredReverse,src$w,hasRequiredSrc$w,src$v,hasRequiredSrc$v,src$u,hasRequiredSrc$u,src$t,hasRequiredSrc$t;function requireIpaddr(){return hasRequiredIpaddr||(hasRequiredIpaddr=1,e=ipaddr,function(t){const r="(0?\\d+|0x[a-f0-9]+)",s={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},n=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),a="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(a,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${a})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(${a})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${r}\\.${r}\\.${r}\\.${r}(${a})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,s,n=0,i=-1,a=(e.match(c.zoneIndex)||[])[0];for(a&&(a=a.substring(1),e=e.replace(/%.+$/,""));(i=e.indexOf(":",i+1))>=0;)n++;if("::"===e.substr(0,2)&&n--,"::"===e.substr(-2,2)&&n--,n>t)return null;for(s=t-n,r=":";s--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),zoneId:a}}function l(e,t,r,s){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let n,i=0;for(;s>0;){if(n=r-s,n<0&&(n=0),e[i]>>n!=t[i]>>n)return!1;s-=r,i+=1}return!0}function p(e){if(i.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(n.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function d(e,t){for(;e.length<t;)e=`0${e}`;return e}const h={};h.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,18,0,0]),15],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let s,n,i;for(s=3;s>=0;s-=1){if(n=this.octets[s],!(n in r))return null;if(i=r[n],t&&0!==i)return null;8!==i&&(t=!0),e+=i}return 32-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),h.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[];let i=0;for(;i<4;)n.push(parseInt(r[i],10)|255^parseInt(s[i],10)),i++;return new this(n)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(e){return null!==this.parser(e)},h.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},h.IPv4.isValidFourPartDecimal=function(e){return!(!h.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(e){let t,r,s,n,i;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[],r=0;r<4;)n.push(parseInt(s[r],10)&parseInt(i[r],10)),r++;return new this(n)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},h.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(e){let t,r,n;if(t=e.match(s.fourOctet))return function(){const e=t.slice(1,6),s=[];for(let t=0;t<e.length;t++)r=e[t],s.push(p(r));return s}();if(t=e.match(s.longValue)){if(n=p(t[1]),n>4294967295||n<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(n>>t&255);return e}().reverse()}return(t=e.match(s.twoOctet))?function(){const e=t.slice(1,4),r=[];if(n=p(e[1]),n>16777215||n<0)throw new Error("ipaddr: address outside defined range");return r.push(p(e[0])),r.push(n>>16&255),r.push(n>>8&255),r.push(255&n),r}():(t=e.match(s.threeOctet))?function(){const e=t.slice(1,5),r=[];if(n=p(e[2]),n>65535||n<0)throw new Error("ipaddr: address outside defined range");return r.push(p(e[0])),r.push(p(e[1])),r.push(n>>8&255),r.push(255&n),r}():null},h.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const s=Math.floor(e/8);for(;r<s;)t[r]=255,r++;return s<4&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},h.IPv6=function(){function e(e,t){let r,s;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(s=this.parts[r],!(0<=s&&s<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]],benchmarking:[new e([8193,2,0,0,0,0,0,0]),48],amt:[new e([8193,3,0,0,0,0,0,0]),32],as112v6:[new e([8193,4,274,0,0,0,0,0]),48],deprecated:[new e([8193,16,0,0,0,0,0,0]),28],orchid2:[new e([8193,32,0,0,0,0,0,0]),28]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let s,n;for(let i=7;i>=0;i-=1){if(s=this.parts[i],!(s in r))return null;if(n=r[s],t&&0!==n)return null;16!==n&&(t=!0),e+=n}return 128-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let s=0;s<r.length;s++)e=r[s],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(d(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new h.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,s=0,n=-1;for(;r=e.exec(t);)r[0].length>n&&(s=r.index,n=r[0].length);return n<0?t:`${t.substring(0,s)}::${t.substring(s+n)}`},e.prototype.toString=function(){return this.toRFC5952String()},e}(),h.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[];let i=0;for(;i<16;)n.push(parseInt(r[i],10)|255^parseInt(s[i],10)),i++;return new this(n)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},h.IPv6.isIPv6=function(e){return null!==this.parser(e)},h.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},h.IPv6.networkAddressFromCIDR=function(e){let t,r,s,n,i;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),n=[],r=0;r<16;)n.push(parseInt(s[r],10)&parseInt(i[r],10)),r++;return new this(n)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},h.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},h.IPv6.parseCIDR=function(e){let t,r,s;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return s=[this.parse(r[1]),t],Object.defineProperty(s,"toString",{value:function(){return this.join("/")}}),s;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(e){let t,r,s,n,i,a;if(s=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${s[1]}`);if(c.native.test(e))return u(e,8);if((s=e.match(c.transitional))&&(a=s[6]||"",t=u(s[1].slice(0,-1)+a,6),t.parts)){for(i=[parseInt(s[2]),parseInt(s[3]),parseInt(s[4]),parseInt(s[5])],r=0;r<i.length;r++)if(n=i[r],!(0<=n&&n<=255))return null;return t.parts.push(i[0]<<8|i[1]),t.parts.push(i[2]<<8|i[3]),{parts:t.parts,zoneId:t.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const s=Math.floor(e/8);for(;r<s;)t[r]=255,r++;return s<16&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},h.fromByteArray=function(e){const t=e.length;if(4===t)return new h.IPv4(e);if(16===t)return new h.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(e){return h.IPv6.isValid(e)||h.IPv4.isValid(e)},h.parse=function(e){if(h.IPv6.isValid(e))return h.IPv6.parse(e);if(h.IPv4.isValid(e))return h.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(e){try{return h.IPv6.parseCIDR(e)}catch(t){try{return h.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},h.subnetMatch=function(e,t,r){let s,n,i,a;for(n in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,n))for(i=t[n],!i[0]||i[0]instanceof Array||(i=[i]),s=0;s<i.length;s++)if(a=i[s],e.kind()===a[0].kind()&&e.match.apply(e,a))return n;return r},e.exports?e.exports=h:t.ipaddr=h}(commonjsGlobal)),ipaddr.exports;var e}function requireIp_blocklist(){if(hasRequiredIp_blocklist)return ip_blocklist.exports;hasRequiredIp_blocklist=1;if(requireSemver().satisfies(process.version,">=14.18.0")){const e=require$$1$2;ip_blocklist.exports=e.BlockList}else{const e=requireIpaddr();ip_blocklist.exports=class{constructor(){this.v4Ranges=[],this.v6Ranges=[]}addSubnet(t,r,s){this["ipv4"===s?"v4Ranges":"v6Ranges"].push(e.parseCIDR(`${t}/${r}`))}check(t,r){try{let s=e.parse(t);if("ipv6"===(r=s.kind())){for(const e of this.v6Ranges)if(s.match(e))return!0;s.isIPv4MappedAddress()&&(s=s.toIPv4Address(),r=s.kind())}if("ipv4"===r)for(const e of this.v4Ranges)if(s.match(e))return!0;return!1}catch{return!1}}}}return ip_blocklist.exports}function requireIp_extractor(){if(hasRequiredIp_extractor)return ip_extractor;hasRequiredIp_extractor=1;const e=requireIp_blocklist(),t=require$$1$2,r=["x-forwarded-for","x-real-ip","true-client-ip","x-client-ip","x-forwarded","forwarded-for","x-cluster-client-ip","fastly-client-ip","cf-connecting-ip","cf-connecting-ipv6"],s=["127.0.0.0/8","10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","169.254.0.0/16","::1/128","fec0::/10","fe80::/10","fc00::/7","fd00::/8"],n=new e;for(const e of s){const[r,s]=e.split("/");n.addSubnet(r,parseInt(s),t.isIPv6(r)?"ipv6":"ipv4")}function i(e){const r={};if(!e)return r;const s=e.split(",");for(const e of s){const s=e.trim(),i=t.isIP(s);if(i){if(!n.check(s,6===i?"ipv6":"ipv4")){r.public=s;break}r.private||(r.private=s)}}return r}return ip_extractor={extractIp:function(e,t){const s=t.headers;if(e.clientIpHeader){if(!s)return;const t=i(s[e.clientIpHeader]);return t.public||t.private}let n;if(s)for(const e of r){const t=i(s[e]);if(t.public)return t.public;!n&&t.private&&(n=t.private)}return n||t.socket?.remoteAddress},ipHeaderList:r},ip_extractor}function requireWeb(){if(hasRequiredWeb)return web_1;hasRequiredWeb=1;const e=requireUniq(),t=requireAnalytics_sampler(),r=requireLog$2(),s=requireTags$2(),n=requireTypes$1(),i=requireKinds(),a=requireUrlfilter(),{extractIp:o}=requireIp_extractor(),{ERROR_MESSAGE:c,ERROR_TYPE:u,ERROR_STACK:l}=requireConstants$2(),p=n.WEB,d=i.SERVER,h=s.RESOURCE_NAME,f=s.SERVICE_NAME,g=s.SPAN_TYPE,m=s.SPAN_KIND,_=s.ERROR,b=s.HTTP_METHOD,y=s.HTTP_URL,v=s.HTTP_STATUS_CODE,S=s.HTTP_ROUTE,q=s.HTTP_REQUEST_HEADERS,E=s.HTTP_RESPONSE_HEADERS,R=s.HTTP_USERAGENT,T=s.HTTP_CLIENT_IP,A=s.MANUAL_DROP,w=":authority",x=":scheme",I=":path",C=new WeakMap,O=new WeakMap,$={normalizeConfig(e){const t=function(e){if(Array.isArray(e.headers))try{return e.headers.map((e=>e.split(":"))).map((([e,t])=>[e.toLowerCase(),t]))}catch(e){r.error(e)}else e.hasOwnProperty("headers")&&r.error("Expected `headers` to be an array of strings.");return[]}(e),s=function(e){if("function"==typeof e.validateStatus)return e.validateStatus;e.hasOwnProperty("validateStatus")&&r.error("Expected `validateStatus` to be a function.");return e=>e<500}(e),n=function(e){const t=()=>{},r=e.hooks&&e.hooks.request||t;return{request:r}}(e),i=a.getFilter(e),o=function(e){if(e&&"boolean"==typeof e.middleware)return e.middleware;e&&e.hasOwnProperty("middleware")&&r.error("Expected `middleware` to be a boolean.");return!0}(e),c=function(e){const t=e.queryStringObfuscation;if("boolean"==typeof t)return t;if("string"==typeof t){if(""===t)return!1;if(".*"===t)return!0;try{return new RegExp(t,"gi")}catch(e){r.error(e)}}e.hasOwnProperty("queryStringObfuscation")&&r.error("Expected `queryStringObfuscation` to be a regex string or boolean.");return!0}(e);return{...e,headers:t,validateStatus:s,hooks:n,filter:i,middleware:o,queryStringObfuscation:c}},setFramework(e,t,r){const s=this.patch(e).span;s&&(s.context()._name=`${t}.request`,s.context()._tags.component=t,$.setConfig(e,r))},setConfig(e,r){const s=C.get(e),n=s.span;s.config=r,r.filter(e.url)||(n.setTag(A,!0),n.context()._trace.isRecording=!1),r.service&&n.setTag(f,r.service),t.sample(n,r.measured,!0)},startSpan(e,t,r,s,n){const i=this.patch(r);let a;return i.span?(i.span.context()._name=n,a=i.span):a=$.startChildSpan(e,n,r.headers),i.tracer=e,i.span=a,i.res=s,this.setConfig(r,t),P(i),a},wrap(e){const t=C.get(e);t.instrumented||(this.wrapEnd(t),t.instrumented=!0)},instrument(e,t,r,s,n,i){const a=this.startSpan(e,t,r,s,n);return this.wrap(r),i&&e.scope().activate(a,(()=>i(a)))},reactivate:(e,t)=>function(e,t){const r=C.get(e);return r?r.tracer.scope().activate(r.span,t):t()}(e,t),enterRoute(e,t){"string"==typeof t&&C.get(e).paths.push(t)},setRoute(e,t){const r=C.get(e);r&&(r.paths=[t])},exitRoute(e){C.get(e).paths.pop()},wrapMiddleware(e,r,s,n){if(!this.active(e))return n();const i=C.get(e),a=i.tracer,o=this.active(e),c=i.config;if(!1===c.middleware)return this.bindAndWrapMiddlewareErrors(n,e,a,o);const u=a.startSpan(s,{childOf:o});return t.sample(u,c.measured),u.addTags({[h]:r._name||r.name||"<anonymous>"}),i.middleware.push(u),a.scope().activate(u,n)},bindAndWrapMiddlewareErrors(e,t,r,s){try{return r.scope().bind(e,s).apply(this,arguments)}catch(e){throw $.addError(t,e),e}},finish(e,t){if(!this.active(e))return;const r=C.get(e).middleware.pop();r&&(t&&r.addTags({[u]:t.name,[c]:t.message,[l]:t.stack}),r.finish())},beforeEnd(e,t){C.get(e).beforeEnd.push(t)},patch(e){let t=C.get(e);return t||(t=e.stream&&C.get(e.stream),t?(C.set(e,t),t):(t={req:e,span:null,paths:[],middleware:[],beforeEnd:[],config:{}},C.set(e,t),t))},root(e){const t=C.get(e);return t?t.span:null},active(e){const t=C.get(e);return t?0===t.middleware.length?t.span||null:t.middleware.slice(-1)[0]:null},startChildSpan(e,t,r){const s=e.extract("http_headers",r);return e.startSpan(t,{childOf:s})},addStatusError(e,t){const r=C.get(e),s=r.span,n=r.error;s.context()._tags.error||s.context()._tags[c]||r.config.validateStatus(t)||s.setTag(_,n||!0)},addError(e,t){if(t instanceof Error){const r=C.get(e);r&&(r.error=t)}},finishMiddleware(e){if(e.finished)return;let t;for(;t=e.middleware.pop();)t.finish()},finishSpan(e){const{req:t,res:r}=e;e.finished&&!t.stream||(P(e),function(e){const{req:t,res:r,paths:s,span:n}=e;s.length>0&&n.setTag(S,s.join(""));n.addTags({[v]:r.statusCode}),$.addStatusError(t,r.statusCode)}(e),e.config.hooks.request(e.span,t,r),function(e){const{req:t,span:r}=e,s=r.context()._tags;if(s["resource.name"])return;const n=[t.method,s[S]].filter((e=>e)).join(" ");r.setTag(h,n)}(e),e.span.finish(),e.finished=!0)},finishAll(e){for(const t of e.beforeEnd)t();$.finishMiddleware(e),$.finishSpan(e)},obfuscateQs(e,t){const{queryStringObfuscation:r}=e;if(!1===r)return t;const s=t.indexOf("?");if(-1===s)return t;const n=t.slice(0,s);if(!0===r)return n;let i=t.slice(s+1);return i=i.replace(r,"<redacted>"),`${n}?${i}`},wrapWriteHead(t){const{req:r,res:s}=t,n=s.writeHead;return function(t,i,a){return a="string"==typeof i?a:i,a=Object.assign(s.getHeaders(),a),"options"===r.method.toLowerCase()&&function(e,t){const r=e.headers.origin,s=t["access-control-allow-origin"];return r&&("*"===s||s===r)}(r,a)&&function(t,r,s){const n=k(s["access-control-allow-headers"]),i=k(t.headers["access-control-request-headers"]),a=["x-datadog-origin","x-datadog-parent-id","x-datadog-sampled","x-datadog-sampling-priority","x-datadog-trace-id","x-datadog-tags"];for(const e of a)~i.indexOf(e)&&n.push(e);n.length>0&&r.setHeader("access-control-allow-headers",e(n).join(","))}(r,s,a),n.apply(this,arguments)}},getContext:e=>C.get(e),wrapRes:(e,t,r,s)=>function(){return $.finishAll(e),s.apply(r,arguments)},wrapEnd(e){const t=e.tracer.scope(),r=e.req,s=e.res,n=s.end;s.writeHead=$.wrapWriteHead(e),O.set(s,this.wrapRes(e,r,s,n)),Object.defineProperty(s,"end",{configurable:!0,get(){return O.get(this)},set(r){O.set(this,t.bind(r,e.span))}})}};function k(e){return"string"==typeof e?e.split(/\s*,\s*/):[]}function P(e){const{req:t,span:r,config:s}=e,n=function(e){const t=e.headers;if(e.stream)return`${t[x]}://${t[w]}${t[I]}`;{const t=function(e){return e.socket&&e.socket.encrypted||e.connection&&e.connection.encrypted?"https":"http"}(e);return`${t}://${e.headers.host}${e.originalUrl||e.url}`}}(t);if(r.addTags({[y]:$.obfuscateQs(s,n),[b]:t.method,[m]:d,[g]:p,[R]:t.headers["user-agent"]}),s.clientIpEnabled&&!r.context()._tags.hasOwnProperty(T)){const e=o(s,t);e&&r.setTag(T,e)}!function(e){const{req:t,res:r,config:s,span:n}=e;s.headers.forEach((([e,s])=>{const i=t.headers[e],a=r.getHeader(e);i&&n.setTag(s||`${q}.${e}`,i),a&&n.setTag(s||`${E}.${e}`,a)}))}(e)}return web_1=$}function requireSrc$M(){if(hasRequiredSrc$M)return src$M;hasRequiredSrc$M=1;const e=requirePlugin$1(),t=requireWeb();return src$M=class extends e{static get id(){return"web"}configure(e){return super.configure(t.normalizeConfig(e))}setFramework(e,r,s){t.setFramework(e,r,s)}},src$M}function requireSrc$L(){if(hasRequiredSrc$L)return src$L;hasRequiredSrc$L=1;const e=requireWeb(),t=requireSrc$M(),r=requireAnalytics_sampler(),{storage:s}=requireDatadogCore(),{COMPONENT:n}=requireConstants$2();function i(e){return e.includes("(/")}return src$L=class extends t{static get id(){return"router"}constructor(...t){super(...t),this._storeStack=[],this._contexts=new WeakMap,this.addSub(`apm:${this.constructor.id}:middleware:enter`,(({req:t,name:r,route:n})=>{const i=this._getActive(t)||this._getStoreSpan();if(!i)return;const a=this._getMiddlewareSpan(r,i),o=this._createContext(t,n,i);i!==a&&o.middleware.push(a);const c=s.getStore();this._storeStack.push(c),this.enter(a,c),e.patch(t),e.setRoute(t,o.route)})),this.addSub(`apm:${this.constructor.id}:middleware:next`,(({req:e})=>{const t=this._contexts.get(e);t&&t.stack.pop()})),this.addSub(`apm:${this.constructor.id}:middleware:finish`,(({req:e})=>{const t=this._contexts.get(e);t&&0!==t.middleware.length&&t.middleware.pop().finish()})),this.addSub(`apm:${this.constructor.id}:middleware:exit`,(({req:e})=>{const t=this._storeStack.pop(),r=t&&t.span;this.enter(r,t)})),this.addSub(`apm:${this.constructor.id}:middleware:error`,(({req:t,error:r})=>{if(e.addError(t,r),!this.config.middleware)return;const s=this._getActive(t);s&&s.setTag("error",r)})),this.addSub("apm:http:server:request:finish",(({req:e})=>{const t=this._contexts.get(e);if(!t)return;let r;for(;r=t.middleware.pop();)r.finish()}))}_getActive(e){const t=this._contexts.get(e);if(t)return 0===t.middleware.length?t.span:t.middleware[t.middleware.length-1]}_getStoreSpan(){const e=s.getStore();return e&&e.span}_getMiddlewareSpan(e,t){if(!1===this.config.middleware)return t;const s=this.tracer.startSpan(`${this.constructor.id}.middleware`,{childOf:t,tags:{[n]:this.constructor.id,"resource.name":e||"<anonymous>"}});return r.sample(s,this.config.measured),s}_createContext(e,t,r){let s=this._contexts.get(e);return t&&"/"!==t&&"*"!==t||(t=""),s?(s.stack.push(t),function(e,t){if(!i(e)&&i(t))return!0;return e.length>t.length}(t=s.stack.join(""),s.route)&&(s.route=t)):(s={span:r,stack:[t],route:t,middleware:[]},this._contexts.set(e,s)),s}},src$L}function requireSrc$K(){if(hasRequiredSrc$K)return src$K;hasRequiredSrc$K=1;const{storage:e}=requireDatadogCore(),t=requireSrc$L(),r=requireWeb();return src$K=class extends t{static get id(){return"hapi"}constructor(...t){super(...t),this._requestSpans=new WeakMap,this.addSub("apm:hapi:request:handle",(({req:t})=>{const r=e.getStore(),s=r&&r.span;this.setFramework(t,"hapi",this.config),this._requestSpans.set(t,s)})),this.addSub("apm:hapi:request:route",(({req:e,route:t})=>{r.setRoute(e,t)})),this.addSub("apm:hapi:request:error",(e=>{e&&e.isBoom&&this.config.validateStatus(e.output.statusCode)||this.addError(e)})),this.addSub("apm:hapi:extension:enter",(({req:e})=>{this.enter(this._requestSpans.get(e))}))}},src$K}function requireSrc$J(){if(hasRequiredSrc$J)return src$J;hasRequiredSrc$J=1;const e=requireCi_plugin(),{storage:t}=requireDatadogCore(),{TEST_STATUS:r,JEST_TEST_RUNNER:s,finishAllTraceSpans:n,getTestSuiteCommonTags:i,addIntelligentTestRunnerSpanTags:a,TEST_PARAMETERS:o,TEST_COMMAND:c,TEST_FRAMEWORK_VERSION:u,TEST_SOURCE_START:l,TEST_ITR_UNSKIPPABLE:p,TEST_ITR_FORCED_RUN:d,TEST_CODE_OWNERS:h,ITR_CORRELATION_ID:f,TEST_SOURCE_FILE:g,TEST_IS_NEW:m,TEST_EARLY_FLAKE_IS_RETRY:_,TEST_EARLY_FLAKE_IS_ENABLED:b}=requireTest(),{COMPONENT:y}=requireConstants$2(),v=requireId(),{TELEMETRY_EVENT_CREATED:S,TELEMETRY_EVENT_FINISHED:q,TELEMETRY_CODE_COVERAGE_STARTED:E,TELEMETRY_CODE_COVERAGE_FINISHED:R,TELEMETRY_ITR_FORCED_TO_RUN:T,TELEMETRY_CODE_COVERAGE_EMPTY:A,TELEMETRY_ITR_UNSKIPPABLE:w,TELEMETRY_CODE_COVERAGE_NUM_FILES:x}=requireTelemetry$3(),I=!!process.env.JEST_WORKER_ID;return src$J=class extends e{static get id(){return"jest"}getUnskippableSuites(e){return this.unskippableSuites||(this.unskippableSuites=JSON.parse(e)),this.unskippableSuites}getForcedToRunSuites(e){return this.forcedToRunSuites||(this.forcedToRunSuites=JSON.parse(e)),this.forcedToRunSuites}constructor(...e){if(super(...e),I){const e=([t])=>{2===t&&(this.testSuiteSpan&&(this.testSuiteSpan.finish(),n(this.testSuiteSpan)),this.tracer._exporter.flush(),process.removeListener("message",e))};process.on("message",e)}this.addSub("ci:jest:session:finish",(({status:e,isSuitesSkipped:t,isSuitesSkippingEnabled:s,isCodeCoverageEnabled:i,testCodeCoverageLinesTotal:o,numSkippedSuites:c,hasUnskippableSuites:u,hasForcedToRunSuites:l,error:p,isEarlyFlakeDetectionEnabled:d,onDone:h})=>{this.testSessionSpan.setTag(r,e),this.testModuleSpan.setTag(r,e),p&&(this.testSessionSpan.setTag("error",p),this.testModuleSpan.setTag("error",p)),a(this.testSessionSpan,this.testModuleSpan,{isSuitesSkipped:t,isSuitesSkippingEnabled:s,isCodeCoverageEnabled:i,testCodeCoverageLinesTotal:o,skippingType:"suite",skippingCount:c,hasUnskippableSuites:u,hasForcedToRunSuites:l}),d&&this.testSessionSpan.setTag(b,"true"),this.testModuleSpan.finish(),this.telemetry.ciVisEvent(q,"module"),this.testSessionSpan.finish(),this.telemetry.ciVisEvent(q,"session"),n(this.testSessionSpan),this.tracer._exporter.flush((()=>{h&&h()}))})),this.addSub("ci:jest:session:configuration",(e=>{e.forEach((e=>{e._ddTestSessionId=this.testSessionSpan.context().toTraceId(),e._ddTestModuleId=this.testModuleSpan.context().toSpanId(),e._ddTestCommand=this.testSessionSpan.context()._tags[c],e._ddItrCorrelationId=this.itrCorrelationId,e._ddIsEarlyFlakeDetectionEnabled=!!this.libraryConfig?.isEarlyFlakeDetectionEnabled,e._ddEarlyFlakeDetectionNumRetries=this.libraryConfig?.earlyFlakeDetectionNumRetries??0,e._ddRepositoryRoot=this.repositoryRoot}))})),this.addSub("ci:jest:test-suite:start",(({testSuite:e,testEnvironmentOptions:t,frameworkVersion:r})=>{const{_ddTestSessionId:s,_ddTestCommand:n,_ddTestModuleId:a,_ddItrCorrelationId:o,_ddForcedToRun:c,_ddUnskippable:u,_ddTestCodeCoverageEnabled:l}=t,h=this.tracer.extract("text_map",{"x-datadog-trace-id":s,"x-datadog-parent-id":a}),g=i(n,r,e,"jest");if(u){if(this.getUnskippableSuites(u)[e]&&(this.telemetry.count(w,{testLevel:"suite"}),g[p]="true"),c){this.getForcedToRunSuites(c)[e]&&(this.telemetry.count(T,{testLevel:"suite"}),g[d]="true")}}o&&(g[f]=o),this.testSuiteSpan=this.tracer.startSpan("jest.test_suite",{childOf:h,tags:{[y]:this.constructor.id,...this.testEnvironmentMetadata,...g}}),this.telemetry.ciVisEvent(S,"suite"),l&&this.telemetry.ciVisEvent(E,"suite",{library:"istanbul"})})),this.addSub("ci:jest:worker-report:trace",(e=>{const t=JSON.parse(e).map((e=>e.map((e=>({...e,span_id:v(e.span_id),trace_id:v(e.trace_id),parent_id:v(e.parent_id)})))));t.forEach((e=>{this.tracer._exporter.export(e)}))})),this.addSub("ci:jest:worker-report:coverage",(e=>{JSON.parse(e).map((e=>({sessionId:v(e.sessionId),suiteId:v(e.suiteId),files:e.files}))).forEach((e=>{this.tracer._exporter.exportCoverage(e)}))})),this.addSub("ci:jest:test-suite:finish",(({status:e,errorMessage:t,error:s})=>{this.testSuiteSpan.setTag(r,e),s?this.testSuiteSpan.setTag("error",s):t&&this.testSuiteSpan.setTag("error",new Error(t)),this.testSuiteSpan.finish(),this.telemetry.ciVisEvent(q,"suite"),n(this.testSuiteSpan),I&&this.tracer._exporter.flush()})),this.addSub("ci:jest:test-suite:code-coverage",(({coverageFiles:e,testSuite:t})=>{e.length||this.telemetry.count(A);const r=[...e,t],{_traceId:s,_spanId:n}=this.testSuiteSpan.context(),i={sessionId:s,suiteId:n,files:r};this.tracer._exporter.exportCoverage(i),this.telemetry.ciVisEvent(R,"suite",{library:"istanbul"}),this.telemetry.distribution(x,{},r.length)})),this.addSub("ci:jest:test:start",(e=>{const r=t.getStore(),s=this.startTestSpan(e);this.enter(s,r)})),this.addSub("ci:jest:test:finish",(({status:e,testStartLine:s})=>{const i=t.getStore().span;i.setTag(r,e),s&&i.setTag(l,s),i.finish(),this.telemetry.ciVisEvent(q,"test",{hasCodeOwners:!!i.context()._tags[h]}),n(i)})),this.addSub("ci:jest:test:err",(e=>{if(e){const s=t.getStore();if(s&&s.span){const t=s.span;t.setTag(r,"fail"),t.setTag("error",e)}}})),this.addSub("ci:jest:test:skip",(e=>{const t=this.startTestSpan(e);t.setTag(r,"skip"),t.finish()}))}startTestSpan(e){const{suite:t,name:r,runner:n,testParameters:i,frameworkVersion:a,testStartLine:c,testSourceFile:p,isNew:d,isEfdRetry:h}=e,f={[s]:n,[o]:i,[u]:a};return c&&(f[l]=c),f[g]=p||t,d&&(f[m]="true",h&&(f[_]="true")),super.startTestSpan(r,t,this.testSuiteSpan,f)}},src$J}function requireSrc$I(){if(hasRequiredSrc$I)return src$I;hasRequiredSrc$I=1;const e=requireSrc$L(),t=requireWeb();return src$I=class extends e{static get id(){return"koa"}constructor(...e){super(...e),this.addSub("apm:koa:request:handle",(({req:e})=>{this.setFramework(e,"koa",this.config)})),this.addSub("apm:koa:request:route",(({req:e,route:r})=>{t.setRoute(e,r)}))}}}function requireCache(){if(hasRequiredCache)return cache;hasRequiredCache=1;const e=requireStorage();return cache=class extends e{static get operation(){return"command"}startSpan(e){return e.kind||(e.kind=this.constructor.kind),super.startSpan(this.operationName(),e)}}}function requireSrc$H(){if(hasRequiredSrc$H)return src$H;hasRequiredSrc$H=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireCache(),r=requireUrlfilter();function s(e,t){if(!t||"AUTH"===e)return e;for(let r=0,s=t.length;r<s;r++)if("function"!=typeof t[r]&&(e=`${e} ${n(t[r])}`).length>1e3)return i(e,1e3);return e}function n(e){switch(typeof e){case"string":case"number":return i(String(e),100);default:return"?"}}function i(e,t){return e.length>t&&(e=e.substr(0,t-3)+"..."),e}function a(e){for(let t=0;t<e.length;t++)e[t]=String(e[t]).toUpperCase()}return src$H=class extends t{static get id(){return"redis"}static get system(){return"redis"}start({db:t,command:r,args:n,connectionOptions:i={},connectionName:a}){const o=r,c=r.toUpperCase();if(!this.config.filter(c))return this.skip();this.startSpan({resource:o,service:this.serviceName({pluginConfig:this.config,system:this.system,connectionName:a}),type:"redis",meta:{"db.type":"redis","db.name":t||"0","redis.raw_command":s(c,n),"out.host":i.host,[e]:i.port}})}configure(e){super.configure(function(e){e.allowlist&&a(e.allowlist);e.whitelist&&a(e.whitelist);e.blocklist&&a(e.blocklist);e.blacklist&&a(e.blacklist);const t=r.getFilter(e);return Object.assign({},e,{filter:t})}(e))}},src$H}function requireSrc$G(){if(hasRequiredSrc$G)return src$G;hasRequiredSrc$G=1;const e=requireSrc$P();return src$G=class extends e{static get id(){return"opensearch"}}}function requireSrc$F(){if(hasRequiredSrc$F)return src$F;hasRequiredSrc$F=1;const{storage:e}=requireDatadogCore(),t=requireDatabase(),r="aerospike.namespace";return src$F=class extends t{static get id(){return"aerospike"}static get operation(){return"command"}static get system(){return"aerospike"}static get prefix(){return"tracing:apm:aerospike:command"}static get peerServicePrecursors(){return[r]}bindStart(t){const{commandName:s,commandArgs:n}=t,i=s.slice(0,s.indexOf("Command")),a=e.getStore(),o=a?a.span:null,c=function(e,t){let s={};if(e.includes("Index")){const[e,n,i,a]=t;s=function(e,t,s,n){return{[r]:e,"aerospike.setname":t,"aerospike.bin":s,"aerospike.index":n}}(e,n,i,a)}else if("Query"===e){const{ns:e,set:n}=t[2];s=function(e){const{ns:t,set:s}=e;return{[r]:t,"aerospike.setname":s}}({ns:e,set:n})}else if(n=t[0],n&&void 0!==n.ns&&void 0!==n.set&&void 0!==n.key){const{ns:e,set:n,key:i}=t[0];s=function(e,t,s){return{"aerospike.key":`${e}:${t}:${s}`,[r]:e,"aerospike.setname":t,"aerospike.userkey":s}}(e,n,i)}var n;return s}(i,n),u=this.startSpan(this.operationName(),{childOf:o,service:this.serviceName({pluginConfig:this.config}),type:"aerospike",kind:"client",resource:i,meta:c},!1);return t.parentStore=a,t.currentStore={...a,span:u},t.currentStore}bindAsyncStart(e){return e.currentStore&&(this.tagPeerService(e.currentStore.span),e.currentStore.span.finish()),e.parentStore}end(e){e.result&&(this.tagPeerService(e.currentStore.span),e.currentStore.span.finish())}error(e){if(e.error){const t=e.error;e.currentStore.span.setTag("error",t)}}},src$F}function requireUtil$4(){if(hasRequiredUtil$4)return util$a;return hasRequiredUtil$4=1,util$a={getAddress:function(e){return e&&e.session&&e.session.connection&&e.session.connection.address||{}},getShortName:function(e){return e&&e.name?e.name.split("_").slice(0,-1).join("_"):null}}}function requireProducer$3(){if(hasRequiredProducer$3)return producer$3;hasRequiredProducer$3=1;const e=requireProducer$5(),{CLIENT_PORT_KEY:t}=requireConstants$2(),{getAddress:r,getShortName:s}=requireUtil$4();return producer$3=class extends e{static get id(){return"amqp10"}static get operation(){return"send"}static get system(){return"amqp"}start({link:e}){const n=r(e),i=s(e);this.startSpan({resource:["send",i].filter((e=>e)).join(" "),meta:{"amqp.link.target.address":i,"amqp.link.role":"sender","out.host":n.host,[t]:n.port,"amqp.link.name":e.name,"amqp.link.handle":e.handle,"amqp.connection.host":n.host,"amqp.connection.port":n.port,"amqp.connection.user":n.user}})}}}function requireConsumer$3(){if(hasRequiredConsumer$3)return consumer$3;hasRequiredConsumer$3=1;const e=requireConsumer$5(),{getAddress:t,getShortName:r}=requireUtil$4();return consumer$3=class extends e{static get id(){return"amqp10"}static get system(){return"amqp"}start({link:e}){const s=r(e),n=t(e);this.startSpan({resource:["receive",s].filter((e=>e)).join(" "),type:"worker",meta:{"amqp.link.source.address":s,"amqp.link.role":"receiver","amqp.link.name":e.name,"amqp.link.handle":e.handle,"amqp.connection.host":n.host,"amqp.connection.port":n.port,"amqp.connection.user":n.user}})}}}function requireSrc$E(){if(hasRequiredSrc$E)return src$E;hasRequiredSrc$E=1;const e=requireProducer$3(),t=requireConsumer$3(),r=requireComposite();return src$E=class extends r{static get id(){return"amqp10"}static get plugins(){return{producer:e,consumer:t}}}}function requireUtil$3(){if(hasRequiredUtil$3)return util$9;return hasRequiredUtil$3=1,util$9={getResourceName:function(e,t={}){return[e,t.exchange,t.routingKey,t.queue,t.source,t.destination].filter((e=>e)).join(" ")}}}function requireProducer$2(){if(hasRequiredProducer$2)return producer$2;hasRequiredProducer$2=1;const{TEXT_MAP:e}=requireFormats(),{CLIENT_PORT_KEY:t}=requireConstants$2(),r=requireProducer$5(),{encodePathwayContext:s}=requirePathway(),{getAmqpMessageSize:n,CONTEXT_PROPAGATION_KEY:i}=requireProcessor(),{getResourceName:a}=requireUtil$3();return producer$2=class extends r{static get id(){return"amqplib"}static get operation(){return"command"}start({channel:r={},method:o,fields:c,message:u}){if("basic.publish"!==o)return;const l=r.connection&&r.connection.stream||{},p=this.startSpan({resource:a(o,c),meta:{"out.host":l._host,[t]:l.remotePort,"amqp.queue":c.queue,"amqp.exchange":c.exchange,"amqp.routingKey":c.routingKey,"amqp.consumerTag":c.consumerTag,"amqp.source":c.source,"amqp.destination":c.destination}});if(c.headers=c.headers||{},this.tracer.inject(p,e,c.headers),this.config.dsmEnabled){const e=null!=c.routingKey,t=n({content:u,headers:c.headers}),r=this.tracer.setCheckpoint(["direction:out",`exchange:${c.exchange}`,`has_routing_key:${e}`,"type:rabbitmq"],p,t),a=s(r);c.headers[i]=a}}},producer$2}function requireConsumer$2(){if(hasRequiredConsumer$2)return consumer$2;hasRequiredConsumer$2=1;const{TEXT_MAP:e}=requireFormats(),t=requireConsumer$5(),{getAmqpMessageSize:r,CONTEXT_PROPAGATION_KEY:s}=requireProcessor(),{getResourceName:n}=requireUtil$3();return consumer$2=class extends t{static get id(){return"amqplib"}static get operation(){return"command"}start({method:t,fields:i,message:a}){if("basic.deliver"!==t&&"basic.get"!==t)return;const o=function(t,r){return r?t.extract(e,r.properties.headers):null}(this.tracer,a),c=this.startSpan({childOf:o,resource:n(t,i),type:"worker",meta:{"amqp.queue":i.queue,"amqp.exchange":i.exchange,"amqp.routingKey":i.routingKey,"amqp.consumerTag":i.consumerTag,"amqp.source":i.source,"amqp.destination":i.destination}});if(this.config.dsmEnabled&&a){const e=r({headers:a.properties.headers,content:a.content}),t=i.queue??i.routingKey;this.tracer.decodeDataStreamsContext(a.properties.headers[s]),this.tracer.setCheckpoint(["direction:in",`topic:${t}`,"type:rabbitmq"],c,e)}}},consumer$2}function requireClient$7(){if(hasRequiredClient$7)return client$7;hasRequiredClient$7=1;const{TEXT_MAP:e}=requireFormats(),{CLIENT_PORT_KEY:t}=requireConstants$2(),r=requireClient$a(),{getResourceName:s}=requireUtil$3();return client$7=class extends r{static get id(){return"amqplib"}static get type(){return"messaging"}static get operation(){return"command"}start({channel:r={},method:n,fields:i}){if("basic.deliver"===n||"basic.get"===n)return;if("basic.publish"===n)return;const a=r.connection&&r.connection.stream||{},o=this.startSpan(this.operationName(),{service:this.config.service||this.serviceName(),resource:s(n,i),kind:this.constructor.kind,meta:{"out.host":a._host,[t]:a.remotePort,"amqp.queue":i.queue,"amqp.exchange":i.exchange,"amqp.routingKey":i.routingKey,"amqp.consumerTag":i.consumerTag,"amqp.source":i.source,"amqp.destination":i.destination}});i.headers=i.headers||{},this.tracer.inject(o,e,i.headers)}},client$7}function requireSrc$D(){if(hasRequiredSrc$D)return src$D;hasRequiredSrc$D=1;const e=requireProducer$2(),t=requireConsumer$2(),r=requireClient$7(),s=requireComposite();return src$D=class extends s{static get id(){return"amqplib"}static get plugins(){return{producer:e,consumer:t,client:r}}}}function requireLog_plugin(){if(hasRequiredLog_plugin)return log_plugin;hasRequiredLog_plugin=1;const{LOG:e}=requireFormats(),t=requirePlugin$1(),{storage:r}=requireDatadogCore();function s(e,t){return new Proxy(e,{get:(e,r,s)=>r===Symbol.toStringTag?Object.prototype.toString.call(e).slice(8,-1):n(e,r)?t.dd:Reflect.get(e,r,s),ownKeys(e){const t=Reflect.ownKeys(e);return r=e,s="dd",Object.prototype.hasOwnProperty.call(r,s)||!Reflect.isExtensible(e)?t:["dd",...t];var r,s},getOwnPropertyDescriptor:(e,r)=>Reflect.getOwnPropertyDescriptor(n(e,r)?t:e,r)})}function n(e,t){return"dd"===t&&!Reflect.has(e,t)&&Reflect.isExtensible(e)}return log_plugin=class extends t{constructor(...t){super(...t),this.addSub(`apm:${this.constructor.id}:log`,(t=>{const n=r.getStore(),i=n&&n.span,a={};this.tracer.inject(i,e,a),t.message=s(t.message,a)}))}configure(e){return super.configure({...e,enabled:e.enabled&&e.logInjection})}},log_plugin}function requireSrc$C(){if(hasRequiredSrc$C)return src$C;hasRequiredSrc$C=1;const e=requireLog_plugin();return src$C=class extends e{static get id(){return"bunyan"}}}function requireSrc$B(){if(hasRequiredSrc$B)return src$B;hasRequiredSrc$B=1;const e=requireDatabase(),t="db.cassandra.contact.points";function r(e,t){return!e||e.length<=t?e:`${e.substr(0,t-3)}...`}return src$B=class extends e{static get id(){return"cassandra-driver"}static get system(){return"cassandra"}static get peerServicePrecursors(){return[t]}start({keyspace:e,query:s,contactPoints:n={}}){Array.isArray(s)&&(s=s.map((e=>(e.query||e).replace(/;?$/,";"))).join(" ")),this.startSpan(this.operationName(),{service:this.serviceName({pluginConfig:this.config,system:this.system}),resource:r(s,5e3),type:"cassandra",kind:"client",meta:{"db.type":"cassandra","cassandra.query":s,"cassandra.keyspace":e,[t]:n.join(",")||null}})}}}function requireParse$1(){if(hasRequiredParse$1)return parse$1;hasRequiredParse$1=1;for(var e="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(","\\<\\<\\<",">>",">\\&","<\\&","[&;()|<>]"].join("|")+")",t=new RegExp("^"+e+"$"),r="|&;()<> \\t",s=/^#$/,n="",i=0;i<4;i++)n+=(4294967296*Math.random()).toString(16);var a=new RegExp("^"+n);function o(i,a,o){o||(o={});var c=o.escape||"\\",u=new RegExp(["("+e+")","("+("(\\"+c+"['\""+r+"]|[^\\s'\""+r+"])+")+"|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')+"].join("|"),"g"),l=function(e,t){for(var r,s=t.lastIndex,n=[];r=t.exec(e);)n.push(r),t.lastIndex===r.index&&(t.lastIndex+=1);return t.lastIndex=s,n}(i,u);if(0===l.length)return[];a||(a={});var p=!1;return l.map((function(e){var r=e[0];if(r&&!p){if(t.test(r))return{op:r};var o,u=!1,l=!1,d="",h=!1;for(o=0;o<r.length;o++){var f=r.charAt(o);if(h=h||!u&&("*"===f||"?"===f),l)d+=f,l=!1;else if(u)f===u?u=!1:"'"==u?d+=f:f===c?(o+=1,d+='"'===(f=r.charAt(o))||f===c||"$"===f?f:c+f):d+="$"===f?m():f;else if('"'===f||"'"===f)u=f;else{if(t.test(f))return{op:r};if(s.test(f)){p=!0;var g={comment:i.slice(e.index+o+1)};return d.length?[d,g]:[g]}f===c?l=!0:d+="$"===f?m():f}}return h?{op:"glob",pattern:d}:d}function m(){var e,t;o+=1;var s=r.charAt(o);if("{"===s){if(o+=1,"}"===r.charAt(o))throw new Error("Bad substitution: "+r.slice(o-2,o+1));if((e=r.indexOf("}",o))<0)throw new Error("Bad substitution: "+r.slice(o));t=r.slice(o,e),o=e}else if(/[*@#?$!_-]/.test(s))t=s,o+=1;else{var i=r.slice(o);(e=i.match(/[^\w\d_]/))?(t=i.slice(0,e.index),o+=e.index-1):(t=i,o=r.length)}return function(e,t,r){var s="function"==typeof e?e(r):e[r];return void 0===s&&""!=r?s="":void 0===s&&(s="$"),"object"==typeof s?t+n+JSON.stringify(s)+n:t+s}(a,"",t)}})).reduce((function(e,t){return void 0===t?e:e.concat(t)}),[])}return parse$1=function(e,t,r){var s=o(e,t,r);return"function"!=typeof t?s:s.reduce((function(e,t){if("object"==typeof t)return e.concat(t);var r=t.split(RegExp("("+n+".*?"+n+")","g"));return 1===r.length?e.concat(r[0]):e.concat(r.filter(Boolean).map((function(e){return a.test(e)?JSON.parse(e.split(n)[1]):e})))}),[])},parse$1}function requireScrubCmdParams(){if(hasRequiredScrubCmdParams)return scrubCmdParams;hasRequiredScrubCmdParams=1;const e=requireParse$1(),t=["LD_PRELOAD","LD_LIBRARY_PATH","PATH"],r=["md5"],s=/\$([\w\d_]*)(?:[^\w\d_]|$)/gim,n=new RegExp("^-{0,2}(?:p(?:ass(?:w(?:or)?d)?)?|api_?key|secret|a(?:ccess|uth)_token|mysql_pwd|credentials|(?:stripe)?token)$","i"),i=new RegExp("^(\\w+=\\w+;)*\\w+=\\w+;?$"),a="?";return scrubCmdParams=function(o){const c=function(e){const t=new Set;let r;for(;r=s.exec(e);)t.add(r[1]);const n={};for(const e of t.keys())n[e]=`$${e}`;return n}(o),u=function(e){const t=[];let r=[],s=!0;return e.forEach((e=>{s&&(t.push(r),s=!1),r.push(e),e.op&&(r=[],s=!0)})),t}(e(o,c)),l=[];return u.forEach((e=>{let s=!1;for(let o=0;o<e.length;o++){const c=e[o];if("object"==typeof c)c.pattern?l.push(c.pattern):c.op?l.push(c.op):c.comment&&l.push(`#${c.comment}`);else if(s){const t=c.split("="),r=t[0];n.test(r)?1===t.length?(e[o+1]=a,l.push(c)):l.push(`${r}=${a}`):l.push(c)}else if(i.test(c)){const r=c.split("=");if(t.includes(r[0]))l.push(c);else{r[1]=a;const t=r.join("=");e[o]=t,l.push(t)}}else if(s=!0,l.push(c),r.includes(c)){for(o++;o<e.length;o++){const t=e[o];t.op?l.push(t.op):(e[o]=a,l.push(a))}break}}})),l},scrubCmdParams}function requireSrc$A(){if(hasRequiredSrc$A)return src$A;hasRequiredSrc$A=1;const e=requireTracing(),t=requireScrubCmdParams(),r=4096;return src$A=class extends e{static get id(){return"child_process"}static get prefix(){return"tracing:datadog:child_process:execution"}get tracer(){return this._tracer}start({command:e,shell:s}){if("string"!=typeof e)return;const n=t(e),i=function(e){let t=e[0].length,s=!1;for(let n=1;n<e.length;n++){if(t>=r){s=!0,e[n]="";continue}const i=e[n].length;t<r&&t+i>r&&(e[n]=e[n].substring(0,2),s=!0),t+=i}return s}(n),a=!0===s?"cmd.shell":"cmd.exec",o={component:"subprocess",[a]:!0===s?n.join(" "):JSON.stringify(n)};i&&(o["cmd.truncated"]=`${i}`),this.startSpan("command_execution",{service:this.config.service,resource:!0===s?"sh":n[0],type:"system",meta:o})}end({result:e,error:t}){let r;if(void 0!==e)r=e?.status||0;else{if(void 0===t)return;r=t?.status||t?.code||0}this.activeSpan?.setTag("cmd.exit_code",`${r}`),this.activeSpan?.finish()}error(e){this.addError(e)}asyncEnd({result:e}){this.activeSpan?.setTag("cmd.exit_code",`${e}`),this.activeSpan?.finish()}}}function requireSrc$z(){if(hasRequiredSrc$z)return src$z;hasRequiredSrc$z=1;const e=requireSrc$L();return src$z=class extends e{static get id(){return"connect"}constructor(...e){super(...e),this.addSub("apm:connect:request:handle",(({req:e})=>{this.setFramework(e,"connect",this.config)}))}}}function requireSrc$y(){if(hasRequiredSrc$y)return src$y;hasRequiredSrc$y=1;const e=requireStorage(),{storage:t}=requireDatadogCore();return src$y=class extends e{static get id(){return"couchbase"}static get peerServicePrecursors(){return["db.couchbase.seed.nodes"]}addSubs(e,t){this.addSub(`apm:couchbase:${e}:start`,t),this.addSub(`apm:couchbase:${e}:error`,(e=>this.addError(e))),this.addSub(`apm:couchbase:${e}:finish`,(e=>this.finish(e)))}startSpan(e,t,r,{bucket:s,collection:n,seedNodes:i}){const a={"db.type":"couchbase",component:"couchbase","resource.name":`couchbase.${e}`,"span.kind":this.constructor.kind,"db.couchbase.seed.nodes":i};s&&(a["couchbase.bucket.name"]=s.name),n&&(a["couchbase.collection.name"]=n.name);for(const e in t)a[e]=t[e];return super.startSpan(this.operationName({operation:e}),{service:this.serviceName({pluginConfig:this.config}),meta:a})}constructor(...e){super(...e),this.addSubs("query",(({resource:e,bucket:r,seedNodes:s})=>{const n=t.getStore(),i=this.startSpan("query",{"span.type":"sql","resource.name":e,"span.kind":this.constructor.kind},n,{bucket:r,seedNodes:s});this.enter(i,n)})),this._addCommandSubs("upsert"),this._addCommandSubs("insert"),this._addCommandSubs("replace"),this._addCommandSubs("append"),this._addCommandSubs("prepend")}_addCommandSubs(e){this.addSubs(e,(({bucket:r,collection:s,seedNodes:n})=>{const i=t.getStore(),a=this.startSpan(e,{},i,{bucket:r,collection:s,seedNodes:n});this.enter(a,i)}))}},src$y}function requireSrc$x(){if(hasRequiredSrc$x)return src$x;hasRequiredSrc$x=1;const e=requirePlugin$1();return src$x=class extends e{static get id(){return"cypress"}}}function requireLookup(){if(hasRequiredLookup)return lookup;hasRequiredLookup=1;const e=requireClient$a();return lookup=class extends e{static get id(){return"dns"}static get operation(){return"lookup"}start([e]){this.startSpan("dns.lookup",{service:this.config.service,resource:e,kind:"client",meta:{"dns.hostname":e,"dns.address":"","dns.addresses":""}})}finish(e){const t=this.activeSpan;if(Array.isArray(e)){const r=Array.isArray(e)?e.map((e=>e.address)).sort():[e];t.setTag("dns.address",r[0]),t.setTag("dns.addresses",r.join(","))}else t.setTag("dns.address",e);super.finish()}},lookup}function requireLookup_service(){if(hasRequiredLookup_service)return lookup_service;hasRequiredLookup_service=1;const e=requireClient$a();return lookup_service=class extends e{static get id(){return"dns"}static get operation(){return"lookup_service"}start([e,t]){this.startSpan("dns.lookup_service",{service:this.config.service,resource:`${e}:${t}`,kind:"client",meta:{"dns.address":e},metrics:{"dns.port":t}})}}}function requireResolve$1(){if(hasRequiredResolve$1)return resolve$1;hasRequiredResolve$1=1;const e=requireClient$a();return resolve$1=class extends e{static get id(){return"dns"}static get operation(){return"resolve"}start([e,t]){const r="string"==typeof t?t:"A";this.startSpan("dns.resolve",{service:this.config.service,resource:`${r} ${e}`,kind:"client",meta:{"dns.hostname":e,"dns.rrtype":r}})}}}function requireReverse(){if(hasRequiredReverse)return reverse;hasRequiredReverse=1;const e=requireClient$a();return reverse=class extends e{static get id(){return"dns"}static get operation(){return"reverse"}start([e]){this.startSpan("dns.reverse",{service:this.config.service,resource:e,kind:"client",meta:{"dns.ip":e}})}}}function requireSrc$w(){if(hasRequiredSrc$w)return src$w;hasRequiredSrc$w=1;const e=requireComposite(),t=requireLookup(),r=requireLookup_service(),s=requireResolve$1(),n=requireReverse();return src$w=class extends e{static get id(){return"dns"}static get plugins(){return{lookup:t,lookup_service:r,resolve:s,reverse:n}}}}function requireSrc$v(){if(hasRequiredSrc$v)return src$v;hasRequiredSrc$v=1;const e=requireSrc$L();return src$v=class extends e{static get id(){return"express"}constructor(...e){super(...e),this.addSub("apm:express:request:handle",(({req:e})=>{this.setFramework(e,"express",this.config)}))}}}function requireSrc$u(){if(hasRequiredSrc$u)return src$u;hasRequiredSrc$u=1;const e=requireSrc$L();return src$u=class extends e{static get id(){return"fastify"}constructor(...e){super(...e),this.addSub("apm:fastify:request:handle",(({req:e})=>{this.setFramework(e,"fastify",this.config)}))}}}function requireSrc$t(){if(hasRequiredSrc$t)return src$t;hasRequiredSrc$t=1;const e=requirePlugin$1(),t=requireWeb();return src$t=class extends e{static get id(){return"find-my-way"}constructor(...e){super(...e),this.addSub("apm:find-my-way:request:route",(({req:e,route:r})=>{t.setRoute(e,r)}))}}}var tools={},signature={},transforms={},lodash_sortby={exports:{}},hasRequiredLodash_sortby,hasRequiredTransforms,hasRequiredSignature,hasRequiredTools,execute,hasRequiredExecute,parse,hasRequiredParse,validate,hasRequiredValidate,resolve,hasRequiredResolve,src$s,hasRequiredSrc$s,channels,hasRequiredChannels,server$7,hasRequiredServer$7,client$6,hasRequiredClient$6,src$r,hasRequiredSrc$r,server$6,hasRequiredServer$6,client$5,hasRequiredClient$5,src$q,hasRequiredSrc$q,src$p,hasRequiredSrc$p,producer$1,hasRequiredProducer$1,consumer$1,hasRequiredConsumer$1,src$o,hasRequiredSrc$o,src$n,hasRequiredSrc$n,src$m,hasRequiredSrc$m,src$l,hasRequiredSrc$l,src$k,hasRequiredSrc$k,src$j,hasRequiredSrc$j,util$8,hasRequiredUtil$2,server$5,hasRequiredServer$5,client$4,hasRequiredClient$4,src$i,hasRequiredSrc$i,src$h,hasRequiredSrc$h,src$g,hasRequiredSrc$g,ipc,hasRequiredIpc,tcp,hasRequiredTcp,src$f,hasRequiredSrc$f,src$e,hasRequiredSrc$e,src$d,hasRequiredSrc$d;function requireLodash_sortby(){return hasRequiredLodash_sortby||(hasRequiredLodash_sortby=1,function(e,t){var r="__lodash_hash_undefined__",s=1,n=2,i=1/0,a=9007199254740991,o="[object Arguments]",c="[object Array]",u="[object Boolean]",l="[object Date]",p="[object Error]",d="[object Function]",h="[object GeneratorFunction]",f="[object Map]",g="[object Number]",m="[object Object]",_="[object Promise]",b="[object RegExp]",y="[object Set]",v="[object String]",S="[object Symbol]",q="[object WeakMap]",E="[object ArrayBuffer]",R="[object DataView]",T=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,A=/^\w*$/,w=/^\./,x=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,I=/\\(\\)?/g,C=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,$={};$["[object Float32Array]"]=$["[object Float64Array]"]=$["[object Int8Array]"]=$["[object Int16Array]"]=$["[object Int32Array]"]=$["[object Uint8Array]"]=$["[object Uint8ClampedArray]"]=$["[object Uint16Array]"]=$["[object Uint32Array]"]=!0,$[o]=$[c]=$[E]=$[u]=$[R]=$[l]=$[p]=$[d]=$[f]=$[g]=$[m]=$[b]=$[y]=$[v]=$[q]=!1;var k="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,P="object"==typeof self&&self&&self.Object===Object&&self,N=k||P||Function("return this")(),L=t&&!t.nodeType&&t,M=L&&e&&!e.nodeType&&e,D=M&&M.exports===L&&k.process,j=function(){try{return D&&D.binding("util")}catch(e){}}(),U=j&&j.isTypedArray;function B(e,t){for(var r=-1,s=e?e.length:0,n=Array(s);++r<s;)n[r]=t(e[r],r,e);return n}function G(e,t){for(var r=-1,s=t.length,n=e.length;++r<s;)e[n+r]=t[r];return e}function F(e,t){for(var r=-1,s=e?e.length:0;++r<s;)if(t(e[r],r,e))return!0;return!1}function z(e){return function(t){return e(t)}}function V(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function H(e){var t=-1,r=Array(e.size);return e.forEach((function(e,s){r[++t]=[s,e]})),r}function W(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var K,Y,J,X=Array.prototype,Q=Function.prototype,Z=Object.prototype,ee=N["__core-js_shared__"],te=(K=/[^.]+$/.exec(ee&&ee.keys&&ee.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",re=Q.toString,se=Z.hasOwnProperty,ne=Z.toString,ie=RegExp("^"+re.call(se).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ae=N.Symbol,oe=N.Uint8Array,ce=Z.propertyIsEnumerable,ue=X.splice,le=ae?ae.isConcatSpreadable:void 0,pe=(Y=Object.keys,J=Object,function(e){return Y(J(e))}),de=Math.max,he=Ke(N,"DataView"),fe=Ke(N,"Map"),ge=Ke(N,"Promise"),me=Ke(N,"Set"),_e=Ke(N,"WeakMap"),be=Ke(Object,"create"),ye=nt(he),ve=nt(fe),Se=nt(ge),qe=nt(me),Ee=nt(_e),Re=ae?ae.prototype:void 0,Te=Re?Re.valueOf:void 0,Ae=Re?Re.toString:void 0;function we(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function xe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function Ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function Ce(e){var t=-1,r=e?e.length:0;for(this.__data__=new Ie;++t<r;)this.add(e[t])}function Oe(e){this.__data__=new xe(e)}function $e(e,t){var r=ut(e)||ct(e)?function(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}(e.length,String):[],s=r.length,n=!!s;for(var i in e)!se.call(e,i)||n&&("length"==i||Xe(i,s))||r.push(i);return r}function ke(e,t){for(var r=e.length;r--;)if(ot(e[r][0],t))return r;return-1}we.prototype.clear=function(){this.__data__=be?be(null):{}},we.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},we.prototype.get=function(e){var t=this.__data__;if(be){var s=t[e];return s===r?void 0:s}return se.call(t,e)?t[e]:void 0},we.prototype.has=function(e){var t=this.__data__;return be?void 0!==t[e]:se.call(t,e)},we.prototype.set=function(e,t){return this.__data__[e]=be&&void 0===t?r:t,this},xe.prototype.clear=function(){this.__data__=[]},xe.prototype.delete=function(e){var t=this.__data__,r=ke(t,e);return!(r<0)&&(r==t.length-1?t.pop():ue.call(t,r,1),!0)},xe.prototype.get=function(e){var t=this.__data__,r=ke(t,e);return r<0?void 0:t[r][1]},xe.prototype.has=function(e){return ke(this.__data__,e)>-1},xe.prototype.set=function(e,t){var r=this.__data__,s=ke(r,e);return s<0?r.push([e,t]):r[s][1]=t,this},Ie.prototype.clear=function(){this.__data__={hash:new we,map:new(fe||xe),string:new we}},Ie.prototype.delete=function(e){return We(this,e).delete(e)},Ie.prototype.get=function(e){return We(this,e).get(e)},Ie.prototype.has=function(e){return We(this,e).has(e)},Ie.prototype.set=function(e,t){return We(this,e).set(e,t),this},Ce.prototype.add=Ce.prototype.push=function(e){return this.__data__.set(e,r),this},Ce.prototype.has=function(e){return this.__data__.has(e)},Oe.prototype.clear=function(){this.__data__=new xe},Oe.prototype.delete=function(e){return this.__data__.delete(e)},Oe.prototype.get=function(e){return this.__data__.get(e)},Oe.prototype.has=function(e){return this.__data__.has(e)},Oe.prototype.set=function(e,t){var r=this.__data__;if(r instanceof xe){var s=r.__data__;if(!fe||s.length<199)return s.push([e,t]),this;r=this.__data__=new Ie(s)}return r.set(e,t),this};var Pe,Ne=(Pe=function(e,t){return e&&Le(e,t,_t)},function(e,t){if(null==e)return e;if(!lt(e))return Pe(e,t);for(var r=e.length,s=-1,n=Object(e);++s<r&&!1!==t(n[s],s,n););return e});var Le=function(e,t,r){for(var s=-1,n=Object(e),i=r(e),a=i.length;a--;){var o=i[++s];if(!1===t(n[o],o,n))break}return e};function Me(e,t){for(var r=0,s=(t=Ze(t,e)?[t]:ze(t)).length;null!=e&&r<s;)e=e[st(t[r++])];return r&&r==s?e:void 0}function De(e,t){return null!=e&&t in Object(e)}function je(e,t,r,i,a){return e===t||(null==e||null==t||!ht(e)&&!ft(t)?e!=e&&t!=t:function(e,t,r,i,a,d){var h=ut(e),_=ut(t),q=c,T=c;h||(q=(q=Ye(e))==o?m:q);_||(T=(T=Ye(t))==o?m:T);var A=q==m&&!V(e),w=T==m&&!V(t),x=q==T;if(x&&!A)return d||(d=new Oe),h||mt(e)?He(e,t,r,i,a,d):function(e,t,r,i,a,o,c){switch(r){case R:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case E:return!(e.byteLength!=t.byteLength||!i(new oe(e),new oe(t)));case u:case l:case g:return ot(+e,+t);case p:return e.name==t.name&&e.message==t.message;case b:case v:return e==t+"";case f:var d=H;case y:var h=o&n;if(d||(d=W),e.size!=t.size&&!h)return!1;var m=c.get(e);if(m)return m==t;o|=s,c.set(e,t);var _=He(d(e),d(t),i,a,o,c);return c.delete(e),_;case S:if(Te)return Te.call(e)==Te.call(t)}return!1}(e,t,q,r,i,a,d);if(!(a&n)){var I=A&&se.call(e,"__wrapped__"),C=w&&se.call(t,"__wrapped__");if(I||C){var O=I?e.value():e,$=C?t.value():t;return d||(d=new Oe),r(O,$,i,a,d)}}if(!x)return!1;return d||(d=new Oe),function(e,t,r,s,i,a){var o=i&n,c=_t(e),u=c.length,l=_t(t),p=l.length;if(u!=p&&!o)return!1;var d=u;for(;d--;){var h=c[d];if(!(o?h in t:se.call(t,h)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var g=!0;a.set(e,t),a.set(t,e);var m=o;for(;++d<u;){var _=e[h=c[d]],b=t[h];if(s)var y=o?s(b,_,h,t,e,a):s(_,b,h,e,t,a);if(!(void 0===y?_===b||r(_,b,s,i,a):y)){g=!1;break}m||(m="constructor"==h)}if(g&&!m){var v=e.constructor,S=t.constructor;v==S||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof S&&S instanceof S||(g=!1)}return a.delete(e),a.delete(t),g}(e,t,r,i,a,d)}(e,t,je,r,i,a))}function Ue(e){return!(!ht(e)||function(e){return!!te&&te in e}(e))&&(pt(e)||V(e)?ie:C).test(nt(e))}function Be(e){return"function"==typeof e?e:null==e?bt:"object"==typeof e?ut(e)?function(e,t){if(Ze(e)&&et(t))return tt(st(e),t);return function(r){var i=function(e,t,r){var s=null==e?void 0:Me(e,t);return void 0===s?r:s}(r,e);return void 0===i&&i===t?function(e,t){return null!=e&&function(e,t,r){t=Ze(t,e)?[t]:ze(t);var s,n=-1,i=t.length;for(;++n<i;){var a=st(t[n]);if(!(s=null!=e&&r(e,a)))break;e=e[a]}if(s)return s;i=e?e.length:0;return!!i&&dt(i)&&Xe(a,i)&&(ut(e)||ct(e))}(e,t,De)}(r,e):je(t,i,void 0,s|n)}}(e[0],e[1]):function(e){var t=function(e){var t=_t(e),r=t.length;for(;r--;){var s=t[r],n=e[s];t[r]=[s,n,et(n)]}return t}(e);if(1==t.length&&t[0][2])return tt(t[0][0],t[0][1]);return function(r){return r===e||function(e,t,r,i){var a=r.length,o=a;if(null==e)return!o;for(e=Object(e);a--;){var c=r[a];if(c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++a<o;){var u=(c=r[a])[0],l=e[u],p=c[1];if(c[2]){if(void 0===l&&!(u in e))return!1}else{var d=new Oe;if(!je(p,l,i,s|n,d))return!1}}return!0}(r,0,t)}}(e):Ze(t=e)?(r=st(t),function(e){return null==e?void 0:e[r]}):function(e){return function(t){return Me(t,e)}}(t);var t,r}function Ge(e){if(r=(t=e)&&t.constructor,s="function"==typeof r&&r.prototype||Z,t!==s)return pe(e);var t,r,s,n=[];for(var i in Object(e))se.call(e,i)&&"constructor"!=i&&n.push(i);return n}function Fe(e,t,r){var s=-1;t=B(t.length?t:[bt],z(Be));var n=function(e,t){var r=-1,s=lt(e)?Array(e.length):[];return Ne(e,(function(e,n,i){s[++r]=t(e,n,i)})),s}(e,(function(e,r,n){return{criteria:B(t,(function(t){return t(e)})),index:++s,value:e}}));return function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(n,(function(e,t){return function(e,t,r){var s=-1,n=e.criteria,i=t.criteria,a=n.length,o=r.length;for(;++s<a;){var c=Ve(n[s],i[s]);if(c)return s>=o?c:c*("desc"==r[s]?-1:1)}return e.index-t.index}(e,t,r)}))}function ze(e){return ut(e)?e:rt(e)}function Ve(e,t){if(e!==t){var r=void 0!==e,s=null===e,n=e==e,i=gt(e),a=void 0!==t,o=null===t,c=t==t,u=gt(t);if(!o&&!u&&!i&&e>t||i&&a&&c&&!o&&!u||s&&a&&c||!r&&c||!n)return 1;if(!s&&!i&&!u&&e<t||u&&r&&n&&!s&&!i||o&&r&&n||!a&&n||!c)return-1}return 0}function He(e,t,r,i,a,o){var c=a&n,u=e.length,l=t.length;if(u!=l&&!(c&&l>u))return!1;var p=o.get(e);if(p&&o.get(t))return p==t;var d=-1,h=!0,f=a&s?new Ce:void 0;for(o.set(e,t),o.set(t,e);++d<u;){var g=e[d],m=t[d];if(i)var _=c?i(m,g,d,t,e,o):i(g,m,d,e,t,o);if(void 0!==_){if(_)continue;h=!1;break}if(f){if(!F(t,(function(e,t){if(!f.has(t)&&(g===e||r(g,e,i,a,o)))return f.add(t)}))){h=!1;break}}else if(g!==m&&!r(g,m,i,a,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function We(e,t){var r,s,n=e.__data__;return("string"==(s=typeof(r=t))||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function Ke(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Ue(r)?r:void 0}var Ye=function(e){return ne.call(e)};function Je(e){return ut(e)||ct(e)||!!(le&&e&&e[le])}function Xe(e,t){return!!(t=null==t?a:t)&&("number"==typeof e||O.test(e))&&e>-1&&e%1==0&&e<t}function Qe(e,t,r){if(!ht(r))return!1;var s=typeof t;return!!("number"==s?lt(r)&&Xe(t,r.length):"string"==s&&t in r)&&ot(r[t],e)}function Ze(e,t){if(ut(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!gt(e))||(A.test(e)||!T.test(e)||null!=t&&e in Object(t))}function et(e){return e==e&&!ht(e)}function tt(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}(he&&Ye(new he(new ArrayBuffer(1)))!=R||fe&&Ye(new fe)!=f||ge&&Ye(ge.resolve())!=_||me&&Ye(new me)!=y||_e&&Ye(new _e)!=q)&&(Ye=function(e){var t=ne.call(e),r=t==m?e.constructor:void 0,s=r?nt(r):void 0;if(s)switch(s){case ye:return R;case ve:return f;case Se:return _;case qe:return y;case Ee:return q}return t});var rt=at((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(gt(e))return Ae?Ae.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}(t);var r=[];return w.test(e)&&r.push(""),e.replace(x,(function(e,t,s,n){r.push(s?n.replace(I,"$1"):t||e)})),r}));function st(e){if("string"==typeof e||gt(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}function nt(e){if(null!=e){try{return re.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var it=function(e,t){return t=de(void 0===t?e.length-1:t,0),function(){for(var r=arguments,s=-1,n=de(r.length-t,0),i=Array(n);++s<n;)i[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=i,function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,a)}}((function(e,t){if(null==e)return[];var r=t.length;return r>1&&Qe(e,t[0],t[1])?t=[]:r>2&&Qe(t[0],t[1],t[2])&&(t=[t[0]]),Fe(e,function(e,t,r,s,n){var i=-1,a=e.length;for(r||(r=Je),n||(n=[]);++i<a;){var o=e[i];r(o)?G(n,o):n[n.length]=o}return n}(t),[])}));function at(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var s=arguments,n=t?t.apply(this,s):s[0],i=r.cache;if(i.has(n))return i.get(n);var a=e.apply(this,s);return r.cache=i.set(n,a),a};return r.cache=new(at.Cache||Ie),r}function ot(e,t){return e===t||e!=e&&t!=t}function ct(e){return function(e){return ft(e)&&lt(e)}(e)&&se.call(e,"callee")&&(!ce.call(e,"callee")||ne.call(e)==o)}at.Cache=Ie;var ut=Array.isArray;function lt(e){return null!=e&&dt(e.length)&&!pt(e)}function pt(e){var t=ht(e)?ne.call(e):"";return t==d||t==h}function dt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}function ht(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ft(e){return!!e&&"object"==typeof e}function gt(e){return"symbol"==typeof e||ft(e)&&ne.call(e)==S}var mt=U?z(U):function(e){return ft(e)&&dt(e.length)&&!!$[ne.call(e)]};function _t(e){return lt(e)?$e(e):Ge(e)}function bt(e){return e}e.exports=it}(lodash_sortby,lodash_sortby.exports)),lodash_sortby.exports}function requireTransforms(){if(hasRequiredTransforms)return transforms;hasRequiredTransforms=1;var e=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(transforms,"__esModule",{value:!0});const t=require$$0$e,r=require$$1$3,s=require$$2$3,n=e(requireLodash_sortby());function i(e){if(e)return n.default.apply(null,arguments)}return transforms.hideLiterals=function(e){return t.visit(e,{IntValue:e=>Object.assign({},e,{value:"0"}),FloatValue:e=>Object.assign({},e,{value:"0"}),StringValue:e=>Object.assign({},e,{value:"",block:!1}),ListValue:e=>Object.assign({},e,{values:[]}),ObjectValue:e=>Object.assign({},e,{fields:[]})})},transforms.hideStringAndNumericLiterals=function(e){return t.visit(e,{IntValue:e=>Object.assign({},e,{value:"0"}),FloatValue:e=>Object.assign({},e,{value:"0"}),StringValue:e=>Object.assign({},e,{value:"",block:!1})})},transforms.dropUnusedDefinitions=function(e,t){const r=s.separateOperations(e)[t];return r||e},transforms.sortAST=function(e){return t.visit(e,{OperationDefinition:e=>Object.assign({},e,{variableDefinitions:i(e.variableDefinitions,"variable.name.value")}),SelectionSet:e=>Object.assign({},e,{selections:n.default(e.selections,"kind","name.value")}),Field:e=>Object.assign({},e,{arguments:i(e.arguments,"name.value")}),FragmentSpread:e=>Object.assign({},e,{directives:i(e.directives,"name.value")}),InlineFragment:e=>Object.assign({},e,{directives:i(e.directives,"name.value")}),FragmentDefinition:e=>Object.assign({},e,{directives:i(e.directives,"name.value"),variableDefinitions:i(e.variableDefinitions,"variable.name.value")}),Directive:e=>Object.assign({},e,{arguments:i(e.arguments,"name.value")})})},transforms.removeAliases=function(e){return t.visit(e,{Field:e=>Object.assign({},e,{alias:void 0})})},transforms.printWithReducedWhitespace=function(e){const s=t.visit(e,{StringValue:e=>Object.assign({},e,{value:Buffer.from(e.value,"utf8").toString("hex"),block:!1})});return r.print(s).replace(/\s+/g," ").replace(/([^_a-zA-Z0-9]) /g,((e,t)=>t)).replace(/ ([^_a-zA-Z0-9])/g,((e,t)=>t)).replace(/"([a-f0-9]+)"/g,((e,t)=>JSON.stringify(Buffer.from(t,"hex").toString("utf8"))))},transforms}function requireSignature(){if(hasRequiredSignature)return signature;hasRequiredSignature=1,Object.defineProperty(signature,"__esModule",{value:!0});const e=requireTransforms();return signature.defaultEngineReportingSignature=function(t,r){return e.printWithReducedWhitespace(e.sortAST(e.removeAliases(e.hideLiterals(e.dropUnusedDefinitions(t,r)))))},signature}function requireTools(){if(hasRequiredTools)return tools;hasRequiredTools=1,Object.defineProperty(tools,"__esModule",{value:!0});var e=requireSignature();return tools.defaultEngineReportingSignature=e.defaultEngineReportingSignature,tools}function requireExecute(){if(hasRequiredExecute)return execute;hasRequiredExecute=1;const e=requireTracing();let t;function r(e,r,s,n){if(!1!==n&&!1!==t)try{try{t=t||requireTools()}catch(e){throw t=!1,e}return t.defaultEngineReportingSignature(e,r)}catch(e){}return[s,r].filter((e=>e)).join(" ")}return execute=class extends e{static get id(){return"graphql"}static get operation(){return"execute"}static get type(){return"graphql"}static get kind(){return"server"}start({operation:e,args:t,docSource:s}){const n=e&&e.operation,i=e&&e.name&&e.name.value,a=t.document,o=this.config.source&&a&&s,c=this.startSpan(this.operationName(),{service:this.config.service||this.serviceName(),resource:r(a,i,n,this.config.signature),kind:this.constructor.kind,type:this.constructor.type,meta:{"graphql.operation.type":n,"graphql.operation.name":i,"graphql.source":o}});!function(e,t,r){const s={};if(r&&e.variables){const t=e.variables(r);for(const e in t)s[`graphql.variables.${e}`]=t[e]}t.addTags(s)}(this.config,c,t.variableValues)}finish({res:e,args:t}){const r=this.activeSpan;this.config.hooks.execute(r,t,e),super.finish()}},execute}function requireParse(){if(hasRequiredParse)return parse;hasRequiredParse=1;const e=requireTracing();return parse=class extends e{static get id(){return"graphql"}static get operation(){return"parser"}start(){this.startSpan("graphql.parse",{service:this.config.service,type:"graphql",meta:{"graphql.source":""}})}finish({source:e,document:t,docSource:r}){const s=this.activeSpan;this.config.source&&t&&s.setTag("graphql.source",r),this.config.hooks.parse(s,e,t),super.finish()}},parse}function requireValidate(){if(hasRequiredValidate)return validate;hasRequiredValidate=1;const e=requireTracing();return validate=class extends e{static get id(){return"graphql"}static get operation(){return"validate"}start({docSource:e,document:t}){const r=this.config.source&&t&&e;this.startSpan("graphql.validate",{service:this.config.service,type:"graphql",meta:{"graphql.source":r}})}finish({document:e,errors:t}){const r=this.activeSpan;this.config.hooks.validate(r,e,t),super.finish()}},validate}function requireResolve(){if(hasRequiredResolve)return resolve;hasRequiredResolve=1;const e=requireTracing(),t=requireDcPolyfill(),r=Symbol("collapsedPaths");function s(e,t){const r=t.filter((e=>"string"==typeof e)).length;return e.depth<0||e.depth>=r}function n(e,t){const r=t.collapse?function(e){return function(){return e.apply(this,arguments).map((e=>"number"==typeof e?"*":e))}}(i):i;return r(e&&e.path)}function i(e){const t=[];let r=e;for(;r;)t.push(r.key),r=r.prev;return t.reverse()}function a(e,t){let r=null;const s={};t&&Object.keys(t).length&&Object.assign(s,t);const n=e.fieldNodes[0].directives;for(const e of n){const t={};for(const r of e.arguments)t[r.name.value]=r.value.value;Object.keys(t).length&&(s[e.name.value]=t)}return Object.keys(s).length&&(r={[e.fieldName]:s}),r}return resolve=class extends e{static get id(){return"graphql"}static get operation(){return"resolve"}start({info:e,context:t,args:i}){const o=n(e,this.config);if(!s(this.config,o))return;const c=o.join(".");if(this.config.collapse){if(t[r]||(t[r]={}),t.fields[c])return;if(t[r][c])return;t[r][c]=!0}const u=t.source,l=e.fieldNodes.find((e=>"Field"===e.kind)),p=this.config.source&&u&&l&&l.loc,d=p&&u.substring(p.start,p.end),h=this.startSpan("graphql.resolve",{service:this.config.service,resource:`${e.fieldName}:${e.returnType}`,type:"graphql",meta:{"graphql.field.name":e.fieldName,"graphql.field.path":c,"graphql.field.type":e.returnType.name,"graphql.source":d}});if(l&&this.config.variables&&l.arguments){const t=this.config.variables(e.variableValues);l.arguments.filter((e=>e.value&&"Variable"===e.value.kind)).filter((e=>e.value.name&&t[e.value.name.value])).map((e=>e.value.name.value)).forEach((e=>{h.setTag(`graphql.variables.${e}`,t[e])}))}this.resolverStartCh.hasSubscribers&&this.resolverStartCh.publish({context:t,resolverInfo:a(e,i)})}constructor(...e){super(...e),this.addTraceSub("updateField",(({field:e,info:t,err:r})=>{const i=n(t,this.config);if(!s(this.config,i))return;const a=this.activeSpan;e.finishTime=a._getTime?a._getTime():0,e.error=e.error||r})),this.resolverStartCh=t.channel("datadog:graphql:resolver:start")}configure(e){super.configure(0!==e.depth&&e)}},resolve}function requireSrc$s(){if(hasRequiredSrc$s)return src$s;hasRequiredSrc$s=1;const e=requirePick(),t=requireComposite(),r=requireLog$2(),s=requireExecute(),n=requireParse(),i=requireValidate(),a=requireResolve();function o(e){return"number"==typeof e.depth?e.depth:(e.hasOwnProperty("depth")&&r.error("Expected `depth` to be a integer."),-1)}function c(t){return"function"==typeof t.variables?t.variables:t.variables instanceof Array?r=>e(r,t.variables):(t.hasOwnProperty("variables")&&r.error("Expected `variables` to be an array or function."),null)}function u(e){const t=()=>{};return{execute:e.hooks?.execute||t,parse:e.hooks?.parse||t,validate:e.hooks?.validate||t}}return src$s=class extends t{static get id(){return"graphql"}static get plugins(){return{execute:s,parse:n,validate:i,resolve:a}}configure(e){return super.configure(function(e){return Object.assign({},e,{depth:o(e),variables:c(e),collapse:void 0===e.collapse||!!e.collapse,hooks:u(e)})}(e))}},src$s}function requireChannels(){if(hasRequiredChannels)return channels;hasRequiredChannels=1;const e=requireDcPolyfill();return channels={bodyParser:e.channel("datadog:body-parser:read:finish"),cookieParser:e.channel("datadog:cookie-parser:read:finish"),startGraphqlResolve:e.channel("datadog:graphql:resolver:start"),graphqlMiddlewareChannel:e.tracingChannel("datadog:apollo:middleware"),apolloChannel:e.tracingChannel("datadog:apollo:request"),apolloServerCoreChannel:e.tracingChannel("datadog:apollo-server-core:request"),incomingHttpRequestStart:e.channel("dd-trace:incomingHttpRequestStart"),incomingHttpRequestEnd:e.channel("dd-trace:incomingHttpRequestEnd"),passportVerify:e.channel("datadog:passport:verify:finish"),queryParser:e.channel("datadog:query:read:finish"),setCookieChannel:e.channel("datadog:iast:set-cookie"),nextBodyParsed:e.channel("apm:next:body-parsed"),nextQueryParsed:e.channel("apm:next:query-parsed"),responseBody:e.channel("datadog:express:response:json:start")}}function requireServer$7(){if(hasRequiredServer$7)return server$7;hasRequiredServer$7=1;const e=requireServer$9(),{storage:t}=requireDatadogCore(),r=requireWeb(),{incomingHttpRequestStart:s,incomingHttpRequestEnd:n}=requireChannels(),{COMPONENT:i}=requireConstants$2();return server$7=class extends e{static get id(){return"http"}constructor(...e){super(...e),this._parentStore=void 0,this.addTraceSub("exit",(e=>this.exit(e)))}addTraceSub(e,t){this.addSub(`apm:${this.constructor.id}:server:${this.operation}:${e}`,t)}start({req:e,res:n,abortController:a}){const o=t.getStore(),c=r.startSpan(this.tracer,{...this.config,service:this.config.service||this.serviceName()},e,n,this.operationName());c.setTag(i,this.constructor.id),this._parentStore=o,this.enter(c,{...o,req:e,res:n});const u=r.getContext(e);u.instrumented||(u.res.writeHead=r.wrapWriteHead(u),u.instrumented=!0),s.hasSubscribers&&s.publish({req:e,res:n,abortController:a})}error(e){r.addError(e)}finish({req:e}){const t=r.getContext(e);t&&t.res&&(n.hasSubscribers&&n.publish({req:e,res:t.res}),r.finishAll(t))}exit({req:e}){const t=this._parentStore&&this._parentStore.span;this.enter(t,this._parentStore),this._parentStore=void 0}configure(e){return super.configure(r.normalizeConfig(e))}},server$7}function requireClient$6(){if(hasRequiredClient$6)return client$6;hasRequiredClient$6=1;const e=requireClient$a(),{storage:t}=requireDatadogCore(),r=requireTags$2(),s=requireAnalytics_sampler(),n=requireFormats().HTTP_HEADERS,i=requireUrlfilter(),a=requireLog$2(),{CLIENT_PORT_KEY:o,COMPONENT:c,ERROR_MESSAGE:u,ERROR_TYPE:l,ERROR_STACK:p}=requireConstants$2(),{URL:d}=require$$0$8,h=r.HTTP_STATUS_CODE,f=r.HTTP_REQUEST_HEADERS,g=r.HTTP_RESPONSE_HEADERS;function m(e){return e=Object.assign({},e,{blocklist:e.blocklist||[]}),i.getFilter(e)}function _(e){if("string"==typeof e)return new d(e).host;return{host:e.hostname||e.host||"localhost",port:e.port}}return client$6=class extends e{static get id(){return"http"}static get prefix(){return"apm:http:client:request"}bindStart(e){const{args:r,http:i={}}=e,a=t.getStore(),u=r.options,l=u.agent||u._defaultAgent||i.globalAgent||{},p=u.protocol||l.protocol||"http:",d=u.hostname||u.host||"localhost",h=u.port?`${d}:${u.port}`:d,f=u.path||u.pathname,g=`${p}//${h}${f?f.split(/[?#]/)[0]:"/"}`,m=this.config.filter(g),b=(u.method||"GET").toUpperCase(),y=a&&m?a.span:null,v=this.startSpan(this.operationName(),{childOf:y,meta:{[c]:this.constructor.id,"span.kind":"client","service.name":this.serviceName({pluginConfig:this.config,sessionDetails:_(u)}),"resource.name":b,"span.type":"http","http.method":b,"http.url":g,"out.host":d},metrics:{[o]:parseInt(u.port)}},!1);return m||(v._spanContext._trace.record=!1),this.shouldInjectTraceHeaders(u,g)&&this.tracer.inject(v,n,u.headers),s.sample(v,this.config.measured),e.span=v,e.parentStore=a,e.currentStore={...a,span:v},e.currentStore}shouldInjectTraceHeaders(e,t){return!(function(e){if(!e)return!1;if(e.headers){const r=Object.keys(e.headers).reduce(((t,r)=>Object.assign(t,{[r.toLowerCase()]:e.headers[r]})),{});if(r["x-amz-signature"])return!0;if([].concat(r.authorization).some((t="AWS4-HMAC-SHA256",e=>String(e).startsWith(t))))return!0}var t;const r=e.search||e.path;return r&&-1!==r.toLowerCase().indexOf("x-amz-signature=")}(e)&&!this.config.enablePropagationWithAmazonHeaders)&&!!this.config.propagationFilter(t)}bindAsyncStart({parentStore:e}){return e}finish({req:e,res:t,span:r}){if(r){if(t){const e=t.status||t.statusCode;r.setTag(h,e),this.config.validateStatus(e)||r.setTag("error",1),function(e,t,r){if(!e.headers)return;const s="function"==typeof e.headers.entries?Object.fromEntries(e.headers.entries()):e.headers;r.headers.forEach((([e,r])=>{const n=s[e];n&&t.setTag(r||`${g}.${e}`,n)}))}(t,r,this.config)}!function(e,t,r){const s=e.headers&&"function"==typeof e.headers.entries?Object.fromEntries(e.headers.entries()):e.headers||e.getHeaders();r.headers.forEach((([e,r])=>{const n=Array.isArray(s[e])?s[e].toString():s[e];n&&t.setTag(r||`${f}.${e}`,n)}))}(e,r,this.config),this.config.hooks.request(r,e,t),this.tagPeerService(r),r.finish()}}error({span:e,error:t,args:r,customRequestTimeout:s}){if(e)if(t)e.addTags({[l]:t.name,[u]:t.message||t.code,[p]:t.stack});else{if(!r.options.agent?.options?.timeout&&!s)return;e.setTag("error",1)}}configure(e){return super.configure(function(e){const t=function(e){if("function"==typeof e.validateStatus)return e.validateStatus;e.hasOwnProperty("validateStatus")&&a.error("Expected `validateStatus` to be a function.");return e=>e<400||e>=500}(e),r=m(e),s=m({blocklist:e.propagationBlocklist}),n=function(e){return Array.isArray(e.headers)?e.headers.filter((e=>"string"==typeof e)).map((e=>e.split(":"))).map((([e,t])=>[e.toLowerCase(),t])):[]}(e),i=function(e){const t=()=>{},r=e.hooks&&e.hooks.request||t;return{request:r}}(e);return Object.assign({},e,{validateStatus:t,filter:r,propagationFilter:s,headers:n,hooks:i})}(e))}},client$6}function requireSrc$r(){if(hasRequiredSrc$r)return src$r;hasRequiredSrc$r=1;const e=requireServer$7(),t=requireClient$6(),r=requireComposite();return src$r=class extends r{static get id(){return"http"}static get plugins(){return{server:e,client:t}}}}function requireServer$6(){if(hasRequiredServer$6)return server$6;hasRequiredServer$6=1;const e=requireServer$9(),{storage:t}=requireDatadogCore(),r=requireWeb(),{COMPONENT:s}=requireConstants$2();return server$6=class extends e{static get id(){return"http2"}addTraceSub(e,t){this.addSub(`apm:${this.constructor.id}:server:${this.operation}:${e}`,t)}start({req:e,res:n}){const i=t.getStore(),a=r.startSpan(this.tracer,{...this.config,service:this.config.service||this.serviceName()},e,n,this.operationName());a.setTag(s,this.constructor.id),this.enter(a,{...i,req:e,res:n});const o=r.getContext(e);o.instrumented||(o.res.writeHead=r.wrapWriteHead(o),o.instrumented=!0)}finish({req:e}){const t=r.getContext(e);t&&t.res&&r.finishAll(t)}error(e){r.addError(e)}configure(e){return super.configure(r.normalizeConfig(e))}},server$6}function requireClient$5(){if(hasRequiredClient$5)return client$5;hasRequiredClient$5=1;const{storage:e}=requireDatadogCore(),t=requireClient$a(),r=require$$0$8.URL,s=requireLog$2(),n=requireTags$2(),i=requireKinds(),a=requireFormats(),{COMPONENT:o,CLIENT_PORT_KEY:c}=requireConstants$2(),u=requireUrlfilter(),l=a.HTTP_HEADERS,p=n.HTTP_STATUS_CODE,d=n.HTTP_REQUEST_HEADERS,h=n.HTTP_RESPONSE_HEADERS,f=n.SPAN_KIND,g=i.CLIENT;function m(e,t,r,s){t&&s.headers.forEach((s=>{const n=t[s];n&&e.setTag(`${r}.${s}`,n)}))}return client$5=class extends t{static get id(){return"http2"}static get prefix(){return"apm:http2:client:request"}bindStart(t){const{authority:s,options:n,headers:i={}}=t,a=function(e,t){"string"==typeof e&&(e=new r(e));const s=e.protocol||t.protocol||"https:";let n=""+(""!==e.port?e.port:"http:"===e.protocol?80:443),i=e.hostname||e.host||"localhost";"https:"===s&&t&&(n=t.port||n,i=t.host||i);return{protocol:s,port:n,host:i}}(s,n),u=i[":path"]||"/",p=u.split(/[?#]/)[0],h=i[":method"]||"GET",_=`${a.protocol}//${a.host}:${a.port}${p}`,b=this.config.filter(_),y=e.getStore(),v=y&&b?y.span:null,S=this.startSpan(this.operationName(),{childOf:v,meta:{[o]:this.constructor.id,[f]:g,"service.name":this.serviceName({pluginConfig:this.config,sessionDetails:a}),"resource.name":h,"span.type":"http","http.method":h,"http.url":_,"out.host":a.host},metrics:{[c]:parseInt(a.port)}},!1);return b||(S._spanContext._trace.record=!1),m(S,i,d,this.config),function(e,t){if(e){if(e=Object.keys(e).reduce(((t,r)=>Object.assign(t,{[r.toLowerCase()]:e[r]})),{}),e["x-amz-signature"])return!0;if([].concat(e.authorization).some((r="AWS4-HMAC-SHA256",e=>String(e).startsWith(r))))return!0}var r;return t&&-1!==t.toLowerCase().indexOf("x-amz-signature=")}(i,u)||this.tracer.inject(S,l,i),t.parentStore=y,t.currentStore={...y,span:S},t.currentStore}bindAsyncStart({eventName:t,eventData:r,currentStore:s,parentStore:n}){switch(t){case"response":return this._onResponse(s,r),n;case"error":return this._onError(s,r),n;case"close":return this._onClose(s,r),n}return e.getStore()}configure(e){return super.configure(function(e){const t=function(e){if("function"==typeof e.validateStatus)return e.validateStatus;e.hasOwnProperty("validateStatus")&&s.error("Expected `validateStatus` to be a function.");return e=>e<400||e>=500}(e),r=function(e){return e=Object.assign({},e,{blocklist:e.blocklist||[]}),u.getFilter(e)}(e),n=function(e){return Array.isArray(e.headers)?e.headers.filter((e=>"string"==typeof e)).map((e=>e.toLowerCase())):[]}(e);return Object.assign({},e,{validateStatus:t,filter:r,headers:n})}(e))}_onResponse(t,r){const s=r&&r[":status"];t.span.setTag(p,s),this.config.validateStatus(s)||e.run(t,(()=>this.addError())),m(t.span,r,h,this.config)}_onError({span:e},t){e.setTag("error",t),e.finish()}_onClose({span:e}){this.tagPeerService(e),e.finish()}},client$5}function requireSrc$q(){if(hasRequiredSrc$q)return src$q;hasRequiredSrc$q=1;const e=requireServer$6(),t=requireClient$5(),r=requireComposite();return src$q=class extends r{static get id(){return"http2"}static get plugins(){return{server:e,client:t}}}}function requireSrc$p(){if(hasRequiredSrc$p)return src$p;hasRequiredSrc$p=1;const e=requireSrc$H();return src$p=class extends e{static get id(){return"ioredis"}}}function requireProducer$1(){if(hasRequiredProducer$1)return producer$1;hasRequiredProducer$1=1;const e=requireProducer$5(),{encodePathwayContext:t}=requirePathway(),{getMessageSize:r,CONTEXT_PROPAGATION_KEY:s}=requireProcessor(),n="messaging.kafka.bootstrap.servers";return producer$1=class extends e{static get id(){return"kafkajs"}static get operation(){return"produce"}static get peerServicePrecursors(){return[n]}constructor(){super(...arguments),this.addSub("apm:kafkajs:produce:commit",(e=>this.commit(e)))}transformProduceResponse(e){const{topicName:t,partition:r,offset:s,baseOffset:n}=e,i=s||n;return{type:"kafka_produce",partition:r,offset:i?Number(i):void 0,topic:t}}commit(e){if(!this.config.dsmEnabled)return;const t=["type","partition","offset","topic"];for(const r of e.map(this.transformProduceResponse))t.some((e=>!r.hasOwnProperty(e)))||this.tracer.setOffset(r)}start({topic:e,messages:i,bootstrapServers:a}){let o;const c=this.startSpan({resource:e,meta:{component:"kafkajs","kafka.topic":e},metrics:{"kafka.batch_size":i.length}});a&&c.setTag(n,a);for(const n of i)if("object"==typeof n&&(this.tracer.inject(c,"text_map",n.headers),this.config.dsmEnabled)){const i=r(n),a=this.tracer.setCheckpoint(["direction:out",`topic:${e}`,"type:kafka"],c,i);o=t(a),n.headers[s]=o}}},producer$1}function requireConsumer$1(){if(hasRequiredConsumer$1)return consumer$1;hasRequiredConsumer$1=1;const e=requireDcPolyfill(),{getMessageSize:t,CONTEXT_PROPAGATION_KEY:r}=requireProcessor(),s=requireConsumer$5(),n=e.channel("dd-trace:kafkajs:consumer:afterStart"),i=e.channel("dd-trace:kafkajs:consumer:beforeFinish");return consumer$1=class extends s{static get id(){return"kafkajs"}static get operation(){return"consume"}constructor(){super(...arguments),this.addSub("apm:kafkajs:consume:commit",(e=>this.commit(e)))}transformCommit(e){const{groupId:t,partition:r,offset:s,topic:n}=e;return{partition:r,topic:n,type:"kafka_commit",offset:Number(s),consumer_group:t}}commit(e){if(!this.config.dsmEnabled)return;const t=["consumer_group","type","partition","offset","topic"];for(const r of e.map(this.transformCommit))t.some((e=>!r.hasOwnProperty(e)))||this.tracer.setOffset(r)}start({topic:e,partition:s,message:i,groupId:a}){const o=function(e,t){if(!t)return null;const r={};for(const e of Object.keys(t))null!==t[e]&&void 0!==t[e]&&(r[e]=t[e].toString());return e.extract("text_map",r)}(this.tracer,i.headers),c=this.startSpan({childOf:o,resource:e,type:"worker",meta:{component:"kafkajs","kafka.topic":e,"kafka.message.offset":i.offset},metrics:{"kafka.partition":s}});if(this.config.dsmEnabled){const s=t(i);this.tracer.decodeDataStreamsContext(i.headers[r]),this.tracer.setCheckpoint(["direction:in",`group:${a}`,`topic:${e}`,"type:kafka"],c,s)}n.hasSubscribers&&n.publish({topic:e,partition:s,message:i,groupId:a})}finish(){i.hasSubscribers&&i.publish(),super.finish()}},consumer$1}function requireSrc$o(){if(hasRequiredSrc$o)return src$o;hasRequiredSrc$o=1;const e=requireProducer$1(),t=requireConsumer$1(),r=requireComposite();return src$o=class extends r{static get id(){return"kafkajs"}static get plugins(){return{producer:e,consumer:t}}}}function requireSrc$n(){if(hasRequiredSrc$n)return src$n;hasRequiredSrc$n=1;const e=requireConstants$2(),t=requireDatabase();return src$n=class extends t{static get id(){return"mysql"}static get system(){return"mysql"}start(t){const r=this.serviceName({pluginConfig:this.config,dbConfig:t.conf,system:this.system}),s=this.startSpan(this.operationName(),{service:r,resource:t.sql,type:"sql",kind:"client",meta:{"db.type":this.system,"db.user":t.conf.user,"db.name":t.conf.database,"out.host":t.conf.host,[e]:t.conf.port}});t.sql=this.injectDbmQuery(s,t.sql,r)}},src$n}function requireSrc$m(){if(hasRequiredSrc$m)return src$m;hasRequiredSrc$m=1;const{storage:e}=requireDatadogCore(),t=requireSrc$n();let r;return src$m=class extends t{static get id(){return"mariadb"}static get system(){return"mariadb"}constructor(...t){super(...t),this.addSub(`apm:${this.component}:pool:skip`,(()=>{r=e.getStore(),e.enterWith({noop:!0})})),this.addSub(`apm:${this.component}:pool:unskip`,(()=>{e.enterWith(r),r=void 0}))}}}function requireSrc$l(){if(hasRequiredSrc$l)return src$l;hasRequiredSrc$l=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireCache();return src$l=class extends t{static get id(){return"memcached"}start({client:t,server:r,query:s}){const n=function(e,t,r){if(!t)if(1===e.servers.length)t=e.servers[0];else{let s=e.redundancy&&e.redundancy<e.servers.length;const n=r.redundancyEnabled;s&&n?(s=e.HashRing.range(r.key,e.redundancy+1,!0),t=s.shift()):t=e.HashRing.get(r.key)}return t&&t.split(":")}(t,r,s),i={"out.host":n[0],[e]:n[1]};this.config.memcachedCommandEnabled&&(i["memcached.command"]=s.command),this.startSpan({service:this.serviceName({pluginConfig:this.config,system:this.system}),resource:s.type,type:"memcached",meta:i})}},src$l}function requireSrc$k(){if(hasRequiredSrc$k)return src$k;hasRequiredSrc$k=1;const e=requireSrc$L(),t=requireWeb();return src$k=class extends e{static get id(){return"microgateway-core"}constructor(...e){super(...e),this.addSub("apm:microgateway-core:request:handle",(({req:e})=>{this.setFramework(e,"microgateway",this.config)})),this.addSub("apm:microgateway-core:request:route",(({req:e,route:r})=>{t.setRoute(e,r)})),this.addSub("apm:microgateway-core:request:error",this.addError)}}}function requireSrc$j(){if(hasRequiredSrc$j)return src$j;hasRequiredSrc$j=1;const e=requireCi_plugin(),{storage:t}=requireDatadogCore(),{TEST_STATUS:r,TEST_PARAMETERS:s,finishAllTraceSpans:n,getTestSuitePath:i,getTestParametersString:a,getTestSuiteCommonTags:o,addIntelligentTestRunnerSpanTags:c,TEST_SOURCE_START:u,TEST_ITR_UNSKIPPABLE:l,TEST_ITR_FORCED_RUN:p,TEST_CODE_OWNERS:d,ITR_CORRELATION_ID:h,TEST_SOURCE_FILE:f,removeEfdStringFromTestName:g,TEST_IS_NEW:m,TEST_EARLY_FLAKE_IS_RETRY:_,TEST_EARLY_FLAKE_IS_ENABLED:b}=requireTest(),{COMPONENT:y}=requireConstants$2(),{TELEMETRY_EVENT_CREATED:v,TELEMETRY_EVENT_FINISHED:S,TELEMETRY_CODE_COVERAGE_STARTED:q,TELEMETRY_CODE_COVERAGE_FINISHED:E,TELEMETRY_ITR_FORCED_TO_RUN:R,TELEMETRY_CODE_COVERAGE_EMPTY:T,TELEMETRY_ITR_UNSKIPPABLE:A,TELEMETRY_CODE_COVERAGE_NUM_FILES:w}=requireTelemetry$3();return src$j=class extends e{static get id(){return"mocha"}constructor(...e){super(...e),this._testSuites=new Map,this._testTitleToParams={},this.sourceRoot=process.cwd(),this.addSub("ci:mocha:test-suite:code-coverage",(({coverageFiles:e,suiteFile:t})=>{if(!this.libraryConfig?.isCodeCoverageEnabled)return;const r=this._testSuites.get(t);e.length||this.telemetry.count(T);const s=[...e,t].map((e=>i(e,this.sourceRoot))),{_traceId:n,_spanId:a}=r.context(),o={sessionId:n,suiteId:a,files:s};this.tracer._exporter.exportCoverage(o),this.telemetry.ciVisEvent(E,"suite",{library:"istanbul"}),this.telemetry.distribution(w,{},s.length)})),this.addSub("ci:mocha:test-suite:start",(({testSuite:e,isUnskippable:r,isForcedToRun:s,itrCorrelationId:n})=>{const a=t.getStore(),c=o(this.command,this.frameworkVersion,i(e,this.sourceRoot),"mocha");r&&(c[l]="true",this.telemetry.count(A,{testLevel:"suite"})),s&&(c[p]="true",this.telemetry.count(R,{testLevel:"suite"}));const u=this.tracer.startSpan("mocha.test_suite",{childOf:this.testModuleSpan,tags:{[y]:this.constructor.id,...this.testEnvironmentMetadata,...c}});this.telemetry.ciVisEvent(v,"suite"),this.libraryConfig?.isCodeCoverageEnabled&&this.telemetry.ciVisEvent(q,"suite",{library:"istanbul"}),n&&u.setTag(h,n),this.enter(u,a),this._testSuites.set(e,u)})),this.addSub("ci:mocha:test-suite:finish",(e=>{const s=t.getStore();if(s&&s.span){const t=s.span;t.context()._tags[r]||t.setTag(r,e),t.finish(),this.telemetry.ciVisEvent(S,"suite")}})),this.addSub("ci:mocha:test-suite:error",(e=>{const s=t.getStore();if(s&&s.span){const t=s.span;t.setTag("error",e),t.setTag(r,"fail")}})),this.addSub("ci:mocha:test:start",(e=>{const r=t.getStore(),s=this.startTestSpan(e);this.enter(s,r)})),this.addSub("ci:mocha:test:finish",(e=>{const s=t.getStore();if(s&&s.span){const t=s.span;t.setTag(r,e),t.finish(),this.telemetry.ciVisEvent(S,"test",{hasCodeOwners:!!t.context()._tags[d]}),n(t)}})),this.addSub("ci:mocha:test:skip",(e=>{const r=t.getStore();if(!r){const t=this.startTestSpan(e);this.enter(t,r)}})),this.addSub("ci:mocha:test:error",(e=>{const s=t.getStore();if(e&&s&&s.span){const t=s.span;"Pending"!==e.constructor.name||this.forbidPending?(t.setTag(r,"fail"),t.setTag("error",e)):t.setTag(r,"skip")}})),this.addSub("ci:mocha:test:parameterize",(({title:e,params:t})=>{this._testTitleToParams[e]=t})),this.addSub("ci:mocha:session:finish",(({status:e,isSuitesSkipped:t,testCodeCoverageLinesTotal:s,numSkippedSuites:i,hasForcedToRunSuites:a,hasUnskippableSuites:o,error:u,isEarlyFlakeDetectionEnabled:l})=>{if(this.testSessionSpan){const{isSuitesSkippingEnabled:p,isCodeCoverageEnabled:d}=this.libraryConfig||{};this.testSessionSpan.setTag(r,e),this.testModuleSpan.setTag(r,e),u&&(this.testSessionSpan.setTag("error",u),this.testModuleSpan.setTag("error",u)),c(this.testSessionSpan,this.testModuleSpan,{isSuitesSkipped:t,isSuitesSkippingEnabled:p,isCodeCoverageEnabled:d,testCodeCoverageLinesTotal:s,skippingCount:i,skippingType:"suite",hasForcedToRunSuites:a,hasUnskippableSuites:o}),l&&this.testSessionSpan.setTag(b,"true"),this.testModuleSpan.finish(),this.telemetry.ciVisEvent(S,"module"),this.testSessionSpan.finish(),this.telemetry.ciVisEvent(S,"session"),n(this.testSessionSpan)}this.libraryConfig=null,this.tracer._exporter.flush()}))}startTestSpan(e){const{testSuiteAbsolutePath:t,title:r,isNew:n,isEfdRetry:o,testStartLine:c}=e,l=g(e.testName),p={},d=a(this._testTitleToParams,r);d&&(p[s]=d),c&&(p[u]=c);const h=i(t,this.sourceRoot),b=this._testSuites.get(t);return this.repositoryRoot!==this.sourceRoot&&this.repositoryRoot?p[f]=i(t,this.repositoryRoot):p[f]=h,n&&(p[m]="true",o&&(p[_]="true")),super.startTestSpan(l,h,b,p)}},src$j}function requireUtil$2(){if(hasRequiredUtil$2)return util$8;return hasRequiredUtil$2=1,util$8={moleculerTags:function(e,t,r){const s=t.service||{},n=t.action||{},i=r.meta&&t.meta;return{"moleculer.context.action":n.name,"moleculer.context.meta":i,"moleculer.context.node_id":t.nodeID,"moleculer.context.request_id":t.requestID,"moleculer.context.service":s.name,"moleculer.namespace":e.namespace,"moleculer.node_id":e.nodeID}}},util$8}function requireServer$5(){if(hasRequiredServer$5)return server$5;hasRequiredServer$5=1;const e=requireServer$9(),{moleculerTags:t}=requireUtil$2();return server$5=class extends e{static get id(){return"moleculer"}static get operation(){return"action"}start({action:e,ctx:r,broker:s}){const n=this.tracer.extract("text_map",r.meta);this.startSpan(this.operationName(),{childOf:n||this.activeSpan,service:this.config.service||this.serviceName(),resource:e.name,kind:"server",type:"web",meta:{"resource.name":e.name,...t(s,r,this.config)}})}}}function requireClient$4(){if(hasRequiredClient$4)return client$4;hasRequiredClient$4=1;const e=requireClient$a(),{moleculerTags:t}=requireUtil$2();return client$4=class extends e{static get id(){return"moleculer"}static get operation(){return"call"}start({actionName:e,opts:t}){const r=this.startSpan(this.operationName(),{service:this.config.service||this.serviceName(),resource:e,kind:"client"});this.tracer.inject(r,"text_map",t.meta)}finish({broker:e,ctx:r}){const s=this.activeSpan;if(r){const n=(r.endpoint||{}).node||{};this.addHost(n.hostname,n.port),s.addTags(t(e,r,this.config))}super.finish()}},client$4}function requireSrc$i(){if(hasRequiredSrc$i)return src$i;hasRequiredSrc$i=1;const e=requireServer$5(),t=requireClient$4(),r=requireComposite();return src$i=class extends r{static get id(){return"moleculer"}static get plugins(){return{server:e,client:t}}}}function requireSrc$h(){if(hasRequiredSrc$h)return src$h;hasRequiredSrc$h=1;const e=requireDatabase();function t(e){return JSON.stringify(e,((e,t)=>"bigint"==typeof t?t.toString():t))}function r(e){return!(t=e,"object"==typeof t&&null!==t&&!(t instanceof Array)&&"function"!=typeof e.toJSON);var t}function s(e){return Buffer.isBuffer(e)||"function"==typeof e||a(e)}function n(e){if(i(e)&&(e=e.toJSON()),s(e))return"?";if(r(e))return e;const t={},n=[{input:e,output:t,depth:0}];for(;n.length;){const{input:e,output:t,depth:a}=n.pop(),o=a+1;for(const c in e){if("function"==typeof e[c])continue;let u=e[c];i(u)&&(u="function"==typeof u.toJSON?u.toJSON():"?"),a>=10||s(u)?t[c]="?":r(u)?t[c]=u:n.push({input:u,output:t[c]={},depth:o})}}return t}function i(e){return e&&e._bsontype&&!a(e)}function a(e){return e&&"Binary"===e._bsontype}return src$h=class extends e{static get id(){return"mongodb-core"}static get component(){return"mongodb"}static get peerServicePrecursors(){return[]}start({ns:e,ops:r,options:s={},name:i}){const a=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return;if(e.query)return t(n(e.query));if(e.filter)return t(n(e.filter))}(r),o=(c=function(e,t,r,s){const n=[s,t];return e.config.queryInResourceName&&r&&n.push(r),n.join(" ")}(this,e,a,i),c.slice(0,Math.min(c.length,1e4)));var c;this.startSpan(this.operationName(),{service:this.serviceName({pluginConfig:this.config}),resource:o,type:"mongodb",kind:"client",meta:{"db.name":e,"mongodb.query":a,"out.host":s.host,"out.port":s.port}})}getPeerService(e){const t=e["db.name"];return t&&void 0===e["peer.service"]&&(e["peer.service"]=t.split(".",1)[0]),super.getPeerService(e)}},src$h}function requireSrc$g(){if(hasRequiredSrc$g)return src$g;hasRequiredSrc$g=1;const e=requireSrc$n();return src$g=class extends e{static get id(){return"mysql2"}}}function requireIpc(){if(hasRequiredIpc)return ipc;hasRequiredIpc=1;const e=requireClient$a();return ipc=class extends e{static get id(){return"net"}static get operation(){return"ipc"}start({options:e}){this.startSpan("ipc.connect",{service:this.config.service,resource:e.path,kind:"client",meta:{"ipc.path":e.path}})}}}function requireTcp(){if(hasRequiredTcp)return tcp;hasRequiredTcp=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireClient$a();return tcp=class extends t{static get id(){return"net"}static get operation(){return"tcp"}constructor(...e){super(...e),this.addTraceSub("connection",(({socket:e})=>{this.activeSpan.addTags({"tcp.local.address":e.localAddress,"tcp.local.port":e.localPort})}))}start({options:t}){const r=t.host||"localhost",s=t.port||0,n=t.family||4;this.startSpan("tcp.connect",{service:this.config.service,resource:[r,s].filter((e=>e)).join(":"),kind:"client",meta:{"tcp.remote.host":r,"tcp.family":`IPv${n}`,"tcp.local.address":"","out.host":r},metrics:{"tcp.remote.port":s,"tcp.local.port":0,[e]:s}})}}}function requireSrc$f(){if(hasRequiredSrc$f)return src$f;hasRequiredSrc$f=1;const e=requirePlugin$1(),t=requireIpc(),r=requireTcp();return src$f=class extends e{static get id(){return"net"}constructor(...e){super(...e),this._ipc=new t(...e),this._tcp=new r(...e)}configure(e){this._ipc.configure(e),this._tcp.configure(e)}},src$f}function requireSrc$e(){if(hasRequiredSrc$e)return src$e;hasRequiredSrc$e=1;const e=requireServer$9(),{storage:t}=requireDatadogCore(),r=requireAnalytics_sampler(),{COMPONENT:s}=requireConstants$2(),n=requireWeb(),i=["/404","/500","/_error","/_not-found"];return src$e=class extends e{static get id(){return"next"}constructor(...e){super(...e),this._requests=new WeakMap,this.addSub("apm:next:page:load",(e=>this.pageLoad(e)))}bindStart({req:e,res:n}){const i=t.getStore(),a=i?i.span:i,o=this.tracer.startSpan(this.operationName(),{childOf:a,tags:{[s]:this.constructor.id,"service.name":this.config.service||this.serviceName(),"resource.name":e.method,"span.type":"web","span.kind":"server","http.method":e.method}});return r.sample(o,this.config.measured,!0),this._requests.set(o,e),{...i,span:o}}error({span:e,error:r}){if(!e){const r=t.getStore();if(!r)return;e=r.span}this.addError(r,e)}finish({req:e,res:r,nextRequest:s={}}){const i=t.getStore();if(!i)return;const a=i.span,o=a.context()._tags.error,c=e.error||s.error;c?(a.setTag("error",c),n.addError(e,c)):o?(a.setTag("error",o),n.addError(e,c||o)):this.config.validateStatus(r.statusCode)||(a.setTag("error",!0),n.addError(e,!0)),a.addTags({"http.status_code":r.statusCode}),this.config.hooks.request(a,e,r),a.finish()}pageLoad({page:e,isAppPath:r=!1,isStatic:a=!1}){const o=t.getStore();if(!o)return;const c=o.span,u=this._requests.get(c);if(!u)return;const l=c.context()._tags["next.page"],p=i.includes(e);l&&p||(r&&!p&&(e=e.substring(0,e.lastIndexOf("/"))),a&&(e=u.url.includes("_next/static")?"/_next/static/*":"/public/*"),c.addTags({[s]:this.constructor.id,"resource.name":`${u.method} ${e}`.trim(),"next.page":e}),n.setRoute(u,e))}configure(e){return super.configure(function(e){const t=function(e){const t=()=>{},r=e.hooks&&e.hooks.request||t;return{request:r}}(e),r="function"==typeof e.validateStatus?e.validateStatus:e=>e<500;return Object.assign({},e,{hooks:t,validateStatus:r})}(e))}},src$e}function requireSrc$d(){if(hasRequiredSrc$d)return src$d;hasRequiredSrc$d=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireDatabase(),r=requireLog$2();return src$d=class extends t{static get id(){return"oracledb"}static get system(){return"oracle"}static get peerServicePrecursors(){return["db.instance","db.hostname"]}start({query:t,connAttrs:s}){const n=this.serviceName({pluginConfig:this.config,params:s}),i=function(e){try{return new URL(`http://${e}`)}catch(e){return r.error(e),{}}}(s.connectString);this.startSpan(this.operationName(),{service:n,resource:t,type:"sql",kind:"client",meta:{"db.user":this.config.user,"db.instance":i.pathname&&i.pathname.substring(1),"db.hostname":i.hostname,[e]:i.port}})}},src$d}lodash_sortby.exports;var services={},src$c={},hasRequiredSrc$c,hasRequiredServices,src$b,hasRequiredSrc$b,logger$1,hasRequiredLogger$1,server$4,hasRequiredServer$4,src$a,hasRequiredSrc$a,src$9,hasRequiredSrc$9,src$8,hasRequiredSrc$8,src$7,hasRequiredSrc$7,producer,hasRequiredProducer,consumer,hasRequiredConsumer,src$6,hasRequiredSrc$6,src$5,hasRequiredSrc$5,src$4,hasRequiredSrc$4,src$3,hasRequiredSrc$3,plugins,hasRequiredPlugins;function requireSrc$c(){if(hasRequiredSrc$c)return src$c;hasRequiredSrc$c=1;const e=requireLog$2(),t=require$$2$1;class r{constructor({ddsource:t,hostname:r,service:s,apiKey:n,site:i="datadoghq.com",interval:a=1e4,timeout:o=2e3,limit:c=1e3}){this.enabled=!!n,this.ddsource=t,this.hostname=r,this.service=s,this.interval=a,this.timeout=o,this.queue=[],this.limit=c,this.endpoint="/api/v2/logs",this.site=i,this.intake=`http-intake.logs.${this.site}`,this.headers={"DD-API-KEY":n,"Content-Type":"application/json"},this.timer=setInterval((()=>{this.flush()}),this.interval).unref(),e.debug(`started log writer to https://${this.intake}${this.endpoint}`)}static tagString(e){const t=[];for(const r in e)t.push(r+":"+e[r]);return t.join(",")}log(e,t,s){if(!this.enabled)return;const n=r.tagString(s);t&&(e["dd.trace_id"]=String(t.trace_id),e["dd.span_id"]=String(t.span_id));const i={...e,timestamp:Date.now(),hostname:e.hostname||this.hostname,ddsource:e.ddsource||this.ddsource,service:e.service||this.service,ddtags:n||void 0};this.enqueue(i)}enqueue(e){this.queue.length>=this.limit&&this.flush(),this.queue.push(e)}shutdown(){clearInterval(this.timer),this.flush()}flush(r=(()=>{})){let s,n,i;if(!this.queue.length)return void setImmediate((()=>r()));try{s=this.queue,this.queue=[],n=s.length,i=JSON.stringify(s)}catch(t){return e.error(`failed to encode ${n} logs`),void setImmediate((()=>r(t)))}const a={hostname:this.intake,port:443,path:this.endpoint,method:"POST",headers:this.headers,timeout:this.timeout},o=t.request(a,(t=>{e.info(`statusCode: ${t.statusCode}`)}));o.once("error",(t=>{e.error(`failed to send ${n} log(s), with error ${t.message}`),r(t)})),o.write(i),o.end(),o.once("response",(t=>{if(t.statusCode>=400){const s=new Error(`failed to send ${n} logs, received response code ${t.statusCode}`);return e.error(s.message),void r(s)}r()}))}}return src$c.ExternalLogger=r,src$c.NoopExternalLogger=class{log(){}enqueue(){}shutdown(){}flush(){}},src$c}function requireServices(){if(hasRequiredServices)return services;hasRequiredServices=1;const{DogStatsDClient:e,NoopDogStatsDClient:t}=requireDogstatsd(),{ExternalLogger:r,NoopExternalLogger:s}=requireSrc$c();let n=null,i=null,a=null;return services.init=function(o){return n=o&&o.dogstatsd?new e({host:o.dogstatsd.hostname,port:o.dogstatsd.port,tags:[`service:${o.tags.service}`,`env:${o.tags.env}`,`version:${o.tags.version}`]}):new t,i=o&&o.apiKey?new r({ddsource:"openai",hostname:o.hostname,service:o.service,apiKey:o.apiKey,interval:1e4}):new s,a=setInterval((()=>{n.flush()}),1e4).unref(),{metrics:n,logger:i}},services.shutdown=function(){clearInterval(a),n=null,i=null,a=null},services}function requireSrc$b(){if(hasRequiredSrc$b)return src$b;hasRequiredSrc$b=1;const e=require$$0$1,t=requireTracing(),{storage:r}=requireDatadogCore(),s=requireServices(),n=requireSampler(),{MEASURED:i}=requireTags$2(),a=/\n/g,o=/\t/g;let c=128;function u(e,t){"object"==typeof t.usage&&t.usage&&(e["openai.response.usage.prompt_tokens"]=t.usage.prompt_tokens,e["openai.response.usage.completion_tokens"]=t.usage.completion_tokens,e["openai.response.usage.total_tokens"]=t.usage.total_tokens)}function l(e){return e&&`sk-...${e.substr(e.length-4)}`}function p(e){if(e)return(e=e.replace(a,"\\n").replace(o,"\\t")).length>c?e.substring(0,c)+"...":e}function d(e,t){const r=Array.isArray(e)?`[${e.join(", ")}]`:e;return t?p(r):r}function h(e){return Array.isArray(e)?e.length:void 0}return src$b=class extends t{static get id(){return"openai"}static get operation(){return"request"}static get system(){return"openai"}constructor(...e){super(...e);const{metrics:t,logger:r}=s.init(this._tracerConfig);this.metrics=t,this.logger=r,this.sampler=new n(.1),this._tracerConfig&&(c=this._tracerConfig.openaiSpanCharLimit)}configure(e){!1===e.enabled&&s.shutdown(),super.configure(e)}start({methodName:t,args:s,basePath:n,apiKey:a}){const o=function(e,t){switch(e){case"listModels":case"listFiles":case"listFineTunes":return{};case"retrieveModel":return{id:t[0]};case"createFile":return{file:t[0],purpose:t[1]};case"deleteFile":case"retrieveFile":case"downloadFile":return{file_id:t[0]};case"listFineTuneEvents":return{fine_tune_id:t[0],stream:t[1]};case"retrieveFineTune":case"deleteModel":case"cancelFineTune":return{fine_tune_id:t[0]};case"createImageEdit":return{file:t[0],prompt:t[1],mask:t[2],n:t[3],size:t[4],response_format:t[5],user:t[6]};case"createImageVariation":return{file:t[0],n:t[1],size:t[2],response_format:t[3],user:t[4]};case"createTranscription":case"createTranslation":return{file:t[0],model:t[1],prompt:t[2],response_format:t[3],temperature:t[4],language:t[5]}}return t[0]}(t,s),c=this.startSpan("openai.request",{service:this.config.service,resource:t,type:"openai",kind:"client",meta:{[i]:1,"openai.user.api_key":l(a),"openai.api_base":n,"openai.request.best_of":o.best_of,"openai.request.echo":o.echo,"openai.request.logprobs":o.logprobs,"openai.request.max_tokens":o.max_tokens,"openai.request.model":o.model,"openai.request.n":o.n,"openai.request.presence_penalty":o.presence_penalty,"openai.request.frequency_penalty":o.frequency_penalty,"openai.request.stop":o.stop,"openai.request.suffix":o.suffix,"openai.request.temperature":o.temperature,"openai.request.top_p":o.top_p,"openai.request.user":o.user,"openai.request.file_id":o.file_id}}),u=r.getStore()||{},f=Object.create(null);u.openai=f;const g={};if("prompt"in o){const e=o.prompt;if(f.prompt=e,"string"==typeof e||Array.isArray(e)&&"number"==typeof e[0])g["openai.request.prompt"]=d(e,!0);else if(Array.isArray(e))for(let t=0;t<e.length;t++)g[`openai.request.prompt.${t}`]=d(e[t],!0)}if("input"in o){const e=d(o.input,!1);g["openai.request.input"]=p(e),f.input=e}if("object"==typeof o.logit_bias&&o.logit_bias)for(const[e,t]of Object.entries(o.logit_bias))g[`openai.request.logit_bias.${e}`]=t;switch(t){case"createFineTune":!function(e,t){e["openai.request.training_file"]=t.training_file,e["openai.request.validation_file"]=t.validation_file,e["openai.request.n_epochs"]=t.n_epochs,e["openai.request.batch_size"]=t.batch_size,e["openai.request.learning_rate_multiplier"]=t.learning_rate_multiplier,e["openai.request.prompt_loss_weight"]=t.prompt_loss_weight,e["openai.request.compute_classification_metrics"]=t.compute_classification_metrics,e["openai.request.classification_n_classes"]=t.classification_n_classes,e["openai.request.classification_positive_class"]=t.classification_positive_class,e["openai.request.classification_betas_count"]=h(t.classification_betas)}(g,o);break;case"createImage":case"createImageEdit":case"createImageVariation":!function(t,r,s){if(r.file&&"object"==typeof r.file&&r.file.path){const n=e.basename(r.file.path);t["openai.request.image"]=n,s.file=n}if(r.mask&&"object"==typeof r.mask&&r.mask.path){const n=e.basename(r.mask.path);t["openai.request.mask"]=n,s.mask=n}t["openai.request.size"]=r.size,t["openai.request.response_format"]=r.response_format,t["openai.request.language"]=r.language}(g,o,f);break;case"createChatCompletion":!function(e,t,r){if(!h(t.messages))return;r.messages=t.messages;for(let r=0;r<t.messages.length;r++){const s=t.messages[r];e[`openai.request.${r}.content`]=p(s.content),e[`openai.request.${r}.role`]=s.role,e[`openai.request.${r}.name`]=s.name,e[`openai.request.${r}.finish_reason`]=s.finish_reason}}(g,o,f);break;case"createFile":case"retrieveFile":!function(t,r){t["openai.request.purpose"]=r.purpose,r.file&&"object"==typeof r.file&&r.file.path&&(t["openai.request.filename"]=e.basename(r.file.path))}(g,o);break;case"createTranscription":case"createTranslation":!function(t,r,s){if(t["openai.request.response_format"]=r.response_format,t["openai.request.language"]=r.language,r.file&&"object"==typeof r.file&&r.file.path){const n=e.basename(r.file.path);t["openai.request.filename"]=n,s.file=n}}(g,o,f);break;case"retrieveModel":!function(e,t){e["openai.request.id"]=t.id}(g,o);break;case"listFineTuneEvents":case"retrieveFineTune":case"deleteModel":case"cancelFineTune":!function(e,t){e["openai.request.fine_tune_id"]=t.fine_tune_id,e["openai.request.stream"]=!!t.stream}(g,o);break;case"createEdit":!function(e,t,r){const s=t.instruction;e["openai.request.instruction"]=s,r.instruction=s}(g,o,f)}c.addTags(g)}finish({headers:e,body:t,method:s,path:n}){const i=this.activeSpan,a=i._spanContext._tags["resource.name"];t=function(e,t){if("downloadFile"===t)return{file:e};return"object"==typeof e?e:{}}(t,a);const o=r.getStore().openai,c=function(e,t){switch(e){case"deleteModel":case"retrieveModel":return"/v1/models/*";case"deleteFile":case"retrieveFile":return"/v1/files/*";case"downloadFile":return"/v1/files/*/content";case"retrieveFineTune":return"/v1/fine-tunes/*";case"listFineTuneEvents":return"/v1/fine-tunes/*/events";case"cancelFineTune":return"/v1/fine-tunes/*/cancel"}return t}(a,n),l={"openai.request.endpoint":c,"openai.request.method":s,"openai.organization.id":t.organization_id,"openai.organization.name":e["openai-organization"],"openai.response.model":e["openai-model"]||t.model,"openai.response.id":t.id,"openai.response.deleted":t.deleted,"openai.response.created":t.created,"openai.response.created_at":t.created_at};!function(e,t,r,s){switch(e){case"createModeration":!function(e,t){if(e["openai.response.id"]=t.id,!t.results)return;e["openai.response.flagged"]=t.results[0].flagged;for(const[r,s]of Object.entries(t.results[0].categories))e[`openai.response.categories.${r}`]=s;for(const[r,s]of Object.entries(t.results[0].category_scores))e[`openai.response.category_scores.${r}`]=s}(t,r);break;case"createCompletion":case"createChatCompletion":case"createEdit":!function(e,t,r){if(u(e,t),!t.choices)return;e["openai.response.choices_count"]=t.choices.length,r.choices=t.choices;for(let r=0;r<t.choices.length;r++){const s=t.choices[r];if(e[`openai.response.choices.${r}.finish_reason`]=s.finish_reason,e[`openai.response.choices.${r}.logprobs`]="logprobs"in s?"returned":void 0,e[`openai.response.choices.${r}.text`]=p(s.text),"message"in s){const t=s.message;e[`openai.response.choices.${r}.message.role`]=t.role,e[`openai.response.choices.${r}.message.content`]=p(t.content),e[`openai.response.choices.${r}.message.name`]=p(t.name)}}}(t,r,s);break;case"listFiles":case"listFineTunes":case"listFineTuneEvents":case"listModels":!function(e,t){if(!t.data)return;e["openai.response.count"]=t.data.length}(t,r);break;case"createEmbedding":!function(e,t){if(u(e,t),!t.data)return;e["openai.response.embeddings_count"]=t.data.length;for(let r=0;r<t.data.length;r++)e[`openai.response.embedding.${r}.embedding_length`]=t.data[r].embedding.length}(t,r);break;case"createFile":case"retrieveFile":!function(e,t){e["openai.response.filename"]=t.filename,e["openai.response.purpose"]=t.purpose,e["openai.response.bytes"]=t.bytes,e["openai.response.status"]=t.status,e["openai.response.status_details"]=t.status_details}(t,r);break;case"deleteFile":!function(e,t){e["openai.response.id"]=t.id}(t,r);break;case"downloadFile":!function(e,t){if(!t.file)return;e["openai.response.total_bytes"]=t.file.length}(t,r);break;case"createFineTune":case"retrieveFineTune":case"cancelFineTune":!function(e,t){e["openai.response.events_count"]=h(t.events),e["openai.response.fine_tuned_model"]=t.fine_tuned_model,t.hyperparams&&(e["openai.response.hyperparams.n_epochs"]=t.hyperparams.n_epochs,e["openai.response.hyperparams.batch_size"]=t.hyperparams.batch_size,e["openai.response.hyperparams.prompt_loss_weight"]=t.hyperparams.prompt_loss_weight,e["openai.response.hyperparams.learning_rate_multiplier"]=t.hyperparams.learning_rate_multiplier);e["openai.response.training_files_count"]=h(t.training_files),e["openai.response.result_files_count"]=h(t.result_files),e["openai.response.validation_files_count"]=h(t.validation_files),e["openai.response.updated_at"]=t.updated_at,e["openai.response.status"]=t.status}(t,r);break;case"createTranscription":case"createTranslation":!function(e,t){e["openai.response.text"]=t.text,e["openai.response.language"]=t.language,e["openai.response.duration"]=t.duration,e["openai.response.segments_count"]=h(t.segments)}(t,r);break;case"createImage":case"createImageEdit":case"createImageVariation":!function(e,t){if(!t.data)return;e["openai.response.images_count"]=t.data.length;for(let r=0;r<t.data.length;r++){const s=t.data[r];e[`openai.response.images.${r}.url`]=p(s.url),e[`openai.response.images.${r}.b64_json`]=s.b64_json&&"returned"}}(t,r);break;case"retrieveModel":!function(e,t){if(e["openai.response.owned_by"]=t.owned_by,e["openai.response.parent"]=t.parent,e["openai.response.root"]=t.root,!t.permission)return;e["openai.response.permission.id"]=t.permission[0].id,e["openai.response.permission.created"]=t.permission[0].created,e["openai.response.permission.allow_create_engine"]=t.permission[0].allow_create_engine,e["openai.response.permission.allow_sampling"]=t.permission[0].allow_sampling,e["openai.response.permission.allow_logprobs"]=t.permission[0].allow_logprobs,e["openai.response.permission.allow_search_indices"]=t.permission[0].allow_search_indices,e["openai.response.permission.allow_view"]=t.permission[0].allow_view,e["openai.response.permission.allow_fine_tuning"]=t.permission[0].allow_fine_tuning,e["openai.response.permission.organization"]=t.permission[0].organization,e["openai.response.permission.group"]=t.permission[0].group,e["openai.response.permission.is_blocking"]=t.permission[0].is_blocking}(t,r)}}(a,l,t,o),i.addTags(l),super.finish(),this.sendLog(a,i,l,o,!1),this.sendMetrics(e,t,c,i._duration)}error(...e){super.error(...e);const t=this.activeSpan,s=t._spanContext._tags["resource.name"],n=r.getStore().openai,i=["error:1"];this.metrics.distribution("openai.request.duration",1e3*t._duration,i),this.metrics.increment("openai.request.error",1,i),this.sendLog(s,t,{},n,!0)}sendMetrics(e,t,r,s){const n=[`org:${e["openai-organization"]}`,`endpoint:${r}`,`model:${e["openai-model"]}`,"error:0"];if(this.metrics.distribution("openai.request.duration",1e3*s,n),t&&"usage"in t){const e=t.usage.prompt_tokens,r=t.usage.completion_tokens;this.metrics.distribution("openai.tokens.prompt",e,n),this.metrics.distribution("openai.tokens.completion",r,n),this.metrics.distribution("openai.tokens.total",e+r,n)}"x-ratelimit-limit-requests"in e&&this.metrics.gauge("openai.ratelimit.requests",Number(e["x-ratelimit-limit-requests"]),n),"x-ratelimit-remaining-requests"in e&&this.metrics.gauge("openai.ratelimit.remaining.requests",Number(e["x-ratelimit-remaining-requests"]),n),"x-ratelimit-limit-tokens"in e&&this.metrics.gauge("openai.ratelimit.tokens",Number(e["x-ratelimit-limit-tokens"]),n),"x-ratelimit-remaining-tokens"in e&&this.metrics.gauge("openai.ratelimit.remaining.tokens",Number(e["x-ratelimit-remaining-tokens"]),n)}sendLog(e,t,r,s,n){if(!Object.keys(s).length)return;if(!this.sampler.isSampled())return;const i={status:n?"error":"info",message:`sampled ${e}`,...s};this.logger.log(i,t,r)}},src$b}function requireLogger$1(){if(hasRequiredLogger$1)return logger$1;hasRequiredLogger$1=1;const e=requireLog_plugin();return logger$1=class extends e{static get id(){return"paperplane"}}}function requireServer$4(){if(hasRequiredServer$4)return server$4;hasRequiredServer$4=1;const e=requireSrc$L(),t=requireWeb();return server$4=class extends e{static get id(){return"paperplane"}constructor(...e){super(...e),this.addSub("apm:paperplane:request:handle",(e=>{this.setFramework(e,"paperplane",this.config)})),this.addSub("apm:paperplane:request:route",(({req:e,route:r})=>{t.setRoute(e,r)}))}}}function requireSrc$a(){if(hasRequiredSrc$a)return src$a;hasRequiredSrc$a=1;const e=requirePlugin$1(),t=requireLogger$1(),r=requireServer$4();return src$a=class extends e{static get id(){return"paperplane"}constructor(...e){super(...e),this.server=new r(...e),this.logger=new t(...e)}configure(e){this.server.configure(e),this.logger.configure(e)}},src$a}function requireSrc$9(){if(hasRequiredSrc$9)return src$9;hasRequiredSrc$9=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireDatabase();return src$9=class extends t{static get id(){return"pg"}static get operation(){return"query"}static get system(){return"postgres"}start({params:t={},query:r,processId:s}){const n=this.serviceName({pluginConfig:this.config,params:t}),i=this.maybeTruncate(r.text),a=this.startSpan(this.operationName(),{service:n,resource:i,type:"sql",kind:"client",meta:{"db.type":"postgres","db.pid":s,"db.name":t.database,"db.user":t.user,"out.host":t.host,[e]:t.port}});r.__ddInjectableQuery=this.injectDbmQuery(a,r.text,n,!!r.name)}},src$9}function requireSrc$8(){if(hasRequiredSrc$8)return src$8;hasRequiredSrc$8=1;const e=requireLog_plugin();return src$8=class extends e{static get id(){return"pino"}}}function requireSrc$7(){if(hasRequiredSrc$7)return src$7;hasRequiredSrc$7=1;const e=requireSrc$L(),t=requireWeb();return src$7=class extends e{static get id(){return"restify"}constructor(...e){super(...e),this.addSub("apm:restify:request:handle",(({req:e})=>{this.setFramework(e,"restify",this.config)})),this.addSub("apm:restify:request:route",(({req:e,route:r})=>{t.setRoute(e,r)}))}configure(e){return super.configure({...e,middleware:!1})}},src$7}function requireProducer(){if(hasRequiredProducer)return producer;hasRequiredProducer=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireProducer$5(),{encodePathwayContext:r}=requirePathway(),{getAmqpMessageSize:s,CONTEXT_PROPAGATION_KEY:n}=requireProcessor();return producer=class extends t{static get id(){return"rhea"}static get operation(){return"send"}constructor(...e){super(...e),this.addTraceSub("encode",this.encode.bind(this))}start({targetAddress:t,host:r,port:s}){const n=t||"amq.topic";this.startSpan({resource:n,meta:{component:"rhea","amqp.link.target.address":n,"amqp.link.role":"sender","out.host":r,[e]:s}})}encode(e){!function(e,t,i){if(e&&(e.delivery_annotations=e.delivery_annotations||{},t.inject(i,"text_map",e.delivery_annotations),t._config.dsmEnabled)){const a=i.context()._tags["amqp.link.target.address"],o=s({content:e.body,headers:e.delivery_annotations}),c=t.setCheckpoint(["direction:out",`exchange:${a}`,"type:rabbitmq"],i,o),u=r(c);e.delivery_annotations[n]=u}}(e,this.tracer,this.activeSpan)}},producer}function requireConsumer(){if(hasRequiredConsumer)return consumer;hasRequiredConsumer=1;const e=requireConsumer$5(),{storage:t}=requireDatadogCore(),{getAmqpMessageSize:r,CONTEXT_PROPAGATION_KEY:s}=requireProcessor();return consumer=class extends e{static get id(){return"rhea"}constructor(...e){super(...e),this.addTraceSub("dispatch",(({state:e})=>{t.getStore().span.setTag("amqp.delivery.state",e)}))}start({msgObj:e}){const t=function(e){let t="amq.topic",r={};e.receiver&&e.receiver.options&&(r=e.receiver.options);r.source&&r.source.address&&(t=r.source.address);return t}(e),n=function(e,t){if(e.message)return t.extract("text_map",e.message.delivery_annotations)}(e,this.tracer),i=this.startSpan({childOf:n,resource:t,type:"worker",meta:{component:"rhea","amqp.link.source.address":t,"amqp.link.role":"receiver"}});if(this.config.dsmEnabled&&e.message){const n=r({headers:e.message.delivery_annotations,content:e.message.body});this.tracer.decodeDataStreamsContext(e.message.delivery_annotations[s]),this.tracer.setCheckpoint(["direction:in",`topic:${t}`,"type:rabbitmq"],i,n)}}},consumer}function requireSrc$6(){if(hasRequiredSrc$6)return src$6;hasRequiredSrc$6=1;const e=requireProducer(),t=requireConsumer(),r=requireComposite();return src$6=class extends r{static get id(){return"rhea"}static get plugins(){return{producer:e,consumer:t}}}}function requireSrc$5(){if(hasRequiredSrc$5)return src$5;hasRequiredSrc$5=1;const e=requireServer$9();function t(e,t,s){return t&&(e+=" "+t),s&&(e+=" "+JSON.stringify(r(s))),e}function r(e){const t={};if("object"!=typeof(s=e)||null===s||s instanceof Array||Buffer.isBuffer(e))return"?";var s;for(const s in e)"function"!=typeof e[s]&&(t[s]=r(e[s]));return t}return src$5=class extends e{static get id(){return"sharedb"}start({actionName:e,request:r}){const s=this.startSpan("sharedb.request",{service:this.config.service,resource:t(e,r.c,r.q),kind:"server",meta:{"sharedb.action":e}});this.config.hooks&&this.config.hooks.receive&&this.config.hooks.receive(s,r)}finish({request:e,res:t}){const r=this.activeSpan;this.config.hooks&&this.config.hooks.reply&&this.config.hooks.reply(r,e,t),super.finish()}},src$5}function requireSrc$4(){if(hasRequiredSrc$4)return src$4;hasRequiredSrc$4=1;const{CLIENT_PORT_KEY:e}=requireConstants$2(),t=requireDatabase();return src$4=class extends t{static get id(){return"tedious"}static get operation(){return"request"}static get system(){return"mssql"}start({queryOrProcedure:t,connectionConfig:r}){this.startSpan(this.operationName(),{service:this.serviceName({pluginConfig:this.config,system:this.system}),resource:t,type:"sql",kind:"client",meta:{"db.type":"mssql",component:"tedious","out.host":r.server,[e]:r.options.port,"db.user":r.userName||r.authentication.options.userName,"db.name":r.options.database,"db.instance":r.options.instanceName}})}}}function requireSrc$3(){if(hasRequiredSrc$3)return src$3;hasRequiredSrc$3=1;const e=requireLog_plugin();return src$3=class extends e{static get id(){return"winston"}}}function requirePlugins(){return hasRequiredPlugins?plugins:(hasRequiredPlugins=1,plugins={get"@aws-sdk/smithy-client"(){return requireSrc$S()},get"@cucumber/cucumber"(){return requireSrc$R()},get"@playwright/test"(){return requireSrc$Q()},get"@elastic/elasticsearch"(){return requireSrc$P()},get"@elastic/transport"(){return requireSrc$P()},get"@google-cloud/pubsub"(){return requireSrc$O()},get"@grpc/grpc-js"(){return requireSrc$N()},get"@hapi/hapi"(){return requireSrc$K()},get"@jest/core"(){return requireSrc$J()},get"@jest/test-sequencer"(){return requireSrc$J()},get"@jest/transform"(){return requireSrc$J()},get"@koa/router"(){return requireSrc$I()},get"@node-redis/client"(){return requireSrc$H()},get"@opensearch-project/opensearch"(){return requireSrc$G()},get"@redis/client"(){return requireSrc$H()},get"@smithy/smithy-client"(){return requireSrc$S()},get aerospike(){return requireSrc$F()},get amqp10(){return requireSrc$E()},get amqplib(){return requireSrc$D()},get"aws-sdk"(){return requireSrc$S()},get bunyan(){return requireSrc$C()},get"cassandra-driver"(){return requireSrc$B()},get child_process(){return requireSrc$A()},get connect(){return requireSrc$z()},get couchbase(){return requireSrc$y()},get cypress(){return requireSrc$x()},get dns(){return requireSrc$w()},get elasticsearch(){return requireSrc$P()},get express(){return requireSrc$v()},get fastify(){return requireSrc$u()},get"find-my-way"(){return requireSrc$t()},get graphql(){return requireSrc$s()},get grpc(){return requireSrc$N()},get hapi(){return requireSrc$K()},get http(){return requireSrc$r()},get http2(){return requireSrc$q()},get https(){return requireSrc$r()},get ioredis(){return requireSrc$p()},get"jest-circus"(){return requireSrc$J()},get"jest-config"(){return requireSrc$J()},get"jest-environment-node"(){return requireSrc$J()},get"jest-environment-jsdom"(){return requireSrc$J()},get"jest-jasmine2"(){return requireSrc$J()},get"jest-worker"(){return requireSrc$J()},get koa(){return requireSrc$I()},get"koa-router"(){return requireSrc$I()},get kafkajs(){return requireSrc$o()},get mariadb(){return requireSrc$m()},get memcached(){return requireSrc$l()},get"microgateway-core"(){return requireSrc$k()},get mocha(){return requireSrc$j()},get"mocha-each"(){return requireSrc$j()},get moleculer(){return requireSrc$i()},get mongodb(){return requireSrc$h()},get"mongodb-core"(){return requireSrc$h()},get mysql(){return requireSrc$n()},get mysql2(){return requireSrc$g()},get net(){return requireSrc$f()},get next(){return requireSrc$e()},get"node:dns"(){return requireSrc$w()},get"node:http"(){return requireSrc$r()},get"node:http2"(){return requireSrc$q()},get"node:https"(){return requireSrc$r()},get"node:net"(){return requireSrc$f()},get oracledb(){return requireSrc$d()},get openai(){return requireSrc$b()},get paperplane(){return requireSrc$a()},get pg(){return requireSrc$9()},get pino(){return requireSrc$8()},get"pino-pretty"(){return requireSrc$8()},get playwright(){return requireSrc$Q()},get redis(){return requireSrc$H()},get restify(){return requireSrc$7()},get rhea(){return requireSrc$6()},get router(){return requireSrc$L()},get sharedb(){return requireSrc$5()},get tedious(){return requireSrc$4()},get winston(){return requireSrc$3()}})}var datadogInstrumentations={},bundlerRegister={},register$1={exports:{}},iitm={exports:{}},importInTheMiddle={exports:{}},register={},hasRequiredRegister$1,hasRequiredImportInTheMiddle,hasRequiredIitm,ritm$1,hasRequiredRitm$1,hook,hasRequiredHook;function requireRegister$1(){if(hasRequiredRegister$1)return register;hasRequiredRegister$1=1;const e=[],t=new WeakMap,r=new Map,s=[],n={set:(e,r,s)=>t.get(e)[r](s),defineProperty(e,r,s){if(!("value"in s))throw new Error("Getters/setters are not supported for exports property descriptors.");return t.get(e)[r](s.value)}};return register.register=function(i,a,o,c){r.set(i,c),t.set(a,o);const u=new Proxy(a,n);e.forEach((e=>e(i,u))),s.push([i,u])},register.importHooks=e,register.specifiers=r,register.toHook=s,register}function requireImportInTheMiddle(){if(hasRequiredImportInTheMiddle)return importInTheMiddle.exports;hasRequiredImportInTheMiddle=1;const e=require$$0$1,t=requireModuleDetailsFromPath(),{fileURLToPath:r}=require$$0$8,{importHooks:s,specifiers:n,toHook:i}=requireRegister$1();function a(e){s.push(e),i.forEach((([t,r])=>e(t,r)))}function o(e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}function c(e,t,r,s){const n=e(t,r,s);n&&n!==t&&(t.default=n)}function u(s,i,o){if(this instanceof u==!1)return new u(s,i,o);"function"==typeof s?(o=s,s=null,i=null):"function"==typeof i&&(o=i,i=null);const l=!!i&&!0===i.internals;this._iitmHook=(i,a)=>{const u=i;let p;if(i.startsWith("node:"))i=i.replace(/^node:/,"");else{if(i.startsWith("file://"))try{i=r(i)}catch(e){}const e=t(i);e&&(i=e.name,p=e.basedir)}if(s){for(const t of s)if(t===i){if(p)if(l)i=i+e.sep+e.relative(p,r(u));else if(!p.endsWith(n.get(u)))continue;c(o,a,i,p)}}else c(o,a,i,p)},a(this._iitmHook)}return u.prototype.unhook=function(){o(this._iitmHook)},importInTheMiddle.exports=u,importInTheMiddle.exports.addHook=a,importInTheMiddle.exports.removeHook=o,importInTheMiddle.exports}function requireIitm(){if(hasRequiredIitm)return iitm.exports;hasRequiredIitm=1;const e=requireSemver(),t=requireLog$2(),{addHook:r}=requireImportInTheMiddle(),s=requireDcPolyfill();if(e.satisfies(process.versions.node,">=14.13.1")){const e=s.channel("dd-trace:moduleLoadStart");r(((t,r)=>{e.hasSubscribers&&e.publish({filename:t,module:r})})),iitm.exports=requireImportInTheMiddle()}else t.warn("ESM is not fully supported by this version of Node.js, so dd-trace will not intercept ESM loading."),iitm.exports=()=>({unhook:()=>{}}),iitm.exports.addHook=()=>{},iitm.exports.removeHook=()=>{};return iitm.exports}function requireRitm$1(){if(hasRequiredRitm$1)return ritm$1;hasRequiredRitm$1=1;const e=require$$0$1,t=require$$1$4,r=requireModuleDetailsFromPath(),s=requireDcPolyfill(),n=t.prototype.require;ritm$1=p;let i=Object.create(null),a=Object.create(null),o=Object.create(null),c=null;const u=s.channel("dd-trace:moduleLoadStart"),l=s.channel("dd-trace:moduleLoadEnd");function p(s,d,h){if(!(this instanceof p))return new p(s,d,h);if("function"==typeof s?(h=s,s=null,d={}):"function"==typeof d&&(h=d,d={}),s=s||[],d=d||{},this.modules=s,this.options=d,this.onrequire=h,Array.isArray(s))for(const e of s){const t=i[e];t?t.push(h):i[e]=[h]}c||(c=t.prototype.require=function(s){const c=t._resolveFilename(s,this),p=-1===c.indexOf(e.sep);let d,h,f;if(a[c])return require.cache[c]&&require.cache[c].exports!==a[c].original?require.cache[c].exports:a[c].exports;if(o[c])return n.apply(this,arguments);o[c]=!0;const g={filename:c,request:s};u.hasSubscribers&&u.publish(g);const m=n.apply(this,arguments);if(g.module=m,l.hasSubscribers&&l.publish(g),delete o[c],p){if(f=i[c],!f)return m;d=c}else{const s=void 0!==process.env.AWS_LAMBDA_FUNCTION_NAME,n=void 0!==process.env.DD_LAMBDA_HANDLER,a=-1!==c.split(e.sep).lastIndexOf("node_modules"),o=s&&n&&!a?{name:c}:r(c);if(!o)return m;if(d=o.name,h=o.basedir,f=i[d],!f)return m;const u=t._resolveLookupPaths(d,this,!0);if(!u)return m;let l;try{l=t._findPath(d,[h,...u])}catch(e){}l&&l===c||(d=d+e.sep+e.relative(h,c))}a[c]={exports:m},a[c].original=m;for(const e of f)a[c].exports=e(a[c].exports,d,h);return a[c].exports})}return p.reset=function(){t.prototype.require=n,c=null,o=Object.create(null),a=Object.create(null),i=Object.create(null)},p.prototype.unhook=function(){for(const e of this.modules){const t=(i[e]||[]).filter((e=>e!==this.onrequire));t.length>0?i[e]=t:delete i[e]}0===Object.keys(i).length&&p.reset()},ritm$1}function requireHook(){if(hasRequiredHook)return hook;hasRequiredHook=1;const e=require$$0$1,t=requireIitm(),r=requireRitm$1();function s(n,i){if(!(this instanceof s))return new s(n,i);this._patched=Object.create(null);const a=(t,r,s,n)=>{const a=[s,r].filter((e=>e)),o=e.join(...a);return this._patched[o]?t:(this._patched[o]=!0,i(t,r,s,n))};this._ritmHook=r(n,{},a),this._iitmHook=t(n,{},((e,t,r)=>e&&e.default?(e.default=a(e.default,t,r),e):a(e,t,r)))}return s.prototype.unhook=function(){this._ritmHook.unhook(),this._iitmHook.unhook(),this._patched=Object.create(null)},hook=s}var apolloServer={},nodeAbortController,hasRequiredNodeAbortController;function requireNodeAbortController(){if(hasRequiredNodeAbortController)return nodeAbortController;hasRequiredNodeAbortController=1;const{EventEmitter:e}=require$$0$f;class t{constructor(){this.eventEmitter=new e,this.onabort=null,this.aborted=!1,this.reason=void 0}toString(){return"[object AbortSignal]"}get[Symbol.toStringTag](){return"AbortSignal"}removeEventListener(e,t){this.eventEmitter.removeListener(e,t)}addEventListener(e,t){this.eventEmitter.on(e,t)}dispatchEvent(e){const t={type:e,target:this},r=`on${e}`;"function"==typeof this[r]&&this[r](t),this.eventEmitter.emit(e,t)}throwIfAborted(){if(this.aborted)throw this.reason}static abort(e){const t=new r;return t.abort(),t.signal}static timeout(e){const t=new r;return setTimeout((()=>t.abort(new Error("TimeoutError"))),e),t.signal}}class r{constructor(){this.signal=new t}abort(e){this.signal.aborted||(this.signal.aborted=!0,this.signal.reason=e||new Error("AbortError"),this.signal.dispatchEvent("abort"))}toString(){return"[object AbortController]"}get[Symbol.toStringTag](){return"AbortController"}}return nodeAbortController={AbortController:r,AbortSignal:t}}var instrument={},instrumentations,hasRequiredInstrumentations,hasRequiredInstrument,shimmer,hasRequiredShimmer,datadogShimmer,hasRequiredDatadogShimmer,hasRequiredApolloServer;function requireInstrumentations(){if(hasRequiredInstrumentations)return instrumentations;hasRequiredInstrumentations=1;const e=Symbol.for("_ddtrace_instrumentations");return commonjsGlobal[e]=commonjsGlobal[e]||{},instrumentations=commonjsGlobal[e]}function requireInstrument(){return hasRequiredInstrument||(hasRequiredInstrument=1,function(e){const t=requireDcPolyfill(),r=requireSemver(),s=requireInstrumentations(),{AsyncResource:n}=require$$0$4,i={};e.channel=function(e){const r=i[e];if(r)return r;const s=t.channel(e);return i[e]=s,s},e.addHook=function({name:e,versions:t,file:r},n){"string"==typeof e&&(e=[e]);for(const i of e)s[i]||(s[i]=[]),s[i].push({name:i,versions:t,file:r,hook:n})},r.satisfies(process.versions.node,">=17.8.0")?e.AsyncResource=n:e.AsyncResource=class extends n{static bind(t,r,s){return r=r||t.name,new e.AsyncResource(r||"bound-anonymous-fn").bind(t,s)}bind(e,t){let r;if(void 0===t){const t=this;r=function(...r){return r.unshift(e,this),Reflect.apply(t.runInAsyncScope,t,r)}}else r=this.runInAsyncScope.bind(this,e,t);return Object.defineProperties(r,{length:{configurable:!0,enumerable:!1,value:e.length,writable:!1},asyncResource:{configurable:!0,enumerable:!0,value:this,writable:!0}}),r}}}(instrument)),instrument}function requireShimmer(){if(hasRequiredShimmer)return shimmer;hasRequiredShimmer=1;const e=new WeakMap;function t(e,t){Object.setPrototypeOf(t,e);const r=Object.getOwnPropertyDescriptors(e),s=Reflect.ownKeys(r);for(const e of s)try{Object.defineProperty(t,e,r[e])}catch(e){}}function r(r,s){o(s),function(e){if(Function.prototype.toString.call(e).startsWith("class"))throw new Error("Target is a native class constructor and cannot be wrapped.")}(r);const n=function(){return s.apply(this,arguments)};return e.set(n,(()=>{s=r})),t(r,n),n}function s(r,s,n){!function(e,t){if(!e)throw new Error("No target object provided.");if("object"!=typeof e&&"function"!=typeof e)throw new Error("Invalid target.");if(!e[t])throw new Error(`No original method ${t}.`);if("function"!=typeof e[t])throw new Error(`Original method ${t} is not a function.`)}(r,s),o(n);const i=r[s],a=n(i),c=Object.getOwnPropertyDescriptor(r,s),u={configurable:!0,...c};if(t(i,a),c){if(e.set(a,(()=>Object.defineProperty(r,s,c))),c.get||c.set?u.get=()=>a:u.value=a,!1===c.configurable)return Object.create(r,{[s]:u})}else e.set(a,(()=>delete r[s])),u.value=a,u.writable=!0;return Object.defineProperty(r,s,u),r}function n(e,t,n){return"function"==typeof t?r(e,t):s(e,t,n)}function i(t,r){if(!t)return t;const s=e.get(r?t[r]:t);return s?(s(),t):t}function a(e){return Array.isArray(e)?e:[e]}function o(e){if(!e)throw new Error("No function provided.");if("function"!=typeof e)throw new Error("Target is not a function.")}return shimmer={wrap:n,massWrap:function(e,t,r){e=a(e),t=a(t);for(const s of e)for(const e of t)n(s,e,r)},unwrap:i,massUnwrap:function(e,t){e=a(e),t=a(t);for(const r of e)for(const e of t)i(r,e)}},shimmer}function requireDatadogShimmer(){return hasRequiredDatadogShimmer?datadogShimmer:(hasRequiredDatadogShimmer=1,datadogShimmer=requireShimmer())}function requireApolloServer(){if(hasRequiredApolloServer)return apolloServer;hasRequiredApolloServer=1;const{AbortController:e}=requireNodeAbortController(),t=requireDcPolyfill(),{addHook:r}=requireInstrument(),s=requireDatadogShimmer(),n=t.tracingChannel("datadog:apollo:middleware"),i=t.tracingChannel("datadog:apollo:request");let a;function o(t){return async function(){if(!a||!i.start.hasSubscribers)return t.apply(this,arguments);const r=new e,s={},n=i.tracePromise(t,{abortController:r,abortData:s},this,...arguments),o=new Promise(((e,t)=>{r.signal.addEventListener("abort",(t=>{const r=new a;Object.keys(s.headers).forEach((e=>{r.set(e,s.headers[e])})),e({headers:r,status:s.statusCode,body:{kind:"complete",string:s.message}})}),{once:!0})}));return Promise.race([o,n])}}return r({name:"@apollo/server",file:"dist/cjs/ApolloServer.js",versions:[">=4.0.0"]},(function(e){return s.wrap(e.ApolloServer.prototype,"executeHTTPGraphQLRequest",o),e})),r({name:"@apollo/server",file:"dist/cjs/express4/index.js",versions:[">=4.0.0"]},(function(e){return s.wrap(e,"expressMiddleware",(function(e){return function(t,r){const i=e.apply(this,arguments);return s.wrap(i,(function(e,t,r){return n.start.hasSubscribers?n.traceSync(i,{req:e},this,...arguments):i.apply(this,arguments)}))}})),e})),r({name:"@apollo/server",file:"dist/cjs/utils/HeaderMap.js",versions:[">=4.0.0"]},(function(e){return a=e.HeaderMap,e})),apolloServer}var apolloServerCore={},hasRequiredApolloServerCore;function requireApolloServerCore(){if(hasRequiredApolloServerCore)return apolloServerCore;hasRequiredApolloServerCore=1;const{AbortController:e}=requireNodeAbortController(),{addHook:t}=requireInstrument(),r=requireDatadogShimmer(),s=requireDcPolyfill().tracingChannel("datadog:apollo-server-core:request");return t({name:"apollo-server-core",file:"dist/runHttpQuery.js",versions:[">3.0.0"]},(t=>{const n=t.HttpQueryError;return r.wrap(t,"runHttpQuery",(function(t){return async function(){if(!s.start.hasSubscribers)return t.apply(this,arguments);const r=new e,i={},a=s.tracePromise(t,{abortController:r,abortData:i},this,...arguments),o=new Promise(((e,t)=>{r.signal.addEventListener("abort",(e=>{t(new n(i.statusCode,i.message,!0,i.headers))}),{once:!0})}));return Promise.race([a,o])}})),t})),apolloServerCore}var awsSdk={},hasRequiredAwsSdk;function requireAwsSdk(){if(hasRequiredAwsSdk)return awsSdk;hasRequiredAwsSdk=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();function n(t){return function(s){if(!this.service)return t.apply(this,arguments);const n=this.service.serviceIdentifier,i=o(n),a=e(`apm:aws:request:start:${i}`);if(!a.hasSubscribers)return t.apply(this,arguments);const c=new r("apm:aws:request:inner"),u=new r("apm:aws:request:outer");return c.runInAsyncScope((()=>(this.on("complete",c.bind((t=>{e(`apm:aws:request:complete:${i}`).publish({response:t})}))),a.publish({serviceIdentifier:n,operation:this.operation,awsRegion:this.service.config&&this.service.config.region,awsService:this.service.api&&this.service.api.className,request:this}),"function"==typeof s&&(arguments[0]=function(t,r,s,n){return function(i,a){const o={request:s,response:a};return n.runInAsyncScope((()=>{if(e(`apm:aws:response:start:${r}`).publish(o),!o.needsFinish)return t.apply(this,arguments);const s=e(`apm:aws:response:finish:${r}`);try{let e=t.apply(this,arguments);return e&&e.then?e=e.then((e=>(s.publish(),e)),(e=>{throw s.publish(e),e})):s.publish(),e}catch(e){throw s.publish(e),e}}))}}(s,i,this,u)),t.apply(this,arguments))))}}function i(t){return function(s,...n){const i=n[n.length-1],c=new r("apm:aws:request:inner"),u=new r("apm:aws:request:outer"),l=this.config.serviceId.toLowerCase(),p=o(l),d=s.constructor.name,h=this.constructor.name.replace(/Client$/,""),f=`${d[0].toLowerCase()}${d.slice(1).replace(/Command$/,"")}`,g={operation:f,params:s.input},m=e(`apm:aws:request:start:${p}`),_=e(`apm:aws:request:region:${p}`),b=e(`apm:aws:request:complete:${p}`),y=e(`apm:aws:response:start:${p}`),v=e(`apm:aws:response:finish:${p}`);return c.runInAsyncScope((()=>(m.publish({serviceIdentifier:l,operation:f,awsService:h,request:g}),this.config.region().then((e=>{_.publish(e)})),"function"!=typeof i?t.call(this,s,...n).then((e=>{const t=a(g,null,e);return b.publish(t),e}),(e=>{const t=a(g,e);throw b.publish(t),e})):(n[n.length-1]=function(e,t){const r=a(g,e,t);b.publish(r),u.runInAsyncScope((()=>{y.publish(r),i.apply(this,arguments),r.needsFinish&&v.publish(r.response.error)}))},t.call(this,s,...n)))))}}function a(e,t,r){const s={request:e,error:t,...r};return r&&r.$metadata&&(s.requestId=r.$metadata.requestId),{request:e,response:s}}function o(e){return["cloudwatchlogs","dynamodb","eventbridge","kinesis","lambda","redshift","s3","sns","sqs"].includes(e)?e:"default"}return t({name:"@smithy/smithy-client",versions:[">=1.0.3"]},(e=>(s.wrap(e.Client.prototype,"send",i),e))),t({name:"@aws-sdk/smithy-client",versions:[">=3"]},(e=>(s.wrap(e.Client.prototype,"send",i),e))),t({name:"aws-sdk",versions:[">=2.3.0"]},(e=>(s.wrap(e.config,"setPromisesDependency",(t=>function(r){const i=t.apply(this,arguments);return s.wrap(e.Request.prototype,"promise",n),i})),e))),t({name:"aws-sdk",file:"lib/core.js",versions:[">=2.3.0"]},(e=>(s.wrap(e.Request.prototype,"promise",n),e))),t({name:"aws-sdk",file:"lib/core.js",versions:[">=2.1.35"]},(e=>(s.wrap(e.Request.prototype,"send",n),e))),awsSdk}var cucumber={},hasRequiredCucumber;function requireCucumber(){if(hasRequiredCucumber)return cucumber;hasRequiredCucumber=1;const{createCoverageMap:e}=requireIstanbulLibCoverage(),{addHook:t,channel:r,AsyncResource:s}=requireInstrument(),n=requireDatadogShimmer(),i=requireLog$2(),a=r("ci:cucumber:test:start"),o=r("ci:cucumber:test:finish"),c=r("ci:cucumber:test-step:start"),u=r("ci:cucumber:error"),l=r("ci:cucumber:test-suite:start"),p=r("ci:cucumber:test-suite:finish"),d=r("ci:cucumber:test-suite:code-coverage"),h=r("ci:cucumber:library-configuration"),f=r("ci:cucumber:test-suite:skippable"),g=r("ci:cucumber:session:start"),m=r("ci:cucumber:session:finish"),_=r("ci:cucumber:itr:skipped-suites"),{getCoveredFilenamesFromCoverage:b,resetCoverage:y,mergeCoverage:v,fromCoverageMapToCoverage:S,getTestSuitePath:q}=requireTest(),E=e=>!!e.tags.find((e=>"@datadog:unskippable"===e.name)),R=e(),T=new WeakSet;let A={};const w={};let x=[],I="",C=!1,O=!1;function $(e){return 1===e.status?{status:"pass"}:2===e.status?{status:"skip"}:4===e.status?{status:"skip",skipReason:"not implemented"}:{status:"fail",errorMessage:e.message}}function k(e){return"PASSED"===e.status?{status:"pass"}:"SKIPPED"===e.status||"PENDING"===e.status?{status:"skip"}:"UNDEFINED"===e.status?{status:"skip",skipReason:"not implemented"}:{status:"fail",errorMessage:e.message}}function P(e,t){T.has(e)||(T.add(e),n.wrap(e.prototype,"run",(e=>function(){if(!a.hasSubscribers)return e.apply(this,arguments);return new s("bound-anonymous-fn").runInAsyncScope((()=>{const r=this.pickle.uri;if(!w[r]){O=E(this.pickle);const e=q(r,process.cwd());C=O&&x.includes(e),l.publish({testSuitePath:e,isUnskippable:O,isForcedToRun:C,itrCorrelationId:I})}const s=this.gherkinDocument&&this.gherkinDocument.feature&&this.gherkinDocument.feature.location&&this.gherkinDocument.feature.location.line;a.publish({testName:this.pickle.name,testFileAbsolutePath:r,testSourceLine:s});try{const s=e.apply(this,arguments);return s.finally((()=>{const e=this.getWorstStepResult(),{status:s,skipReason:n,errorMessage:i}=t?k(e):$(e);if(w[r]?w[r].push(s):w[r]=[s],o.publish({status:s,skipReason:n,errorMessage:i}),w[r].length===A[r].length){const e=(a=w[r]).some((e=>"fail"===e))?"fail":a.every((e=>"skip"===e))?"skip":"pass";if(commonjsGlobal.__coverage__){const e=b(commonjsGlobal.__coverage__);d.publish({coverageFiles:e,suiteFile:r}),v(commonjsGlobal.__coverage__,R),y(commonjsGlobal.__coverage__)}p.publish(e)}var a})),s}catch(e){throw u.publish(e),e}}))})),n.wrap(e.prototype,"runStep",(e=>function(){if(!c.hasSubscribers)return e.apply(this,arguments);const r=arguments[0];let n;n=t?r.text:r.isHook?"hook":r.pickleStep.text;return new s("bound-anonymous-fn").runInAsyncScope((()=>{c.publish({resource:n});try{const r=e.apply(this,arguments);return r.then((e=>{const{status:r,skipReason:s,errorMessage:n}=t?k(e):$(e);o.publish({isStep:!0,status:r,skipReason:s,errorMessage:n})})),r}catch(e){throw u.publish(e),e}}))})))}return t({name:"@cucumber/cucumber",versions:["7.0.0 - 7.2.1"],file:"lib/runtime/pickle_runner.js"},(function(e){return process.env.CUCUMBER_WORKER_ID?(i.warn("Unable to initialize CI Visibility because Cucumber is running in parallel mode."),e):(P(e.default,!1),e)})),t({name:"@cucumber/cucumber",versions:[">=7.3.0"],file:"lib/runtime/test_case_runner.js"},(function(e){return process.env.CUCUMBER_WORKER_ID?(i.warn("Unable to initialize CI Visibility because Cucumber is running in parallel mode."),e):(P(e.default,!0),e)})),t({name:"@cucumber/cucumber",versions:[">=7.0.0"],file:"lib/runtime/index.js"},((e,t)=>(n.wrap(e.default.prototype,"start",(e=>async function(){const r=new s("bound-anonymous-fn");let n;const a=new Promise((e=>{n=e}));r.runInAsyncScope((()=>{h.publish({onDone:n})})),await a;const o=new Promise((e=>{n=e}));r.runInAsyncScope((()=>{f.publish({onDone:n})}));const c=await o,u=c.err;x=c.skippableSuites;let l=[],p=!1;if(!u){const e=(b=x,(d=this).pickleIds.reduce(((e,t)=>{const r=d.eventDataCollector.getPickle(t),s=q(r.uri,process.cwd()),n=E(r);return b.includes(s)&&!n?e.skippedSuites.add(s):e.picklesToRun.push(t),e}),{skippedSuites:new Set,picklesToRun:[]})),{picklesToRun:t}=e;p=t.length!==this.pickleIds.length,i.debug((()=>`${t.length} out of ${this.pickleIds.length} suites are going to run.`)),this.pickleIds=t,l=Array.from(e.skippedSuites),I=c.itrCorrelationId}var d,b;A=function(e){return e.pickleIds.reduce(((t,r)=>{const s=e.eventDataCollector.getPickle(r);return t[s.uri]?t[s.uri].push(s):t[s.uri]=[s],t}),{})}(this);const y=process.argv.slice(2).join(" "),v=process.env.npm_lifecycle_script||`cucumber-js ${y}`;r.runInAsyncScope((()=>{g.publish({command:v,frameworkVersion:t})})),!u&&l.length&&_.publish({skippedSuites:l,frameworkVersion:t});const T=await e.apply(this,arguments);let w;if(commonjsGlobal.__coverage__){try{w=R.getCoverageSummary().lines.pct}catch(e){}commonjsGlobal.__coverage__=S(R)}return r.runInAsyncScope((()=>{m.publish({status:T?"pass":"fail",isSuitesSkipped:p,testCodeCoverageLinesTotal:w,numSkippedSuites:l.length,hasUnskippableSuites:O,hasForcedToRunSuites:C})})),T})),e))),cucumber}var playwright={},hasRequiredPlaywright,elasticsearch,hasRequiredElasticsearch;function requirePlaywright(){if(hasRequiredPlaywright)return playwright;hasRequiredPlaywright=1;const{addHook:e,channel:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),{parseAnnotations:n}=requireTest(),i=t("ci:playwright:test:start"),a=t("ci:playwright:test:finish"),o=t("ci:playwright:session:start"),c=t("ci:playwright:session:finish"),u=t("ci:playwright:test-suite:start"),l=t("ci:playwright:test-suite:finish"),p=new WeakMap,d=new Map,h=new Map;let f=[];const g={passed:"pass",failed:"fail",timedOut:"fail",skipped:"skip"};let m={};function _(e){try{return e._configLoader.fullConfig()}catch(t){try{return e._loader.fullConfig()}catch(t){return e._config||{}}}}function b(e){const t=e._config?.config?.projects;return t||e._loader?.fullConfig()?.projects}function y(e,t){return e?e.find((e=>e.__projectId===t||e._id===t))?.name:null}function v(e,t){const{_requireFile:s,title:n,_type:a,location:{line:o}}=e;if("beforeAll"===a||"afterAll"===a)return;if(!f.includes(s)){f.push(s);const e=new r("bound-anonymous-fn");d.set(s,e),e.runInAsyncScope((()=>{u.publish(s)}))}const c=new r("bound-anonymous-fn");p.set(e,c),c.runInAsyncScope((()=>{i.publish({testName:n,testSuiteAbsolutePath:s,testSourceLine:o,browserName:t})}))}function S(e,t,r,s){let i;t.length&&(i=n(t));const{_requireFile:o,results:c,_type:u}=e;if("beforeAll"===u||"afterAll"===u)return;const f=c[c.length-1];if(p.get(e).runInAsyncScope((()=>{a.publish({testStatus:r,steps:f.steps,error:s,extraTags:i})})),h.has(o)?h.get(o).push(r):h.set(o,[r]),m[o]=m[o].filter((t=>t!==e)),!m[o].length){const e=h.get(o);let t="pass";e.some((e=>"fail"===e))?t="fail":e.every((e=>"skip"===e))&&(t="skip");d.get(o).runInAsyncScope((()=>{l.publish(t)}))}}function q(e){return function(){return m=function(e){const t={};for(const{test:r}of e.values()){const{_requireFile:e}=r;"beforeAll"!==r._type&&"afterAll"!==r._type&&(t[e]?t[e].push(r):t[e]=[r])}return t}(this._testById),e.apply(this,arguments)}}function E(e){return function(){return m=arguments[0].reduce(((e,{requireFile:t,tests:r})=>(e[t]?e[t]=e[t].concat(r):e[t]=r,e)),{}),e.apply(this,arguments)}}function R(e,t){return e._testById?e._testById.get(t)?.test:e._allTests?e._allTests.find((({id:e})=>e===t)):void 0}function T(e,t){return s.wrap(e.Dispatcher.prototype,"run",t),s.wrap(e.Dispatcher.prototype,"_createWorker",(e=>function(){const t=this,r=e.apply(this,arguments);return r.on("testBegin",(({testId:e})=>{const r=R(t,e);v(r,y(b(t),r._projectId))})),r.on("testEnd",(({testId:e,status:r,errors:s,annotations:n})=>{S(R(t,e),n,g[r],s&&s[0])})),r})),e}function A(e,t){return s.wrap(e.Runner.prototype,"runAllTests",(e=>async function(){const s=new r("bound-anonymous-fn"),n=function(e){const t=_(e);return t.rootDir?t.rootDir:e._configDir?e._configDir:e._config&&e._config.config?.rootDir||process.cwd()}(this),i=`playwright ${process.argv.slice(2).join(" ")}`;s.runInAsyncScope((()=>{o.publish({command:i,frameworkVersion:t,rootDir:n})}));const a=function(e){const t=_(e);return t.projects?.map((({project:e})=>e))}(this),u=await e.apply(this,arguments);Object.values(m).forEach((e=>{e.forEach((e=>{v(e,y(a,e._projectId)),S(e,[],"skip")}))}));const l=u.status||u;let p;const d=new Promise((e=>{p=e}));return s.runInAsyncScope((()=>{c.publish({status:g[l],onDone:p})})),await d,f=[],m={},u})),e}return e({name:"@playwright/test",file:"lib/runner.js",versions:[">=1.18.0 <=1.30.0"]},A),e({name:"@playwright/test",file:"lib/dispatcher.js",versions:[">=1.18.0 <1.30.0"]},(function(e){return s.wrap(e.Dispatcher.prototype,"run",q),s.wrap(e.Dispatcher.prototype,"_createWorker",(e=>function(){const t=this,r=e.apply(this,arguments);return r.process.on("message",(({method:e,params:r})=>{if("testBegin"===e){const{test:e}=t._testById.get(r.testId);v(e,y(b(t),e._projectId))}else if("testEnd"===e){const{test:e}=t._testById.get(r.testId),{results:s}=e,n=s[s.length-1];S(e,r.annotations,g[n.status],n.error)}})),r})),e})),e({name:"@playwright/test",file:"lib/dispatcher.js",versions:[">=1.30.0 <1.31.0"]},(e=>T(e,q))),e({name:"@playwright/test",file:"lib/runner/dispatcher.js",versions:[">=1.31.0 <1.38.0"]},(e=>T(e,E))),e({name:"@playwright/test",file:"lib/runner/runner.js",versions:[">=1.31.0 <1.38.0"]},A),e({name:"playwright",file:"lib/runner/runner.js",versions:[">=1.38.0"]},A),e({name:"playwright",file:"lib/runner/dispatcher.js",versions:[">=1.38.0"]},(e=>T(e,E))),playwright}function requireElasticsearch(){if(hasRequiredElasticsearch)return elasticsearch;hasRequiredElasticsearch=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();function n(t){const r=e(`apm:${t}:query:connect`);return function(e){return function(){const t=e.apply(this,arguments);return r.hasSubscribers&&t&&t.url&&r.publish(t.url),t}}}function i(t){const s=e(`apm:${t}:query:start`),n=e(`apm:${t}:query:finish`),i=e(`apm:${t}:query:error`);return function(e){return function(t,n,o){if(!s.hasSubscribers)return e.apply(this,arguments);if(!t)return e.apply(this,arguments);const c=new r("bound-anonymous-fn"),u=new r("bound-anonymous-fn");return u.runInAsyncScope((()=>{s.publish({params:t});try{const r=arguments.length-1;if("function"==typeof(o=arguments[r]))return o=c.bind(o),arguments[r]=u.bind((function(e){return a(t,e),o.apply(null,arguments)})),e.apply(this,arguments);{const r=e.apply(this,arguments);if(r&&"function"==typeof r.then){const e=u.bind((()=>a(t))),s=u.bind((e=>a(t,e)));r.then(e,s)}else a(t);return r}}catch(e){throw e.stack,i.publish(e),e}}))}};function a(e,t){t&&i.publish(t),n.publish({params:e})}}return t({name:"@elastic/transport",file:"lib/Transport.js",versions:[">=8"]},(e=>(s.wrap(e.default.prototype,"request",i("elasticsearch")),s.wrap(e.default.prototype,"getConnection",n("elasticsearch")),e))),t({name:"@elastic/elasticsearch",file:"lib/Transport.js",versions:[">=5.6.16 <8",">=8"]},(e=>(s.wrap(e.prototype,"request",i("elasticsearch")),s.wrap(e.prototype,"getConnection",n("elasticsearch")),e))),t({name:"elasticsearch",file:"src/lib/transport.js",versions:[">=10"]},(e=>(s.wrap(e.prototype,"request",i("elasticsearch")),e))),t({name:"elasticsearch",file:"src/lib/connection_pool.js",versions:[">=10"]},(t=>(s.wrap(t.prototype,"select",function(){const t=e("apm:elasticsearch:query:connect");return function(e){return function(){if(1===arguments.length){const e=arguments[0];arguments[0]=function(r,s){t.hasSubscribers&&s&&s.host&&t.publish({hostname:s.host.host,port:s.host.port}),e(r,s)}}return e.apply(this,arguments)}}}()),t))),elasticsearch={createWrapRequest:i,createWrapGetConnection:n}}var googleCloudPubsub={},hasRequiredGoogleCloudPubsub;function requireGoogleCloudPubsub(){if(hasRequiredGoogleCloudPubsub)return googleCloudPubsub;hasRequiredGoogleCloudPubsub=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:google-cloud-pubsub:request:start"),i=e("apm:google-cloud-pubsub:request:finish"),a=e("apm:google-cloud-pubsub:request:error"),o=e("apm:google-cloud-pubsub:receive:start"),c=e("apm:google-cloud-pubsub:receive:finish"),u=e("apm:google-cloud-pubsub:receive:error"),l=["createTopic","updateTopic","publish","getTopic","listTopics","listTopicSubscriptions","listTopicSnapshots","deleteTopic","detachSubscription"],p=["createSchema","getSchema","listSchemas","listSchemaRevisions","commitSchema","rollbackSchema","deleteSchemaRevision","deleteSchema","validateSchema","validateMessage"],d=["createSubscription","getSubscription","updateSubscription","listSubscriptions","deleteSubscription","modifyAckDeadline","acknowledge","pull","streamingPull","modifyPushConfig","getSnapshot","listSnapshots","createSnapshot","updateSnapshot","deleteSnapshot","seek"];function h(e){const t=e.name;return function(s){if(!n.hasSubscribers)return e.apply(this,arguments);const o=new r("bound-anonymous-fn");return o.runInAsyncScope((()=>{const c=this.auth._cachedProjectId,u=arguments[arguments.length-1];if(n.publish({request:s,api:t,projectId:c}),"function"==typeof u){const t=new r("bound-anonymous-fn");return arguments[arguments.length-1]=o.bind((function(e){return e&&a.publish(e),i.publish(),t.runInAsyncScope((()=>u.apply(this,arguments)))})),e.apply(this,arguments)}return e.apply(this,arguments).then((e=>(i.publish(),e)),(e=>{throw a.publish(e),i.publish(),e}))}))}}function f(e,t,r){for(const n of t)"function"==typeof e[n]&&s.wrap(e,n,r)}return t({name:"@google-cloud/pubsub",versions:[">=1.2"]},(e=>{const t=e.Subscription;return s.wrap(t.prototype,"emit",(e=>function(t,s){if("message"!==t||!s)return e.apply(this,arguments);return new r("bound-anonymous-fn").runInAsyncScope((()=>{try{return e.apply(this,arguments)}catch(e){throw u.publish(e),e}}))})),e})),t({name:"@google-cloud/pubsub",versions:[">=1.2"],file:"build/src/lease-manager.js"},(e=>{const t=e.LeaseManager;return s.wrap(t.prototype,"_dispense",(e=>function(t){return o.hasSubscribers&&o.publish({message:t}),e.apply(this,arguments)})),s.wrap(t.prototype,"remove",(e=>function(t){return c.publish({message:t}),e.apply(this,arguments)})),s.wrap(t.prototype,"clear",(e=>function(){for(const e of this._messages)c.publish({message:e});return e.apply(this,arguments)})),e})),t({name:"@google-cloud/pubsub",versions:[">=1.2"]},(e=>{const{PublisherClient:t,SchemaServiceClient:r,SubscriberClient:s}=e.v1;return f(t.prototype,l,h),f(s.prototype,d,h),r&&f(r.prototype,p,h),e})),googleCloudPubsub}var graphql$1={},hasRequiredGraphql$1;function requireGraphql$1(){if(hasRequiredGraphql$1)return graphql$1;hasRequiredGraphql$1=1;const{AbortController:e}=requireNodeAbortController(),{addHook:t,channel:r,AsyncResource:s}=requireInstrument(),n=requireDatadogShimmer(),i=new WeakMap,a=new WeakMap,o=new WeakSet,c=new WeakSet,u=r("apm:graphql:execute:start"),l=r("apm:graphql:execute:finish"),p=r("apm:graphql:execute:error"),d=r("apm:graphql:resolve:start"),h=r("apm:graphql:resolve:finish"),f=r("apm:graphql:resolve:updateField"),g=r("apm:graphql:resolve:error"),m=r("apm:graphql:parser:start"),_=r("apm:graphql:parser:finish"),b=r("apm:graphql:parser:error"),y=r("apm:graphql:validate:start"),v=r("apm:graphql:validate:finish"),S=r("apm:graphql:validate:error");class q extends Error{constructor(e){super(e),this.name="AbortError"}}function E(e,t){if(!e||!Array.isArray(e.definitions))return;const r=e.definitions.filter((e=>e)),s=["query","mutation","subscription"];return t?r.filter((e=>-1!==s.indexOf(e.operation))).find((e=>t===(e.name&&e.name.value))):r.find((e=>-1!==s.indexOf(e.operation)))}function R(e,t){return 1!==e.length?function(e,t){return e[3]=e[3]||{},e[6]=x(e[6]||t),e.length=Math.max(e.length,7),{schema:e[0],document:e[1],rootValue:e[2],contextValue:e[3],variableValues:e[4],operationName:e[5],fieldResolver:e[6]}}(e,t):(e[0].contextValue=e[0].contextValue||{},e[0].fieldResolver=x(e[0].fieldResolver||t),e[0])}function T(e){return function(t){if(!m.hasSubscribers)return e.apply(this,arguments);return new s("bound-anonymous-fn").runInAsyncScope((()=>{let r;m.publish();try{r=e.apply(this,arguments);return E(r)?(t&&a.set(r,t.body||t),r):r}catch(e){throw e.stack,b.publish(e),e}finally{_.publish({source:t,document:r,docSource:a.get(r)})}}))}}function A(e){return function(t,r,n,i){if(!y.hasSubscribers)return e.apply(this,arguments);return new s("bound-anonymous-fn").runInAsyncScope((()=>{let t;y.publish({docSource:a.get(r),document:r});try{return t=e.apply(this,arguments),t&&t[0]&&S.publish(t&&t[0]),t}catch(e){throw e.stack,S.publish(e),e}finally{v.publish({document:r,errors:t})}}))}}function w(t){return function(r){const n=t.defaultFieldResolver;return function(){if(!u.hasSubscribers)return r.apply(this,arguments);const t=new s("bound-anonymous-fn");return t.runInAsyncScope((()=>{const s=R(arguments,n),o=s.schema,c=s.document,d=a.get(c),f=s.contextValue,m=E(c,s.operationName);if(i.has(f))return r.apply(this,arguments);o&&(O(o._queryType),O(o._mutationType)),u.publish({operation:m,args:s,docSource:a.get(c)});const _={source:d,asyncResource:t,fields:{},abortController:new e};return i.set(f,_),I(r,t,this,arguments,_.abortController,((e,t)=>{h.hasSubscribers&&function({fields:e}){Object.keys(e).reverse().forEach((t=>{const r=e[t];r.asyncResource.runInAsyncScope((()=>{r.error&&g.publish(r.error),h.publish(r.finishTime)}))}))}(_);const r=e||t&&t.errors&&t.errors[0];r&&p.publish(r),l.publish({res:t,args:s,context:_})}))}))}}}function x(e){if("function"!=typeof e||o.has(e))return e;function t(t,r,n,a){if(!d.hasSubscribers)return e.apply(this,arguments);const o=i.get(n);if(!o)return e.apply(this,arguments);const c=function(e,t,r){const n=t&&t.path,i=function(e){const t=[];let r=e;for(;r;)t.push(r.key),r=r.prev;return t.reverse()}(n),a=i.join("."),o=e.fields;let c=o[a];if(!c){const n=function(e,t){for(let r=t.length-1;r>0;r--){const s=C(e,t.slice(0,r));if(s)return s}return{asyncResource:e.asyncResource}}(e,i);n.asyncResource.runInAsyncScope((()=>{const i=new s("bound-anonymous-fn");i.runInAsyncScope((()=>{d.publish({info:t,context:e,args:r})})),c=o[a]={parent:n,asyncResource:i,error:null}}))}return c}(o,a,r);return I(e,c.asyncResource,this,arguments,o.abortController,(e=>{f.publish({field:c,info:a,err:e})}))}return o.add(t),t}function I(e,t,r,s,n,i){return i=i||(()=>{}),t.runInAsyncScope((()=>{if(n?.signal.aborted)throw i(null,null),new q("Aborted");try{const n=e.apply(r,s);return n&&"function"==typeof n.then?n.then(t.bind((e=>i(null,e))),t.bind((e=>i(e)))):i(null,n),n}catch(e){throw i(e),e}}))}function C(e,t){return e.fields[t.join(".")]}function O(e){e&&e._fields&&!c.has(e)&&(c.add(e),Object.keys(e._fields).forEach((t=>{const r=e._fields[t];!function(e){if(!e||!e.resolve)return;e.resolve=x(e.resolve)}(r),function(e){if(!e||!e.type)return;let t=e.type;for(;t.ofType;)t=t.ofType;O(t)}(r)})))}return t({name:"@graphql-tools/executor",file:"cjs/execution/execute.js",versions:[">=0.0.14"]},(e=>(n.wrap(e,"execute",w(e)),e))),t({name:"graphql",file:"execution/execute.js",versions:[">=0.10"]},(e=>(n.wrap(e,"execute",w(e)),e))),t({name:"graphql",file:"language/parser.js",versions:[">=0.10"]},(e=>(n.wrap(e,"parse",T),e))),t({name:"graphql",file:"validation/validate.js",versions:[">=0.10"]},(e=>(n.wrap(e,"validate",A),e))),graphql$1}var grpc={},client$3={},types,hasRequiredTypes,hasRequiredClient$3;function requireTypes(){return hasRequiredTypes?types:(hasRequiredTypes=1,types={unary:"unary",bidi:"bidi_streaming",client_stream:"client_streaming",clientStream:"client_streaming",server_stream:"server_streaming",serverStream:"server_streaming"})}function requireClient$3(){if(hasRequiredClient$3)return client$3;hasRequiredClient$3=1;const e=requireTypes(),{addHook:t,channel:r}=requireInstrument(),s=requireDatadogShimmer(),n=parseInt(process.versions.node.split(".")[0]),i=new WeakSet,a=new WeakMap,o=r("apm:grpc:client:request:start"),c=r("apm:grpc:client:request:asyncStart"),u=r("apm:grpc:client:request:error"),l=r("apm:grpc:client:request:finish"),p=r("apm:grpc:client:request:emit");function d(e,t=!1){return function(r){return function(s){const n=v(this,arguments,4);return y(this,r,n,s,n[4],e,t)}}}function h(e=!1){return function(t){return function(r){const s=t.apply(this,arguments);return s?(g(s,e),s):s}}}function f(e=!1){return function(t){return function(r){const s=t.apply(this,arguments);return m(s,r,e),s}}}function g(e,t=!1){for(const r in e)e[r].format||(e[r].service&&e[r].prototype?m(e[r],e[r].service,t):g(e[r],t))}function m(t,r,s=!1){const n=t.prototype;"object"!=typeof r||"format"in r||Object.keys(r).forEach((t=>{if(!r[t])return;const i=r[t].originalName,a=r[t].path,o=function(t){if(t.requestStream)return t.responseStream?e.bidi:e.client_stream;if(t.responseStream)return e.server_stream;return e.unary}(r[t]);r[t]&&(n[t]=_(n[t],a,o,s)),i&&(n[i]=_(n[i],a,o,s))}))}function _(e,t,r,s){if("function"!=typeof e||i.has(e))return e;const n=function(){const n=v(this,arguments,1);return y(this,e,n,t,n[1],r,s)};return Object.assign(n,e),i.add(n),n}function b(e,t=(()=>{})){return function(r){return r&&(e.error=r,u.publish(e)),c.runStores(e,(()=>t.apply(this,arguments)))}}function y(t,r,n,i,a,c,d=!1){if(!o.hasSubscribers)return r.apply(t,n);const h=n.length,f=n[h-1],g={metadata:a,path:i,type:c};return o.runStores(g,(()=>{try{c!==e.unary&&c!==e.client_stream||("function"==typeof f?n[h-1]=b(g,f):n[h]=b(g));const i=r.apply(t,n);return i&&"function"==typeof i.emit&&s.wrap(i,"emit",function(e,t=!1){const r=t?function(e,t,r){e.result=t,e.peer=r.getPeer(),l.publish(e)}:function(e,t,r){e.result=t,l.publish(e)};return function(t){return function(s,n){switch(s){case"error":e.error=n,u.publish(e);break;case"status":r(e,n,this)}return p.runStores(e,(()=>t.apply(this,arguments)))}}}(g,d)),i}catch(e){g.error=e,u.publish(g)}}))}function v(e,t,r){const s=function(e){let t=e;do{const e=a.get(t);if(e)return e}while(t=Object.getPrototypeOf(t))}(e);if(!e||!s)return t;const n=t[r],i=[];for(let e=0;e<r;e++)i.push(t[e]);n&&n.constructor&&"Metadata"===n.constructor.name||i.push(new s.Metadata),n&&i.push(n);for(let e=r+1;e<t.length;e++)i.push(t[e]);return i}function S(t=!1){return function(r){const n=r.Client.prototype;return a.set(n,r),s.wrap(n,"makeBidiStreamRequest",d(e.bidi,t)),s.wrap(n,"makeClientStreamRequest",d(e.clientStream,t)),s.wrap(n,"makeServerStreamRequest",d(e.serverStream,t)),s.wrap(n,"makeUnaryRequest",d(e.unary,t)),r}}return n<=14&&(t({name:"grpc",versions:[">=1.24.3"]},S(!0)),t({name:"grpc",versions:[">=1.24.3"],file:"src/client.js"},(e=>(s.wrap(e,"makeClientConstructor",f(!0)),e)))),t({name:"@grpc/grpc-js",versions:[">=1.0.3 <1.1.4"]},S(!1)),t({name:"@grpc/grpc-js",versions:[">=1.0.3 <1.1.4"],file:"build/src/make-client.js"},(e=>(s.wrap(e,"makeClientConstructor",f(!1)),s.wrap(e,"loadPackageDefinition",h(!1)),e))),t({name:"@grpc/grpc-js",versions:[">=1.1.4"]},S(!0)),t({name:"@grpc/grpc-js",versions:[">=1.1.4"],file:"build/src/make-client.js"},(e=>(s.wrap(e,"makeClientConstructor",f(!0)),s.wrap(e,"loadPackageDefinition",h(!0)),e))),client$3}var server$3={},hasRequiredServer$3,hasRequiredGrpc;function requireServer$3(){if(hasRequiredServer$3)return server$3;hasRequiredServer$3=1;const e=requireTypes(),{channel:t,addHook:r}=requireInstrument(),s=requireDatadogShimmer(),n=parseInt(process.versions.node.split(".")[0]),i=t("apm:grpc:server:request:start"),a=t("apm:grpc:server:request:asyncStart"),o=t("apm:grpc:server:request:error"),c=t("apm:grpc:server:request:update"),u=t("apm:grpc:server:request:finish"),l=t("apm:grpc:server:request:emit"),p=0,d=1;function h(t,r){return function(n,h){if(!((e,t)=>{return!(!i.hasSubscribers||!e||!e.type||!t[0]||"unary"!==e.type&&("function"!=typeof(r=t[0]).emit||"function"!=typeof r.once)||"unary"===e.type&&"function"!=typeof t[1]);var r})(this,arguments))return t.apply(this,arguments);const f=n.metadata,g=e[this.type],m="unary"!==g,_={name:r,metadata:f,type:g};return i.runStores(_,(()=>{try{const e=()=>{_.code=d,u.publish(_)};return n.once("cancelled",e),m?function(e,t,r){e.call&&e.call.sendStatus&&(e.call.sendStatus=function(e,t){return function(r){return t.status=r,c.publish(t),e.apply(this,arguments)}}(e.call.sendStatus,t));s.wrap(e,"emit",function(e,t,r){return function(s){return function(n,i){switch(n){case"error":t.error=i,o.publish(t),t.code=i.code,u.publish(t),e.removeListener("cancelled",r);break;case"finish":e.status&&c.publish(e.status),e.status&&0!==e.status.code||u.publish(t),e.removeListener("cancelled",r)}return s.apply(this,arguments)}}}(e,t,r))}(n,_,e):arguments[1]=function(e=(()=>{}),t,r,s){return function(n,i,c,l){return n?(r.error=n,o.publish(r)):(r.code=p,r.trailer=c),u.publish(r),t.removeListener("cancelled",s),a.runStores(r,(()=>e.apply(this,arguments)))}}(h,n,_,e),s.wrap(n,"emit",(e=>function(){return l.runStores(_,(()=>e.apply(this,arguments)))})),t.apply(this,arguments)}catch(e){_.error=e,o.publish(_)}}))}}function f(e){return function(t,r,s,n,i){return"function"==typeof r&&(arguments[1]=h(r,t)),e.apply(this,arguments)}}return n<=14&&r({name:"grpc",versions:[">=1.24.3"],file:"src/server.js"},(e=>(s.wrap(e.Server.prototype,"register",f),e))),r({name:"@grpc/grpc-js",versions:[">=1.0.3"],file:"build/src/server.js"},(e=>(s.wrap(e.Server.prototype,"register",f),e))),server$3}function requireGrpc(){return hasRequiredGrpc||(hasRequiredGrpc=1,requireClient$3(),requireServer$3()),grpc}var hapi={},hasRequiredHapi;function requireHapi(){if(hasRequiredHapi)return hapi;hasRequiredHapi=1;const e=requireDatadogShimmer(),{addHook:t,channel:r,AsyncResource:s}=requireInstrument(),n=r("apm:hapi:request:handle"),i=r("apm:hapi:request:route"),a=r("apm:hapi:request:error"),o=r("apm:hapi:extension:enter");function c(e){return function(t){const r=e.apply(this,arguments);return r?("function"==typeof r.ext&&(r.ext=l(r.ext)),"function"==typeof r.start&&(r.start=u(r.start)),r):r}}function u(e){return function(){return this&&"function"==typeof this.ext&&this.ext("onPreResponse",g),e.apply(this,arguments)}}function l(e){return function(t,r,s){return"object"==typeof t?arguments[0]=function(e){return[].concat(e).map((e=>e&&e.method?Object.assign({},e,{method:h(e.method)}):e))}(t):arguments[1]=h(r),e.apply(this,arguments)}}function p(e){return function(t){const r=e.apply(this,arguments);return"function"!=typeof r?r:function(e,t){return n.publish({req:e,res:t}),r.apply(this,arguments)}}}function d(e){return function(t){const r=e.apply(this,arguments);return this&&Array.isArray(this._cycle)&&(this._cycle=this._cycle.map(f)),r}}function h(e){return[].concat(e).map(f)}function f(e){return"function"!=typeof e?e:function(t,r){const n=t&&t.raw&&t.raw.req;if(!n)return e.apply(this,arguments);return new s("bound-anonymous-fn").runInAsyncScope((()=>(o.publish({req:n}),e.apply(this,arguments))))}}function g(e,t){if(!e||!e.raw)return m(e,t);const r=e.raw.req;return e.response instanceof Error&&a.publish(e.response),e.route&&i.publish({req:r,route:e.route.path}),m(e,t)}function m(e,t){return t.continue?"function"==typeof t.continue?t.continue():t.continue:"function"==typeof t?t():void 0}return t({name:"@hapi/hapi",versions:[">=17.9"]},(t=>(e.massWrap(t,["server","Server"],c),t))),t({name:"@hapi/hapi",versions:[">=17.9"],file:"lib/core.js"},(t=>(e.wrap(t.prototype,"_dispatch",p),t))),t({name:"@hapi/hapi",versions:[">=17.9"],file:"lib/route.js"},(t=>(e.wrap(t.prototype,"rebuild",d),t))),t({name:"hapi",versions:[">=17"]},(t=>(e.massWrap(t,["server","Server"],c),t))),t({name:"hapi",versions:["16"]},(t=>(e.wrap(t.Server.prototype,"start",u),e.wrap(t.Server.prototype,"ext",l),t))),t({name:"hapi",versions:["16"],file:"lib/connection.js"},(t=>(e.wrap(t.prototype,"_dispatch",p),t))),t({name:"hapi",versions:[">=17"],file:"lib/core.js"},(t=>(e.wrap(t.prototype,"_dispatch",p),t))),t({name:"hapi",versions:[">=16"],file:"lib/route.js"},(t=>(e.wrap(t.prototype,"rebuild",d),t))),hapi}var jest$1={},build={},detectNewline={exports:{}},hasRequiredDetectNewline,hasRequiredBuild,util$7,hasRequiredUtil$1,hasRequiredJest;function requireDetectNewline(){if(hasRequiredDetectNewline)return detectNewline.exports;hasRequiredDetectNewline=1;const e=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");const t=e.match(/(?:\r?\n)/g)||[];if(0===t.length)return;const r=t.filter((e=>"\r\n"===e)).length;return r>t.length-r?"\r\n":"\n"};return detectNewline.exports=e,detectNewline.exports.graceful=t=>"string"==typeof t&&e(t)||"\n",detectNewline.exports}function requireBuild(){if(hasRequiredBuild)return build;function e(){const t=require$$0$a;return e=function(){return t},t}function t(){const e=(r=requireDetectNewline())&&r.__esModule?r:{default:r};var r;return t=function(){return e},e}hasRequiredBuild=1,Object.defineProperty(build,"__esModule",{value:!0}),build.extract=function(e){const t=e.match(n);return t?t[0].trimLeft():""},build.parse=function(e){return p(e).pragmas},build.parseWithComments=p,build.print=function({comments:r="",pragmas:s={}}){const n=(0,t().default)(r)??e().EOL,i=" *",a=Object.keys(s),o=a.flatMap((e=>d(e,s[e]))).map((e=>`${i} ${e}${n}`)).join("");if(!r){if(0===a.length)return"";if(1===a.length&&!Array.isArray(s[a[0]])){const e=s[a[0]];return`/** ${d(a[0],e)[0]} */`}}const c=r.split(n).map((e=>`${i} ${e}`)).join(n)+n;return"/**"+n+(r?c:"")+(r&&a.length?i+n:"")+o+" */"},build.strip=function(e){const t=e.match(n);return t&&t[0]?e.substring(t[0].length):e};const r=/\*\/$/,s=/^\/\*\*?/,n=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,i=/(^|\s+)\/\/([^\r\n]*)/g,a=/^(\r?\n)+/,o=/(?:^|\r?\n) *(@[^\r\n]*?) *\r?\n *(?![^@\r\n]*\/\/[^]*)([^@\r\n\s][^@\r\n]+?) *\r?\n/g,c=/(?:^|\r?\n) *@(\S+) *([^\r\n]*)/g,u=/(\r?\n|^) *\* ?/g,l=[];function p(n){const p=(0,t().default)(n)??e().EOL;n=n.replace(s,"").replace(r,"").replace(u,"$1");let d="";for(;d!==n;)d=n,n=n.replace(o,`${p}$1 $2${p}`);n=n.replace(a,"").trimRight();const h=Object.create(null),f=n.replace(c,"").replace(a,"").trimRight();let g;for(;g=c.exec(n);){const e=g[2].replace(i,"");"string"==typeof h[g[1]]||Array.isArray(h[g[1]])?h[g[1]]=l.concat(h[g[1]],e):h[g[1]]=e}return{comments:f,pragmas:h}}function d(e,t){return l.concat(t).map((t=>`@${e} ${t}`.trim()))}return build}function requireUtil$1(){if(hasRequiredUtil$1)return util$7;hasRequiredUtil$1=1;const{readFileSync:e}=require$$0$6,{parse:t,extract:r}=requireBuild(),{getTestSuitePath:s}=requireTest(),n=requireLog$2();function i(s){let i;try{const n=e(s.path,"utf8");i=t(r(n))}catch(e){return!1}if(!i?.datadog)return!1;try{return JSON.parse(i.datadog).unskippable}catch(e){return n.warn("@datadog block comment is malformed."),!0}}return util$7={getFormattedJestTestParameters:function(e){if(!e||!e.length)return;const[t,...r]=e;if(0===r.length)return t;const s=t[0].split("|").map((e=>e.trim())),n=[];for(let e=0;e<r.length;e++){const t=r[e],i=e%s.length;i||n.push({});const a=s[i];n[n.length-1][a]=t}return n},getJestTestName:function(e){const t=[];let r=e;do{t.unshift(r.name)}while(r=r.parent);return t.shift(),t.join(" ")},getJestSuitesToRun:function(e,t,r){const n={},a={},o=[],c=[];for(const u of t){const t=s(u.path,r),l=e.includes(t);i(u)?(c.push(u),n[t]=!0,l&&(a[t]=!0)):l?o.push(t):c.push(u)}const u=Object.keys(n).length>0,l=Object.keys(a).length>0;if(t.length){const[e]=t;e?.context?.config?.testEnvironmentOptions&&(u&&(e.context.config.testEnvironmentOptions._ddUnskippable=JSON.stringify(n)),l&&(e.context.config.testEnvironmentOptions._ddForcedToRun=JSON.stringify(a)))}return{skippedSuites:o,suitesToRun:c,hasUnskippableSuites:u,hasForcedToRunSuites:l}},isMarkedAsUnskippable:i},util$7}function requireJest(){if(hasRequiredJest)return jest$1;hasRequiredJest=1;const{addHook:e,channel:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=requireLog$2(),{getCoveredFilenamesFromCoverage:i,JEST_WORKER_TRACE_PAYLOAD_CODE:a,JEST_WORKER_COVERAGE_PAYLOAD_CODE:o,getTestLineStart:c,getTestSuitePath:u,getTestParametersString:l,EFD_STRING:p,removeEfdStringFromTestName:d}=requireTest(),{getFormattedJestTestParameters:h,getJestTestName:f,getJestSuitesToRun:g}=requireUtil$1(),{DD_MAJOR:m}=requireVersion(),_=t("ci:jest:session:start"),b=t("ci:jest:session:finish"),y=t("ci:jest:session:configuration"),v=t("ci:jest:test-suite:start"),S=t("ci:jest:test-suite:finish"),q=t("ci:jest:worker-report:trace"),E=t("ci:jest:worker-report:coverage"),R=t("ci:jest:test-suite:code-coverage"),T=t("ci:jest:test:start"),A=t("ci:jest:test:skip"),w=t("ci:jest:test:finish"),x=t("ci:jest:test:err"),I=t("ci:jest:test-suite:skippable"),C=t("ci:jest:library-configuration"),O=t("ci:jest:known-tests"),$=t("ci:jest:itr:skipped-suites");let k=[],P=[],N=!1,L=!1,M=!1,D=!1,j=0,U=!1,B=!1,G=!1,F=0;const z=new r("bound-anonymous-fn"),V={pending:"skip",disabled:"skip",todo:"skip",passed:"pass",failed:"fail"},H=new WeakMap,W=new WeakMap,K=new Map;function Y(e){let t;if(Array.isArray(e)){const[r,s]=e;null!==r&&r.stack?t=r:(t=s,t.message=r)}else t=e;return t}function J(e,t){return`${p} (#${t}): ${e}`}function X(e,t){return class extends e{constructor(e,t){super(e,t);const r=e.globalConfig?e.globalConfig.rootDir:e.rootDir;this.rootDir=r,this.testSuite=u(t.testPath,r),this.nameToParams={},this.global._ddtrace=commonjsGlobal._ddtrace,this.testEnvironmentOptions=function(e){return e.projectConfig&&e.projectConfig.testEnvironmentOptions?e.projectConfig.testEnvironmentOptions:e.testEnvironmentOptions?e.testEnvironmentOptions:{}}(e);const s=this.testEnvironmentOptions._ddRepositoryRoot;if(s&&(this.testSourceFile=u(t.testPath,s)),this.isEarlyFlakeDetectionEnabled=this.testEnvironmentOptions._ddIsEarlyFlakeDetectionEnabled,this.isEarlyFlakeDetectionEnabled){F=this.testEnvironmentOptions._ddEarlyFlakeDetectionNumRetries;try{this.knownTestsForThisSuite=this.getKnownTestsForSuite(this.testEnvironmentOptions._ddKnownTests)}catch(e){this.isEarlyFlakeDetectionEnabled=!1}}}getKnownTestsForSuite(e){let t=e;return Array.isArray(e)||(t=JSON.parse(t)),t.filter((e=>e.includes(this.testSuite))).map((e=>e.replace(`jest.${this.testSuite}.`,"").trim()))}getTestNameFromAddTestEvent(e,t){const r=f(t.currentDescribeBlock);return d(`${r} ${e.testName}`).trim()}async handleTestEvent(e,i){super.handleTestEvent&&await super.handleTestEvent(e,i);const a=(e,t)=>{this.nameToParams[e]=[...t]};if("setup"===e.name&&this.global.test&&s.wrap(this.global.test,"each",(e=>function(){const t=h(arguments),r=e.apply(this,arguments);return function(){const[e]=arguments;return a(e,t),r.apply(this,arguments)}})),"test_start"===e.name){let s=!1,n=null;const i=l(this.nameToParams,e.test.name),a=new r("bound-anonymous-fn");H.set(e.test,a);const o=f(e.test);if(this.isEarlyFlakeDetectionEnabled){const e=d(o);s=K.has(e),s&&(n=K.get(e),K.set(e,n+1))}a.runInAsyncScope((()=>{T.publish({name:d(o),suite:this.testSuite,testSourceFile:this.testSourceFile,runner:"jest-circus",testParameters:i,frameworkVersion:t,isNew:s,isEfdRetry:n>0}),W.set(e.test,e.test.fn),e.test.fn=a.bind(e.test.fn)}))}if("add_test"===e.name&&this.isEarlyFlakeDetectionEnabled){const t=this.getTestNameFromAddTestEvent(e,i),r=!this.knownTestsForThisSuite?.includes(t),s="todo"===e.mode||"skip"===e.mode;if(r&&!s&&!K.has(t)){K.set(t,0);for(let t=0;t<F;t++)this.global.test?this.global.test(J(e.testName,t),e.fn,e.timeout):n.error("Early flake detection could not retry test because global.test is undefined")}}if("test_done"===e.name){H.get(e.test).runInAsyncScope((()=>{let t="pass";if(e.test.errors&&e.test.errors.length){t="fail";const r=Y(e.test.errors[0]);x.publish(r)}w.publish({status:t,testStartLine:c(e.test.asyncError,this.testSuite)}),e.test.fn=W.get(e.test)}))}if("test_skip"===e.name||"test_todo"===e.name){new r("bound-anonymous-fn").runInAsyncScope((()=>{A.publish({name:f(e.test),suite:this.testSuite,testSourceFile:this.testSourceFile,runner:"jest-circus",frameworkVersion:t,testStartLine:c(e.test.asyncError,this.testSuite)})}))}}}}function Q(e,t){if(e.default){const r=X(e.default,t);return e.default=r,e.TestEnvironment=r,e}return X(e,t)}function Z(e){const t=e.default?e.default:e;return s.wrap(t.prototype,"_addUntestedFiles",(e=>async function(){return L?Promise.resolve():e.apply(this,arguments)})),e}function ee(e){const{configs:t}=e;if(z.runInAsyncScope((()=>{y.publish(t.map((e=>e.testEnvironmentOptions)))})),t.forEach((e=>{e.testEnvironmentOptions._ddTestCodeCoverageEnabled=N,e.testEnvironmentOptions._ddKnownTests=P})),M=!!e.globalConfig.collectCoverage,e.globalConfig.forceExit&&n.warn("Jest's '--forceExit' flag has been passed. This may cause loss of data."),N){const t={...e.globalConfig,collectCoverage:!0};e.globalConfig=t}if(L){const t={...e.globalConfig,coverageReporters:["none"],passWithNoTests:!0};e.globalConfig=t}return e}return e({name:"jest-environment-node",versions:[">=24.8.0"]},Q),e({name:"jest-environment-jsdom",versions:[">=24.8.0"]},Q),e({name:"@jest/test-sequencer",versions:[">=24.8.0"]},((e,t)=>(s.wrap(e.default.prototype,"shard",(e=>function(){const r=e.apply(this,arguments);if(!r.length)return r;const[s]=r,i=s?.context?.config?.rootDir,a=g(k,r,i||process.cwd());return n.debug((()=>`${a.suitesToRun.length} out of ${r.length} suites are going to run.`)),U=a.hasUnskippableSuites,B=a.hasForcedToRunSuites,D=a.suitesToRun.length!==r.length,j=a.skippedSuites.length,$.publish({skippedSuites:a.skippedSuites,frameworkVersion:t}),k=[],a.suitesToRun})),e))),e({name:"@jest/reporters",file:"build/coverage_reporter.js",versions:[">=24.8.0 <26.6.2"]},Z),e({name:"@jest/reporters",file:"build/CoverageReporter.js",versions:[">=26.6.2"]},Z),e({name:"@jest/core",file:"build/cli/index.js",versions:[">=24.8.0"]},(function(e,t){const r=s.wrap(e,"runCLI",(e=>async function(){let r;const s=new Promise((e=>{r=e}));if(!C.hasSubscribers)return e.apply(this,arguments);z.runInAsyncScope((()=>{C.publish({onDone:r})}));try{const{err:e,libraryConfig:t}=await s;e||(N=t.isCodeCoverageEnabled,L=t.isSuitesSkippingEnabled,G=t.isEarlyFlakeDetectionEnabled,F=t.earlyFlakeDetectionNumRetries)}catch(e){n.error(e)}if(G){const e=new Promise((e=>{r=e}));z.runInAsyncScope((()=>{O.publish({onDone:r})}));try{const{err:t,knownTests:r}=await e;t||(P=r)}catch(e){n.error(e)}}if(L){const e=new Promise((e=>{r=e}));z.runInAsyncScope((()=>{I.publish({onDone:r})}));try{const{err:t,skippableSuites:r}=await e;t||(k=r)}catch(e){n.error(e)}}const i=process.argv.slice(2).join(" ");z.runInAsyncScope((()=>{_.publish({command:`jest ${i}`,frameworkVersion:t})}));const a=await e.apply(this,arguments),{results:{success:o,coverageMap:c,numFailedTestSuites:u,numFailedTests:l,numTotalTests:p,numTotalTestSuites:d}}=a;let h,f,g,m;if(M)try{const{pct:e,total:t}=c.getCoverageSummary().lines;h=0!==t?e:0}catch(e){}o?f=0===p&&0===d?"skip":"pass":(f="fail",g=new Error(`Failed test suites: ${u}. Failed tests: ${l}`));const y=new Promise((e=>{r=()=>{clearTimeout(m),e()}})),v=new Promise((e=>{m=setTimeout((()=>{e("timeout")}),1e4).unref()}));z.runInAsyncScope((()=>{b.publish({status:f,isSuitesSkipped:D,isSuitesSkippingEnabled:L,isCodeCoverageEnabled:N,testCodeCoverageLinesTotal:h,numSkippedSuites:j,hasUnskippableSuites:U,hasForcedToRunSuites:B,error:g,isEarlyFlakeDetectionEnabled:G,onDone:r})}));return"timeout"===await Promise.race([y,v])&&n.error("Timeout waiting for the tracer to flush"),j=0,a}));return e.runCLI=r.runCLI,e})),e({name:"jest-circus",file:"build/legacy-code-todo-rewrite/jestAdapter.js",versions:[">=24.8.0"]},(function(e,t){const n=e.default?e.default:e,a=s.wrap(n,(function(){const e=arguments[2];if(!e)return n.apply(this,arguments);const s=new r("bound-anonymous-fn");return s.runInAsyncScope((()=>(v.publish({testSuite:e.testSuite,testEnvironmentOptions:e.testEnvironmentOptions,frameworkVersion:t}),n.apply(this,arguments).then((t=>{const{numFailingTests:r,skipped:n,failureMessage:a}=t;let o="pass";if(n?o="skipped":0!==r&&(o="fail"),e.testEnvironmentOptions?._ddTestCodeCoverageEnabled){const t=i(e.global.__coverage__).map((t=>u(t,e.rootDir)));s.runInAsyncScope((()=>{R.publish({coverageFiles:t,testSuite:e.testSuite})}))}return S.publish({status:o,errorMessage:a}),t})).catch((e=>{throw S.publish({status:"fail",error:e}),e})))))}));return e.default?e.default=a:e=a,e})),e({name:"@jest/transform",versions:[">=24.8.0"],file:"build/ScriptTransformer.js"},(e=>{const t=e.createScriptTransformer;return e.createScriptTransformer=async function(e){const{testEnvironmentOptions:r,...s}=e,{_ddTestModuleId:n,_ddTestSessionId:i,_ddTestCommand:a,_ddForcedToRun:o,_ddUnskippable:c,_ddItrCorrelationId:u,_ddKnownTests:l,_ddIsEarlyFlakeDetectionEnabled:p,_ddEarlyFlakeDetectionNumRetries:d,_ddRepositoryRoot:h,...f}=r;return s.testEnvironmentOptions=f,arguments[0]=s,t.apply(this,arguments)},e})),e({name:"@jest/core",versions:[">=24.8.0"],file:"build/SearchSource.js"},((e,t)=>{const r=e.default?e.default:e;return s.wrap(r.prototype,"getTestPaths",(e=>async function(){if(!k.length)return e.apply(this,arguments);const[{rootDir:r,shard:s}]=arguments;if(s&&s.shardIndex)return e.apply(this,arguments);const i=await e.apply(this,arguments),{tests:a}=i,o=g(k,a,r);return n.debug((()=>`${o.suitesToRun.length} out of ${a.length} suites are going to run.`)),U=o.hasUnskippableSuites,B=o.hasForcedToRunSuites,D=o.suitesToRun.length!==a.length,j=o.skippedSuites.length,$.publish({skippedSuites:o.skippedSuites,frameworkVersion:t}),k=[],{...i,tests:o.suitesToRun}})),e})),e({name:"jest-config",versions:[">=25.1.0"]},(function(e){return s.wrap(e,"readConfigs",(e=>async function(){const t=await e.apply(this,arguments);return ee(t),t})),e})),e({name:"jest-config",versions:["24.8.0 - 24.9.0"]},(function(e){return s.wrap(e,"readConfigs",(e=>function(){const t=e.apply(this,arguments);return ee(t),t})),e})),m<4&&e({name:"jest-jasmine2",versions:[">=24.8.0"],file:"build/jasmineAsyncInstall.js"},(function(e,t){return n.warn("jest-jasmine2 support is removed from dd-trace@v4. Consider changing to jest-circus as `testRunner`."),function(n,i){return i._ddtrace=commonjsGlobal._ddtrace,s.wrap(i.jasmine.Spec.prototype,"execute",(e=>function(s){const i=new r("bound-anonymous-fn");i.runInAsyncScope((()=>{const r=u(this.result.testPath,n.rootDir);T.publish({name:this.getFullName(),suite:r,runner:"jest-jasmine2",frameworkVersion:t});const a=this,o=i.bind((function(){if(a.result.failedExpectations&&a.result.failedExpectations.length){const e=Y(a.result.failedExpectations[0].error);x.publish(e)}w.publish({status:V[a.result.status]}),s.apply(this,arguments)}));arguments[0]=o,e.apply(this,arguments)}))})),e.default(n,i)}})),e({name:"jest-worker",versions:[">=24.9.0"],file:"build/workers/ChildProcessWorker.js"},(e=>{const t=e.default;return s.wrap(t.prototype,"_onMessage",(e=>function(){const[t,r]=arguments[0];if(t!==a){if(t!==o)return e.apply(this,arguments);z.runInAsyncScope((()=>{E.publish(r)}))}else z.runInAsyncScope((()=>{q.publish(r)}))})),e})),jest$1}var koa={},hasRequiredKoa;function requireKoa(){if(hasRequiredKoa)return koa;hasRequiredKoa=1;const e=requireDatadogShimmer(),{addHook:t,channel:r}=requireInstrument(),s=r("apm:koa:middleware:enter"),n=r("apm:koa:middleware:exit"),i=r("apm:koa:middleware:error"),a=r("apm:koa:middleware:next"),o=r("apm:koa:middleware:finish"),c=r("apm:koa:request:handle"),u=r("apm:koa:request:route"),l=new WeakMap;function p(e){return function(){const t=e.apply(this,arguments);return"function"!=typeof t?t:function(e,r){return c.publish({req:e,res:r}),t.apply(this,arguments)}}}function d(e){return function(){const t=e.apply(this,arguments);if(!Array.isArray(this.middleware))return t;const r=this.middleware.pop();return this.middleware.push(m(r)),t}}function h(e){return function(t,r,s,n){const i=e.apply(this,arguments);return!Array.isArray(t)&&i&&Array.isArray(i.stack)&&g(i),i}}function f(e){return function(){const t=e.apply(this,arguments);return t.stack.forEach(g),t}}function g(t){t.stack=t.stack.map((r=>{if("function"!=typeof r)return r;r=l.get(r)||r;const s=e.wrap(r,m(r,t));return l.set(s,r),s}))}function m(e,t){if("function"!=typeof e)return e;const r=e.name;return function(i,o){if(!i||!s.hasSubscribers)return e.apply(this,arguments);const c=i.req,u=t&&t.path,l="string"==typeof u&&!u.endsWith("(.*)")&&!u.endsWith("([^/]*)")&&u;s.publish({req:c,name:r,route:l}),"function"==typeof o&&(arguments[1]=function(e,t){return function(){return a.publish({req:e}),t.apply(this,arguments)}}(c,o));try{const t=e.apply(this,arguments);return t&&"function"==typeof t.then?t.then((e=>(_(i),e)),(e=>{throw _(i,e),e})):(_(i),t)}catch(e){throw _(i,e),e}finally{n.publish({req:c})}}}function _(e,t){const r=e.req,s=e.routePath;t&&i.publish({req:r,error:t}),s&&u.publish({req:r,route:s}),o.publish({req:r})}return t({name:"koa",versions:[">=2"]},(t=>(e.wrap(t.prototype,"callback",p),e.wrap(t.prototype,"use",d),t))),t({name:"@koa/router",versions:[">=8"]},(t=>(e.wrap(t.prototype,"register",h),e.wrap(t.prototype,"use",f),t))),t({name:"koa-router",versions:[">=7"]},(t=>(e.wrap(t.prototype,"register",h),e.wrap(t.prototype,"use",f),t))),koa}var redis={},hasRequiredRedis;function requireRedis(){if(hasRequiredRedis)return redis;hasRequiredRedis=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:redis:command:start"),i=e("apm:redis:command:finish"),a=e("apm:redis:command:error");let o;function c(e){return function(t){if(!n.hasSubscribers)return e.apply(this,arguments);const s=t[0],o=t.slice(1),c=new r("bound-anonymous-fn");return c.runInAsyncScope((()=>{p(this,s,o,this._url);const t=e.apply(this,arguments),r=c.bind((()=>h(i,a))),n=c.bind((e=>h(i,a,e)));return t.then(r,n),t}))}}function u(e){return class extends e{constructor(){if(super(arguments),o)try{const e=new URL(o);e&&(this._url={host:e.hostname,port:+e.port||6379})}catch(e){}this._url=this._url||{host:"localhost",port:6379}}}}function l(e){return function(t){o=t&&t.url;const r=e.apply(this,arguments);return o=void 0,r}}function p(e,t,r,s={}){const i=e.selected_db,a=e.connection_options||e.connection_option||e.connectionOption||s;n.publish({db:i,command:t,args:r,connectionOptions:a})}function d(e,t,r){return function(s){if(h(e,t,s),r)return r.apply(this,arguments)}}function h(e,t,r){r&&t.publish(r),e.publish()}return t({name:"@node-redis/client",file:"dist/lib/client/commands-queue.js",versions:[">=1"]},(e=>(e.default=u(e.default),s.wrap(e.default.prototype,"addCommand",c),e))),t({name:"@node-redis/client",file:"dist/lib/client/index.js",versions:[">=1"]},(e=>(s.wrap(e.default,"create",l),e))),t({name:"@redis/client",file:"dist/lib/client/index.js",versions:[">=1.1"]},(e=>(s.wrap(e.default,"create",l),e))),t({name:"@redis/client",file:"dist/lib/client/commands-queue.js",versions:[">=1.1"]},(e=>(e.default=u(e.default),s.wrap(e.default.prototype,"addCommand",c),e))),t({name:"redis",versions:[">=2.6 <4"]},(e=>(s.wrap(e.RedisClient.prototype,"internal_send_command",(e=>function(t){if(!n.hasSubscribers)return e.apply(this,arguments);if(!t.callback)return e.apply(this,arguments);const s=new r("bound-anonymous-fn"),o=new r("bound-anonymous-fn"),c=s.bind(t.callback);return o.runInAsyncScope((()=>{p(this,t.command,t.args),t.callback=o.bind(d(i,a,c));try{return e.apply(this,arguments)}catch(e){throw a.publish(e),e}}))})),e))),t({name:"redis",versions:[">=0.12 <2.6"]},(e=>(s.wrap(e.RedisClient.prototype,"send_command",(e=>function(t,s,o){if(!n.hasSubscribers)return e.apply(this,arguments);const c=new r("bound-anonymous-fn"),u=new r("bound-anonymous-fn");return u.runInAsyncScope((()=>{if(p(this,t,s),"function"==typeof o){const e=c.bind(o);arguments[2]=u.bind(d(i,a,e))}else if(Array.isArray(s)&&"function"==typeof s[s.length-1]){const e=c.bind(s[s.length-1]);s[s.length-1]=u.bind(d(i,a,e))}else arguments[2]=u.bind(d(i,a));try{return e.apply(this,arguments)}catch(e){throw a.publish(e),e}}))})),e))),redis}var opensearch={},hasRequiredOpensearch;function requireOpensearch(){if(hasRequiredOpensearch)return opensearch;hasRequiredOpensearch=1;const{addHook:e}=requireInstrument(),t=requireDatadogShimmer(),{createWrapRequest:r,createWrapGetConnection:s}=requireElasticsearch();return e({name:"@opensearch-project/opensearch",file:"lib/Transport.js",versions:[">=1"]},(e=>(t.wrap(e.prototype,"request",r("opensearch")),t.wrap(e.prototype,"getConnection",s("opensearch")),e))),opensearch}var otelSdkTrace={},hasRequiredOtelSdkTrace;function requireOtelSdkTrace(){if(hasRequiredOtelSdkTrace)return otelSdkTrace;hasRequiredOtelSdkTrace=1;const{addHook:e}=requireInstrument(),t=requireDatadogShimmer(),r=requireDdTrace();return process.env.DD_TRACE_OTEL_ENABLED&&e({name:"@opentelemetry/sdk-trace-node",file:"build/src/NodeTracerProvider.js",versions:["*"]},(e=>(t.wrap(e,"NodeTracerProvider",(()=>r.TracerProvider)),e))),otelSdkTrace}var aerospike={},hasRequiredAerospike;function requireAerospike(){if(hasRequiredAerospike)return aerospike;hasRequiredAerospike=1;const{addHook:e}=requireInstrument(),t=requireDatadogShimmer(),r=(0,requireDcPolyfill().tracingChannel)("apm:aerospike:command");function s(e){return function(...t){if("function"!=typeof t[0])return e.apply(this,t);const s={commandName:this.constructor.name,commandArgs:this.args,clientConfig:this.client.config};return r.traceCallback(e,-1,s,this,...t)}}return e({name:"aerospike",file:"lib/commands/command.js",versions:["^3.16.2","4","5"]},(e=>{return t.wrap(e,"function"!=typeof(r=e)?r:function(){const e=r.apply(this,arguments);return e?(t.wrap(e.prototype,"process",s),e):e});var r})),aerospike}var amqp10={},hasRequiredAmqp10;function requireAmqp10(){if(hasRequiredAmqp10)return amqp10;hasRequiredAmqp10=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();function n(e,t,r){r&&t.publish(r),e.publish()}return t({name:"amqp10",file:"lib/sender_link.js",versions:[">=3"]},(t=>{const i=e("apm:amqp10:send:start"),a=e("apm:amqp10:send:finish"),o=e("apm:amqp10:send:error");return s.wrap(t.prototype,"send",(e=>function(t,s){if(!i.hasSubscribers)return e.apply(this,arguments);const c=new r("bound-anonymous-fn");return c.runInAsyncScope((()=>{i.publish({link:this});try{const t=e.apply(this,arguments);return t?(t.then(c.bind((()=>n(a,o))),c.bind((e=>n(a,o,e)))),t):(n(a,o),t)}catch(e){throw n(a,o,e),e}}))})),t})),t({name:"amqp10",file:"lib/receiver_link.js",versions:[">=3"]},(t=>{const n=e("apm:amqp10:receive:start"),i=e("apm:amqp10:receive:finish"),a=e("apm:amqp10:receive:error");return s.wrap(t.prototype,"_messageReceived",(e=>function(t){if(!t||t.aborted||t.more)return e.apply(this,arguments);return new r("bound-anonymous-fn").runInAsyncScope((()=>{n.publish({link:this});try{return e.apply(this,arguments)}catch(e){throw a.publish(e),e}finally{i.publish()}}))})),t})),amqp10}var amqplib={},kebabcase,hasRequiredKebabcase,hasRequiredAmqplib;function requireKebabcase(){return hasRequiredKebabcase?kebabcase:(hasRequiredKebabcase=1,kebabcase=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.trim().replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").replace(/^-+|-+$/g,"").replace(/_/g,"-").replace(/-{2,}/g,"-").toLowerCase()})}function requireAmqplib(){if(hasRequiredAmqplib)return amqplib;hasRequiredAmqplib=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireKebabcase(),n=requireDatadogShimmer(),i=e("apm:amqplib:command:start"),a=e("apm:amqplib:command:finish"),o=e("apm:amqplib:command:error");let c={};function u(e,t,s,n,c,u){if(!i.hasSubscribers)return e.apply(t,s);return new r("bound-anonymous-fn").runInAsyncScope((()=>{i.publish({channel:t,method:n,fields:c,message:u});try{return e.apply(t,s)}catch(e){throw o.publish(e),e}finally{a.publish()}}))}return t({name:"amqplib",file:"lib/defs.js",versions:[">=0.5"]},(e=>(c=Object.keys(e).filter((t=>Number.isInteger(e[t]))).filter((e=>/([A-Z][a-z0-9]+)+/.test(e))).reduce(((t,r)=>Object.assign(t,{[e[r]]:s(r).replace("-",".")})),{}),e))),t({name:"amqplib",file:"lib/channel.js",versions:[">=0.5"]},(e=>(n.wrap(e.Channel.prototype,"sendImmediately",(e=>function(t,r){return u(e,this,arguments,c[t],r)})),n.wrap(e.Channel.prototype,"sendMessage",(e=>function(t){return u(e,this,arguments,"basic.publish",t,arguments[2])})),n.wrap(e.BaseChannel.prototype,"dispatchMessage",(e=>function(t,r){return u(e,this,arguments,"basic.deliver",t,r)})),e))),amqplib}var bluebird={},promise$1={},hasRequiredPromise$1,hasRequiredBluebird;function requirePromise$1(){if(hasRequiredPromise$1)return promise$1;hasRequiredPromise$1=1;const{AsyncResource:e}=require$$0$4;function t(e,t){return"function"!=typeof t?t:function(){return e.runInAsyncScope((()=>t.apply(this,arguments)))}}return promise$1.wrapThen=function(r){return function(s,n,i){const a=new e("bound-anonymous-fn");return arguments[0]=t(a,s),arguments[1]=t(a,n),i&&(arguments[2]=t(a,i)),r.apply(this,arguments)}},promise$1}function requireBluebird(){if(hasRequiredBluebird)return bluebird;hasRequiredBluebird=1;const{addHook:e}=requireInstrument(),{wrapThen:t}=requirePromise$1(),r=requireDatadogShimmer();function s(e){return function(e){return function(){const n=e.apply(this,arguments);return r.wrap(n.prototype,"_then",t),r.wrap(n,"getNewLibraryCopy",s()),n}}}return e({name:"bluebird",versions:[">=2.0.2"]},(e=>(r.wrap(e.prototype,"_then",t),e))),e({name:"bluebird",versions:["^2.11.0","^3.4.1"]},(e=>(r.wrap(e,"getNewLibraryCopy",s()),e))),bluebird}var bodyParser={},hasRequiredBodyParser;function requireBodyParser(){if(hasRequiredBodyParser)return bodyParser;hasRequiredBodyParser=1;const{AbortController:e}=requireNodeAbortController(),t=requireDatadogShimmer(),{channel:r,addHook:s}=requireInstrument(),n=r("datadog:body-parser:read:finish");return s({name:"body-parser",file:"lib/read.js",versions:[">=1.4.0"]},(r=>t.wrap(r,(function(t,s,i){return arguments[2]=function(t,r,s){return function(){if(n.hasSubscribers&&t){const s=new e,i=t.body;if(n.publish({req:t,res:r,body:i,abortController:s}),s.signal.aborted)return}return s.apply(this,arguments)}}(t,s,i),r.apply(this,arguments)})))),bodyParser}var bunyan={},hasRequiredBunyan;function requireBunyan(){if(hasRequiredBunyan)return bunyan;hasRequiredBunyan=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer();return t({name:"bunyan",versions:[">=1"]},(t=>{const s=e("apm:bunyan:log");return r.wrap(t.prototype,"_emit",(e=>function(t){if(s.hasSubscribers){const e={message:t};s.publish(e),arguments[0]=e.message}return e.apply(this,arguments)})),t})),bunyan}var cassandraDriver={},hasRequiredCassandraDriver;function requireCassandraDriver(){if(hasRequiredCassandraDriver)return cassandraDriver;hasRequiredCassandraDriver=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:cassandra-driver:query:start"),i=e("apm:cassandra-driver:query:finish"),a=e("apm:cassandra-driver:query:error"),o=e("apm:cassandra-driver:query:connect");function c(e,t,r){r&&t.publish(r),e.publish(void 0)}function u(e,t,r,s){return r.bind((function(r){if(c(e,t,r),s)return s.apply(this,arguments)}))}function l(e,t,r){return!!e&&(t.length===r&&"function"==typeof t[r-1])}return t({name:"cassandra-driver",versions:[">=3.0.0"]},(e=>(s.wrap(e.Client.prototype,"batch",(e=>function(t,s,o){if(!n.hasSubscribers)return e.apply(this,arguments);const l=new r("bound-anonymous-fn"),p=new r("bound-anonymous-fn"),d=arguments.length-1;let h=arguments[d];return"function"==typeof h&&(h=l.bind(h),arguments[d]=u(i,a,p,h)),p.runInAsyncScope((()=>{const s=this.options&&this.options.contactPoints;n.publish({keyspace:this.keyspace,query:t,contactPoints:s});try{const t=e.apply(this,arguments);if("function"!=typeof t&&t){const e=new r("bound-anonymous-fn");return t.then(e.bind((()=>c(i,a))),e.bind((e=>c(i,a,e))))}return u(i,a,p,t)}catch(e){throw c(i,a,e),e}}))})),e))),t({name:"cassandra-driver",versions:[">=4.4"]},(e=>(s.wrap(e.Client.prototype,"_execute",(e=>function(t,s,o,u){if(!n.hasSubscribers)return e.apply(this,arguments);return new r("bound-anonymous-fn").runInAsyncScope((()=>{const s=this.options&&this.options.contactPoints;n.publish({keyspace:this.keyspace,query:t,contactPoints:s});const o=e.apply(this,arguments),u=new r("bound-anonymous-fn");return o.then(u.bind((()=>c(i,a))),u.bind((e=>c(i,a,e)))),o}))})),e))),t({name:"cassandra-driver",versions:["3 - 4.3"]},(e=>(s.wrap(e.Client.prototype,"_innerExecute",(e=>function(t,s,o,l){if(!n.hasSubscribers)return e.apply(this,arguments);const p=new r("bound-anonymous-fn"),d=new r("bound-anonymous-fn");return 4!==(h=arguments).length&&"function"!=typeof h[3]?e.apply(this,arguments):d.runInAsyncScope((()=>{const r=this.options&&this.options.contactPoints;n.publish({keyspace:this.keyspace,query:t,contactPoints:r});const s=arguments.length-1;let o=arguments[s];"function"==typeof o&&(o=p.bind(o),arguments[s]=u(i,a,d,o));try{return e.apply(this,arguments)}catch(e){throw c(i,a,e),e}}));var h})),e))),t({name:"cassandra-driver",versions:[">=3.3"],file:"lib/request-execution.js"},(e=>(s.wrap(e.prototype,"_sendOnConnection",(e=>function(){return n.hasSubscribers?(o.publish({hostname:this._connection.address,port:this._connection.port}),e.apply(this,arguments)):e.apply(this,arguments)})),e))),t({name:"cassandra-driver",versions:["3.3 - 4.3"],file:"lib/request-execution.js"},(e=>(s.wrap(e.prototype,"start",(e=>function(t){if(!n.hasSubscribers)return t.apply(this,arguments);const s=new r("bound-anonymous-fn"),i=this;return l(this,arguments,1)?(t=s.bind(t),arguments[0]=r.bind((function(){return o.publish({hostname:i._connection.address,port:i._connection.port}),t.apply(this,arguments)})),e.apply(this,arguments)):e.apply(this,arguments)})),e))),t({name:"cassandra-driver",versions:["3 - 3.2"],file:"lib/request-handler.js"},(e=>(s.wrap(e.prototype,"send",(e=>function(t,s,i){if(!n.hasSubscribers)return e.apply(this,arguments);const a=this;if(!l(this,arguments,3))return e.apply(this,arguments);const c=new r("bound-anonymous-fn");return i=c.bind(i),arguments[2]=r.bind((function(){return o.publish({hostname:a.connection.address,port:a.connection.port}),i.apply(this,arguments)})),e.apply(this,arguments)})),e))),cassandraDriver}var child_process={},hasRequiredChild_process;function requireChild_process(){if(hasRequiredChild_process)return child_process;hasRequiredChild_process=1;const e=require$$0$3,{addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=requireDcPolyfill().tracingChannel("datadog:child_process:execution"),i=["execFile","spawn"],a=["execFileSync","spawnSync"];let o=!1;function c(e,t){const r={command:e[0]};return Array.isArray(e[1])?(r.command=r.command+" "+e[1].join(" "),null!=e[2]&&"object"==typeof e[2]&&(r.options=e[2])):null!=e[1]&&"object"==typeof e[1]&&(r.options=e[1]),r.shell=t||!0===r.options?.shell||"string"==typeof r.options?.shell,r}function u(e=!1){return function(t){return function(){if(!n.start.hasSubscribers||0===arguments.length)return t.apply(this,arguments);const r=c(arguments,e);return n.traceSync(t,{command:r.command,shell:r.shell},this,...arguments)}}}return["child_process","node:child_process"].forEach((l=>{t({name:l},(t=>(o||(o=!0,s.massWrap(t,i,function(t=!1){return function(i){function a(){if(!n.start.hasSubscribers||0===arguments.length)return i.apply(this,arguments);const e=c(arguments,t);return new r("bound-anonymous-fn").runInAsyncScope((()=>{n.start.publish({command:e.command,shell:e.shell});const t=i.apply(this,arguments);if(t){let r=!1;t.on("error",(e=>{r=!0,n.error.publish(e)})),t.on("close",(t=>{t=t||0,r||0===t||n.error.publish(),n.asyncEnd.publish({command:e.command,shell:e.shell,result:t})}))}return t}))}if(i[e.promisify.custom]){const r=s.wrap(i[e.promisify.custom],function(e,t){return function(){if(!n.start.hasSubscribers||0===arguments.length)return e.apply(this,arguments);const r=c(arguments,t);return n.tracePromise(e,{command:r.command,shell:r.shell},this,...arguments)}}(i[e.promisify.custom]),t),o=Object.getOwnPropertyDescriptor(i,e.promisify.custom);Object.defineProperty(a,e.promisify.custom,{...o,value:r})}return a}}()),s.massWrap(t,a,u()),s.wrap(t,"execSync",u(!0))),t)))})),child_process}var connect={},hasRequiredConnect;function requireConnect(){if(hasRequiredConnect)return connect;hasRequiredConnect=1;const e=requireDatadogShimmer(),{addHook:t,channel:r}=requireInstrument(),s=r("apm:connect:middleware:enter"),n=r("apm:connect:middleware:exit"),i=r("apm:connect:middleware:error"),a=r("apm:connect:middleware:next"),o=r("apm:connect:middleware:finish"),c=r("apm:connect:request:handle");function u(t){return"function"!=typeof t?t:function(r,c){const u=t.apply(this,arguments);if(!this||!Array.isArray(this.stack))return u;const l=this.stack.length-1,p=this.stack[l];return p&&p.handle&&(this.stack[l].handle=function(t){if("function"!=typeof t.handle)return t.handle;const r=t.handle;return e.wrap(r,(function(){if(!s.hasSubscribers)return r.apply(this,arguments);const e=arguments.length-1,c=r._name||r.name,u=arguments[arguments.length>3?1:0],l=arguments[e];"function"==typeof l&&(arguments[e]=function(e,t){return function(r){r&&i.publish({req:e,error:r}),a.publish({req:e}),o.publish({req:e}),t.apply(this,arguments)}}(u,l));const p=t.route;s.publish({name:c,req:u,route:p});try{return r.apply(this,arguments)}catch(e){throw i.publish({req:u,error:e}),a.publish({req:u}),o.publish({req:u}),e}finally{n.publish({req:u})}}))}(p)),u}}function l(e){return function(t,r){return c.hasSubscribers&&c.publish({req:t,res:r}),e.apply(this,arguments)}}return t({name:"connect",versions:[">=3"]},(t=>e.wrap(t,function(t){return"function"!=typeof t?t:function(){const r=t();return r?(e.wrap(r,"use",u),e.wrap(r,"handle",l),r):r}}(t)))),t({name:"connect",versions:["2.2.2"]},(t=>(e.wrap(t.proto,"use",u),e.wrap(t.proto,"handle",l),t))),connect}var cookie={},hasRequiredCookie;function requireCookie(){if(hasRequiredCookie)return cookie;hasRequiredCookie=1;const e=requireDatadogShimmer(),{channel:t,addHook:r}=requireInstrument(),s=t("datadog:cookie:parse:finish");function n(e){return function(){const t=e.apply(this,arguments);return s.hasSubscribers&&t&&s.publish({cookies:t}),t}}return r({name:"cookie",versions:[">=0.4"]},(t=>(e.wrap(t,"parse",n),t))),cookie}var cookieParser={},hasRequiredCookieParser;function requireCookieParser(){if(hasRequiredCookieParser)return cookieParser;hasRequiredCookieParser=1;const{AbortController:e}=requireNodeAbortController(),t=requireDatadogShimmer(),{channel:r,addHook:s}=requireInstrument(),n=r("datadog:cookie-parser:read:finish");return s({name:"cookie-parser",versions:[">=1.0.0"]},(r=>t.wrap(r,(function(){const s=r.apply(this,arguments);return t.wrap(s,(function(t,r,i){return arguments[2]=function(t,r,s){return function(){if(n.hasSubscribers&&t){const s=new e,i=Object.assign({},t.cookies,t.signedCookies);if(n.publish({req:t,res:r,abortController:s,cookies:i}),s.signal.aborted)return}return s.apply(this,arguments)}}(t,r,i),s.apply(this,arguments)}))})))),cookieParser}var couchbase={},hasRequiredCouchbase;function requireCouchbase(){if(hasRequiredCouchbase)return couchbase;hasRequiredCouchbase=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();function n(e,t=2){for(let r=e.length-1;r>=t;r--)if("function"==typeof e[r])return r;return-1}function i(e){return e&&("string"==typeof e?e:e.statement)}function a(e,t){e.forEach((e=>t(e)))}function o(e){return s.wrap(e,(function(t,s){if(!Array.isArray(s))return e.apply(this,arguments);const n=s.length-1,i=s[n];return i instanceof Function&&(s[n]=r.bind(i)),e.apply(this,arguments)}))}function c(e){return s.wrap(e,(function(t,s,n){"function"==typeof(n=r.bind(arguments[arguments.length-1]))&&(arguments[arguments.length-1]=n);return e.apply(this,arguments)}))}function u(t,s,i,a,o){const c=e(`apm:couchbase:${s}:start`),u=e(`apm:couchbase:${s}:finish`),l=e(`apm:couchbase:${s}:error`);if(!c.hasSubscribers)return t.apply(a,o);const p=new r("bound-anonymous-fn"),d=new r("bound-anonymous-fn");return p.runInAsyncScope((()=>{c.publish(i);try{const e=n(o,1);if(e>=0){const t=d.bind(o[e]);o[e]=p.bind((function(e,r){return e&&l.publish(e),u.publish({result:r}),t.apply(a,arguments)}))}const r=t.apply(a,o);return r.then(p.bind((e=>u.publish({result:e}))),p.bind((e=>l.publish(e)))),r}catch(e){throw e.stack,l.publish(e),e}}))}function l(e){return function(t){return function(){return u(t,e,{collection:{name:this._name||"_default"},bucket:{name:this._scope._bucket._name},seedNodes:this._dd_connStr},this,arguments)}}}function p(e){return function(t){const r=i(t);return u(e,"query",{resource:r,seedNodes:this._connStr},this,arguments)}}return t({name:"couchbase",file:"lib/bucket.js",versions:["^2.6.12"]},(t=>{const u=e("apm:couchbase:query:start"),l=e("apm:couchbase:query:finish"),p=e("apm:couchbase:query:error");return t.prototype._maybeInvoke=o(t.prototype._maybeInvoke),t.prototype.query=c(t.prototype.query),s.wrap(t.prototype,"_n1qlReq",(e=>function(t,s,n,a){if(!u.hasSubscribers)return e.apply(this,arguments);if(!a||!a.once)return e.apply(this,arguments);const o=i(s),c=new r("bound-anonymous-fn");return c.runInAsyncScope((()=>{u.publish({resource:o,bucket:{name:this.name||this._name},seedNodes:this._dd_hosts}),a.once("rows",c.bind((()=>{l.publish(void 0)}))),a.once("error",c.bind((e=>{p.publish(e),l.publish(void 0)})));try{return e.apply(this,arguments)}catch(e){throw e.stack,p.publish(e),e}}))})),a(["upsert","insert","replace","append","prepend"],(i=>{t.prototype[i]=function(t,i){const a=e(t+":start"),o=e(t+":finish"),c=e(t+":error");return s.wrap(i,(function(){if(!a.hasSubscribers)return i.apply(this,arguments);const e=n(arguments);if(e<0)return i.apply(this,arguments);const t=new r("bound-anonymous-fn"),s=new r("bound-anonymous-fn");return s.runInAsyncScope((()=>{const r=t.bind(arguments[e]);a.publish({bucket:{name:this.name||this._name},seedNodes:this._dd_hosts}),arguments[e]=s.bind((function(e,t){return e&&c.publish(e),o.publish(t),r.apply(this,arguments)}));try{return i.apply(this,arguments)}catch(e){throw e.stack,c.publish(e),e}}))}))}(`apm:couchbase:${i}`,t.prototype[i])})),t})),t({name:"couchbase",file:"lib/cluster.js",versions:["^2.6.12"]},(e=>(e.prototype._maybeInvoke=o(e.prototype._maybeInvoke),e.prototype.query=c(e.prototype.query),s.wrap(e.prototype,"openBucket",(e=>function(){const t=e.apply(this,arguments),r=this.dsnObj.hosts;return t._dd_hosts=r.map((e=>e.join(":"))).join(","),t})),e))),t({name:"couchbase",file:"lib/bucket.js",versions:["^3.0.7","^3.1.3"]},(e=>(s.wrap(e.prototype,"collection",(e=>function(){const t=e.apply(this,arguments),r=this._cluster._connStr;return t._dd_connStr=r,t})),e))),t({name:"couchbase",file:"lib/collection.js",versions:["^3.0.7","^3.1.3"]},(e=>(a(["upsert","insert","replace"],(t=>{s.wrap(e.prototype,t,l(t))})),e))),t({name:"couchbase",file:"lib/cluster.js",versions:["^3.0.7","^3.1.3"]},(e=>(s.wrap(e.prototype,"query",p),e))),t({name:"couchbase",file:"dist/collection.js",versions:[">=3.2.2"]},(e=>{const t=e.Collection;return a(["upsert","insert","replace"],(e=>{s.wrap(t.prototype,e,l(e))})),e})),t({name:"couchbase",file:"dist/bucket.js",versions:[">=3.2.2"]},(e=>{const t=e.Bucket;return s.wrap(t.prototype,"collection",(e=>function(){const t=e.apply(this,arguments),r=this._cluster._connStr;return t._dd_connStr=r,t})),e})),t({name:"couchbase",file:"dist/cluster.js",versions:[">=3.2.2"]},(e=>{const t=e.Cluster;return s.wrap(t.prototype,"query",p),e})),couchbase}var crypto={},hasRequiredCrypto;function requireCrypto(){if(hasRequiredCrypto)return crypto;hasRequiredCrypto=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer(),s=e("datadog:crypto:hashing:start"),n=e("datadog:crypto:cipher:start"),i=["createHash","createHmac","createSign","createVerify","sign","verify"],a=["createCipheriv","createDecipheriv"];function o(e){return function(t){return function(){if(e.hasSubscribers&&arguments.length>0){const t=arguments[0];e.publish({algorithm:t})}return t.apply(this,arguments)}}}return t({name:["crypto","node:crypto"]},(e=>(r.massWrap(e,i,o(s)),r.massWrap(e,a,o(n)),e))),crypto}var cypress={},hasRequiredCypress;function requireCypress(){if(hasRequiredCypress)return cypress;hasRequiredCypress=1;const{addHook:e}=requireInstrument();return e({name:"cypress",versions:[">=6.7.0"]},(e=>e)),cypress}var dns={},hasRequiredDns;function requireDns(){if(hasRequiredDns)return dns;hasRequiredDns=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n={resolveAny:"ANY",resolve4:"A",resolve6:"AAAA",resolveCname:"CNAME",resolveMx:"MX",resolveNs:"NS",resolveTxt:"TXT",resolveSrv:"SRV",resolvePtr:"PTR",resolveNaptr:"NAPTR",resolveSoa:"SOA"},i=new WeakMap;function a(e){Object.keys(n).filter((t=>!!e[t])).forEach((t=>{i.set(e[t],n[t]),e[t]=o("apm:dns:resolve",e[t],2,n[t])}))}function o(t,n,i,a){const o=e(t+":start"),c=e(t+":finish"),u=e(t+":error");return s.wrap(n,(function(){const e=r.bind(arguments[arguments.length-1]);if(!o.hasSubscribers||arguments.length<i||"function"!=typeof e)return n.apply(this,arguments);const t=Array.from(arguments);t.pop(),a&&t.push(a);const s=new r("bound-anonymous-fn");return s.runInAsyncScope((()=>{o.publish(t),arguments[arguments.length-1]=s.bind((function(t,r){t&&u.publish(t),c.publish(r),e.apply(this,arguments)}));try{return n.apply(this,arguments)}catch(e){throw e.stack,u.publish(e),e}}))}))}return t({name:["dns","node:dns"]},(e=>(e.lookup=o("apm:dns:lookup",e.lookup,2),e.lookupService=o("apm:dns:lookup_service",e.lookupService,3),e.resolve=o("apm:dns:resolve",e.resolve,2),e.reverse=o("apm:dns:reverse",e.reverse,2),a(e),e.Resolver&&(e.Resolver.prototype.resolve=o("apm:dns:resolve",e.Resolver.prototype.resolve,2),e.Resolver.prototype.reverse=o("apm:dns:reverse",e.Resolver.prototype.reverse,2),a(e.Resolver.prototype)),e))),dns}var express={},methods,hasRequiredMethods,pathToRegexp,hasRequiredPathToRegexp,router,hasRequiredRouter,hasRequiredExpress;
/*!
 * methods
 * Copyright(c) 2013-2014 TJ Holowaychuk
 * Copyright(c) 2015-2016 Douglas Christopher Wilson
 * MIT Licensed
 */function requireMethods(){if(hasRequiredMethods)return methods;hasRequiredMethods=1;var e=require$$1$1;return methods=e.METHODS&&e.METHODS.map((function(e){return e.toLowerCase()}))||["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","purge","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch","search","connect"]}function requirePathToRegexp(){if(hasRequiredPathToRegexp)return pathToRegexp;hasRequiredPathToRegexp=1,pathToRegexp=function t(r,s,n){s=s||[];var i,a=(n=n||{}).strict,o=!1!==n.end,c=n.sensitive?"":"i",u=0,l=s.length,p=0,d=0;if(r instanceof RegExp){for(;i=e.exec(r.source);)s.push({name:d++,optional:!1,offset:i.index});return r}if(Array.isArray(r))return r=r.map((function(e){return t(e,s,n).source})),new RegExp("(?:"+r.join("|")+")",c);r=("^"+r+(a?"":"/"===r[r.length-1]?"?":"/?")).replace(/\/\(/g,"/(?:").replace(/([\/\.])/g,"\\$1").replace(/(\\\/)?(\\\.)?:(\w+)(\(.*?\))?(\*)?(\?)?/g,(function(e,t,r,n,i,a,o,c){t=t||"",r=r||"",i=i||"([^\\/"+r+"]+?)",o=o||"",s.push({name:n,optional:!!o,offset:c+u});var l=(o?"":t)+"(?:"+r+(o?t:"")+i+(a?"((?:[\\/"+r+"].+?)?)":"")+")"+o;return u+=l.length-e.length,l})).replace(/\*/g,(function(e,t){for(var r=s.length;r-- >l&&s[r].offset>t;)s[r].offset+=3;return"(.*)"}));for(;i=e.exec(r);){for(var h=0,f=i.index;"\\"===r.charAt(--f);)h++;h%2!=1&&((l+p===s.length||s[l+p].offset>i.index)&&s.splice(l+p,0,{name:d++,optional:!1,offset:i.index}),p++)}return r+=o?"$":"/"===r[r.length-1]?"":"(?=\\/|$)",new RegExp(r,c)};var e=/\((?!\?)/g;return pathToRegexp}function requireRouter(){if(hasRequiredRouter)return router;hasRequiredRouter=1;const e=requireMethods().concat("all"),t=requirePathToRegexp(),r=requireDatadogShimmer(),{addHook:s,channel:n}=requireInstrument();function i(s){const i=n(`apm:${s}:middleware:enter`),a=n(`apm:${s}:middleware:exit`),o=n(`apm:${s}:middleware:finish`),c=n(`apm:${s}:middleware:error`),u=n(`apm:${s}:middleware:next`),l=new WeakMap,p=Object.create(null);function d(e,t){t._name=t._name||e.name;const s=r.wrap(t,(function(){if(!i.hasSubscribers)return t.apply(this,arguments);const r=l.get(e),s=arguments.length-1,n=t._name||t.name,p=arguments[arguments.length>3?1:0],d=arguments[s];let h;if("function"==typeof d&&(arguments[s]=function(e,t){return function(r){r&&"route"!==r&&"router"!==r&&c.publish({req:e,error:r}),u.publish({req:e}),o.publish({req:e}),t.apply(this,arguments)}}(p,d)),r)for(let t=0;t<r.length;t++)if(r[t].test(e)){h=r[t].path;break}i.publish({name:n,req:p,route:h});try{return t.apply(this,arguments)}catch(e){throw c.publish({req:p,error:e}),u.publish({req:p}),o.publish({req:p}),e}finally{a.publish({req:p})}}));return s._datadog_orig=t,s}function h(e){const r=f([].concat(e));return"function"==typeof r[0]?[]:r.map((e=>({path:e instanceof RegExp?`(${e})`:e,test:r=>{const s=l.get(r);return!function(e,t){if(void 0!==e.regexp.fast_star)return e.regexp.fast_star;return t.some((e=>"*"===e.path))}(r,s)&&!function(e,t){if(void 0!==e.regexp.fast_slash)return e.regexp.fast_slash;return t.some((e=>"/"===e.path))}(r,s)&&function(e){const r=p[e];if(r)return r;const s=t(e);return p[e]=s,s}(e).test(r.path)}})))}function f(e){return e.reduce(((e,t)=>Array.isArray(t)?e.concat(f(t)):e.concat(t)),[])}function g(t){return function(r){const s=this.stack?[].concat(this.stack).length:0,n=t.apply(this,arguments);return"function"==typeof this.stack&&(this.stack=[{handle:this.stack}]),function(t,r,s){[].concat(t).slice(r).forEach((t=>{t.__handle?t.__handle=d(t,t.__handle):t.handle=d(t,t.handle),l.set(t,s),t.route&&e.forEach((e=>{"function"==typeof t.route.stack&&(t.route.stack=[{handle:t.route.stack}]),t.route[e]=g(t.route[e])}))}))}(this.stack,s,h(r)),n}}return g}const a=i("router");return s({name:"router",versions:[">=1"]},(e=>(r.wrap(e.prototype,"use",a),r.wrap(e.prototype,"route",a),e))),router={createWrapRouterMethod:i}}function requireExpress(){if(hasRequiredExpress)return express;hasRequiredExpress=1;const{createWrapRouterMethod:e}=requireRouter(),t=requireDatadogShimmer(),{addHook:r,channel:s}=requireInstrument(),{AbortController:n}=requireNodeAbortController(),i=s("apm:express:request:handle");function a(e){return function(t,r){return i.hasSubscribers&&i.publish({req:t}),e.apply(this,arguments)}}const o=e("express"),c=s("datadog:express:response:json:start");function u(e){return function(t){return c.hasSubscribers&&(2===arguments.length&&"number"!=typeof arguments[1]&&(t=arguments[1]),c.publish({req:this.req,body:t})),e.apply(this,arguments)}}r({name:"express",versions:[">=4"]},(e=>(t.wrap(e.application,"handle",a),t.wrap(e.Router,"use",o),t.wrap(e.Router,"route",o),t.wrap(e.response,"json",u),t.wrap(e.response,"jsonp",u),e)));const l=s("datadog:query:read:finish");r({name:"express",versions:[">=4"],file:"lib/middleware/query.js"},(e=>t.wrap(e,(function(){const r=e.apply(this,arguments);return t.wrap(r,(function(e,t,s){return arguments[2]=function(e,t,r){return function(){if(l.hasSubscribers&&e){const r=new n,s=e.query;if(l.publish({req:e,res:t,query:s,abortController:r}),r.signal.aborted)return}return r.apply(this,arguments)}}(e,t,s),r.apply(this,arguments)}))}))));const p=s("datadog:express:process_params:start"),d=e=>t=>function(){return p.hasSubscribers&&p.publish({req:arguments[e]}),t.apply(this,arguments)};return r({name:"express",versions:[">=4.0.0 <4.3.0"]},(e=>(t.wrap(e.Router,"process_params",d(1)),e))),r({name:"express",versions:[">=4.3.0"]},(e=>(t.wrap(e.Router,"process_params",d(2)),e))),express}var expressMongoSanitize={},hasRequiredExpressMongoSanitize;function requireExpressMongoSanitize(){if(hasRequiredExpressMongoSanitize)return expressMongoSanitize;hasRequiredExpressMongoSanitize=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer(),s=e("datadog:express-mongo-sanitize:sanitize:finish"),n=e("datadog:express-mongo-sanitize:filter:finish"),i=["body","params","headers","query"];return t({name:"express-mongo-sanitize",versions:[">=1.0.0"]},(e=>(r.wrap(e,"sanitize",(e=>function(){const t=e.apply(this,arguments);return s.hasSubscribers&&s.publish({sanitizedObject:t}),t})),r.wrap(e,(function(){const t=e.apply(this,arguments);return r.wrap(t,(function(e,s,a){if(!n.hasSubscribers)return t.apply(this,arguments);const o=r.wrap(a,(function(){return n.publish({sanitizedProperties:i,req:e}),a.apply(this,arguments)}));return t.call(this,e,s,o)}))}))))),expressMongoSanitize}var fastify={},hasRequiredFastify;function requireFastify(){if(hasRequiredFastify)return fastify;hasRequiredFastify=1;const e=requireDatadogShimmer(),{addHook:t,channel:r,AsyncResource:s}=requireInstrument(),n=r("apm:fastify:middleware:error"),i=r("apm:fastify:request:handle"),a=new WeakMap;function o(t,r){return"function"!=typeof t?t:function(){const n=t.apply(this,arguments);return n&&"function"==typeof n.addHook?(n.addHook("onRequest",c),n.addHook("preHandler",u),r?(n.addHook("preParsing",p),n.addHook("preValidation",l)):(n.addHook("onRequest",p),n.addHook("preHandler",l)),n.addHook=function(t){return function(r,n){return"function"!=typeof(n=arguments[arguments.length-1])||(arguments[arguments.length-1]=e.wrap(n,(function(e,t,i){const o=d(e);try{if("function"==typeof i)return i=arguments[arguments.length-1],arguments[arguments.length-1]=function(e){if(h(e,o),"onRequest"===r||"preParsing"===r){const e=new s("bound-anonymous-fn");return a.set(o,e),e.runInAsyncScope((()=>i.apply(this,arguments)))}return i.apply(this,arguments)},n.apply(this,arguments);{const e=n.apply(this,arguments);return e&&"function"==typeof e.catch?e.catch((e=>h(e,o))):e}}catch(e){throw h(e,o)}}))),t.apply(this,arguments)}}(n.addHook),n):n}}function c(e,t,r){if("function"!=typeof r)return;const s=d(e),n=function(e){return e&&(e.raw||e.res||e)}(t);return i.publish({req:s,res:n}),r()}function u(e,t,r){if("function"!=typeof r)return;if(!t||"function"!=typeof t.send)return r();const s=d(e);t.send=function(e,t){return function(r){return r instanceof Error&&n.publish({req:t,error:r}),e.apply(this,arguments)}}(t.send,s),r()}function l(e,t,r){const s=d(e),n=a.get(s);if(!n)return r();n.runInAsyncScope((()=>r()))}function p(e,t,r,n){"function"!=typeof n&&(n=r);const i=d(e),o=new s("bound-anonymous-fn");a.set(i,o),o.runInAsyncScope((()=>n()))}function d(e){return e&&(e.raw||e.req||e)}function h(e,t){return e&&n.publish({error:e,req:t}),e}return t({name:"fastify",versions:[">=3"]},(t=>{const r=e.wrap(t,o(t,!0));return r.fastify=r,r.default=r,r})),t({name:"fastify",versions:["2"]},(t=>e.wrap(t,o(t,!0)))),t({name:"fastify",versions:["1"]},(t=>e.wrap(t,o(t,!1)))),fastify}var findMyWay={},hasRequiredFindMyWay;function requireFindMyWay(){if(hasRequiredFindMyWay)return findMyWay;hasRequiredFindMyWay=1;const e=requireDatadogShimmer(),{addHook:t,channel:r}=requireInstrument(),s=r("apm:find-my-way:request:route");function n(e){return function(t,r,n){const i="function"==typeof n?2:3,a=arguments[i],o=function(e){return s.publish({req:e,route:r}),a.apply(this,arguments)};return"function"==typeof a&&(arguments[i]=o),e.apply(this,arguments)}}return t({name:"find-my-way",versions:[">=1"]},(t=>(e.wrap(t.prototype,"on",n),t))),findMyWay}var fs$3={},hasRequiredFs;function requireFs(){if(hasRequiredFs)return fs$3;hasRequiredFs=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:fs:operation:start"),i=e("apm:fs:operation:finish"),a=e("apm:fs:operation:error"),o=Symbol("ddFileHandle");let c,u,l;const p={access:["path","mode"],appendFile:["path","data","options"],chmod:["path","mode"],chown:["path","uid","gid"],close:["fd"],copyFile:["src","dest","mode"],cp:["src","dest","options"],exists:["path"],fchmod:["fd","mode"],fchown:["fd","uid","gid"],fdatasync:["fd"],fstat:["fd","options"],fsync:["fd"],ftruncate:["fd","len"],futimes:["fd","atime","mtime"],lchmod:["path","mode"],lchown:["path","uid","gid"],link:["existingPath","newPath"],lstat:["path","options"],lutimes:["path","atime","mtime"],mkdir:["path","options"],mkdtemp:["prefix","options"],open:["path","flag","mode"],opendir:["path","options"],read:["fd"],readdir:["path","options"],readFile:["path","options"],readlink:["path","options"],readv:["fd"],realpath:["path","options"],rename:["oldPath","newPath"],rmdir:["path","options"],rm:["path","options"],stat:["path","options"],symlink:["target","path","type"],truncate:["path","len"],unlink:["path"],utimes:["path","atime","mtime"],write:["fd"],writeFile:["file","data","options"],writev:["fd"]},d={unwatchFile:["path","listener"],watch:["path","options","listener"],watchFile:["path","options","listener"]},h={appendFile:["data","options"],chmod:["mode"],chown:["uid","gid"],close:[],createReadStream:["options"],createWriteStream:["options"],datasync:[],read:["buffer","offset","length","position"],readableWebStream:[],readFile:["options"],readLines:["options"],readv:["buffers","position"],stat:["options"],sync:[],truncate:["len"],utimes:["atime","mtime"],write:["buffer","offset","length","position"],writeFile:["data","options"],writev:["buffers","position"]};function f(e){const t=function(e){c||(c=Reflect.ownKeys(e).find((e=>"symbol"==typeof e&&e.toString().includes("kHandle"))));return Object.getPrototypeOf(e)}(e),r=Reflect.getOwnPropertyDescriptor(t,c);r&&r.get||Reflect.defineProperty(t,c,{get(){return this[o]},set(e){this[o]=e,S(this,"close",b("filehandle."))},configurable:!0});for(const e of Reflect.ownKeys(t))"string"==typeof e&&"constructor"!==e&&"fd"!==e&&"getAsyncId"!==e&&S(t,e,b("filehandle."))}function g(e){return e.description||e.toString()}function m(e){const t={createReadStream:"ReadStream",createWriteStream:"WriteStream"}[e.name];return function(s,o){if(!n.hasSubscribers)return e.apply(this,arguments);const c=new r("bound-anonymous-fn"),u=y(t,["path","options"],arguments);return c.runInAsyncScope((()=>{n.publish(u);try{const t=e.apply(this,arguments),r=c.bind((e=>{a.publish(e),s()})),s=c.bind((()=>{i.publish(),t.off("close",s),t.off("end",s),t.off("finish",s),t.off("error",r)}));return t.once("close",s),t.once("end",s),t.once("finish",s),t.once("error",r),t}catch(e){a.publish(e),i.publish()}}))}}function _(e=""){return function(t){const s=e||t.name,o=s,c=s;return function(){if(!n.hasSubscribers)return t.apply(this,arguments);const e=y(o,d[c],arguments,this);return new r("bound-anonymous-fn").runInAsyncScope((()=>{n.publish(e);try{const e=t.apply(this,arguments);return i.publish(),e}catch(e){throw a.publish(e),i.publish(),e}}))}}}function b(e="",t=""){return function(s){const o=t||s.name,u=`${e}${o}`,l=o.match(/^(.+?)(Sync)?(\.native)?$/)[1];return function(){if(!n.hasSubscribers)return s.apply(this,arguments);const t=arguments.length-1,o="function"==typeof arguments[t]&&arguments[t],d=new r("bound-anonymous-fn"),g=y(u,function(e){return"filehandle."===e?h:p}(e)[l],arguments,this);if(o){const e=new r("bound-anonymous-fn");arguments[t]=d.bind((function(t){return"object"==typeof t&&a.publish(t),i.publish(),e.runInAsyncScope((()=>o.apply(this,arguments)))}))}return d.runInAsyncScope((()=>{n.publish(g);try{const e=s.apply(this,arguments);return o?e:e&&"function"==typeof e.then?e.then((e=>(function(e){return!c&&"open"===e.name}(s)&&f(e),i.publish(),e)),(e=>{throw a.publish(e),i.publish(),e})):(i.publish(),e)}catch(e){throw a.publish(e),i.publish(),e}}))}}}function y(e,t,r,s){const n={};if(t)for(let e=0;e<t.length;e++)t[e]&&"function"!=typeof r[e]&&(n[t[e]]=r[e]);return s&&(s.path&&(n.path=s.path),s.fd&&(n.fd=s.fd)),{operation:e,...n}}function v(e,t,r){for(const s of t)S(e,s,r)}function S(e,t,r){try{s.wrap(e,t,r)}catch(e){}}return["fs","node:fs"].forEach((e=>{t({name:e},(e=>{const t=Object.keys(p),r=t.map((e=>`${e}Sync`));return v(e,t,b()),v(e,r,b()),v(e.promises,t,b("promises.")),S(e.realpath,"native",b("","realpath.native")),S(e.realpathSync,"native",b("","realpath.native")),S(e.promises.realpath,"native",b("","realpath.native")),S(e,"createReadStream",m),S(e,"createWriteStream",m),e.Dir&&(S(e.Dir.prototype,"close",b("dir.")),S(e.Dir.prototype,"closeSync",b("dir.")),S(e.Dir.prototype,"read",b("dir.")),S(e.Dir.prototype,"readSync",b("dir.")),S(e.Dir.prototype,Symbol.asyncIterator,(function(e){return function(){return u&&l||function(e){const t=Reflect.ownKeys(e);for(const e of t){if(u&&l)break;"symbol"==typeof e&&(!u&&g(e).includes("kDirReadPromisified")&&(u=e),!l&&g(e).includes("kDirClosePromisified")&&(l=e))}}(this),S(this,u,b("dir.","read")),S(this,l,b("dir.","close")),e.apply(this,arguments)}}))),S(e,"unwatchFile",_()),S(e,"watch",_()),S(e,"watchFile",_()),e}))})),fs$3}var genericPool={},hasRequiredGenericPool;function requireGenericPool(){if(hasRequiredGenericPool)return genericPool;hasRequiredGenericPool=1;const{addHook:e,AsyncResource:t}=requireInstrument(),r=requireDatadogShimmer();function s(){return function(e){return function(r,s){return"function"==typeof r&&(arguments[0]=t.bind(r)),e.apply(this,arguments)}}}return e({name:"generic-pool",versions:["^2.4"]},(e=>(r.wrap(e.Pool.prototype,"acquire",s()),e))),e({name:"generic-pool",versions:["2 - 2.3"]},(e=>(r.wrap(e,"Pool",(function(e){return"function"!=typeof e?e:function(t){const n=e.apply(this,arguments);return n&&"function"==typeof n.acquire&&r.wrap(n,"acquire",s()),n}})),e))),genericPool}var http={},client$2={},hasRequiredClient$2;function requireClient$2(){if(hasRequiredClient$2)return client$2;hasRequiredClient$2=1;const e=require$$0$8,{channel:t,addHook:r}=requireInstrument(),s=requireDatadogShimmer(),n=requireLog$2(),i=t("apm:http:client:request:start"),a=t("apm:http:client:request:finish"),o=t("apm:http:client:request:end"),c=t("apm:http:client:request:asyncStart"),u=t("apm:http:client:request:error");function l(t,r){function l(t,r,s){const n=t;t=function(t){if("string"!=typeof t)return t instanceof e.URL?p(t):t;try{return p(new e.URL(t))}catch(r){return e.parse(t)}}(t);const[i,a]=function(e,t,r){return"function"==typeof e?[e,r||{}]:[t,e]}(r,s,t),o=function(e,t){return"object"==typeof t?Object.assign(e||{},t):e}(t,a);!function(e){e.headers=e.headers||{}}(o);return{uri:e.format(o),options:o,callback:i,originalUrl:n}}function p(e){const r=e.agent||t.globalAgent,s={protocol:e.protocol||r.protocol,hostname:"string"==typeof e.hostname&&e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname||e.host||"localhost",hash:e.hash,search:e.search,pathname:e.pathname,path:`${e.pathname||""}${e.search||""}`,href:e.href};return""!==e.port&&(s.port=Number(e.port)),(e.username||e.password)&&(s.auth=`${e.username}:${e.password}`),s}s.wrap(t,r,(function(e){return function(){if(!i.hasSubscribers)return e.apply(this,arguments);let r;try{r=l.apply(null,arguments)}catch(t){return n.error(t),e.apply(this,arguments)}const s={args:r,http:t};return i.runStores(s,(()=>{let t=!1,n=r.callback;n&&(n=function(){return c.runStores(s,(()=>r.callback.apply(this,arguments)))});const i=r.options,l=()=>{t||(t=!0,a.publish(s))};try{const t=e.call(this,i,n),r=t.emit,a=t.setTimeout;s.req=t;let o=!1;return t.setTimeout=function(){return o=!0,a.apply(this,arguments)},t.emit=function(e,t){switch(e){case"response":{const e=t;s.res=e,e.on("end",l),e.on("error",l);break}case"connect":case"upgrade":s.res=t,l();break;case"error":case"timeout":s.error=t,s.customRequestTimeout=o,u.publish(s);case"abort":case"close":l()}return r.apply(this,arguments)},t}catch(e){throw s.error=e,u.publish(s),e}finally{o.publish(s)}}))}}))}return r({name:["http","https","node:http","node:https"]},(function(e){return l(e,"request"),l(e,"get"),e})),client$2}var server$2={},hasRequiredServer$2,hasRequiredHttp;function requireServer$2(){if(hasRequiredServer$2)return server$2;hasRequiredServer$2=1;const{AbortController:e}=requireNodeAbortController(),{channel:t,addHook:r}=requireInstrument(),s=requireDatadogShimmer(),n=t("apm:http:server:request:start"),i=t("apm:http:server:request:exit"),a=t("apm:http:server:request:error"),o=t("apm:http:server:request:finish"),c=t("datadog:http:server:response:set-header:finish"),u=new WeakSet;function l(e){return function(t,r){return o.hasSubscribers?(["finish","close"].includes(t)&&!u.has(this)&&(o.publish({req:this.req}),u.add(this)),e.apply(this,arguments)):e.apply(this,arguments)}}function p(t){return function(r,o,u){if(!n.hasSubscribers)return t.apply(this,arguments);if("request"===r){u.req=o;const l=new e;n.publish({req:o,res:u,abortController:l});try{return l.signal.aborted?this.listenerCount(r)>0:(c.hasSubscribers&&function(e){s.wrap(e,"setHeader",(t=>function(r,s){const n=t.apply(this,arguments);return c.publish({name:r,value:s,res:e}),n}))}(u),t.apply(this,arguments))}catch(e){throw a.publish(e),e}finally{i.publish({req:o})}}return t.apply(this,arguments)}}return r({name:["http","node:http"]},(e=>(s.wrap(e.ServerResponse.prototype,"emit",l),s.wrap(e.Server.prototype,"emit",p),e))),r({name:["https","node:https"]},(e=>(s.wrap(e.Server.prototype,"emit",p),e))),server$2}function requireHttp(){return hasRequiredHttp||(hasRequiredHttp=1,requireClient$2(),requireServer$2()),http}var http2={},client$1={},hasRequiredClient$1;function requireClient$1(){if(hasRequiredClient$1)return client$1;hasRequiredClient$1=1;const e=requireDatadogShimmer(),{addHook:t,channel:r}=requireInstrument(),s=r("apm:http2:client:connect:start"),n=r("apm:http2:client:request:start"),i=r("apm:http2:client:request:end"),a=r("apm:http2:client:request:asyncStart"),o=r("apm:http2:client:request:asyncEnd"),c=r("apm:http2:client:request:error");function u(t,r){return function(s){return function(u){if(!n.hasSubscribers)return s.apply(this,arguments);const l={headers:u,authority:t,options:r};return n.runStores(l,(()=>{try{const t=s.apply(this,arguments);return e.wrap(t,"emit",function(e){return function(t){return function(r,s){return e.eventName=r,e.eventData=s,a.runStores(e,(()=>{try{return t.apply(this,arguments)}finally{o.publish(e)}}))}}}(l)),t}catch(e){throw l.error=e,c.publish(l),e}finally{i.publish(l)}}))}}}function l(t){return function(r,n){s.hasSubscribers&&s.publish({authority:r});const i=t.apply(this,arguments);return e.wrap(i,"request",u(r,n)),i}}return t({name:["http2","node:http2"]},(t=>(e.wrap(t,"connect",l),t))),client$1}var server$1={},hasRequiredServer$1,hasRequiredHttp2;function requireServer$1(){if(hasRequiredServer$1)return server$1;hasRequiredServer$1=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:http2:server:request:start"),i=e("apm:http2:server:request:error"),a=e("apm:http2:server:request:finish");function o(e){return function(...t){const r=e.apply(this,t);return s.wrap(r,"emit",u),r}}function c(e){const t=new r("bound-anonymous-fn");return function(r,s){return t.runInAsyncScope((()=>("close"===r&&a.hasSubscribers&&a.publish({req:this.req}),e.apply(this,arguments))))}}function u(e){return function(t,a,o){if(!n.hasSubscribers)return e.apply(this,arguments);if("request"===t){o.req=a;return new r("bound-anonymous-fn").runInAsyncScope((()=>{n.publish({req:a,res:o}),s.wrap(o,"emit",c);try{return e.apply(this,arguments)}catch(e){throw i.publish(e),e}}))}return e.apply(this,arguments)}}return t({name:["http2","node:http2"]},(e=>(s.wrap(e,"createSecureServer",o),s.wrap(e,"createServer",o),e))),server$1}function requireHttp2(){return hasRequiredHttp2||(hasRequiredHttp2=1,requireClient$1(),requireServer$1()),http2}var ioredis={},hasRequiredIoredis;function requireIoredis(){if(hasRequiredIoredis)return ioredis;hasRequiredIoredis=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:ioredis:command:start"),i=e("apm:ioredis:command:finish"),a=e("apm:ioredis:command:error");function o(e,t,r){r&&t.publish(r),e.publish()}return t({name:"ioredis",versions:[">=2"]},(e=>(s.wrap(e.prototype,"sendCommand",(e=>function(t,s){if(!n.hasSubscribers)return e.apply(this,arguments);if(!t||!t.promise)return e.apply(this,arguments);const c=this.options||{},u=c.connectionName,l=c.db,p={host:c.host,port:c.port},d=new r("bound-anonymous-fn");return d.runInAsyncScope((()=>{n.publish({db:l,command:t.name,args:t.args,connectionOptions:p,connectionName:u});const r=d.bind((()=>o(i,a))),s=d.bind((e=>o(i,a,e)));t.promise.then(r,s);try{return e.apply(this,arguments)}catch(e){throw a.publish(e),e}}))})),e))),ioredis}var knex={},hasRequiredKnex;function requireKnex(){if(hasRequiredKnex)return knex;hasRequiredKnex=1;const{addHook:e,channel:t,AsyncResource:r}=requireInstrument(),{wrapThen:s}=requirePromise$1(),n=requireDatadogShimmer(),i=t("datadog:knex:raw:start"),a=t("datadog:knex:raw:finish");function o(t){e({name:"knex",versions:[">=0.8.0"],file:t},(e=>(n.wrap(e.prototype,"then",s),e)))}function c(e,t){return"function"!=typeof e?e:function(){t(),e.apply(this,arguments)}}return o("lib/query/builder.js"),o("lib/raw.js"),o("lib/schema/builder.js"),e({name:"knex",versions:[">=2"],file:"lib/knex-builder/Knex.js"},(e=>(n.wrap(e.Client.prototype,"raw",(e=>function(){if(!i.hasSubscribers)return e.apply(this,arguments);const t=arguments[0];if("DEFAULT"===t)return e.apply(this,arguments);const s=new r("bound-anonymous-fn");function o(){a.publish()}return s.runInAsyncScope((()=>{i.publish({sql:t,dialect:this.dialect});const r=e.apply(this,arguments);return n.wrap(r,"then",(e=>function(){return s.runInAsyncScope((()=>{arguments[0]=c(arguments[0],o),arguments[1]&&(arguments[1]=c(arguments[1],o));const t=e.apply(this,arguments);return n.wrap(t,"catch",(e=>function(){return arguments[0]=c(arguments[0],o),e.apply(this,arguments)})),t}))})),n.wrap(r,"asCallback",(e=>function(){return s.runInAsyncScope((()=>(arguments[0]=c(arguments[0],o),e.apply(this,arguments))))})),r}))})),e))),knex}var kafkajs={},hasRequiredKafkajs;function requireKafkajs(){if(hasRequiredKafkajs)return kafkajs;hasRequiredKafkajs=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:kafkajs:produce:start"),i=e("apm:kafkajs:produce:commit"),a=e("apm:kafkajs:produce:finish"),o=e("apm:kafkajs:produce:error"),c=e("apm:kafkajs:consume:start"),u=e("apm:kafkajs:consume:commit"),l=e("apm:kafkajs:consume:finish"),p=e("apm:kafkajs:consume:error");function d(e){const{payload:{groupId:t,topics:r}}=e,s=[];for(const{topic:e,partitions:n}of r)for(const{partition:r,offset:i}of n)s.push({groupId:t,partition:r,offset:i,topic:e});u.publish(s)}return t({name:"kafkajs",file:"src/index.js",versions:[">=1.4"]},(e=>{class t extends e{constructor(e){super(e),this._brokers=e.brokers&&"function"!=typeof e.brokers?e.brokers.join(","):void 0}}return s.wrap(t.prototype,"producer",(e=>function(){const t=e.apply(this,arguments),s=t.send,c=this._brokers;return t.send=function(){const e=new r("bound-anonymous-fn");return e.runInAsyncScope((()=>{if(!n.hasSubscribers)return s.apply(this,arguments);try{const{topic:t,messages:r=[]}=arguments[0];for(const e of r)"object"==typeof e&&(e.headers=e.headers||{});n.publish({topic:t,messages:r,bootstrapServers:c});const u=s.apply(this,arguments);return u.then(e.bind((()=>a.publish(void 0))),e.bind((e=>{e&&o.publish(e),a.publish(void 0)}))),u.then((e=>{i.hasSubscribers&&i.publish(e)})),u}catch(e){throw o.publish(e),a.publish(void 0),e}}))},t})),s.wrap(t.prototype,"consumer",(e=>function(){if(!c.hasSubscribers)return e.apply(this,arguments);const t=e.apply(this,arguments);t.on(t.events.COMMIT_OFFSETS,d);const s=t.run,n=arguments[0].groupId;return t.run=function({eachMessage:e,...t}){return s("function"!=typeof e?{eachMessage:e,...t}:{eachMessage:function(...t){const s=new r("bound-anonymous-fn");return s.runInAsyncScope((()=>{const{topic:r,partition:i,message:a}=t[0];c.publish({topic:r,partition:i,message:a,groupId:n});try{const r=e.apply(this,t);return r&&"function"==typeof r.then?r.then(s.bind((()=>l.publish(void 0))),s.bind((e=>{e&&p.publish(e),l.publish(void 0)}))):l.publish(void 0),r}catch(e){throw p.publish(e),l.publish(void 0),e}}))},...t})},t})),t})),kafkajs}var ldapjs={},hasRequiredLdapjs;function requireLdapjs(){if(hasRequiredLdapjs)return ldapjs;hasRequiredLdapjs=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();function n(e){return"string"==typeof e||e instanceof String}return t({name:"ldapjs",versions:[">=2"]},(t=>{const i=e("datadog:ldapjs:client:search");return s.wrap(t.Client.prototype,"search",(e=>function(t,r){if(i.hasSubscribers){let e;n(r)?e=r:"object"==typeof r&&r.filter&&n(r.filter)&&(e=r.filter),i.publish({base:t,filter:e})}return e.apply(this,arguments)})),s.wrap(t.Client.prototype,"_send",(e=>function(){const t=function(e){let t=-1;for(let r=e.length-1;r>=0;r--)if("function"==typeof e[r]){t=r;break}return t}(arguments);if(t>-1){const e=arguments[t];arguments[t]=s.wrap(e,(function(t,n){"object"==typeof n&&"function"==typeof n.on&&function(e){const t=new WeakMap,n=e=>function(s,n){if("function"==typeof n){let e=t.get(n);e||(e=new r("bound-anonymous-fn").bind(n),t.set(n,e)),arguments[1]=e}return e.apply(this,arguments)};s.wrap(e,"on",n),s.wrap(e,"addListener",n);const i=e=>function(r,s){if("function"==typeof s){const e=t.get(s);e&&(arguments[1]=e)}return e.apply(this,arguments)};s.wrap(e,"off",i),s.wrap(e,"removeListener",i)}(n),e.apply(this,arguments)}))}return e.apply(this,arguments)})),s.wrap(t.Client.prototype,"bind",(e=>function(t,s,n,i){return"function"==typeof n?arguments[2]=r.bind(n):"function"==typeof i&&(arguments[3]=r.bind(i)),e.apply(this,arguments)})),t})),ldapjs}var limitdClient={},hasRequiredLimitdClient;function requireLimitdClient(){if(hasRequiredLimitdClient)return limitdClient;hasRequiredLimitdClient=1;const{addHook:e,AsyncResource:t}=requireInstrument(),r=requireDatadogShimmer();function s(e){return function(){const r=arguments.length-1;return arguments[r]=t.bind(arguments[r]),e.apply(this,arguments)}}return e({name:"limitd-client",versions:[">=2.8"]},(e=>(r.wrap(e.prototype,"_directRequest",s),r.wrap(e.prototype,"_retriedRequest",s),e))),limitdClient}var mariadb={},hasRequiredMariadb;function requireMariadb(){if(hasRequiredMariadb)return mariadb;hasRequiredMariadb=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:mariadb:query:start"),i=e("apm:mariadb:query:finish"),a=e("apm:mariadb:query:error"),o=e("apm:mariadb:pool:skip"),c=e("apm:mariadb:pool:unskip");function u(e){return class extends e{constructor(...e){super(...e);const t=new r("bound-anonymous-fn");this.start&&(this.start=function(e,t){return function(){if(!n.hasSubscribers)return e.apply(this,arguments);const o=t.bind(this.resolve),c=t.bind(this.reject),u=t.runInAsyncScope((()=>new r("bound-anonymous-fn")));return s.wrap(this,"resolve",(function(){return function(){return u.runInAsyncScope((()=>{i.publish()})),o.apply(this,arguments)}})),s.wrap(this,"reject",(function(){return function(e){return u.runInAsyncScope((()=>{a.publish(e),i.publish()})),c.apply(this,arguments)}})),u.runInAsyncScope((()=>(n.publish({sql:this.sql,conf:this.opts}),e.apply(this,arguments))))}}(this.start,t))}}}function l(e){return function(t){return function(s){if(!n.hasSubscribers)return t.apply(this,arguments);return new r("bound-anonymous-fn").runInAsyncScope((()=>(n.publish({sql:s,conf:e}),t.apply(this,arguments).then((e=>(i.publish(),e)),(e=>{throw a.publish(e),i.publish(),e})))),"bound-anonymous-fn")}}}function p(e,t){return function(o){e.apply(this,arguments),s.wrap(this,t,l(o)),s.wrap(this,"_queryCallback",function(e){return function(t){return function(s){if(!n.hasSubscribers)return t.apply(this,arguments);const o=arguments[arguments.length-1],c=new r("bound-anonymous-fn"),u=new r("bound-anonymous-fn");return"function"!=typeof o&&(arguments.length=arguments.length+1),arguments[arguments.length-1]=c.bind((function(e){if(e&&a.publish(e),i.publish(),"function"==typeof o)return u.runInAsyncScope((()=>o.apply(this,arguments)))})),c.runInAsyncScope((()=>(n.publish({sql:s,conf:e}),t.apply(this,arguments))),"bound-anonymous-fn")}}}(o))}}function d(e){return function(){o.publish();try{return e.apply(this,arguments)}finally{c.publish()}}}const h="mariadb";return t({name:h,file:"lib/cmd/query.js",versions:[">=3"]},(e=>u(e))),t({name:h,file:"lib/cmd/execute.js",versions:[">=3"]},(e=>u(e))),t({name:h,file:"lib/pool.js",versions:[">=3"]},(e=>(s.wrap(e.prototype,"_createConnection",d),e))),t({name:h,file:"lib/connection.js",versions:[">=2.5.2 <3"]},(e=>s.wrap(e,p(e,"_queryPromise")))),t({name:h,file:"lib/connection.js",versions:[">=2.0.4 <=2.5.1"]},(e=>s.wrap(e,p(e,"query")))),t({name:h,file:"lib/pool-base.js",versions:[">=2.0.4 <3"]},(e=>s.wrap(e,function(e){return function(t,r,n,i){arguments[1]=d(r),arguments[2]=d(n),e.apply(this,arguments),s.wrap(this,"query",l(t.connOptions))}}(e)))),mariadb}var memcached={},hasRequiredMemcached;function requireMemcached(){if(hasRequiredMemcached)return memcached;hasRequiredMemcached=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();return t({name:"memcached",versions:[">=2.2"]},(t=>{const n=e("apm:memcached:command:start"),i=e("apm:memcached:command:finish"),a=e("apm:memcached:command:error");return s.wrap(t.prototype,"command",(e=>function(t,s){if(!n.hasSubscribers)return e.apply(this,arguments);const o=new r("bound-anonymous-fn"),c=new r("bound-anonymous-fn"),u=this,l=c.bind((function(){const e=t.apply(this,arguments),r=o.bind(e.callback);return e.callback=c.bind((function(e){return e&&a.publish(e),i.publish(),r.apply(this,arguments)})),n.publish({client:u,server:s,query:e}),e}));return c.runInAsyncScope((()=>{arguments[0]=l;return e.apply(this,arguments)}))})),t})),memcached}var microgatewayCore={},hasRequiredMicrogatewayCore;function requireMicrogatewayCore(){if(hasRequiredMicrogatewayCore)return microgatewayCore;hasRequiredMicrogatewayCore=1;const e=requireDatadogShimmer(),{addHook:t,channel:r,AsyncResource:s}=requireInstrument(),n=r("apm:microgateway-core:request:handle"),i=r("apm:microgateway-core:request:route"),a=r("apm:microgateway-core:request:error"),o="microgateway-core",c=[">=2.1"],u=new WeakMap;function l(e){return function(t){const r=e.apply(this,arguments);return function(e,t,s){return arguments[2]=function(e,t,r){return function(s){return u.get(e).runInAsyncScope((()=>{s&&a.publish(s),t.proxy&&t.proxy.base_path&&i.publish({req:e,res:t,route:t.proxy.base_path})})),r.apply(this,arguments)}}(e,t,s),r.apply(this,arguments)}}}return t({name:o,versions:c,file:"lib/config-proxy-middleware.js"},(t=>e.wrap(t,function(e){return function(){const t=e.apply(this,arguments);return function(e,r,i){const a=new s("bound-anonymous-fn");return u.set(e,a),n.publish({req:e,res:r}),t.apply(this,arguments)}}}(t)))),t({name:o,versions:c,file:"lib/plugins-middleware.js"},(t=>e.wrap(t,l(t)))),microgatewayCore}var mocha={},hasRequiredMocha;function requireMocha(){if(hasRequiredMocha)return mocha;hasRequiredMocha=1;const{createCoverageMap:e}=requireIstanbulLibCoverage(),{isMarkedAsUnskippable:t}=requireUtil$1(),{addHook:r,channel:s,AsyncResource:n}=requireInstrument(),i=requireDatadogShimmer(),a=requireLog$2(),{getCoveredFilenamesFromCoverage:o,resetCoverage:c,mergeCoverage:u,getTestSuitePath:l,fromCoverageMapToCoverage:p,getCallSites:d,addEfdStringToTestName:h,removeEfdStringFromTestName:f}=requireTest(),g=s("ci:mocha:test:start"),m=s("ci:mocha:test:error"),_=s("ci:mocha:test:skip"),b=s("ci:mocha:test:finish"),y=s("ci:mocha:test:parameterize"),v=s("ci:mocha:library-configuration"),S=s("ci:mocha:known-tests"),q=s("ci:mocha:test-suite:skippable"),E=s("ci:mocha:session:start"),R=s("ci:mocha:session:finish"),T=s("ci:mocha:test-suite:start"),A=s("ci:mocha:test-suite:finish"),w=s("ci:mocha:test-suite:error"),x=s("ci:mocha:test-suite:code-coverage"),I=s("ci:mocha:itr:skipped-suites"),C=new WeakSet,O=new WeakMap,$=new WeakMap,k=new Map,P=new WeakMap,N={};let L=!1;const M=e();let D,j=[],U=!1,B=[];const G=[];let F=!1,z="",V=!1,H=0,W=!1,K=[];function Y(e){return e.isPending()?"skip":e.isFailed()||e.timedOut?"fail":"pass"}function J(e){return`mocha.${l(e.file,process.cwd())}.${f(e.fullTitle())}`}function X(e){if(!e.fn)return O.get(e);if(!e.fn.asyncResource)return O.get(e.fn);const t=$.get(e.fn);return O.get(t)}return r({name:"mocha",versions:[">=5.2.0"],file:"lib/mocha.js"},((e,r)=>{D=r;const s=new n("bound-anonymous-fn");return i.wrap(e.prototype,"run",(e=>function(){if(this.options.parallel)return a.warn("Unable to initialize CI Visibility because Mocha is running in parallel mode."),e.apply(this,arguments);if(!v.hasSubscribers||this.isWorker)return this.isWorker&&(L=!0),e.apply(this,arguments);this.options.delay=!0;const r=e.apply(this,arguments);this.files.forEach((e=>{t({path:e})&&G.push(e)}));const n=({err:e,skippableSuites:t,itrCorrelationId:s})=>{e?j=[]:(j=t,z=s);const n=r.suite.suites.reduce(((e,t)=>{const r=l(t.file,process.cwd()),s=j.includes(r),n=G.includes(t.file);return s&&!n?e.skippedSuites.add(r):e.suitesToRun.push(t),e}),{suitesToRun:[],skippedSuites:new Set});const{suitesToRun:i}=n;U=i.length!==r.suite.suites.length,a.debug((()=>`${i.length} out of ${r.suite.suites.length} suites are going to run.`)),r.suite.suites=i,B=Array.from(n.skippedSuites),commonjsGlobal.run()},i=({err:e,knownTests:t})=>{e?(K=[],V=!1):K=t,W?q.publish({onDone:s.bind(n)}):commonjsGlobal.run()},o=({err:e,libraryConfig:t})=>{if(e||!q.hasSubscribers||!S.hasSubscribers)return commonjsGlobal.run();V=t.isEarlyFlakeDetectionEnabled,W=t.isSuitesSkippingEnabled,H=t.earlyFlakeDetectionNumRetries,V?S.publish({onDone:s.bind(i)}):W?q.publish({onDone:s.bind(n)}):commonjsGlobal.run()};return s.runInAsyncScope((()=>{v.publish({onDone:s.bind(o)})})),r})),e})),r({name:"mocha",versions:[">=5.2.0"],file:"lib/suite.js"},(e=>(i.wrap(e.prototype,"addTest",(e=>function(t){let r;const s=d().find((e=>e.getFileName()===t.file));return s&&(r=s.getLineNumber(),P.set(t,r)),e.apply(this,arguments)})),e))),r({name:"mocha",versions:[">=5.2.0"],file:"lib/runner.js"},(function(e){return C.has(e)||(C.add(e),i.wrap(e.prototype,"runTests",(e=>function(t,r){return V&&t.tests.forEach((e=>{!e.isPending()&&function(e){return!K.includes(J(e))}(e)&&(e._ddIsNew=!0,function(e){const t=e.title,r=e.parent;for(let s=0;s<H;s++){const n=e.clone();n.title=h(t,s+1),r.addTest(n),n._ddIsNew=!0,n._ddIsEfdRetry=!0}}(e))})),e.apply(this,arguments)})),i.wrap(e.prototype,"run",(e=>function(){if(!g.hasSubscribers||L)return e.apply(this,arguments);const{suitesByTestFile:t,numSuitesByTestFile:r}=function(e){const t={};!function e(r){r.file&&(t[r.file]?t[r.file].push(r):t[r.file]=[r]),r.suites.forEach((t=>{e(t)}))}(e);const r=Object.keys(t).reduce(((e,r)=>(e[r]=t[r].length,e)),{});return{suitesByTestFile:t,numSuitesByTestFile:r}}(this.suite),s=new n("bound-anonymous-fn");return this.once("end",s.bind((function(){let e,t,r="pass";if(this.stats?(r=0===this.stats.failures?"pass":"fail",0===this.stats.tests&&(r="skip")):0!==this.failures&&(r="fail"),V)for(const e of Object.values(N)){const t=e.filter((e=>e.isFailed())),r=t.length===e.length;t.length&&!r&&(this.stats.failures-=t.length,this.failures-=t.length)}if("fail"===r&&(e=new Error(`Failed tests: ${this.failures}.`)),k.clear(),commonjsGlobal.__coverage__){try{t=M.getCoverageSummary().lines.pct}catch(e){}commonjsGlobal.__coverage__=p(M)}R.publish({status:r,isSuitesSkipped:U,testCodeCoverageLinesTotal:t,numSkippedSuites:B.length,hasForcedToRunSuites:F,hasUnskippableSuites:!!G.length,error:e,isEarlyFlakeDetectionEnabled:V})}))),this.once("start",s.bind((function(){const e=`mocha ${process.argv.slice(2).join(" ")}`;E.publish({command:e,frameworkVersion:D}),B.length&&I.publish({skippedSuites:B,frameworkVersion:D})}))),this.on("suite",(function(e){if(e.root||!e.tests.length)return;let t=k.get(e.file);if(!t){t=new n("bound-anonymous-fn"),k.set(e.file,t);const r=G.includes(e.file);F=r&&j.includes(l(e.file,process.cwd())),t.runInAsyncScope((()=>{T.publish({testSuite:e.file,isUnskippable:r,isForcedToRun:F,itrCorrelationId:z})}))}})),this.on("suite end",(function(e){if(e.root)return;const s=t[e.file];if(!(0==--r[e.file]))return;let n="pass";if(s.every((e=>e.pending))?n="skip":s.forEach((e=>{e.eachTest((e=>{("failed"===e.state||e.timedOut)&&(n="fail")}))})),commonjsGlobal.__coverage__){const t=o(commonjsGlobal.__coverage__);x.publish({coverageFiles:t,suiteFile:e.file}),u(commonjsGlobal.__coverage__,M),c(commonjsGlobal.__coverage__)}k.get(e.file).runInAsyncScope((()=>{A.publish(n)}))})),this.on("test",(e=>{if(function(e){return void 0!==e._currentRetry&&0!==e._currentRetry}(e))return;const t=P.get(e),r=new n("bound-anonymous-fn");O.set(e.fn,r);const{file:s,title:i,_ddIsNew:a,_ddIsEfdRetry:o}=e,c={testName:e.fullTitle(),testSuiteAbsolutePath:s,title:i,isNew:a,isEfdRetry:o,testStartLine:t};if(a){const t=J(e);N[t]?N[t].push(e):N[t]=[e]}r.runInAsyncScope((()=>{g.publish(c)}))})),this.on("test end",(e=>{const t=X(e),r=Y(e);t&&!e.parent._afterEach.length&&t.runInAsyncScope((()=>{b.publish(r)}))})),this.on("hook end",(e=>{const t=e.ctx.currentTest;if(t&&e.parent._afterEach.includes(e)){if(e.parent._afterEach.indexOf(e)===e.parent._afterEach.length-1){const e=Y(t);X(t).runInAsyncScope((()=>{b.publish(e)}))}}})),this.on("fail",((e,t)=>{const r=e.file;let s=e;const n="hook"===e.type;let i;n&&e.ctx&&(s=e.ctx.currentTest),s&&(i=X(s)),i&&i.runInAsyncScope((()=>{n?(t.message=`${e.fullTitle()}: ${t.message}`,m.publish(t),b.publish("fail")):m.publish(t)}));const a=k.get(r);if(a){const r=new Error(`"${e.parent.fullTitle()}" failed with message "${t.message}"`);r.stack=t.stack,a.runInAsyncScope((()=>{w.publish(r)}))}})),this.on("pending",(e=>{const t=P.get(e),{file:r,title:s}=e,i={testName:e.fullTitle(),testSuiteAbsolutePath:r,title:s,testStartLine:t},a=X(e);if(a)a.runInAsyncScope((()=>{_.publish(i)}));else{const t=new n("bound-anonymous-fn");e.fn?O.set(e.fn,t):O.set(e,t),t.runInAsyncScope((()=>{_.publish(i)}))}})),e.apply(this,arguments)}))),e})),r({name:"mocha",versions:[">=5.2.0"],file:"lib/cli/run-helpers.js"},(e=>(i.wrap(e,"runMocha",(e=>async function(){if(!g.hasSubscribers)return e.apply(this,arguments);const t=arguments[0];return t.options.parallel||(t.options.delay=!0),e.apply(this,arguments)})),e))),r({name:"mocha",versions:[">=5.2.0"],file:"lib/runnable.js"},(e=>(i.wrap(e.prototype,"run",(e=>function(){if(!g.hasSubscribers)return e.apply(this,arguments);const t=this.parent._beforeEach.includes(this),r=this.parent._afterEach.includes(this),s=t||r;if(this.fn.asyncResource){const e=$.get(this.fn);this.fn=e}if(s||"test"===this.type){const e=X(s?this.ctx.currentTest:this);if(e){const t=e.bind(this.fn);$.set(t,this.fn),this.fn=t,this.fn.asyncResource||(this.fn.asyncResource=e)}}return e.apply(this,arguments)})),e))),r({name:"mocha-each",versions:[">=2.0.1"]},(function(e){return C.has(e)?e:(C.add(e),i.wrap(e,(function(){const[t]=arguments,{it:r,...s}=e.apply(this,arguments);return{it:function(e){y.publish({title:e,params:t}),r.apply(this,arguments)},...s}})))})),mocha}var moleculer={},client={},hasRequiredClient;function requireClient(){if(hasRequiredClient)return client;hasRequiredClient=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:moleculer:call:start"),i=e("apm:moleculer:call:finish"),a=e("apm:moleculer:call:error");function o(e){return function(t,s,o){const c=new r("bound-anonymous-fn");return(o=arguments[2]=o||{}).meta=o.meta||{},arguments.length=Math.max(3,arguments.length),c.runInAsyncScope((()=>{n.publish({actionName:t,params:s,opts:o});const r=e.apply(this,arguments),c=this,u=r.ctx;return r.then((e=>(i.publish({broker:c,ctx:u}),e)),(e=>{throw a.publish(e),i.publish({broker:c,ctx:u}),e}))}))}}return t({name:"moleculer",versions:[">=0.14"]},(e=>(s.wrap(e.ServiceBroker.prototype,"call",o),e))),client}var server={},hasRequiredServer,hasRequiredMoleculer;function requireServer(){if(hasRequiredServer)return server;hasRequiredServer=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:moleculer:action:start"),i=e("apm:moleculer:action:finish"),a=e("apm:moleculer:action:error");function o(e){return function(t){return this.middlewares&&this.middlewares.add&&this.middlewares.add({name:"Datadog",localAction(e,t){const s=this;return function(o){return new r("bound-anonymous-fn").runInAsyncScope((()=>{n.publish({action:t,ctx:o,broker:s});try{return e(o).then((e=>(i.publish(),e)),(e=>{throw a.publish(e),i.publish(),e}))}catch(e){a.publish(e),i.publish()}}))}}}),e.apply(this,arguments)}}return t({name:"moleculer",versions:[">=0.14"]},(e=>(s.wrap(e.ServiceBroker.prototype,"registerMiddlewares",o),e))),server}function requireMoleculer(){return hasRequiredMoleculer||(hasRequiredMoleculer=1,requireClient(),requireServer()),moleculer}var mongodb={},mongodbCore={},hasRequiredMongodbCore,hasRequiredMongodb;function requireMongodbCore(){if(hasRequiredMongodbCore)return mongodbCore;hasRequiredMongodbCore=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:mongodb:query:start"),i=e("apm:mongodb:query:finish"),a=e("apm:mongodb:query:error");function o(e){return s.wrap(e,"command",(e=>c(e,"command"))),s.wrap(e,"insert",(e=>c(e,"insert","insert"))),s.wrap(e,"update",(e=>c(e,"update","update"))),s.wrap(e,"remove",(e=>c(e,"remove","remove"))),s.wrap(e,"query",(e=>c(e,"query"))),s.wrap(e,"getMore",(e=>c(e,"getMore","getMore"))),s.wrap(e,"killCursors",(e=>c(e,"killCursors","killCursors"))),e}function c(e,t,r){return s.wrap(e,(function(s,i,a){return n.hasSubscribers?d(t,e,this,arguments,s,i,a,{name:r}):e.apply(this,arguments)}))}function u(e,t,r){return s.wrap(e,(function(s,i){if(!n.hasSubscribers)return e.apply(this,arguments);const a="string"==typeof this.address?this.address.split(":"):"",o={s:{options:2===a.length?{host:a[0],port:a[1]}:{}}};return s=`${s.db}.${s.collection}`,d(t,e,this,arguments,o,s,i,{name:r})}))}function l(e,t,r){return s.wrap(e,(function(){if(!n.hasSubscribers)return e.apply(this,arguments);const s=this.server.s.pool,i=this.ns;return d(t,e,this,arguments,s,i,{},{name:r})}))}function p(e,t,r){return s.wrap(e,(function(s,i){return n.hasSubscribers?d(t,e,this,arguments,this,s,i,{name:r}):e.apply(this,arguments)}))}function d(e,t,s,o,c,u,l,p={}){const d=p.name||l&&Object.keys(l)[0],h=o.length-1;let f=o[h];if("function"!=typeof f)return t.apply(s,o);const g=c&&c.s&&c.s.options,m=new r("bound-anonymous-fn"),_=new r("bound-anonymous-fn");return f=m.bind(f),_.runInAsyncScope((()=>{n.publish({ns:u,ops:l,options:g,name:d}),o[h]=_.bind((function(e,t){if(e&&a.publish(e),i.publish(),f)return f.apply(this,arguments)}));try{return t.apply(s,o)}catch(e){throw a.publish(e),e}}))}return t({name:"mongodb-core",versions:["2 - 3.1.9"]},(e=>{const t=e.Server.prototype;s.wrap(t,"command",(e=>p(e,"command"))),s.wrap(t,"insert",(e=>p(e,"insert","insert"))),s.wrap(t,"update",(e=>p(e,"update","update"))),s.wrap(t,"remove",(e=>p(e,"remove","remove")));const r=e.Cursor.prototype;return s.wrap(r,"_getmore",(e=>l(e,"getMore","getMore"))),s.wrap(r,"_find",(e=>function(e,t,r){const i=function(){if(!n.hasSubscribers)return e.apply(this,arguments);const r=this.server.s.pool,s=this.ns,i=this.cmd;return d(t,e,this,arguments,r,s,i)};return s.wrap(e,i)}(e,"_find"))),s.wrap(r,"kill",(e=>l(e,"killCursors","killCursors"))),e})),t({name:"mongodb",versions:[">=4 <4.6.0"],file:"lib/cmap/connection.js"},(e=>{const t=e.Connection.prototype;return s.wrap(t,"command",(e=>u(e,"command"))),s.wrap(t,"query",(e=>u(e,"query"))),e})),t({name:"mongodb",versions:[">=4.6.0"],file:"lib/cmap/connection.js"},(e=>{const t=e.Connection.prototype;return s.wrap(t,"command",(e=>u(e,"command"))),e})),t({name:"mongodb",versions:[">=3.3 <4"],file:"lib/core/wireprotocol/index.js"},(e=>o(e))),t({name:"mongodb-core",versions:[">=3.2"],file:"lib/wireprotocol/index.js"},(e=>o(e))),t({name:"mongodb-core",versions:["~3.1.10"],file:"lib/wireprotocol/3_2_support.js"},(e=>(s.wrap(e.prototype,"command",(e=>c(e,"command"))),e))),t({name:"mongodb-core",versions:["~3.1.10"],file:"lib/wireprotocol/2_6_support.js"},(e=>(s.wrap(e.prototype,"command",(e=>c(e,"command"))),e))),t({name:"mongodb",versions:[">=3.5.4 <4.11.0"],file:"lib/utils.js"},(e=>(s.wrap(e,"maybePromise",(e=>function(t,s,n){const i=new r("bound-anonymous-fn"),a=arguments.length-2;return"function"==typeof(s=arguments[a])&&(arguments[a]=i.bind(s)),e.apply(this,arguments)})),e))),mongodbCore}function requireMongodb(){if(hasRequiredMongodb)return mongodb;hasRequiredMongodb=1,requireMongodbCore();const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=["count","countDocuments","deleteMany","deleteOne","find","findOneAndDelete","findOneAndReplace","replaceOne"],i=["findOneAndUpdate","updateMany","updateOne"],a=e("datadog:mongodb:collection:filter:start");return t({name:"mongodb",versions:[">=3.3 <5","5",">=6"]},(e=>([...n,...i].forEach((t=>{if(!(t in e.Collection.prototype))return;const n=i.includes(t);s.wrap(e.Collection.prototype,t,(e=>function(){if(!a.hasSubscribers)return e.apply(this,arguments);return new r("bound-anonymous-fn").runInAsyncScope((()=>{const r=[arguments[0]];return n&&r.push(arguments[1]),a.publish({filters:r,methodName:t}),e.apply(this,arguments)}))}))})),e))),mongodb}var mongoose={},hasRequiredMongoose;function requireMongoose(){if(hasRequiredMongoose)return mongoose;hasRequiredMongoose=1;const{addHook:e,channel:t}=requireInstrument(),{wrapThen:r}=requirePromise$1(),{AsyncResource:s}=requireInstrument(),n=requireDatadogShimmer();function i(e){return function(t){return"function"==typeof t?arguments[0]=s.bind(t):"function"==typeof this[t]&&(arguments[0]=s.bind(((...e)=>this[t](...e)))),e.apply(this,arguments)}}e({name:"mongoose",versions:[">=4.6.4 <5","5","6",">=7"]},(e=>(e.Promise!==commonjsGlobal.Promise&&n.wrap(e.Promise.prototype,"then",r),n.wrap(e.Collection.prototype,"addQueue",i),e)));const a=t("datadog:mongoose:model:filter:start"),o=t("datadog:mongoose:model:filter:finish"),c=["count","countDocuments","deleteMany","deleteOne","find","findOne","findOneAndDelete","findOneAndReplace","replaceOne","remove"],u=["findOneAndUpdate","updateMany","updateOne"];e({name:"mongoose",versions:[">=4.6.4 <5","5","6",">=7"],file:"lib/model.js"},(e=>([...c,...u].forEach((t=>{const r=u.includes(t);t in e&&n.wrap(e,t,(e=>function(){if(!a.hasSubscribers)return e.apply(this,arguments);const i=new s("bound-anonymous-fn"),c=[arguments[0]];r&&c.push(arguments[1]);const u=i.bind((function(){o.publish()}));let l=!1;const p=e=>{const t=e.length-1;"function"==typeof e[t]&&(n.wrap(e,t,(e=>function(){return u(),e.apply(this,arguments)})),l=!0)};return p(arguments),i.runInAsyncScope((()=>{a.publish({filters:c,methodName:t});const r=e.apply(this,arguments);return l||n.wrap(r,"exec",(e=>function(){l||p(arguments);const t=e.apply(this,arguments);return l||"function"!=typeof t?.then||n.wrap(t,"then",(e=>function(){const t=arguments[0],r=arguments[1];return arguments[0]=function(){if(u(),t)return t.apply(this,arguments)},arguments[1]=function(){if(u(),r)return r.apply(this,arguments)},e.apply(this,arguments)})),t})),r}))}))})),e)));const l=t("datadog:mongoose:sanitize-filter:finish");return e({name:"mongoose",versions:["6",">=7"],file:"lib/helpers/query/sanitizeFilter.js"},(e=>n.wrap(e,(function(){const t=e.apply(this,arguments);return l.hasSubscribers&&l.publish({sanitizedObject:t}),t})))),mongoose}var mquery={},hasRequiredMquery;function requireMquery(){if(hasRequiredMquery)return mquery;hasRequiredMquery=1;const e=requireDcPolyfill(),{channel:t,addHook:r}=requireInstrument(),s=requireDatadogShimmer(),n=t("datadog:mquery:filter:prepare"),i=e.tracingChannel("datadog:mquery:filter"),a=["find","findOne","findOneAndRemove","findOneAndDelete","count","distinct","where"],o=["findOneAndUpdate"];return r({name:"mquery",versions:[">=5.0.0"]},(e=>([...a,...o].forEach((t=>{t in e.prototype&&s.wrap(e.prototype,t,(e=>function(){if(n.hasSubscribers){const e=function(e,t){const[r,s]=e,n=r&&"object"==typeof r?[r]:[];return s&&"object"==typeof s&&o.includes(t)&&n.push(s),n}(arguments,t);e?.length&&n.publish({filters:e})}return e.apply(this,arguments)}))})),s.wrap(e.prototype,"exec",(e=>function(){return i.tracePromise(e,{},this,arguments)})),e))),mquery}var mysql={},hasRequiredMysql;function requireMysql(){if(hasRequiredMysql)return mysql;hasRequiredMysql=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();return t({name:"mysql",file:"lib/Connection.js",versions:[">=2"]},(t=>{const n=e("apm:mysql:query:start"),i=e("apm:mysql:query:finish"),a=e("apm:mysql:query:error");return s.wrap(t.prototype,"query",(e=>function(){if(!n.hasSubscribers)return e.apply(this,arguments);const t={sql:arguments[0].sql||arguments[0],conf:this.config},s=new r("bound-anonymous-fn"),o=new r("bound-anonymous-fn");return o.runInAsyncScope((()=>{n.publish(t),arguments[0].sql?arguments[0].sql=t.sql:arguments[0]=t.sql;try{const t=e.apply(this,arguments);if(t._callback){const e=s.bind(t._callback);t._callback=o.bind((function(t,r){return t&&a.publish(t),i.publish(r),e.apply(this,arguments)}))}else{const e=o.bind((function(){i.publish(void 0)}));t.on("end",e)}return t}catch(e){throw e.stack,a.publish(e),e}}))})),t})),t({name:"mysql",file:"lib/Pool.js",versions:[">=2"]},(t=>{const n=e("datadog:mysql:pool:query:start"),i=e("datadog:mysql:pool:query:finish");return s.wrap(t.prototype,"getConnection",(e=>function(t){return arguments[0]=r.bind(t),e.apply(this,arguments)})),s.wrap(t.prototype,"query",(e=>function(){if(!n.hasSubscribers)return e.apply(this,arguments);const t=new r("bound-anonymous-fn"),a=arguments[0].sql||arguments[0];return t.runInAsyncScope((()=>{n.publish({sql:a});const r=t.bind((function(){i.publish()})),o=arguments[arguments.length-1];"function"==typeof o&&(arguments[arguments.length-1]=s.wrap(o,(function(){return r(),o.apply(this,arguments)})));const c=e.apply(this,arguments);return c&&c.then&&c.then(r).catch(r),c}))})),t})),mysql}var mysql2={},hasRequiredMysql2;function requireMysql2(){if(hasRequiredMysql2)return mysql2;hasRequiredMysql2=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();return t({name:"mysql2",file:"lib/connection.js",versions:[">=1"]},(t=>{const n=e("apm:mysql2:query:start"),i=e("apm:mysql2:query:finish"),a=e("apm:mysql2:query:error");return s.wrap(t.prototype,"addCommand",(e=>function(t){if(!n.hasSubscribers)return e.apply(this,arguments);const s=new r("bound-anonymous-fn"),o=t&&t.constructor&&t.constructor.name,c="function"==typeof t.execute&&("Execute"===o||"Query"===o);return t.execute=c?function(e,t,s,o){const c=new r("bound-anonymous-fn");return s.bind((function(r,u){const l={sql:e.statement?e.statement.query:e.sql,conf:o};if(n.publish(l),e.statement?e.statement.query=l.sql:e.sql=l.sql,this.onResult){const e=c.bind(this.onResult);this.onResult=s.bind((function(t){t&&a.publish(t),i.publish(void 0),e.apply(this,arguments)}),"bound-anonymous-fn",this)}else this.on("error",s.bind((e=>a.publish(e)))),this.on("end",s.bind((()=>i.publish(void 0))));this.execute=t;try{return t.apply(this,arguments)}catch(e){a.publish(e)}}),e)}(t,t.execute,s,this.config):function(e,t,r){return r.bind((function(e,s){return this.onResult&&(this.onResult=r.bind(this.onResult)),t.apply(this,arguments)}),e)}(t,t.execute,s),s.bind(e,this).apply(this,arguments)})),t})),mysql2}var net={},hasRequiredNet;function requireNet(){if(hasRequiredNet)return net;hasRequiredNet=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:net:ipc:start"),i=e("apm:net:ipc:finish"),a=e("apm:net:ipc:error"),o=e("apm:net:tcp:start"),c=e("apm:net:tcp:finish"),u=e("apm:net:tcp:error"),l=e("apm:net:tcp:connection");function p(e){if(e[0])switch(typeof e[0]){case"object":return Array.isArray(e[0])?p(e[0]):e[0];case"string":if(isNaN(parseFloat(e[0])))return{path:e[0]};case"number":return{port:e[0],host:"string"==typeof e[1]?e[1]:"localhost"}}}function d(e,t,r){const s=["connect","error","close","timeout"],n=r.bind((function(e){e&&("ipc"===t?a.publish(e):u.publish(e)),"ipc"===t?i.publish(void 0):c.publish(void 0)})),o=r.bind((function(){l.publish({socket:e})})),p=function(){e.removeListener("connect",o),s.forEach((t=>{e.removeListener(t,n),e.removeListener(t,p)}))};"tcp"===t&&e.once("connect",o),s.forEach((t=>{e.once(t,n),e.once(t,p)}))}return t({name:["net","node:net"]},((e,t,i)=>(s.wrap(e.Socket.prototype,"connect",(e=>function(){if(!n.hasSubscribers||!o.hasSubscribers)return e.apply(this,arguments);const t=p(arguments),s=arguments.length-1,i=arguments[s];if(!t)return e.apply(this,arguments);const c=new r("bound-anonymous-fn"),l=new r("bound-anonymous-fn");"function"==typeof i&&(arguments[s]=c.bind(i));const h=t.path?"ipc":"tcp";return l.runInAsyncScope((()=>{"ipc"===h?(n.publish({options:t}),d(this,"ipc",l)):(o.publish({options:t}),d(this,"tcp",l));const r=this.emit;this.emit=function(e){switch(e){case"ready":case"connect":return c.runInAsyncScope((()=>r.apply(this,arguments)));default:return r.apply(this,arguments)}};try{return e.apply(this,arguments)}catch(e){throw"ipc"===h?a.publish(e):u.publish(e),e}}))})),e))),net}var next={},hasRequiredNext;function requireNext(){if(hasRequiredNext)return next;hasRequiredNext=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer(),{DD_MAJOR:s}=requireVersion(),n=e("apm:next:request:start"),i=e("apm:next:request:finish"),a=e("apm:next:request:error"),o=e("apm:next:page:load"),c=e("apm:next:body-parsed"),u=e("apm:next:query-parsed"),l=new WeakSet,p=new WeakMap,d="x-middleware-invoke";function h(e){return function(t,r,s,n){return q(t,r,(()=>e.apply(this,arguments)))}}function f(e){return function(t,r,s,n){return q(t,r,(()=>e.apply(this,arguments).then((e=>e?this.hasPage(s).then((t=>{const r=t?{page:s}:function(e,t=[]){for(const r of t)if(r.page.startsWith("/api")&&r.match(e))return S(r.page);return S(e)}(s,this.dynamicRoutes);return o.publish(r),e})):e))))}}function g(e){return function(t,r,s,n){return q(t,r,(()=>{const t="object"==typeof n&&"object"==typeof n.definition?n.definition.pathname:void 0;return o.publish({page:t}),e.apply(this,arguments)}))}}function m(e){return function(t,r,s,n,i){return q(t,r,(()=>e.apply(this,arguments)))}}function _(e){return function(t,r,s,n,i){return q(r,s,t,(()=>e.apply(this,arguments)))}}function b(e){return function(t){return q(t.req,t.res,(()=>e.apply(this,arguments)))}}function y(e){return function(t,r){return q(t.req,t.res,r,(()=>e.apply(this,arguments)))}}function v(e){return function(t,r){const s=e.apply(this,arguments);return s&&o.publish(S(t)),s}}function S(e){if("object"!=typeof e)return{page:e};const t=e.isAppPath;return{page:e.pathname||e.page,isAppPath:t}}function q(e,t,r,s){"function"==typeof r&&(s=r,r=null),e=e.originalRequest||e,t=t.originalResponse||t;if(e.headers[d]||l.has(e))return r&&a.publish({error:r}),s();l.add(e);const i={req:e,res:t};return n.runStores(i,(()=>{try{return s(i).then((e=>R(i,e)),(e=>R(i,null,e)))}catch(e){return R(i,null,e)}}))}function E(e){return function(t,r,s){return q(t,r,(()=>(o.hasSubscribers&&s&&o.publish({page:s,isStatic:!0}),e.apply(this,arguments))))}}function R(e,t,r){r&&(e.error=r,a.publish(e));const s=p.get(e.req);if(s&&(e.nextRequest=s),i.publish(e),r)throw r;return t}return t({name:"next",versions:[">=13.3.0"],file:"dist/server/web/spec-extension/adapters/next-request.js"},(e=>(r.wrap(e.NextRequestAdapter,"fromNodeNextRequest",(e=>function(t){const r=e.apply(this,arguments);return p.set(t.originalRequest,r),r})),e))),t({name:"next",versions:[">=11.1"],file:"dist/server/serve-static.js"},(e=>r.wrap(e,"serveStatic",E))),t({name:"next",versions:s>=4?[">=10.2 <11.1"]:[">=9.5 <11.1"],file:"dist/next-server/server/serve-static.js"},(e=>r.wrap(e,"serveStatic",E))),t({name:"next",versions:[">=11.1"],file:"dist/server/next-server.js"},(e=>{const t=e.default;return r.wrap(t.prototype,"handleRequest",h),r.wrap(t.prototype,"renderToResponse",b),r.wrap(t.prototype,"renderErrorToResponse",y),r.wrap(t.prototype,"findPageComponents",v),e})),t({name:"next",versions:[">=13.2"],file:"dist/server/next-server.js"},(e=>{const t=e.default;return r.wrap(t.prototype,"handleApiRequest",g),e})),t({name:"next",versions:[">=11.1 <13.2"],file:"dist/server/next-server.js"},(e=>{const t=e.default;return r.wrap(t.prototype,"handleApiRequest",f),e})),t({name:"next",versions:s>=4?[">=10.2 <11.1"]:[">=9.5 <11.1"],file:"dist/next-server/server/next-server.js"},(e=>{const t=e.default;return r.wrap(t.prototype,"handleRequest",h),r.wrap(t.prototype,"handleApiRequest",f),r.wrap(t.prototype,"renderToHTML",m),r.wrap(t.prototype,"renderErrorToHTML",_),r.wrap(t.prototype,"findPageComponents",v),e})),t({name:"next",versions:[">=13"],file:"dist/server/web/spec-extension/request.js"},(e=>{const t=Object.getOwnPropertyDescriptor(e.NextRequest.prototype,"nextUrl");return r.wrap(t,"get",(function(e){return function(){const t=e.apply(this,arguments);if(u.hasSubscribers){const e={};for(const r of t.searchParams.keys())e[r]||(e[r]=t.searchParams.getAll(r));u.publish({query:e})}return t}})),Object.defineProperty(e.NextRequest.prototype,"nextUrl",t),r.massWrap(e.NextRequest.prototype,["text","json"],(function(e){return async function(){const t=await e.apply(this,arguments);return c.publish({body:t}),t}})),r.wrap(e.NextRequest.prototype,"formData",(function(e){return async function(){const t=await e.apply(this,arguments);let r=t;return"function"==typeof t.entries&&(r=Object.fromEntries(t.entries())),c.publish({body:r}),t}})),e})),next}var oracledb={},hasRequiredOracledb;function requireOracledb(){if(hasRequiredOracledb)return oracledb;hasRequiredOracledb=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=new WeakMap,i=new WeakMap,a=e("apm:oracledb:query:start"),o=e("apm:oracledb:query:error"),c=e("apm:oracledb:query:finish");function u(e){e&&o.publish(e),c.publish(void 0)}return t({name:"oracledb",versions:["5"]},(e=>(s.wrap(e.Connection.prototype,"execute",(e=>function(t,...s){if(!a.hasSubscribers)return e.apply(this,arguments);if(arguments.length&&"function"==typeof arguments[arguments.length-1]){const e=arguments[arguments.length-1],t=new r("apm:oracledb:outer-scope");arguments[arguments.length-1]=function(r,s){return u(r),t.runInAsyncScope((()=>e.apply(this,arguments)))}}return new r("apm:oracledb:inner-scope").runInAsyncScope((()=>{const r=n.get(this);a.publish({query:t,connAttrs:r});try{let t=e.apply(this,arguments);return t&&"function"==typeof t.then&&(t=t.then((e=>(u(),e)),(e=>{throw u(e),e}))),t}catch(e){throw o.publish(e),e}}))})),s.wrap(e,"getConnection",(e=>function(t,r){if(!r)return e.apply(this,arguments).then((e=>(n.set(e,t),e)));arguments[1]=(e,s)=>{s&&n.set(s,t),r(e,s)},e.apply(this,arguments)})),s.wrap(e,"createPool",(e=>function(t,r){if(!r)return e.apply(this,arguments).then((e=>(i.set(e,t),e)));arguments[1]=(e,s)=>{s&&i.set(s,t),r(e,s)},e.apply(this,arguments)})),s.wrap(e.Pool.prototype,"getConnection",(e=>function(){let t;if("function"==typeof arguments[arguments.length-1]&&(t=arguments[arguments.length-1]),!t)return e.apply(this,arguments).then((e=>(n.set(e,i.get(this)),e)));arguments[arguments.length-1]=(e,r)=>{r&&n.set(r,i.get(this)),t(e,r)},e.apply(this,arguments)})),e))),oracledb}var openai={},hasRequiredOpenai;function requireOpenai(){if(hasRequiredOpenai)return openai;hasRequiredOpenai=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer(),s=e("apm:openai:request:start"),n=e("apm:openai:request:finish"),i=e("apm:openai:request:error");return t({name:"openai",file:"dist/api.js",versions:[">=3.0.0 <4"]},(e=>{const t=Object.getOwnPropertyNames(e.OpenAIApi.prototype);t.shift();for(const a of t)r.wrap(e.OpenAIApi.prototype,a,(e=>function(){return s.hasSubscribers?(s.publish({methodName:a,args:arguments,basePath:this.basePath,apiKey:this.configuration.apiKey}),e.apply(this,arguments).then((e=>(n.publish({headers:e.headers,body:e.data,path:e.request.path,method:e.request.method}),e))).catch((e=>{throw i.publish({err:e}),e}))):e.apply(this,arguments)}));return e})),openai}var paperplane={},hasRequiredPaperplane;function requirePaperplane(){if(hasRequiredPaperplane)return paperplane;hasRequiredPaperplane=1;const{addHook:e,channel:t}=requireInstrument(),r=requireDatadogShimmer(),s=t("apm:paperplane:log"),n=t("apm:paperplane:request:handle"),i=t("apm:paperplane:request:route"),a=Number(process.versions.node.split(".")[0]),o="paperplane",c=a<=12?[">=2.3.2"]:a<=14?[">=3.1.1"]:[],u=e=>t=>{const{original:r,route:s}=t;return i.hasSubscribers&&i.publish({req:r,route:s}),e(t)},l=e=>t=>{const r={message:t};return s.publish(r),e(r.message)},p=e=>t=>{const r=e(t);return function(e,t){return n.publish(e),r.apply(this,arguments)}},d=e=>t=>{const r={};for(const e in t)r[e]=u(t[e]);return e(r)};return e({name:o,versions:c,file:"lib/logger.js"},(e=>(r.wrap(e,"logger",l),e))),e({name:o,versions:c,file:"lib/mount.js"},(e=>(r.wrap(e,"mount",p),e))),e({name:o,versions:c,file:"lib/routes.js"},(e=>(r.wrap(e,"routes",d),e))),a<=12&&e({name:o,versions:["2.3.0 - 2.3.1"]},(e=>(r.wrap(e,"mount",p),r.wrap(e,"routes",d),e))),paperplane}var passportHttp={},passportUtils,hasRequiredPassportUtils,hasRequiredPassportHttp;function requirePassportUtils(){if(hasRequiredPassportUtils)return passportUtils;hasRequiredPassportUtils=1;const e=requireDatadogShimmer(),{channel:t}=requireInstrument(),r=t("datadog:passport:verify:finish");function s(t,s,n,i){return r.hasSubscribers?e.wrap(n,(function(e,s,a){const o={type:i,username:t};return r.publish({credentials:o,user:s}),n.apply(this,arguments)})):n}return passportUtils={wrapVerify:function(e,t,r){return t?function(t,n,i,a){return arguments[3]=s(n,0,a,r),e.apply(this,arguments)}:function(t,n,i){return arguments[2]=s(t,0,i,r),e.apply(this,arguments)}}},passportUtils}function requirePassportHttp(){if(hasRequiredPassportHttp)return passportHttp;hasRequiredPassportHttp=1;const e=requireDatadogShimmer(),{addHook:t}=requireInstrument(),{wrapVerify:r}=requirePassportUtils();return t({name:"passport-http",file:"lib/passport-http/strategies/basic.js",versions:[">=0.3.0"]},(t=>e.wrap(t,(function(){const e="http";return"function"==typeof arguments[0]?arguments[0]=r(arguments[0],!1,e):arguments[1]=r(arguments[1],arguments[0]&&arguments[0].passReqToCallback,e),t.apply(this,arguments)})))),passportHttp}var passportLocal={},hasRequiredPassportLocal;function requirePassportLocal(){if(hasRequiredPassportLocal)return passportLocal;hasRequiredPassportLocal=1;const e=requireDatadogShimmer(),{addHook:t}=requireInstrument(),{wrapVerify:r}=requirePassportUtils();return t({name:"passport-local",file:"lib/strategy.js",versions:[">=1.0.0"]},(t=>e.wrap(t,(function(){const e="local";return"function"==typeof arguments[0]?arguments[0]=r(arguments[0],!1,e):arguments[1]=r(arguments[1],arguments[0]&&arguments[0].passReqToCallback,e),t.apply(this,arguments)})))),passportLocal}var pg={},hasRequiredPg;function requirePg(){if(hasRequiredPg)return pg;hasRequiredPg=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n=e("apm:pg:query:start"),i=e("apm:pg:query:finish"),a=e("apm:pg:query:error"),o=e("datadog:pg:pool:query:start"),c=e("datadog:pg:pool:query:finish");function u(e){return function(){if(!n.hasSubscribers)return e.apply(this,arguments);const t=new r("bound-anonymous-fn"),s=new r("bound-anonymous-fn"),o=this.processID,c=arguments[0]&&"object"==typeof arguments[0]?arguments[0]:{text:arguments[0]},u=Object.getOwnPropertyDescriptor(c,"text");if(!u||u.configurable){const e=c.text;Object.defineProperty(c,"text",{get(){return this?.__ddInjectableQuery||e}})}return s.runInAsyncScope((()=>{n.publish({params:this.connectionParameters,query:c,processId:o}),arguments[0]=c;const r=s.bind((function(e){e&&a.publish(e),i.publish()})),u=e.apply(this,arguments),l=this.queryQueue||this._queryQueue,p=this.activeQuery||this._activeQuery,d=l[l.length-1]||p;if(!d)return u;if(d.callback){const e=t.bind(d.callback);d.callback=function(t,s){return r(t),e.apply(this,arguments)}}else d.once?d.once("error",r).once("end",(()=>r())):d.then((()=>r()),r);try{return u}catch(e){a.publish(e)}}))}}return t({name:"pg",versions:[">=8.0.3"]},(e=>(s.wrap(e.Client.prototype,"query",(e=>u(e))),s.wrap(e.Pool.prototype,"query",(e=>function(e){return function(){if(!o.hasSubscribers)return e.apply(this,arguments);const t=new r("bound-anonymous-fn"),n=arguments[0]&&"object"==typeof arguments[0]?arguments[0]:{text:arguments[0]};return t.runInAsyncScope((()=>{o.publish({query:n});const r=t.bind((function(){c.publish()})),i=arguments[arguments.length-1];"function"==typeof i&&(arguments[arguments.length-1]=s.wrap(i,(function(){return r(),i.apply(this,arguments)})));const a=e.apply(this,arguments);return a&&a.then&&a.then((()=>{r()})).catch((()=>{r()})),a}))}}(e))),e))),t({name:"pg",file:"lib/native/index.js",versions:[">=8.0.3"]},(e=>(s.wrap(e.prototype,"query",(e=>u(e))),e))),pg}var pino={},hasRequiredPino;function requirePino(){if(hasRequiredPino)return pino;hasRequiredPino=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer();function s(e,t,r){return function(){const s=r.apply(this,arguments);return Object.defineProperty(s,e,{configurable:!0,enumerable:!0,writable:!0,value:t(s[e])}),s}}function n(t){const r=e("apm:pino:log");return function(e,s,n,i){const a={message:e=arguments[0]=e||{}};return r.publish(a),arguments[0]=a.message,t.apply(this,arguments)}}function i(t){const r=e("apm:pino:log");return function(){let e={};t&&(e=t.apply(this,arguments));const s={message:e};return r.publish(s),s.message}}function a(t){const r=e("apm:pino:log");return function(e){const s={message:e.input};return r.publish(s),e.input=s.message,t.apply(this,arguments)}}return t({name:"pino",versions:["2 - 3","4",">=5 <5.14.0"]},(e=>{const t=e.symbols&&e.symbols.asJsonSym||"asJson";return r.wrap(e,s(t,n,e))})),t({name:"pino",versions:[">=5.14.0 <6.8.0"]},(e=>{const t=e.symbols.mixinSym;return r.wrap(e,s(t,i,e))})),t({name:"pino",versions:[">=6.8.0"]},(e=>{const t=e.symbols.mixinSym,n=r.wrap(e,s(t,i,e));return n.pino=n,n.default=n,n})),t({name:"pino-pretty",file:"lib/utils.js",versions:[">=3"]},(e=>(r.wrap(e,"prettifyObject",a),e))),t({name:"pino-pretty",versions:["1 - 2"]},(t=>r.wrap(t,function(t){const r=e("apm:pino:log");return function(){const e=t.apply(this,arguments);return function(t){const s={message:t};return r.publish(s),arguments[0]=s.message,e.apply(this,arguments)}}}(t)))),pino}var promiseJs={},hasRequiredPromiseJs;function requirePromiseJs(){if(hasRequiredPromiseJs)return promiseJs;hasRequiredPromiseJs=1;const{addHook:e}=requireInstrument(),{wrapThen:t}=requirePromise$1(),r=requireDatadogShimmer();return e({name:"promise-js",versions:[">=0.0.3"]},(e=>(e!==commonjsGlobal.Promise&&r.wrap(e.prototype,"then",t),e))),promiseJs}var promise={},hasRequiredPromise;function requirePromise(){if(hasRequiredPromise)return promise;hasRequiredPromise=1;const{addHook:e}=requireInstrument(),{wrapThen:t}=requirePromise$1(),r=requireDatadogShimmer();return e({name:"promise",file:"lib/core.js",versions:[">=7"]},(e=>(r.wrap(e.prototype,"then",t),e))),promise}var q={},hasRequiredQ;function requireQ(){if(hasRequiredQ)return q;hasRequiredQ=1;const{addHook:e}=requireInstrument(),{wrapThen:t}=requirePromise$1(),r=requireDatadogShimmer();return e({name:"q",versions:["1"]},(e=>(r.wrap(e.makePromise.prototype,"then",t),e))),e({name:"q",versions:[">=2"]},(e=>(r.wrap(e.Promise.prototype,"then",t),e))),q}var qs={},hasRequiredQs;function requireQs(){if(hasRequiredQs)return qs;hasRequiredQs=1;const{addHook:e,channel:t}=requireInstrument(),r=requireDatadogShimmer(),s=t("datadog:qs:parse:finish");function n(e){return function(){const t=e.apply(this,arguments);return s.hasSubscribers&&t&&s.publish({qs:t}),t}}return e({name:"qs",versions:[">=1"]},(e=>(r.wrap(e,"parse",n),e))),qs}var restify={},hasRequiredRestify;function requireRestify(){if(hasRequiredRestify)return restify;hasRequiredRestify=1;const e=requireDatadogShimmer(),{addHook:t,channel:r}=requireInstrument(),s=["use","pre"],n=["del","get","head","opts","post","put","patch"],i=r("apm:restify:request:handle"),a=r("apm:restify:middleware:error"),o=r("apm:restify:middleware:enter"),c=r("apm:restify:middleware:exit"),u=r("apm:restify:middleware:finish"),l=r("apm:restify:middleware:next");function p(e){return function(t,r){return i.publish({req:t,res:r}),e.apply(this,arguments)}}function d(e){return function(t){const r=f(Array.prototype.slice.call(arguments,1));return e.apply(this,[t].concat(r))}}function h(e){return function(){return e.apply(this,f(arguments))}}function f(e){return Array.prototype.map.call(e,g)}function g(e){return Array.isArray(e)?f(e):function(t,r,s){"function"==typeof s&&(arguments[2]=function(e,t){return function(){l.publish({req:e}),u.publish({req:e}),t.apply(this,arguments)}}(t,s));const n=t.route&&t.route.path;o.publish({req:t,route:n});try{const r=e.apply(this,arguments);return r&&"object"==typeof r&&"function"==typeof r.then?r.then((function(){return l.publish({req:t}),u.publish({req:t}),arguments[0]})).catch((function(e){throw a.publish({req:t,error:e}),l.publish({req:t}),u.publish({req:t}),e})):r}catch(e){throw a.publish({req:t,error:e}),l.publish({req:t}),u.publish({req:t}),e}finally{c.publish({req:t})}}}return t({name:"restify",versions:[">=3"],file:"lib/server.js"},(t=>(e.wrap(t.prototype,"_setupRequest",p),e.massWrap(t.prototype,s,h),e.massWrap(t.prototype,n,d),t))),restify}var rhea={exports:{}},hasRequiredRhea;function requireRhea(){return hasRequiredRhea||(hasRequiredRhea=1,function(e,t){const{channel:r,addHook:s,AsyncResource:n}=requireInstrument(),i=requireDatadogShimmer(),a=Symbol("circularBufferConstructor"),o=Symbol("inFlightDeliveries"),c=new WeakSet,u=r("apm:rhea:send:start"),l=r("apm:rhea:send:encode"),p=r("apm:rhea:send:error"),d=r("apm:rhea:send:finish"),h=r("apm:rhea:receive:start"),f=r("apm:rhea:receive:dispatch"),g=r("apm:rhea:receive:error"),m=r("apm:rhea:receive:finish"),_=new WeakMap;function b(e){return e.connection&&e.session&&e.session.outgoing}function y(e,t){let r=e[o];r||(r=new Set,e[o]=r),r.add(t)}s({name:"rhea",versions:[">=1"]},(e=>(i.wrap(e.message,"encode",(e=>function(t){return l.publish(t),e.apply(this,arguments)})),e))),s({name:"rhea",versions:[">=1"],file:"lib/link.js"},(e=>{const t=e.Sender,r=e.Receiver;return i.wrap(t.prototype,"send",(e=>function(t,r,s){if(!b(this))return e.apply(this,arguments);const{host:i,port:a}=function(e){let t,r;e&&e.options&&(t=e.options.host,r=e.options.port);return{host:t,port:r}}(this.connection),o=this.options&&this.options.target&&this.options.target.address?this.options.target.address:void 0,c=new n("bound-anonymous-fn");return c.runInAsyncScope((()=>{u.publish({targetAddress:o,host:i,port:a,msg:t});const r=e.apply(this,arguments),s={asyncResource:c,connection:this.connection};_.set(r,s),y(this.connection,r);try{return r}catch(e){throw p.publish(e),e}}))})),i.wrap(r.prototype,"dispatch",(e=>function(t,r){if(!b(this))return e.apply(this,arguments);if("message"===t&&r){const t=new n("bound-anonymous-fn");return t.runInAsyncScope((()=>{if(h.publish({msgObj:r,connection:this.connection}),r.delivery){const e={asyncResource:t,connection:this.connection};_.set(r.delivery,e),r.delivery.update=function(e,t){const r=_.get(e),s=r.asyncResource;if(e&&s){const e=s.bind(t);return n.bind((function(t,r){const s=function(e){if(e&&e.descriptor&&e.descriptor)switch(e.descriptor.value){case 36:return"accepted";case 37:return"rejected";case 38:return"released";case 39:return"modified"}}(r);return f.publish({state:s}),e.apply(this,arguments)}))}return function(e,r){return t.apply(this,arguments)}}(r.delivery,r.delivery.update),y(this.connection,r.delivery)}try{return e.apply(this,arguments)}catch(e){throw g.publish(e),e}}))}return e.apply(this,arguments)})),e})),s({name:"rhea",versions:[">=1"],file:"lib/connection.js"},(e=>(i.wrap(e.prototype,"dispatch",(e=>function(r,s){if("disconnected"===r){const e=s.error||this.saved_error;this[o]&&this[o].forEach((r=>{const s=_.get(r),n=s&&s.asyncResource;n&&n.runInAsyncScope((()=>{g.publish(e),t.beforeFinish(r,null),m.publish()}))}))}return e.apply(this,arguments)})),e))),s({name:"rhea",versions:[">=1"],file:"lib/session.js"},(e=>{var r;return r=e.prototype,Object.defineProperty(r,"outgoing",{configurable:!0,get(){},set(e){if(delete r.outgoing,this.outgoing=e,e){let s;if(e.deliveries&&(s=e.deliveries.constructor),s&&!c.has(s.prototype)){i.wrap(s.prototype,"pop_if",(e=>function(r){return arguments[0]=n.bind((function(e){const s=_.get(e),n=s&&s.asyncResource;if(!n)return r(e);const i=n.runInAsyncScope((()=>r(e)));if(i){const r=e.remote_state,s=r&&r.constructor?e.remote_state.constructor.composite_type:void 0;n.runInAsyncScope((()=>{t.beforeFinish(e,s),d.publish()}))}return i})),e.apply(this,arguments)})),c.add(s.prototype);const e=r.constructor;e&&(e[a]=s)}}}}),e})),e.exports.inFlightDeliveries=o,e.exports.beforeFinish=function(e,t){const r=_.get(e);r&&(t&&f.publish({state:t}),r.connection&&r.connection[o]&&r.connection[o].delete(e))},e.exports.contexts=_}(rhea,rhea.exports)),rhea.exports}var sharedb={},hasRequiredSharedb;function requireSharedb(){if(hasRequiredSharedb)return sharedb;hasRequiredSharedb=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer(),n={hs:"handshake",qf:"query-fetch",qs:"query-subscribe",qu:"query-unsubscribe",bf:"bulk-fetch",bs:"bulk-subscribe",bu:"bulk-unsubscribe",f:"fetch",s:"subscribe",u:"unsubscribe",op:"op",nf:"snapshot-fetch",nt:"snapshot-fetch-by-ts",p:"presence-broadcast",pr:"presence-request",ps:"presence-subscribe",pu:"presence-unsubscribe"};return t({name:"sharedb",versions:[">=1"],file:"lib/agent.js"},(t=>{const i=e("apm:sharedb:request:start"),a=e("apm:sharedb:request:finish"),o=e("apm:sharedb:request:error");return s.wrap(t.prototype,"_handleMessage",(e=>function(t,s){const c=new r("bound-anonymous-fn"),u=new r("bound-anonymous-fn"),l=function(e){const t=n[e];if(void 0===t)return e;return t}(t.a);return u.runInAsyncScope((()=>{i.publish({actionName:l,request:t}),s=c.bind(s),arguments[1]=u.bind((function(e,r){return e&&o.publish(e),a.publish({request:t,res:r}),s.apply(this,arguments)}));try{return e.apply(this,arguments)}catch(e){throw o.publish(e),e}}))})),t})),sharedb}var sequelize={},hasRequiredSequelize;function requireSequelize(){if(hasRequiredSequelize)return sequelize;hasRequiredSequelize=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();return t({name:"sequelize",versions:[">=4"]},(t=>{const n=e("datadog:sequelize:query:start"),i=e("datadog:sequelize:query:finish");return s.wrap(t.prototype,"query",(e=>function(t){if(!n.hasSubscribers)return e.apply(this,arguments);const s=new r("bound-anonymous-fn");let a;function o(){s.bind((function(){i.publish()}),this).apply(this)}return this.options&&this.options.dialect?a=this.options.dialect:this.dialect&&this.dialect.name&&(a=this.dialect.name),s.bind((function(){n.publish({sql:t,dialect:a});const r=e.apply(this,arguments);return r.then(o,o),r}),this).apply(this,arguments)})),t})),sequelize}var tedious={},hasRequiredTedious;function requireTedious(){if(hasRequiredTedious)return tedious;hasRequiredTedious=1;const{channel:e,addHook:t,AsyncResource:r}=requireInstrument(),s=requireDatadogShimmer();return t({name:"tedious",versions:[">=1.0.0"]},(t=>{const n=e("apm:tedious:request:start"),i=e("apm:tedious:request:finish"),a=e("apm:tedious:request:error");return s.wrap(t.Connection.prototype,"makeRequest",(e=>function(t){if(!n.hasSubscribers)return e.apply(this,arguments);const s=function(e){if(!e.parameters)return;const t=e.parametersByName.statement||e.parametersByName.stmt;if(!t)return e.sqlTextOrProcedure;return t.value}(t);if(!s)return e.apply(this,arguments);const o=new r("bound-anonymous-fn"),c=new r("bound-anonymous-fn"),u=this.config;return c.runInAsyncScope((()=>{n.publish({queryOrProcedure:s,connectionConfig:u});const r=o.bind(t.callback,t);t.callback=c.bind((function(e){return e&&a.publish(e),i.publish(void 0),r.apply(this,arguments)}),null,t);try{return e.apply(this,arguments)}catch(e){throw a.publish(e),e}}))})),t})),tedious}var when={},hasRequiredWhen;function requireWhen(){if(hasRequiredWhen)return when;hasRequiredWhen=1;const{addHook:e}=requireInstrument(),{wrapThen:t}=requirePromise$1(),r=requireDatadogShimmer();return e({name:"when",file:"lib/Promise.js",versions:[">=3"]},(e=>(r.wrap(e.prototype,"then",t),e))),when}var winston={},hasRequiredWinston,hooks,hasRequiredHooks;function requireWinston(){if(hasRequiredWinston)return winston;hasRequiredWinston=1;const{channel:e,addHook:t}=requireInstrument(),r=requireDatadogShimmer(),s=new WeakSet;function n(e,t){return function(){const r=e.apply(this,arguments);if(t.hasSubscribers)for(const e in this.transports){const r=this.transports[e];if(s.has(r)||"function"!=typeof r.log)continue;const n=r.log;r.log=function(e,r,s,i){const a={message:s||{}};t.publish(a),arguments[2]=a.message,n.apply(this,arguments)},s.add(r)}return r}}return t({name:"winston",file:"lib/winston/logger.js",versions:[">=3"]},(t=>{const s=e("apm:winston:log");return r.wrap(t.prototype,"write",(e=>function(t,r,n){if(s.hasSubscribers){const e={message:t};s.publish(e),arguments[0]=e.message}return e.apply(this,arguments)})),t})),t({name:"winston",file:"lib/winston/logger.js",versions:["1","2"]},(t=>{const s=e("apm:winston:log");return t.Logger.prototype.configure&&r.wrap(t.Logger.prototype,"configure",(e=>n(e,s))),r.wrap(t.Logger.prototype,"add",(e=>n(e,s))),t})),winston}function requireHooks(){return hasRequiredHooks?hooks:(hasRequiredHooks=1,hooks={"@apollo/server":()=>requireApolloServer(),"apollo-server-core":()=>requireApolloServerCore(),"@aws-sdk/smithy-client":()=>requireAwsSdk(),"@cucumber/cucumber":()=>requireCucumber(),"@playwright/test":()=>requirePlaywright(),"@elastic/elasticsearch":()=>requireElasticsearch(),"@elastic/transport":()=>requireElasticsearch(),"@google-cloud/pubsub":()=>requireGoogleCloudPubsub(),"@graphql-tools/executor":()=>requireGraphql$1(),"@grpc/grpc-js":()=>requireGrpc(),"@hapi/hapi":()=>requireHapi(),"@jest/core":()=>requireJest(),"@jest/reporters":()=>requireJest(),"@jest/test-sequencer":()=>requireJest(),"@jest/transform":()=>requireJest(),"@koa/router":()=>requireKoa(),"@node-redis/client":()=>requireRedis(),"@opensearch-project/opensearch":()=>requireOpensearch(),"@opentelemetry/sdk-trace-node":()=>requireOtelSdkTrace(),"@redis/client":()=>requireRedis(),"@smithy/smithy-client":()=>requireAwsSdk(),aerospike:()=>requireAerospike(),amqp10:()=>requireAmqp10(),amqplib:()=>requireAmqplib(),"aws-sdk":()=>requireAwsSdk(),bluebird:()=>requireBluebird(),"body-parser":()=>requireBodyParser(),bunyan:()=>requireBunyan(),"cassandra-driver":()=>requireCassandraDriver(),child_process:()=>requireChild_process(),connect:()=>requireConnect(),cookie:()=>requireCookie(),"cookie-parser":()=>requireCookieParser(),couchbase:()=>requireCouchbase(),crypto:()=>requireCrypto(),cypress:()=>requireCypress(),dns:()=>requireDns(),elasticsearch:()=>requireElasticsearch(),express:()=>requireExpress(),"express-mongo-sanitize":()=>requireExpressMongoSanitize(),fastify:()=>requireFastify(),"find-my-way":()=>requireFindMyWay(),fs:()=>requireFs(),"generic-pool":()=>requireGenericPool(),graphql:()=>requireGraphql$1(),grpc:()=>requireGrpc(),hapi:()=>requireHapi(),http:()=>requireHttp(),http2:()=>requireHttp2(),https:()=>requireHttp(),ioredis:()=>requireIoredis(),"jest-circus":()=>requireJest(),"jest-config":()=>requireJest(),"jest-environment-node":()=>requireJest(),"jest-environment-jsdom":()=>requireJest(),"jest-jasmine2":()=>requireJest(),"jest-worker":()=>requireJest(),knex:()=>requireKnex(),koa:()=>requireKoa(),"koa-router":()=>requireKoa(),kafkajs:()=>requireKafkajs(),ldapjs:()=>requireLdapjs(),"limitd-client":()=>requireLimitdClient(),mariadb:()=>requireMariadb(),memcached:()=>requireMemcached(),"microgateway-core":()=>requireMicrogatewayCore(),mocha:()=>requireMocha(),"mocha-each":()=>requireMocha(),moleculer:()=>requireMoleculer(),mongodb:()=>requireMongodb(),"mongodb-core":()=>requireMongodbCore(),mongoose:()=>requireMongoose(),mquery:()=>requireMquery(),mysql:()=>requireMysql(),mysql2:()=>requireMysql2(),net:()=>requireNet(),next:()=>requireNext(),"node:child_process":()=>requireChild_process(),"node:crypto":()=>requireCrypto(),"node:dns":()=>requireDns(),"node:http":()=>requireHttp(),"node:http2":()=>requireHttp2(),"node:https":()=>requireHttp(),"node:net":()=>requireNet(),oracledb:()=>requireOracledb(),openai:()=>requireOpenai(),paperplane:()=>requirePaperplane(),"passport-http":()=>requirePassportHttp(),"passport-local":()=>requirePassportLocal(),pg:()=>requirePg(),pino:()=>requirePino(),"pino-pretty":()=>requirePino(),playwright:()=>requirePlaywright(),"promise-js":()=>requirePromiseJs(),promise:()=>requirePromise(),q:()=>requireQ(),qs:()=>requireQs(),redis:()=>requireRedis(),restify:()=>requireRestify(),rhea:()=>requireRhea(),router:()=>requireRouter(),sharedb:()=>requireSharedb(),sequelize:()=>requireSequelize(),tedious:()=>requireTedious(),when:()=>requireWhen(),winston:()=>requireWinston()})}var fetch$1={},hasRequiredFetch,hasRequiredRegister,hasRequiredBundlerRegister,hasRequiredDatadogInstrumentations;function requireFetch(){if(hasRequiredFetch)return fetch$1;hasRequiredFetch=1;const e=requireDatadogShimmer(),{channel:t}=requireInstrument(),r=t("apm:fetch:request:start"),s=t("apm:fetch:request:finish"),n=t("apm:fetch:request:error");return globalThis.fetch&&(globalThis.fetch=e.wrap(fetch,function(e,t){return"function"!=typeof e?e:function(i,a){if(!r.hasSubscribers)return e.apply(this,arguments);const o=new t(i,a),c={req:o,headers:o.headers};return r.runStores(c,(()=>(arguments[0]=c.req,arguments[1]={headers:c.headers},e.apply(this,arguments).then((e=>(c.res=e,s.publish(c),e)),(e=>{throw"AbortError"!==e.name&&(c.error=e,n.publish(c)),s.publish(c),e})))))}}(fetch,globalThis.Request))),fetch$1}function requireRegister(){return hasRequiredRegister||(hasRequiredRegister=1,function(e){const{channel:t}=requireDcPolyfill(),r=require$$0$1,s=requireSemver(),n=requireHook(),i=requireRequirePackageJson(),a=requireLog$2(),{DD_TRACE_DISABLED_INSTRUMENTATIONS:o=""}=process.env,c=requireHooks(),u=requireInstrumentations(),l=Object.keys(c),p=new RegExp(`\\${r.sep}`,"g"),d=new Set(o?o.split(","):[]),h=t("dd-trace:instrumentation:load");d.has("fetch")||requireFetch();const f=Symbol("hookExportsMap");for(const e of l)d.has(e)||n([e],((t,r,s,n)=>{if(r=r.replace(p,"/"),c[e](),!u[e])return t;for(const{name:i,file:o,versions:c,hook:l}of u[e]){const e=_(i,o);if(l[f]||(l[f]=new WeakMap),r===e){const e=n||m(s);if(g(e,c)){if(l[f].has(t))return t;try{h.publish({name:i,version:e,file:o}),t=l(t,e,i),l[f].set(t,i)}catch(e){a.error(e)}}}}return t}));function g(e,t){return!e||t&&t.some((t=>s.satisfies(s.coerce(e),t)))}function m(t){if(t)return i(t,e).version}function _(e,t){return[e,t].filter((e=>e)).join("/")}e.exports={filename:_,pathSepExpr:p,loadChannel:h,matchVersion:g}}(register$1)),register$1.exports}function requireBundlerRegister(){if(hasRequiredBundlerRegister)return bundlerRegister;hasRequiredBundlerRegister=1;const e=requireDcPolyfill(),{filename:t,loadChannel:r,matchVersion:s}=requireRegister(),n=requireHooks(),i=requireInstrumentations(),a=requireLog$2();return e.subscribe||(e.subscribe=(t,r)=>{e.channel(t).subscribe(r)}),e.unsubscribe||(e.unsubscribe=(t,r)=>{e.channel(t).hasSubscribers&&e.channel(t).unsubscribe(r)}),e.subscribe("dd-trace:bundler:load",(e=>{try{n[e.package]()}catch(t){throw a.error(`esbuild-wrapped ${e.package} missing in list of hooks`),t}if(i[e.package]){for(const{name:n,file:o,versions:c,hook:u}of i[e.package])if(e.path===t(n,o)&&s(e.version,c))try{r.publish({name:n,version:e.version,file:o}),e.module=u(e.module,e.version)}catch(e){a.error(e)}}else a.error(`esbuild-wrapped ${e.package} missing in list of instrumentations`)})),bundlerRegister}function requireDatadogInstrumentations(){return hasRequiredDatadogInstrumentations||(hasRequiredDatadogInstrumentations=1,requireBundlerRegister(),requireRegister()),datadogInstrumentations}register$1.exports;var lambda={},patch={},handler={},errors,hasRequiredErrors,hasRequiredHandler,hasRequiredPatch,ritm,hasRequiredRitm,hasRequiredLambda,src$2,hasRequiredSrc$2,plugin_manager,hasRequiredPlugin_manager,activation,hasRequiredActivation,apply_states,hasRequiredApply_states,scheduler,hasRequiredScheduler,manager,hasRequiredManager,capabilities,hasRequiredCapabilities,api_security_sampler,hasRequiredApi_security_sampler,telemetry$1,hasRequiredTelemetry$1,reporter,hasRequiredReporter,addresses,hasRequiredAddresses,waf_context_wrapper,hasRequiredWaf_context_wrapper,nativeAppsec,hasRequiredNativeAppsec,waf_manager,hasRequiredWaf_manager,waf_1,hasRequiredWaf,blocked_templates,hasRequiredBlocked_templates,blocking,hasRequiredBlocking;function requireErrors(){if(hasRequiredErrors)return errors;hasRequiredErrors=1;class e extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class t extends e{}return t.prototype.name="Impending Timeout",errors={ImpendingTimeout:t}}function requireHandler(){if(hasRequiredHandler)return handler;hasRequiredHandler=1;const e=requireLog$2(),{channel:t}=requireInstrument(),{ERROR_MESSAGE:r,ERROR_TYPE:s}=requireConstants$2(),{ImpendingTimeout:n}=requireErrors(),i=commonjsGlobal._ddtrace._tracer,a=t("apm:aws:lambda:timeout");let o;return a.subscribe((t=>{!function(){const t=i.scope().active();if(null!==t){const e=new n("Datadog detected an impending timeout");t.addTags({[r]:e.message,[s]:e.name})}else e.debug("An impending timeout was reached, but no root span was found. No error will be tagged.");i._processor.killAll(),null!==t&&t.finish()}()})),handler.datadog=function(e){return(...t)=>{const r=function(e){let t=e.length>1?e[1]:void 0;if((void 0===t||void 0===t.getRemainingTimeInMillis)&&(t=e.length>2?e[2]:void 0,void 0===t||void 0===t.getRemainingTimeInMillis))throw Error("Could not extract context");return t}(t);!function(e){const t=e.getRemainingTimeInMillis();let r=parseInt(process.env.DD_APM_FLUSH_DEADLINE_MILLISECONDS)||100;r=r<0?100:r,o=setTimeout((()=>{a.publish(void 0)}),t-r)}(r);const s=e.apply(this,t);return s&&"function"==typeof s.then?s.then((e=>(clearTimeout(o),e))):s}},handler}function requirePatch(){if(hasRequiredPatch)return patch;hasRequiredPatch=1;const e=require$$0$1,{_extractModuleNameAndHandlerPath:t,_extractModuleRootAndHandler:r,_getLambdaFilePath:s}=requireRitm(),{datadog:n}=requireHandler(),{addHook:i}=requireInstrument(),a=requireDatadogShimmer(),o=e=>(a.wrap(e,"datadog",c),e);function c(e){return t=>e(n(t))}function u(e){return n(e)}const l=process.env.LAMBDA_TASK_ROOT,p=process.env.DD_LAMBDA_HANDLER;if(void 0!==p){const[n,o]=r(p),[c,d]=t(o);i({name:s(e.resolve(l,n,c))},(e=>t=>(a.wrap(t,e,u),t))(d))}else i({name:"datadog-lambda-js"},o);return patch}function requireRitm(){if(hasRequiredRitm)return ritm;hasRequiredRitm=1;const e=require$$0$6,t=require$$0$1,r=requireLog$2(),s=requireHook(),n=requireInstrumentations(),{filename:i,pathSepExpr:a}=requireRegister();function o(e){const r=t.basename(e);return[e.substring(0,e.indexOf(r)),r]}function c(e){const t=e.match(/^([^.]*)\.(.*)$/);if(t&&3===t.length)return[t[1],t[2]]}function u(t){let r=t;return e.existsSync(t+".js")?r+=".js":e.existsSync(t+".mjs")?r+=".mjs":e.existsSync(t+".cjs")&&(r+=".cjs"),r}return ritm={_extractModuleRootAndHandler:o,_extractModuleNameAndHandlerPath:c,_getLambdaFilePath:u,registerLambdaHook:()=>{const e=process.env.LAMBDA_TASK_ROOT,l=process.env.DD_LAMBDA_HANDLER;if(void 0!==l){const[i,a]=o(l),[p]=c(a),d=u(t.resolve(e,i,p));s([d],(e=>{requirePatch();for(const{hook:t}of n[d])try{e=t(e)}catch(e){r.error(e)}return e}))}else{const e="datadog-lambda-js";s([e],((t,s,o)=>{s=s.replace(a,"/"),requirePatch();for(const{name:a,file:o,hook:c}of n[e]){if(s===i(a,o))try{t=c(t)}catch(e){r.error(e)}}return t}))}}},ritm}function requireLambda(){if(hasRequiredLambda)return lambda;hasRequiredLambda=1;const{registerLambdaHook:e}=requireRitm();return e(),lambda}function requireSrc$2(){if(hasRequiredSrc$2)return src$2;hasRequiredSrc$2=1;const e=requireClient$6();return src$2=class extends e{static get id(){return"fetch"}static get prefix(){return"apm:fetch:request"}addTraceSub(e,t){this.addSub(`apm:${this.constructor.id}:${this.operation}:${e}`,t)}bindStart(e){const t=e.req,r=new URL(t.url),s=r.headers=Object.fromEntries(t.headers.entries());r.method=t.method,e.args={options:r};const n=super.bindStart(e);return e.headers=s,e.req=new globalThis.Request(t,{headers:s}),n}},src$2}function requirePlugin_manager(){if(hasRequiredPlugin_manager)return plugin_manager;hasRequiredPlugin_manager=1;const{channel:e}=requireDcPolyfill(),{isFalse:t}=requireUtil$9(),r=requirePlugins(),s=requireLog$2(),n=requireServiceNaming(),i=e("dd-trace:instrumentation:load");requireDatadogInstrumentations(),void 0!==process.env.AWS_LAMBDA_FUNCTION_NAME&&requireLambda();const{DD_TRACE_DISABLED_PLUGINS:a}=process.env,o=new Set(a&&a.split(",").map((e=>e.trim()))),c={};function u(e){if(e&&"function"==typeof e&&!c[e.id]){const r=`DD_TRACE_${e.id.toUpperCase()}_ENABLED`,n=process.env[r.replace(/[^a-z0-9_]/gi,"_")];t(n)||o.has(e.id)?(s.debug(`Plugin "${e.id}" was disabled via configuration option.`),c[e.id]=null):c[e.id]=e}}return i.subscribe((({name:e})=>{u(r[e])})),u(requireSrc$2()),plugin_manager=class{constructor(e){this._tracer=e,this._tracerConfig=null,this._pluginsByName={},this._configsByName={},this._loadedSubscriber=({name:e})=>{const t=r[e];t&&"function"==typeof t&&this.loadPlugin(t.id)},i.subscribe(this._loadedSubscriber)}loadPlugin(e){const t=c[e];if(!t)return;if(!this._tracerConfig)return;this._pluginsByName[e]||(this._pluginsByName[e]=new t(this._tracer,this._tracerConfig));const r=this._configsByName[e]||{enabled:!1!==this._tracerConfig.plugins};this._pluginsByName[e].configure({...this._getSharedConfig(e),...r})}configurePlugin(e,t){const r=this._isEnabled(t);this._configsByName[e]={...t,enabled:r},this.loadPlugin(e)}configure(e={}){this._tracerConfig=e,n.configure(e);for(const e in c)this.loadPlugin(e)}destroy(){for(const e in this._pluginsByName)this._pluginsByName[e].configure({enabled:!1});i.unsubscribe(this._loadedSubscriber)}_isEnabled(e){return"boolean"==typeof e?e:!e||!1!==e.enabled}_getSharedConfig(e){const{logInjection:t,serviceMapping:r,queryStringObfuscation:s,site:n,url:i,headerTags:a,dbmPropagationMode:o,dsmEnabled:c,clientIpEnabled:u,memcachedCommandEnabled:l}=this._tracerConfig,p={};return void 0!==t&&(p.logInjection=t),void 0!==s&&(p.queryStringObfuscation=s),p.dbmPropagationMode=o,p.dsmEnabled=c,p.memcachedCommandEnabled=l,r&&r[e]&&(p.service=r[e]),void 0!==u&&(p.clientIpEnabled=u),p.site=n,p.url=i,p.headers=a||[],p}},plugin_manager}function requireActivation(){if(hasRequiredActivation)return activation;hasRequiredActivation=1;const e={ONECLICK:"OneClick",ENABLED:"Enabled",DISABLED:"Disabled",fromConfig(t){switch(t.appsec.enabled){case!0:return e.ENABLED;case!1:return e.DISABLED;case void 0:return e.ONECLICK;default:return e.DISABLED}}};return activation=e}function requireApply_states(){return hasRequiredApply_states?apply_states:(hasRequiredApply_states=1,apply_states={UNACKNOWLEDGED:1,ACKNOWLEDGED:2,ERROR:3})}function requireScheduler(){if(hasRequiredScheduler)return scheduler;hasRequiredScheduler=1;return scheduler=class{constructor(e,t){this._timer=null,this._callback=e,this._interval=t}start(){this._timer||this.runAfterDelay(0)}runAfterDelay(e=this._interval){this._timer=setTimeout(this._callback,e,(()=>this.runAfterDelay())),this._timer.unref&&this._timer.unref()}stop(){clearTimeout(this._timer),this._timer=null}}}function requireManager(){if(hasRequiredManager)return manager;hasRequiredManager=1;const{URL:e,format:t}=require$$0$8,r=requireCryptoRandomuuid(),{EventEmitter:s}=require$$0$f,n=require$$6.version,i=requireRequest(),a=requireLog$2(),{getExtraServices:o}=requireExtraServices(),{UNACKNOWLEDGED:c,ACKNOWLEDGED:u,ERROR:l}=requireApply_states(),p=requireScheduler(),d=r(),h=Buffer.alloc(1).toString("base64"),f=Symbol("kPreUpdate");class g extends s{static get kPreUpdate(){return f}constructor(r){super();const s=Math.floor(1e3*r.remoteConfig.pollInterval);this.url=r.url||new e(t({protocol:"http:",hostname:r.hostname||"localhost",port:r.port})),this.scheduler=new p((e=>this.poll(e)),s),this.state={client:{state:{root_version:1,targets_version:0,config_states:[],has_error:!1,error:"",backend_client_state:""},id:d,products:[],is_tracer:!0,client_tracer:{runtime_id:r.tags["runtime-id"],language:"node",tracer_version:n,service:r.service,env:r.env,app_version:r.version,extra_services:[]},capabilities:h},cached_target_files:[]},this.appliedConfigs=new Map}updateCapabilities(e,t){const r=Buffer.from(this.state.client.capabilities,"base64").toString("hex");let s=BigInt(`0x${r}`);t?s|=e:s&=~e;let n=s.toString(16);n.length%2&&(n=`0${n}`),this.state.client.capabilities=Buffer.from(n,"hex").toString("base64")}on(e,t){return super.on(e,t),this.updateProducts(),this.state.client.products.length&&this.scheduler.start(),this}off(e,t){return super.off(e,t),this.updateProducts(),this.state.client.products.length||this.scheduler.stop(),this}updateProducts(){this.state.client.products=this.eventNames().filter((e=>"string"==typeof e))}getPayload(){return this.state.client.client_tracer.extra_services=o(),JSON.stringify(this.state)}poll(e){const t={url:this.url,method:"POST",path:"/v0.7/config"};i(this.getPayload(),t,((t,r,s)=>{if(404===s)return e();if(t)return a.error(t),e();if(this.state.client.state.has_error&&(this.state.client.state.has_error=!1,this.state.client.state.error=""),r&&"{}"!==r)try{this.parseConfig(JSON.parse(r))}catch(t){a.error(`Could not parse remote config response: ${t}`),this.state.client.state.has_error=!0,this.state.client.state.error=t.toString()}e()}))}parseConfig({client_configs:e=[],targets:t,target_files:r=[]}){const s=[],n=[],i=[];for(const t of this.appliedConfigs.values())e.includes(t.path)||s.push(t);if(t=m(t)){for(const s of e){const e=t.signed.targets[s];if(!e)throw new Error(`Unable to find target for path ${s}`);const a=this.appliedConfigs.get(s),o={};if(a){if(a.hashes.sha256===e.hashes.sha256)continue;i.push(o)}else n.push(o);const u=r.find((e=>e.path===s));if(!u)throw new Error(`Unable to find file for path ${s}`);const{product:l,id:p}=b(s);Object.assign(o,{path:s,product:l,id:p,version:e.custom.v,apply_state:c,apply_error:"",length:e.length,hashes:e.hashes,file:m(u.raw)})}this.state.client.state.targets_version=t.signed.version,this.state.client.state.backend_client_state=t.signed.custom.opaque_backend_state}if(s.length||n.length||i.length){this.emit(g.kPreUpdate,{toUnapply:s,toApply:n,toModify:i}),this.dispatch(s,"unapply"),this.dispatch(n,"apply"),this.dispatch(i,"modify"),this.state.client.state.config_states=[],this.state.cached_target_files=[];for(const e of this.appliedConfigs.values())this.state.client.state.config_states.push({id:e.id,version:e.version,product:e.product,apply_state:e.apply_state,apply_error:e.apply_error}),this.state.cached_target_files.push({path:e.path,length:e.length,hashes:Object.entries(e.hashes).map((e=>({algorithm:e[0],hash:e[1]})))})}}dispatch(e,t){for(const r of e){if(r.apply_state===c||"unapply"===t)try{this.emit(r.product,t,r.file,r.id)&&(r.apply_state=u)}catch(e){r.apply_state=l,r.apply_error=e.toString()}"unapply"===t?this.appliedConfigs.delete(r.path):this.appliedConfigs.set(r.path,r)}}}function m(e){return e?JSON.parse(Buffer.from(e,"base64").toString()):null}const _=/^(?:datadog\/\d+|employee)\/([^/]+)\/([^/]+)\/[^/]+$/;function b(e){const t=_.exec(e);if(!t||!t[1]||!t[2])throw new Error(`Unable to parse path ${e}`);return{product:t[1],id:t[2]}}return manager=g}function requireCapabilities(){return hasRequiredCapabilities?capabilities:(hasRequiredCapabilities=1,capabilities={ASM_ACTIVATION:2n,ASM_IP_BLOCKING:4n,ASM_DD_RULES:8n,ASM_EXCLUSIONS:16n,ASM_REQUEST_BLOCKING:32n,ASM_USER_BLOCKING:128n,ASM_CUSTOM_RULES:256n,ASM_CUSTOM_BLOCKING_RESPONSE:512n,ASM_TRUSTED_IPS:1024n,ASM_API_SECURITY_SAMPLE_RATE:2048n,APM_TRACING_SAMPLE_RATE:4096n,APM_TRACING_LOGS_INJECTION:8192n,APM_TRACING_HTTP_HEADER_TAGS:16384n,APM_TRACING_CUSTOM_TAGS:32768n,APM_TRACING_ENABLED:1n<<19n})}function requireApi_security_sampler(){if(hasRequiredApi_security_sampler)return api_security_sampler;hasRequiredApi_security_sampler=1;const e=requireLog$2();let t,r;const s=new WeakSet;function n(t){r=function(t){let r=parseFloat(t);isNaN(r)?(e.warn(`Incorrect API Security request sampling value: ${t}`),r=0):r=Math.min(1,Math.max(0,r));return r}(t)}return api_security_sampler={configure:function({apiSecurity:e}){t=e.enabled,n(e.requestSampling)},disable:function(){t=!1},setRequestSampling:n,sampleRequest:function(e){if(!t||!r)return!1;const n=Math.random()<=r;return n&&s.add(e),n},isSampled:function(e){return s.has(e)}}}function requireTelemetry$1(){if(hasRequiredTelemetry$1)return telemetry$1;hasRequiredTelemetry$1=1;const e=requireMetrics().manager.namespace("appsec"),t=Symbol("_dd.appsec.telemetry.waf.result.tags"),r={REQUEST_BLOCKED:"request_blocked",RULE_TRIGGERED:"rule_triggered",WAF_TIMEOUT:"waf_timeout",WAF_VERSION:"waf_version",EVENT_RULES_VERSION:"event_rules_version"},s=new WeakMap;let n=!1;function i(e){let t=s.get(e);return t||(t={},s.set(e,t)),t}function a(e,t){return{[r.WAF_VERSION]:e,[r.EVENT_RULES_VERSION]:t}}return telemetry$1={enable:function(e){n=e?.enabled&&e.metrics},disable:function(){n=!1},updateWafRequestsMetricTags:function(s,o){if(!o||!n)return;const c=a(s.wafVersion,s.rulesVersion);!function(t,r){t.duration&&e.distribution("waf.duration",r).track(t.duration),t.durationExt&&e.distribution("waf.duration_ext",r).track(t.durationExt)}(s,c);const u=function(e,s){const n=i(e);let a=n[t];return a||(a={[r.REQUEST_BLOCKED]:!1,[r.RULE_TRIGGERED]:!1,[r.WAF_TIMEOUT]:!1,...s},n[t]=a),a}(o,c),{blockTriggered:l,ruleTriggered:p,wafTimeout:d}=s;return l&&(u[r.REQUEST_BLOCKED]=l),p&&(u[r.RULE_TRIGGERED]=p),d&&(u[r.WAF_TIMEOUT]=d),u},incrementWafInitMetric:function(t,r){if(!n)return;const s=a(t,r);e.count("waf.init",s).inc()},incrementWafUpdatesMetric:function(t,r){if(!n)return;const s=a(t,r);e.count("waf.updates",s).inc()},incrementWafRequestsMetric:function(r){if(!r||!n)return;const a=i(r)[t];a&&e.count("waf.requests",a).inc(),s.delete(r)}},telemetry$1}function requireReporter(){if(hasRequiredReporter)return reporter;hasRequiredReporter=1;const e=requireRate_limiter(),{storage:t}=requireDatadogCore(),r=requireWeb(),{ipHeaderList:s}=requireIp_extractor(),{incrementWafInitMetric:n,updateWafRequestsMetricTags:i,incrementWafUpdatesMetric:a,incrementWafRequestsMetric:o}=requireTelemetry$1(),c=require$$5;let u=new e(100);const l=new Map,p=["content-encoding","content-language","content-length","content-type"],d=f(["accept","accept-encoding","accept-language","host","forwarded","user-agent","via","x-amzn-trace-id",...s,...p],"http.request.headers."),h=f(p,"http.response.headers.");function f(e,t){return new Map(e.map((e=>[e,`${t}${m(e)}`])))}function g(e,t){const r={};if(!e)return r;for(const[s,n]of t){const t=e[s];t&&(r[n]=""+t)}return r}function m(e){return e.trim().slice(0,200).replace(/[^a-zA-Z0-9_\-:/]/g,"_").toLowerCase()}return reporter={metricsQueue:l,filterHeaders:g,formatHeaderName:m,reportWafInit:function(e,t,r={}){l.set("_dd.appsec.waf.version",e),l.set("_dd.appsec.event_rules.loaded",r.loaded?.length||0),l.set("_dd.appsec.event_rules.error_count",r.failed?.length||0),r.failed?.length&&l.set("_dd.appsec.event_rules.errors",JSON.stringify(r.errors)),l.set("manual.keep","true"),n(e,t)},reportMetrics:function(e){const s=t.getStore(),n=s?.req&&r.root(s.req);n&&(e.duration&&n.setTag("_dd.appsec.waf.duration",e.duration),e.durationExt&&n.setTag("_dd.appsec.waf.duration_ext",e.durationExt),e.rulesVersion&&n.setTag("_dd.appsec.event_rules.version",e.rulesVersion),i(e,s.req))},reportAttack:function(e){const s=t.getStore(),n=s?.req,i=r.root(n);if(!i)return;const a=i.context()._tags,o=g(n.headers,d);o["appsec.event"]="true",u.isAllowed()&&(o["manual.keep"]="true"),a["_dd.origin"]||(o["_dd.origin"]="appsec");const c=a["_dd.appsec.json"];o["_dd.appsec.json"]=c?c.slice(0,-2)+","+e.slice(1)+"}":'{"triggers":'+e+"}";const l=o["http.request.headers.user-agent"];l&&(o["http.useragent"]=l),o["network.client.ip"]=n.socket.remoteAddress,i.addTags(o)},reportWafUpdate:a,reportSchemas:function(e){if(!e)return;const s=t.getStore()?.req,n=r.root(s);if(!n)return;const i={};for(const[t,r]of Object.entries(e)){const e=c.gzipSync(JSON.stringify(r));i[t]=e.toString("base64")}n.addTags(i)},finishRequest:function(e,t){const s=r.root(e);if(!s)return;if(l.size&&(s.addTags(Object.fromEntries(l)),l.clear()),o(e),!s.context()._tags["appsec.event"])return;const n=g(t.getHeaders(),h);e.route&&"string"==typeof e.route.path&&(n["http.endpoint"]=e.route.path),s.addTags(n)},setRateLimit:function(t){u=new e(t)},mapHeaderAndTags:f},reporter}function requireAddresses(){return hasRequiredAddresses?addresses:(hasRequiredAddresses=1,addresses={HTTP_INCOMING_BODY:"server.request.body",HTTP_INCOMING_QUERY:"server.request.query",HTTP_INCOMING_HEADERS:"server.request.headers.no_cookies",HTTP_INCOMING_URL:"server.request.uri.raw",HTTP_INCOMING_METHOD:"server.request.method",HTTP_INCOMING_PARAMS:"server.request.path_params",HTTP_INCOMING_COOKIES:"server.request.cookies",HTTP_INCOMING_RESPONSE_CODE:"server.response.status",HTTP_INCOMING_RESPONSE_HEADERS:"server.response.headers.no_cookies",HTTP_INCOMING_GRAPHQL_RESOLVERS:"graphql.server.all_resolvers",HTTP_INCOMING_GRAPHQL_RESOLVER:"graphql.server.resolver",HTTP_OUTGOING_BODY:"server.response.body",HTTP_CLIENT_IP:"http.client_ip",USER_ID:"usr.id",WAF_CONTEXT_PROCESSOR:"waf.context.processor"})}function requireWaf_context_wrapper(){if(hasRequiredWaf_context_wrapper)return waf_context_wrapper;hasRequiredWaf_context_wrapper=1;const e=requireLog$2(),t=requireReporter(),r=requireAddresses(),s=new Set([r.HTTP_INCOMING_QUERY]);return waf_context_wrapper=class{constructor(e,t,r,s){this.ddwafContext=e,this.wafTimeout=t,this.wafVersion=r,this.rulesVersion=s,this.addressesToSkip=new Set}run({persistent:r,ephemeral:n}){const i={};let a=!1;const o={},c=new Set(this.addressesToSkip);if(r&&"object"==typeof r)for(const e of Object.keys(r))this.addressesToSkip.has(e)||(o[e]=r[e],s.has(e)&&c.add(e));if(Object.keys(o).length&&(i.persistent=o,a=!0),n&&Object.keys(n).length&&(i.ephemeral=n,a=!0),a)try{const e=process.hrtime.bigint(),r=this.ddwafContext.run(i,this.wafTimeout),s=process.hrtime.bigint();this.addressesToSkip=c;const n=!!r.events?.length,a=r.actions?.includes("block");return t.reportMetrics({duration:r.totalRuntime/1e3,durationExt:parseInt(s-e)/1e3,rulesVersion:this.rulesVersion,ruleTriggered:n,blockTriggered:a,wafVersion:this.wafVersion,wafTimeout:r.timeout}),n&&t.reportAttack(JSON.stringify(r.events)),t.reportSchemas(r.derivatives),r.actions}catch(t){e.error("Error while running the AppSec WAF"),e.error(t)}}dispose(){this.ddwafContext.dispose()}}}function requireNativeAppsec(){return hasRequiredNativeAppsec?nativeAppsec:(hasRequiredNativeAppsec=1,nativeAppsec=requireNodeGypBuild()(__dirname))}function requireWaf_manager(){if(hasRequiredWaf_manager)return waf_manager;hasRequiredWaf_manager=1;const e=requireLog$2(),t=requireReporter(),r=requireWaf_context_wrapper(),s=new WeakMap;return waf_manager=class{constructor(e,r){this.config=r,this.wafTimeout=r.wafTimeout,this.ddwaf=this._loadDDWAF(e),this.ddwafVersion=this.ddwaf.constructor.version(),this.rulesVersion=this.ddwaf.diagnostics.ruleset_version,t.reportWafInit(this.ddwafVersion,this.rulesVersion,this.ddwaf.diagnostics.rules)}_loadDDWAF(t){try{const{DDWAF:e}=requireNativeAppsec(),{obfuscatorKeyRegex:r,obfuscatorValueRegex:s}=this.config;return new e(t,{obfuscatorKeyRegex:r,obfuscatorValueRegex:s})}catch(t){throw e.error("AppSec could not load native package. In-app WAF features will not be available."),t}}getWAFContext(e){let t=s.get(e);return t||(t=new r(this.ddwaf.createContext(),this.wafTimeout,this.ddwafVersion,this.rulesVersion),s.set(e,t)),t}update(e){this.ddwaf.update(e),t.reportWafUpdate(this.ddwafVersion,this.rulesVersion)}destroy(){this.ddwaf&&this.ddwaf.dispose()}},waf_manager}function requireWaf(){if(hasRequiredWaf)return waf_1;hasRequiredWaf=1;const{storage:e}=requireDatadogCore(),t=requireLog$2(),r={wafManager:null,init:function(e,t){s();const a=requireWaf_manager();r.wafManager=new a(e,t),r.run=n,r.disposeContext=i},destroy:s,update:function(e){if(!r.wafManager)throw new Error("Cannot update disabled WAF");try{r.wafManager.update(e)}catch(e){throw t.error("Could not apply rules from remote config"),e}},run:a,disposeContext:a};function s(){r.wafManager&&(r.wafManager.destroy(),r.wafManager=null),r.run=a,r.disposeContext=a}function n(s,n){if(!n){const r=e.getStore();if(!r||!r.req)return void t.warn("Request object not available in waf.run");n=r.req}return r.wafManager.getWAFContext(n).run(s)}function i(e){const t=r.wafManager.getWAFContext(e);t&&!t.ddwafContext.disposed&&t.dispose()}function a(){}return waf_1=r}function requireBlocked_templates(){if(hasRequiredBlocked_templates)return blocked_templates;hasRequiredBlocked_templates=1;return blocked_templates={html:'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>You\'ve been blocked</title><style>a,body,div,html,span{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}body{background:-webkit-radial-gradient(26% 19%,circle,#fff,#f4f7f9);background:radial-gradient(circle at 26% 19%,#fff,#f4f7f9);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-line-pack:center;align-content:center;width:100%;min-height:100vh;line-height:1;flex-direction:column}p{display:block}main{text-align:center;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-line-pack:center;align-content:center;flex-direction:column}p{font-size:18px;line-height:normal;color:#646464;font-family:sans-serif;font-weight:400}a{color:#4842b7}footer{width:100%;text-align:center}footer p{font-size:16px}</style></head><body><main><p>Sorry, you cannot access this page. Please contact the customer service team.</p></main><footer><p>Security provided by <a href="https://www.datadoghq.com/product/security-platform/application-security-monitoring/" target="_blank">Datadog</a></p></footer></body></html>',json:'{"errors":[{"title":"You\'ve been blocked","detail":"Sorry, you cannot access this page. Please contact the customer service team. Security provided by Datadog."}]}',graphqlJson:'{"errors":[{"message":"You\'ve been blocked","extensions":{"detail":"Sorry, you cannot perform this operation. Please contact the customer service team. Security provided by Datadog."}}]}'}}function requireBlocking(){if(hasRequiredBlocking)return blocking;hasRequiredBlocking=1;const e=requireLog$2(),t=requireBlocked_templates(),r={};let s,n=t.html,i=t.json,a=t.graphqlJson;const o={GRAPHQL:"graphql"};function c(e,t){return`${e}+${t}`}function u(e,t,u){let l,p,d;const h=t||r[c(e.method,e.url)];if(h){const e=function(e){if(e===o.GRAPHQL)return{type:"application/json",body:a}}(h);l=e?.type,p=e?.body}if(!l){const t=e.headers.accept?.split(",").map((e=>e.split(";",1)[0].trim()));s&&"auto"!==s.parameters.type?"html"===s.parameters.type?(l="text/html; charset=utf-8",p=n):(l="application/json",p=i):t?.includes("text/html")&&!t.includes("application/json")?(l="text/html; charset=utf-8",p=n):(l="application/json",p=i)}d="block_request"===s?.type&&s.parameters.status_code?s.parameters.status_code:403;const f={"Content-Type":l,"Content-Length":Buffer.byteLength(p)};return u.addTags({"appsec.blocked":"true"}),{body:p,statusCode:d,headers:f}}function l(e,t,r){return"redirect_request"===s?.type&&s.parameters.location?function(e){let t=s.parameters.status_code;(!t||t<300||t>=400)&&(t=303);const r={Location:s.parameters.location};return e.addTags({"appsec.blocked":"true"}),{headers:r,statusCode:t}}(r):u(e,t,r)}return blocking={addSpecificEndpoint:function(e,t,s){r[c(e,t)]=s},block:function(t,r,s,n,i){if(r.headersSent)return void e.warn("Cannot send blocking response when headers have already been sent");const{body:a,headers:o,statusCode:c}=l(t,i,s);r.writeHead(c,o).end(a),n?.abort()},specificBlockingTypes:o,getBlockingData:l,setTemplates:function(e){n=e.appsec.blockedTemplateHtml?e.appsec.blockedTemplateHtml:t.html,i=e.appsec.blockedTemplateJson?e.appsec.blockedTemplateJson:t.json,a=e.appsec.blockedTemplateGraphql?e.appsec.blockedTemplateGraphql:t.graphqlJson},updateBlockingConfiguration:function(e){s=e}},blocking}var version$3="2.2",metadata={rules_version:"1.10.0"},rules=[{id:"blk-001-001",name:"Block IP Addresses",tags:{type:"block_ip",category:"security_response"},conditions:[{parameters:{inputs:[{address:"http.client_ip"}],data:"blocked_ips"},operator:"ip_match"}],transformers:[],on_match:["block"]},{id:"blk-001-002",name:"Block User Addresses",tags:{type:"block_user",category:"security_response"},conditions:[{parameters:{inputs:[{address:"usr.id"}],data:"blocked_users"},operator:"exact_match"}],transformers:[],on_match:["block"]},{id:"crs-913-110",name:"Acunetix",tags:{type:"commercial_scanner",crs_id:"913110",category:"attack_attempt",tool_name:"Acunetix",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies"}],list:["acunetix-product","(acunetix web vulnerability scanner","acunetix-scanning-agreement","acunetix-user-agreement","md5(acunetix_wvs_security_test)"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-913-120",name:"Known security scanner filename/argument",tags:{type:"security_scanner",crs_id:"913120",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["/.adsensepostnottherenonobook","/<invalid>hello.html","/actsensepostnottherenonotive","/acunetix-wvs-test-for-some-inexistent-file","/antidisestablishmentarianism","/appscan_fingerprint/mac_address","/arachni-","/cybercop","/nessus_is_probing_you_","/nessustest","/netsparker-","/rfiinc.txt","/thereisnowaythat-you-canbethere","/w3af/remotefileinclude.html","appscan_fingerprint","w00tw00t.at.isc.sans.dfind","w00tw00t.at.blackhats.romanian.anti-sec"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-920-260",name:"Unicode Full/Half Width Abuse Attack Attempt",tags:{type:"http_protocol_violation",crs_id:"920260",category:"attack_attempt",cwe:"176",capec:"1000/255/153/267/71",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\%u[fF]{2}[0-9a-fA-F]{2}",options:{case_sensitive:!0,min_length:6}},operator:"match_regex"}],transformers:[]},{id:"crs-921-110",name:"HTTP Request Smuggling Attack",tags:{type:"http_protocol_violation",crs_id:"921110",category:"attack_attempt",cwe:"444",capec:"1000/210/272/220/33"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],regex:"(?:get|post|head|options|connect|put|delete|trace|track|patch|propfind|propatch|mkcol|copy|move|lock|unlock)\\s+[^\\s]+\\s+http/\\d",options:{case_sensitive:!0,min_length:12}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-921-160",name:"HTTP Header Injection Attack via payload (CR/LF and header-name detected)",tags:{type:"http_protocol_violation",crs_id:"921160",category:"attack_attempt",cwe:"113",capec:"1000/210/272/220/105"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.path_params"}],regex:"[\\n\\r]+(?:refresh|(?:set-)?cookie|(?:x-)?(?:forwarded-(?:for|host|server)|via|remote-ip|remote-addr|originating-IP))\\s*:",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-930-100",name:"Obfuscated Path Traversal Attack (/../)",tags:{type:"lfi",crs_id:"930100",category:"attack_attempt",cwe:"22",capec:"1000/255/153/126",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.headers.no_cookies"}],regex:"(?:%(?:c(?:0%(?:[2aq]f|5c|9v)|1%(?:[19p]c|8s|af))|2(?:5(?:c(?:0%25af|1%259c)|2f|5c)|%46|f)|(?:(?:f(?:8%8)?0%8|e)0%80%a|bg%q)f|%3(?:2(?:%(?:%6|4)6|F)|5%%63)|u(?:221[56]|002f|EFC8|F025)|1u|5c)|0x(?:2f|5c)|\\/|\\x5c)(?:%(?:(?:f(?:(?:c%80|8)%8)?0%8|e)0%80%ae|2(?:(?:5(?:c0%25a|2))?e|%45)|u(?:(?:002|ff0)e|2024)|%32(?:%(?:%6|4)5|E)|c0(?:%[256aef]e|\\.))|\\.(?:%0[01])?|0x2e){2,3}(?:%(?:c(?:0%(?:[2aq]f|5c|9v)|1%(?:[19p]c|8s|af))|2(?:5(?:c(?:0%25af|1%259c)|2f|5c)|%46|f)|(?:(?:f(?:8%8)?0%8|e)0%80%a|bg%q)f|%3(?:2(?:%(?:%6|4)6|F)|5%%63)|u(?:221[56]|002f|EFC8|F025)|1u|5c)|0x(?:2f|5c)|\\/|\\x5c)",options:{min_length:4}},operator:"match_regex"}],transformers:["normalizePath"]},{id:"crs-930-110",name:"Simple Path Traversal Attack (/../)",tags:{type:"lfi",crs_id:"930110",category:"attack_attempt",cwe:"22",capec:"1000/255/153/126",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.headers.no_cookies"}],regex:"(?:(?:^|[\\x5c/])\\.{2,3}[\\x5c/]|[\\x5c/]\\.{2,3}(?:[\\x5c/]|$))",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-930-120",name:"OS File Access Attempt",tags:{type:"lfi",crs_id:"930120",category:"attack_attempt",cwe:"22",capec:"1000/255/153/126",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["/.htaccess","/.htdigest","/.htpasswd","/.addressbook","/.aptitude/config",".aws/config",".aws/credentials","/.bash_config","/.bash_history","/.bash_logout","/.bash_profile","/.bashrc",".cache/notify-osd.log",".config/odesk/odesk team.conf","/.cshrc","/.dockerignore",".drush/","/.eslintignore","/.fbcindex","/.forward","/.git",".git/","/.gitattributes","/.gitconfig",".gnupg/",".hplip/hplip.conf","/.ksh_history","/.lesshst",".lftp/","/.lhistory","/.lldb-history",".local/share/mc/","/.lynx_cookies","/.my.cnf","/.mysql_history","/.nano_history","/.node_repl_history","/.pearrc","/.pgpass","/.php_history","/.pinerc",".pki/","/.proclog","/.procmailrc","/.psql_history","/.python_history","/.rediscli_history","/.rhistory","/.rhosts","/.sh_history","/.sqlite_history",".ssh/authorized_keys",".ssh/config",".ssh/id_dsa",".ssh/id_dsa.pub",".ssh/id_rsa",".ssh/id_rsa.pub",".ssh/identity",".ssh/identity.pub",".ssh/id_ecdsa",".ssh/id_ecdsa.pub",".ssh/known_hosts",".subversion/auth",".subversion/config",".subversion/servers",".tconn/tconn.conf","/.tcshrc",".vidalia/vidalia.conf","/.viminfo","/.vimrc","/.www_acl","/.wwwacl","/.xauthority","/.zhistory","/.zshrc","/.zsh_history","/.nsconfig","data/elasticsearch","data/kafka","etc/ansible","etc/bind","etc/centos-release","etc/centos-release-upstream","etc/clam.d","etc/elasticsearch","etc/freshclam.conf","etc/gshadow","etc/gshadow-","etc/httpd","etc/kafka","etc/kibana","etc/logstash","etc/lvm","etc/mongod.conf","etc/my.cnf","etc/nuxeo.conf","etc/pki","etc/postfix","etc/scw-release","etc/subgid","etc/subgid-","etc/sudoers.d","etc/sysconfig","etc/system-release-cpe","opt/nuxeo","opt/tomcat","tmp/kafka-logs","usr/lib/rpm/rpm.log","var/data/elasticsearch","var/lib/elasticsearch","etc/.java","etc/acpi","etc/alsa","etc/alternatives","etc/apache2","etc/apm","etc/apparmor","etc/apparmor.d","etc/apport","etc/apt","etc/asciidoc","etc/avahi","etc/bash_completion.d","etc/binfmt.d","etc/bluetooth","etc/bonobo-activation","etc/brltty","etc/ca-certificates","etc/calendar","etc/chatscripts","etc/chromium-browser","etc/clamav","etc/cni","etc/console-setup","etc/coraza-waf","etc/cracklib","etc/cron.d","etc/cron.daily","etc/cron.hourly","etc/cron.monthly","etc/cron.weekly","etc/cups","etc/cups.save","etc/cupshelpers","etc/dbus-1","etc/dconf","etc/default","etc/depmod.d","etc/dhcp","etc/dictionaries-common","etc/dkms","etc/dnsmasq.d","etc/dockeretc/dpkg","etc/emacs","etc/environment.d","etc/fail2ban","etc/firebird","etc/firefox","etc/fonts","etc/fwupd","etc/gconf","etc/gdb","etc/gdm3","etc/geoclue","etc/ghostscript","etc/gimp","etc/glvnd","etc/gnome","etc/gnome-vfs-2.0","etc/gnucash","etc/gnustep","etc/groff","etc/grub.d","etc/gss","etc/gtk-2.0","etc/gtk-3.0","etc/hp","etc/ifplugd","etc/imagemagick-6","etc/init","etc/init.d","etc/initramfs-tools","etc/insserv.conf.d","etc/iproute2","etc/iptables","etc/java","etc/java-11-openjdk","etc/java-17-oracle","etc/java-8-openjdk","etc/kernel","etc/ld.so.conf.d","etc/ldap","etc/libblockdev","etc/libibverbs.d","etc/libnl-3","etc/libpaper.d","etc/libreoffice","etc/lighttpd","etc/logcheck","etc/logrotate.d","etc/lynx","etc/mail","etc/mc","etc/menu","etc/menu-methods","etc/modprobe.d","etc/modsecurity","etc/modules-load.d","etc/monit","etc/mono","etc/mplayer","etc/mpv","etc/muttrc.d","etc/mysql","etc/netplan","etc/network","etc/networkd-dispatcher","etc/networkmanager","etc/newt","etc/nghttpx","etc/nikto","etc/odbcdatasources","etc/openal","etc/openmpi","etc/opt","etc/osync","etc/packagekit","etc/pam.d","etc/pcmcia","etc/perl","etc/php","etc/pki","etc/pm","etc/polkit-1","etc/postfix","etc/ppp","etc/profile.d","etc/proftpd","etc/pulse","etc/python","etc/rc0.d","etc/rc1.d","etc/rc2.d","etc/rc3.d","etc/rc4.d","etc/rc5.d","etc/rc6.d","etc/rcs.d","etc/resolvconf","etc/rsyslog.d","etc/samba","etc/sane.d","etc/security","etc/selinux","etc/sensors.d","etc/sgml","etc/signon-ui","etc/skel","etc/snmp","etc/sound","etc/spamassassin","etc/speech-dispatcher","etc/ssh","etc/ssl","etc/sudoers.d","etc/sysctl.d","etc/sysstat","etc/systemd","etc/terminfo","etc/texmf","etc/thermald","etc/thnuclnt","etc/thunderbird","etc/timidity","etc/tmpfiles.d","etc/ubuntu-advantage","etc/udev","etc/udisks2","etc/ufw","etc/update-manager","etc/update-motd.d","etc/update-notifier","etc/upower","etc/urlview","etc/usb_modeswitch.d","etc/vim","etc/vmware","etc/vmware-installer","etc/vmware-vix","etc/vulkan","etc/w3m","etc/wireshark","etc/wpa_supplicant","etc/x11","etc/xdg","etc/xml","etc/redis.conf","etc/redis-sentinel.conf","etc/php.ini","bin/php.ini","etc/httpd/php.ini","usr/lib/php.ini","usr/lib/php/php.ini","usr/local/etc/php.ini","usr/local/lib/php.ini","usr/local/php/lib/php.ini","usr/local/php4/lib/php.ini","usr/local/php5/lib/php.ini","usr/local/apache/conf/php.ini","etc/php4.4/fcgi/php.ini","etc/php4/apache/php.ini","etc/php4/apache2/php.ini","etc/php5/apache/php.ini","etc/php5/apache2/php.ini","etc/php/php.ini","etc/php/php4/php.ini","etc/php/apache/php.ini","etc/php/apache2/php.ini","web/conf/php.ini","usr/local/zend/etc/php.ini","opt/xampp/etc/php.ini","var/local/www/conf/php.ini","etc/php/cgi/php.ini","etc/php4/cgi/php.ini","etc/php5/cgi/php.ini","home2/bin/stable/apache/php.ini","home/bin/stable/apache/php.ini","etc/httpd/conf.d/php.conf","php5/php.ini","php4/php.ini","php/php.ini","windows/php.ini","winnt/php.ini","apache/php/php.ini","xampp/apache/bin/php.ini","netserver/bin/stable/apache/php.ini","volumes/macintosh_hd1/usr/local/php/lib/php.ini","etc/mono/1.0/machine.config","etc/mono/2.0/machine.config","etc/mono/2.0/web.config","etc/mono/config","usr/local/cpanel/logs/stats_log","usr/local/cpanel/logs/access_log","usr/local/cpanel/logs/error_log","usr/local/cpanel/logs/license_log","usr/local/cpanel/logs/login_log","var/cpanel/cpanel.config","usr/local/psa/admin/logs/httpsd_access_log","usr/local/psa/admin/logs/panel.log","usr/local/psa/admin/conf/php.ini","etc/sw-cp-server/applications.d/plesk.conf","usr/local/psa/admin/conf/site_isolation_settings.ini","usr/local/sb/config","etc/sw-cp-server/applications.d/00-sso-cpserver.conf","etc/sso/sso_config.ini","etc/mysql/conf.d/old_passwords.cnf","var/mysql.log","var/mysql-bin.index","var/data/mysql-bin.index","program files/mysql/mysql server 5.0/data/{host}.err","program files/mysql/mysql server 5.0/data/mysql.log","program files/mysql/mysql server 5.0/data/mysql.err","program files/mysql/mysql server 5.0/data/mysql-bin.log","program files/mysql/mysql server 5.0/data/mysql-bin.index","program files/mysql/data/{host}.err","program files/mysql/data/mysql.log","program files/mysql/data/mysql.err","program files/mysql/data/mysql-bin.log","program files/mysql/data/mysql-bin.index","mysql/data/{host}.err","mysql/data/mysql.log","mysql/data/mysql.err","mysql/data/mysql-bin.log","mysql/data/mysql-bin.index","usr/local/mysql/data/mysql.log","usr/local/mysql/data/mysql.err","usr/local/mysql/data/mysql-bin.log","usr/local/mysql/data/mysql-slow.log","usr/local/mysql/data/mysqlderror.log","usr/local/mysql/data/{host}.err","usr/local/mysql/data/mysql-bin.index","var/lib/mysql/my.cnf","etc/mysql/my.cnf","etc/my.cnf","program files/mysql/mysql server 5.0/my.ini","program files/mysql/mysql server 5.0/my.cnf","program files/mysql/my.ini","program files/mysql/my.cnf","mysql/my.ini","mysql/my.cnf","mysql/bin/my.ini","var/postgresql/log/postgresql.log","usr/internet/pgsql/data/postmaster.log","usr/local/pgsql/data/postgresql.log","usr/local/pgsql/data/pg_log","postgresql/log/pgadmin.log","var/lib/pgsql/data/postgresql.conf","var/postgresql/db/postgresql.conf","var/nm2/postgresql.conf","usr/local/pgsql/data/postgresql.conf","usr/local/pgsql/data/pg_hba.conf","usr/internet/pgsql/data/pg_hba.conf","usr/local/pgsql/data/passwd","usr/local/pgsql/bin/pg_passwd","etc/postgresql/postgresql.conf","etc/postgresql/pg_hba.conf","home/postgres/data/postgresql.conf","home/postgres/data/pg_version","home/postgres/data/pg_ident.conf","home/postgres/data/pg_hba.conf","program files/postgresql/8.3/data/pg_hba.conf","program files/postgresql/8.3/data/pg_ident.conf","program files/postgresql/8.3/data/postgresql.conf","program files/postgresql/8.4/data/pg_hba.conf","program files/postgresql/8.4/data/pg_ident.conf","program files/postgresql/8.4/data/postgresql.conf","program files/postgresql/9.0/data/pg_hba.conf","program files/postgresql/9.0/data/pg_ident.conf","program files/postgresql/9.0/data/postgresql.conf","program files/postgresql/9.1/data/pg_hba.conf","program files/postgresql/9.1/data/pg_ident.conf","program files/postgresql/9.1/data/postgresql.conf","wamp/logs/access.log","wamp/logs/apache_error.log","wamp/logs/genquery.log","wamp/logs/mysql.log","wamp/logs/slowquery.log","wamp/bin/apache/apache2.2.22/logs/access.log","wamp/bin/apache/apache2.2.22/logs/error.log","wamp/bin/apache/apache2.2.21/logs/access.log","wamp/bin/apache/apache2.2.21/logs/error.log","wamp/bin/mysql/mysql5.5.24/data/mysql-bin.index","wamp/bin/mysql/mysql5.5.16/data/mysql-bin.index","wamp/bin/apache/apache2.2.21/conf/httpd.conf","wamp/bin/apache/apache2.2.22/conf/httpd.conf","wamp/bin/apache/apache2.2.21/wampserver.conf","wamp/bin/apache/apache2.2.22/wampserver.conf","wamp/bin/apache/apache2.2.22/conf/wampserver.conf","wamp/bin/mysql/mysql5.5.24/my.ini","wamp/bin/mysql/mysql5.5.24/wampserver.conf","wamp/bin/mysql/mysql5.5.16/my.ini","wamp/bin/mysql/mysql5.5.16/wampserver.conf","wamp/bin/php/php5.3.8/php.ini","wamp/bin/php/php5.4.3/php.ini","xampp/apache/logs/access.log","xampp/apache/logs/error.log","xampp/mysql/data/mysql-bin.index","xampp/mysql/data/mysql.err","xampp/mysql/data/{host}.err","xampp/sendmail/sendmail.log","xampp/apache/conf/httpd.conf","xampp/filezillaftp/filezilla server.xml","xampp/mercurymail/mercury.ini","xampp/php/php.ini","xampp/phpmyadmin/config.inc.php","xampp/sendmail/sendmail.ini","xampp/webalizer/webalizer.conf","opt/lampp/etc/httpd.conf","xampp/htdocs/aca.txt","xampp/htdocs/admin.php","xampp/htdocs/leer.txt","usr/local/apache/logs/audit_log","usr/local/apache2/logs/audit_log","logs/security_debug_log","logs/security_log","usr/local/apache/conf/modsec.conf","usr/local/apache2/conf/modsec.conf","winnt/system32/logfiles/msftpsvc","winnt/system32/logfiles/msftpsvc1","winnt/system32/logfiles/msftpsvc2","windows/system32/logfiles/msftpsvc","windows/system32/logfiles/msftpsvc1","windows/system32/logfiles/msftpsvc2","etc/logrotate.d/proftpd","www/logs/proftpd.system.log","etc/pam.d/proftpd","etc/proftp.conf","etc/protpd/proftpd.conf","etc/vhcs2/proftpd/proftpd.conf","etc/proftpd/modules.conf","etc/vsftpd.chroot_list","etc/logrotate.d/vsftpd.log","etc/vsftpd/vsftpd.conf","etc/vsftpd.conf","etc/chrootusers","var/adm/log/xferlog","etc/wu-ftpd/ftpaccess","etc/wu-ftpd/ftphosts","etc/wu-ftpd/ftpusers","logs/pure-ftpd.log","usr/sbin/pure-config.pl","usr/etc/pure-ftpd.conf","etc/pure-ftpd/pure-ftpd.conf","usr/local/etc/pure-ftpd.conf","usr/local/etc/pureftpd.pdb","usr/local/pureftpd/etc/pureftpd.pdb","usr/local/pureftpd/sbin/pure-config.pl","usr/local/pureftpd/etc/pure-ftpd.conf","etc/pure-ftpd.conf","etc/pure-ftpd/pure-ftpd.pdb","etc/pureftpd.pdb","etc/pureftpd.passwd","etc/pure-ftpd/pureftpd.pdb","usr/ports/ftp/pure-ftpd/pure-ftpd.conf","usr/ports/ftp/pure-ftpd/pureftpd.pdb","usr/ports/ftp/pure-ftpd/pureftpd.passwd","usr/ports/net/pure-ftpd/pure-ftpd.conf","usr/ports/net/pure-ftpd/pureftpd.pdb","usr/ports/net/pure-ftpd/pureftpd.passwd","usr/pkgsrc/net/pureftpd/pure-ftpd.conf","usr/pkgsrc/net/pureftpd/pureftpd.pdb","usr/pkgsrc/net/pureftpd/pureftpd.passwd","usr/ports/contrib/pure-ftpd/pure-ftpd.conf","usr/ports/contrib/pure-ftpd/pureftpd.pdb","usr/ports/contrib/pure-ftpd/pureftpd.passwd","usr/sbin/mudlogd","etc/muddleftpd/mudlog","etc/muddleftpd.com","etc/muddleftpd/mudlogd.conf","etc/muddleftpd/muddleftpd.conf","usr/sbin/mudpasswd","etc/muddleftpd/muddleftpd.passwd","etc/muddleftpd/passwd","etc/logrotate.d/ftp","etc/ftpchroot","etc/ftphosts","etc/ftpusers","winnt/system32/logfiles/smtpsvc","winnt/system32/logfiles/smtpsvc1","winnt/system32/logfiles/smtpsvc2","winnt/system32/logfiles/smtpsvc3","winnt/system32/logfiles/smtpsvc4","winnt/system32/logfiles/smtpsvc5","windows/system32/logfiles/smtpsvc","windows/system32/logfiles/smtpsvc1","windows/system32/logfiles/smtpsvc2","windows/system32/logfiles/smtpsvc3","windows/system32/logfiles/smtpsvc4","windows/system32/logfiles/smtpsvc5","etc/osxhttpd/osxhttpd.conf","system/library/webobjects/adaptors/apache2.2/apache.conf","etc/apache2/sites-available/default","etc/apache2/sites-available/default-ssl","etc/apache2/sites-enabled/000-default","etc/apache2/sites-enabled/default","etc/apache2/apache2.conf","etc/apache2/ports.conf","usr/local/etc/apache/httpd.conf","usr/pkg/etc/httpd/httpd.conf","usr/pkg/etc/httpd/httpd-default.conf","usr/pkg/etc/httpd/httpd-vhosts.conf","etc/httpd/mod_php.conf","etc/httpd/extra/httpd-ssl.conf","etc/rc.d/rc.httpd","usr/local/apache/conf/httpd.conf.default","usr/local/apache/conf/access.conf","usr/local/apache22/conf/httpd.conf","usr/local/apache22/httpd.conf","usr/local/etc/apache22/conf/httpd.conf","usr/local/apps/apache22/conf/httpd.conf","etc/apache22/conf/httpd.conf","etc/apache22/httpd.conf","opt/apache22/conf/httpd.conf","usr/local/etc/apache2/vhosts.conf","usr/local/apache/conf/vhosts.conf","usr/local/apache2/conf/vhosts.conf","usr/local/apache/conf/vhosts-custom.conf","usr/local/apache2/conf/vhosts-custom.conf","etc/apache/default-server.conf","etc/apache2/default-server.conf","usr/local/apache2/conf/extra/httpd-ssl.conf","usr/local/apache2/conf/ssl.conf","etc/httpd/conf.d","usr/local/etc/apache22/httpd.conf","usr/local/etc/apache2/httpd.conf","etc/apache2/httpd2.conf","etc/apache2/ssl-global.conf","etc/apache2/vhosts.d/00_default_vhost.conf","apache/conf/httpd.conf","etc/apache/httpd.conf","etc/httpd/conf","http/httpd.conf","usr/local/apache1.3/conf/httpd.conf","usr/local/etc/httpd/conf","var/apache/conf/httpd.conf","var/www/conf","www/apache/conf/httpd.conf","www/conf/httpd.conf","etc/init.d","etc/apache/access.conf","etc/rc.conf","www/logs/freebsddiary-error.log","www/logs/freebsddiary-access_log","library/webserver/documents/index.html","library/webserver/documents/index.htm","library/webserver/documents/default.html","library/webserver/documents/default.htm","library/webserver/documents/index.php","library/webserver/documents/default.php","usr/local/etc/webmin/miniserv.conf","etc/webmin/miniserv.conf","usr/local/etc/webmin/miniserv.users","etc/webmin/miniserv.users","winnt/system32/logfiles/w3svc/inetsvn1.log","winnt/system32/logfiles/w3svc1/inetsvn1.log","winnt/system32/logfiles/w3svc2/inetsvn1.log","winnt/system32/logfiles/w3svc3/inetsvn1.log","windows/system32/logfiles/w3svc/inetsvn1.log","windows/system32/logfiles/w3svc1/inetsvn1.log","windows/system32/logfiles/w3svc2/inetsvn1.log","windows/system32/logfiles/w3svc3/inetsvn1.log","apache/logs/error.log","apache/logs/access.log","apache2/logs/error.log","apache2/logs/access.log","logs/error.log","logs/access.log","etc/httpd/logs/access_log","etc/httpd/logs/access.log","etc/httpd/logs/error_log","etc/httpd/logs/error.log","usr/local/apache/logs/access_log","usr/local/apache/logs/access.log","usr/local/apache/logs/error_log","usr/local/apache/logs/error.log","usr/local/apache2/logs/access_log","usr/local/apache2/logs/access.log","usr/local/apache2/logs/error_log","usr/local/apache2/logs/error.log","var/www/logs/access_log","var/www/logs/access.log","var/www/logs/error_log","var/www/logs/error.log","opt/lampp/logs/access_log","opt/lampp/logs/error_log","opt/xampp/logs/access_log","opt/xampp/logs/error_log","opt/lampp/logs/access.log","opt/lampp/logs/error.log","opt/xampp/logs/access.log","opt/xampp/logs/error.log","program files/apache group/apache/logs/access.log","program files/apache group/apache/logs/error.log","program files/apache software foundation/apache2.2/logs/error.log","program files/apache software foundation/apache2.2/logs/access.log","opt/apache/apache.conf","opt/apache/conf/apache.conf","opt/apache2/apache.conf","opt/apache2/conf/apache.conf","opt/httpd/apache.conf","opt/httpd/conf/apache.conf","etc/httpd/apache.conf","etc/apache2/apache.conf","etc/httpd/conf/apache.conf","usr/local/apache/apache.conf","usr/local/apache/conf/apache.conf","usr/local/apache2/apache.conf","usr/local/apache2/conf/apache.conf","usr/local/php/apache.conf.php","usr/local/php4/apache.conf.php","usr/local/php5/apache.conf.php","usr/local/php/apache.conf","usr/local/php4/apache.conf","usr/local/php5/apache.conf","private/etc/httpd/apache.conf","opt/apache/apache2.conf","opt/apache/conf/apache2.conf","opt/apache2/apache2.conf","opt/apache2/conf/apache2.conf","opt/httpd/apache2.conf","opt/httpd/conf/apache2.conf","etc/httpd/apache2.conf","etc/httpd/conf/apache2.conf","usr/local/apache/apache2.conf","usr/local/apache/conf/apache2.conf","usr/local/apache2/apache2.conf","usr/local/apache2/conf/apache2.conf","usr/local/php/apache2.conf.php","usr/local/php4/apache2.conf.php","usr/local/php5/apache2.conf.php","usr/local/php/apache2.conf","usr/local/php4/apache2.conf","usr/local/php5/apache2.conf","private/etc/httpd/apache2.conf","usr/local/apache/conf/httpd.conf","usr/local/apache2/conf/httpd.conf","etc/httpd/conf/httpd.conf","etc/apache/apache.conf","etc/apache/conf/httpd.conf","etc/apache2/httpd.conf","usr/apache2/conf/httpd.conf","usr/apache/conf/httpd.conf","usr/local/etc/apache/conf/httpd.conf","usr/local/apache/httpd.conf","usr/local/apache2/httpd.conf","usr/local/httpd/conf/httpd.conf","usr/local/etc/apache2/conf/httpd.conf","usr/local/etc/httpd/conf/httpd.conf","usr/local/apps/apache2/conf/httpd.conf","usr/local/apps/apache/conf/httpd.conf","usr/local/php/httpd.conf.php","usr/local/php4/httpd.conf.php","usr/local/php5/httpd.conf.php","usr/local/php/httpd.conf","usr/local/php4/httpd.conf","usr/local/php5/httpd.conf","etc/apache2/conf/httpd.conf","etc/http/conf/httpd.conf","etc/httpd/httpd.conf","etc/http/httpd.conf","etc/httpd.conf","opt/apache/conf/httpd.conf","opt/apache2/conf/httpd.conf","var/www/conf/httpd.conf","private/etc/httpd/httpd.conf","private/etc/httpd/httpd.conf.default","etc/apache2/vhosts.d/default_vhost.include","etc/apache2/conf.d/charset","etc/apache2/conf.d/security","etc/apache2/envvars","etc/apache2/mods-available/autoindex.conf","etc/apache2/mods-available/deflate.conf","etc/apache2/mods-available/dir.conf","etc/apache2/mods-available/mem_cache.conf","etc/apache2/mods-available/mime.conf","etc/apache2/mods-available/proxy.conf","etc/apache2/mods-available/setenvif.conf","etc/apache2/mods-available/ssl.conf","etc/apache2/mods-enabled/alias.conf","etc/apache2/mods-enabled/deflate.conf","etc/apache2/mods-enabled/dir.conf","etc/apache2/mods-enabled/mime.conf","etc/apache2/mods-enabled/negotiation.conf","etc/apache2/mods-enabled/php5.conf","etc/apache2/mods-enabled/status.conf","program files/apache group/apache/conf/httpd.conf","program files/apache group/apache2/conf/httpd.conf","program files/xampp/apache/conf/apache.conf","program files/xampp/apache/conf/apache2.conf","program files/xampp/apache/conf/httpd.conf","program files/apache group/apache/apache.conf","program files/apache group/apache/conf/apache.conf","program files/apache group/apache2/conf/apache.conf","program files/apache group/apache/apache2.conf","program files/apache group/apache/conf/apache2.conf","program files/apache group/apache2/conf/apache2.conf","program files/apache software foundation/apache2.2/conf/httpd.conf","volumes/macintosh_hd1/opt/httpd/conf/httpd.conf","volumes/macintosh_hd1/opt/apache/conf/httpd.conf","volumes/macintosh_hd1/opt/apache2/conf/httpd.conf","volumes/macintosh_hd1/usr/local/php/httpd.conf.php","volumes/macintosh_hd1/usr/local/php4/httpd.conf.php","volumes/macintosh_hd1/usr/local/php5/httpd.conf.php","volumes/webbackup/opt/apache2/conf/httpd.conf","volumes/webbackup/private/etc/httpd/httpd.conf","volumes/webbackup/private/etc/httpd/httpd.conf.default","usr/local/etc/apache/vhosts.conf","usr/local/jakarta/tomcat/conf/jakarta.conf","usr/local/jakarta/tomcat/conf/server.xml","usr/local/jakarta/tomcat/conf/context.xml","usr/local/jakarta/tomcat/conf/workers.properties","usr/local/jakarta/tomcat/conf/logging.properties","usr/local/jakarta/dist/tomcat/conf/jakarta.conf","usr/local/jakarta/dist/tomcat/conf/server.xml","usr/local/jakarta/dist/tomcat/conf/context.xml","usr/local/jakarta/dist/tomcat/conf/workers.properties","usr/local/jakarta/dist/tomcat/conf/logging.properties","usr/share/tomcat6/conf/server.xml","usr/share/tomcat6/conf/context.xml","usr/share/tomcat6/conf/workers.properties","usr/share/tomcat6/conf/logging.properties","var/cpanel/tomcat.options","usr/local/jakarta/tomcat/logs/catalina.out","usr/local/jakarta/tomcat/logs/catalina.err","opt/tomcat/logs/catalina.out","opt/tomcat/logs/catalina.err","usr/share/logs/catalina.out","usr/share/logs/catalina.err","usr/share/tomcat/logs/catalina.out","usr/share/tomcat/logs/catalina.err","usr/share/tomcat6/logs/catalina.out","usr/share/tomcat6/logs/catalina.err","usr/local/apache/logs/mod_jk.log","usr/local/jakarta/tomcat/logs/mod_jk.log","usr/local/jakarta/dist/tomcat/logs/mod_jk.log","opt/[jboss]/server/default/conf/jboss-minimal.xml","opt/[jboss]/server/default/conf/jboss-service.xml","opt/[jboss]/server/default/conf/jndi.properties","opt/[jboss]/server/default/conf/log4j.xml","opt/[jboss]/server/default/conf/login-config.xml","opt/[jboss]/server/default/conf/standardjaws.xml","opt/[jboss]/server/default/conf/standardjboss.xml","opt/[jboss]/server/default/conf/server.log.properties","opt/[jboss]/server/default/deploy/jboss-logging.xml","usr/local/[jboss]/server/default/conf/jboss-minimal.xml","usr/local/[jboss]/server/default/conf/jboss-service.xml","usr/local/[jboss]/server/default/conf/jndi.properties","usr/local/[jboss]/server/default/conf/log4j.xml","usr/local/[jboss]/server/default/conf/login-config.xml","usr/local/[jboss]/server/default/conf/standardjaws.xml","usr/local/[jboss]/server/default/conf/standardjboss.xml","usr/local/[jboss]/server/default/conf/server.log.properties","usr/local/[jboss]/server/default/deploy/jboss-logging.xml","private/tmp/[jboss]/server/default/conf/jboss-minimal.xml","private/tmp/[jboss]/server/default/conf/jboss-service.xml","private/tmp/[jboss]/server/default/conf/jndi.properties","private/tmp/[jboss]/server/default/conf/log4j.xml","private/tmp/[jboss]/server/default/conf/login-config.xml","private/tmp/[jboss]/server/default/conf/standardjaws.xml","private/tmp/[jboss]/server/default/conf/standardjboss.xml","private/tmp/[jboss]/server/default/conf/server.log.properties","private/tmp/[jboss]/server/default/deploy/jboss-logging.xml","tmp/[jboss]/server/default/conf/jboss-minimal.xml","tmp/[jboss]/server/default/conf/jboss-service.xml","tmp/[jboss]/server/default/conf/jndi.properties","tmp/[jboss]/server/default/conf/log4j.xml","tmp/[jboss]/server/default/conf/login-config.xml","tmp/[jboss]/server/default/conf/standardjaws.xml","tmp/[jboss]/server/default/conf/standardjboss.xml","tmp/[jboss]/server/default/conf/server.log.properties","tmp/[jboss]/server/default/deploy/jboss-logging.xml","program files/[jboss]/server/default/conf/jboss-minimal.xml","program files/[jboss]/server/default/conf/jboss-service.xml","program files/[jboss]/server/default/conf/jndi.properties","program files/[jboss]/server/default/conf/log4j.xml","program files/[jboss]/server/default/conf/login-config.xml","program files/[jboss]/server/default/conf/standardjaws.xml","program files/[jboss]/server/default/conf/standardjboss.xml","program files/[jboss]/server/default/conf/server.log.properties","program files/[jboss]/server/default/deploy/jboss-logging.xml","[jboss]/server/default/conf/jboss-minimal.xml","[jboss]/server/default/conf/jboss-service.xml","[jboss]/server/default/conf/jndi.properties","[jboss]/server/default/conf/log4j.xml","[jboss]/server/default/conf/login-config.xml","[jboss]/server/default/conf/standardjaws.xml","[jboss]/server/default/conf/standardjboss.xml","[jboss]/server/default/conf/server.log.properties","[jboss]/server/default/deploy/jboss-logging.xml","opt/[jboss]/server/default/log/server.log","opt/[jboss]/server/default/log/boot.log","usr/local/[jboss]/server/default/log/server.log","usr/local/[jboss]/server/default/log/boot.log","private/tmp/[jboss]/server/default/log/server.log","private/tmp/[jboss]/server/default/log/boot.log","tmp/[jboss]/server/default/log/server.log","tmp/[jboss]/server/default/log/boot.log","program files/[jboss]/server/default/log/server.log","program files/[jboss]/server/default/log/boot.log","[jboss]/server/default/log/server.log","[jboss]/server/default/log/boot.log","var/lighttpd.log","var/logs/access.log","usr/local/apache2/logs/lighttpd.error.log","usr/local/apache2/logs/lighttpd.log","usr/local/apache/logs/lighttpd.error.log","usr/local/apache/logs/lighttpd.log","usr/local/lighttpd/log/lighttpd.error.log","usr/local/lighttpd/log/access.log","usr/home/user/var/log/lighttpd.error.log","usr/home/user/var/log/apache.log","home/user/lighttpd/lighttpd.conf","usr/home/user/lighttpd/lighttpd.conf","etc/lighttpd/lighthttpd.conf","usr/local/etc/lighttpd.conf","usr/local/lighttpd/conf/lighttpd.conf","usr/local/etc/lighttpd.conf.new","var/www/.lighttpdpassword","logs/access_log","logs/error_log","etc/nginx/nginx.conf","usr/local/etc/nginx/nginx.conf","usr/local/nginx/conf/nginx.conf","usr/local/zeus/web/global.cfg","usr/local/zeus/web/log/errors","opt/lsws/conf/httpd_conf.xml","usr/local/lsws/conf/httpd_conf.xml","opt/lsws/logs/error.log","opt/lsws/logs/access.log","usr/local/lsws/logs/error.log","usr/local/logs/access.log","usr/local/samba/lib/log.user","usr/local/logs/samba.log","etc/samba/netlogon","etc/smbpasswd","etc/smb.conf","etc/samba/dhcp.conf","etc/samba/smb.conf","etc/samba/samba.conf","etc/samba/smb.conf.user","etc/samba/smbpasswd","etc/samba/smbusers","etc/samba/private/smbpasswd","usr/local/etc/smb.conf","usr/local/samba/lib/smb.conf.user","etc/dhcp3/dhclient.conf","etc/dhcp3/dhcpd.conf","etc/dhcp/dhclient.conf","program files/vidalia bundle/polipo/polipo.conf","etc/tor/tor-tsocks.conf","etc/stunnel/stunnel.conf","etc/tsocks.conf","etc/tinyproxy/tinyproxy.conf","etc/miredo-server.conf","etc/miredo.conf","etc/miredo/miredo-server.conf","etc/miredo/miredo.conf","etc/wicd/dhclient.conf.template.default","etc/wicd/manager-settings.conf","etc/wicd/wired-settings.conf","etc/wicd/wireless-settings.conf","etc/ipfw.rules","etc/ipfw.conf","etc/firewall.rules","winnt/system32/logfiles/firewall/pfirewall.log","winnt/system32/logfiles/firewall/pfirewall.log.old","windows/system32/logfiles/firewall/pfirewall.log","windows/system32/logfiles/firewall/pfirewall.log.old","etc/clamav/clamd.conf","etc/clamav/freshclam.conf","etc/x11/xorg.conf","etc/x11/xorg.conf-vesa","etc/x11/xorg.conf-vmware","etc/x11/xorg.conf.beforevmwaretoolsinstall","etc/x11/xorg.conf.orig","etc/bluetooth/input.conf","etc/bluetooth/main.conf","etc/bluetooth/network.conf","etc/bluetooth/rfcomm.conf","etc/bash_completion.d/debconf","root/.bash_logout","root/.bash_history","root/.bash_config","root/.bashrc","etc/bash.bashrc","var/adm/syslog","var/adm/sulog","var/adm/utmp","var/adm/utmpx","var/adm/wtmp","var/adm/wtmpx","var/adm/lastlog/username","usr/spool/lp/log","var/adm/lp/lpd-errs","usr/lib/cron/log","var/adm/loginlog","var/adm/pacct","var/adm/dtmp","var/adm/acct/sum/loginlog","var/adm/x0msgs","var/adm/crash/vmcore","var/adm/crash/unix","etc/newsyslog.conf","var/adm/qacct","var/adm/ras/errlog","var/adm/ras/bootlog","var/adm/cron/log","etc/utmp","etc/security/lastlog","etc/security/failedlogin","usr/spool/mqueue/syslog","var/adm/messages","var/adm/aculogs","var/adm/aculog","var/adm/vold.log","var/adm/log/asppp.log","var/lp/logs/lpsched","var/lp/logs/lpnet","var/lp/logs/requests","var/cron/log","var/saf/_log","var/saf/port/log","tmp/access.log","etc/sensors.conf","etc/sensors3.conf","etc/host.conf","etc/pam.conf","etc/resolv.conf","etc/apt/apt.conf","etc/inetd.conf","etc/syslog.conf","etc/sysctl.conf","etc/sysctl.d/10-console-messages.conf","etc/sysctl.d/10-network-security.conf","etc/sysctl.d/10-process-security.conf","etc/sysctl.d/wine.sysctl.conf","etc/security/access.conf","etc/security/group.conf","etc/security/limits.conf","etc/security/namespace.conf","etc/security/pam_env.conf","etc/security/sepermit.conf","etc/security/time.conf","etc/ssh/sshd_config","etc/adduser.conf","etc/deluser.conf","etc/avahi/avahi-daemon.conf","etc/ca-certificates.conf","etc/ca-certificates.conf.dpkg-old","etc/casper.conf","etc/chkrootkit.conf","etc/debconf.conf","etc/dns2tcpd.conf","etc/e2fsck.conf","etc/esound/esd.conf","etc/etter.conf","etc/fuse.conf","etc/foremost.conf","etc/hdparm.conf","etc/kernel-img.conf","etc/kernel-pkg.conf","etc/ld.so.conf","etc/ltrace.conf","etc/mail/sendmail.conf","etc/manpath.config","etc/kbd/config","etc/ldap/ldap.conf","etc/logrotate.conf","etc/mtools.conf","etc/smi.conf","etc/updatedb.conf","etc/pulse/client.conf","usr/share/adduser/adduser.conf","etc/hostname","etc/networks","etc/timezone","etc/modules","etc/passwd","etc/shadow","etc/fstab","etc/motd","etc/hosts","etc/group","etc/alias","etc/crontab","etc/crypttab","etc/exports","etc/mtab","etc/hosts.allow","etc/hosts.deny","etc/os-release","etc/password.master","etc/profile","etc/default/grub","etc/resolvconf/update-libc.d/sendmail","etc/inittab","etc/issue","etc/issue.net","etc/login.defs","etc/sudoers","etc/sysconfig/network-scripts/ifcfg-eth0","etc/redhat-release","etc/scw-release","etc/system-release-cpe","etc/debian_version","etc/fedora-release","etc/mandrake-release","etc/slackware-release","etc/suse-release","etc/security/group","etc/security/passwd","etc/security/user","etc/security/environ","etc/security/limits","etc/security/opasswd","boot/grub/grub.cfg","boot/grub/menu.lst","root/.ksh_history","root/.xauthority","usr/lib/security/mkuser.default","var/lib/squirrelmail/prefs/squirrelmail.log","etc/squirrelmail/apache.conf","etc/squirrelmail/config_local.php","etc/squirrelmail/default_pref","etc/squirrelmail/index.php","etc/squirrelmail/config_default.php","etc/squirrelmail/config.php","etc/squirrelmail/filters_setup.php","etc/squirrelmail/sqspell_config.php","etc/squirrelmail/config/config.php","etc/httpd/conf.d/squirrelmail.conf","usr/share/squirrelmail/config/config.php","private/etc/squirrelmail/config/config.php","srv/www/htdos/squirrelmail/config/config.php","var/www/squirrelmail/config/config.php","var/www/html/squirrelmail/config/config.php","var/www/html/squirrelmail-1.2.9/config/config.php","usr/share/squirrelmail/plugins/squirrel_logger/setup.php","usr/local/squirrelmail/www/readme","windows/system32/drivers/etc/hosts","windows/system32/drivers/etc/lmhosts.sam","windows/system32/drivers/etc/networks","windows/system32/drivers/etc/protocol","windows/system32/drivers/etc/services","/boot.ini","windows/debug/netsetup.log","windows/comsetup.log","windows/repair/setup.log","windows/setupact.log","windows/setupapi.log","windows/setuperr.log","windows/updspapi.log","windows/wmsetup.log","windows/windowsupdate.log","windows/odbc.ini","usr/local/psa/admin/htdocs/domains/databases/phpmyadmin/libraries/config.default.php","etc/apache2/conf.d/phpmyadmin.conf","etc/phpmyadmin/config.inc.php","etc/openldap/ldap.conf","etc/cups/acroread.conf","etc/cups/cupsd.conf","etc/cups/cupsd.conf.default","etc/cups/pdftops.conf","etc/cups/printers.conf","windows/system32/macromed/flash/flashinstall.log","windows/system32/macromed/flash/install.log","etc/cvs-cron.conf","etc/cvs-pserver.conf","etc/subversion/config","etc/modprobe.d/vmware-tools.conf","etc/updatedb.conf.beforevmwaretoolsinstall","etc/vmware-tools/config","etc/vmware-tools/tpvmlp.conf","etc/vmware-tools/vmware-tools-libraries.conf","var/log","var/log/sw-cp-server/error_log","var/log/sso/sso.log","var/log/dpkg.log","var/log/btmp","var/log/utmp","var/log/wtmp","var/log/mysql/mysql-bin.log","var/log/mysql/mysql-bin.index","var/log/mysql/data/mysql-bin.index","var/log/mysql.log","var/log/mysql.err","var/log/mysqlderror.log","var/log/mysql/mysql.log","var/log/mysql/mysql-slow.log","var/log/mysql-bin.index","var/log/data/mysql-bin.index","var/log/postgresql/postgresql.log","var/log/postgres/pg_backup.log","var/log/postgres/postgres.log","var/log/postgresql.log","var/log/pgsql/pgsql.log","var/log/postgresql/postgresql-8.1-main.log","var/log/postgresql/postgresql-8.3-main.log","var/log/postgresql/postgresql-8.4-main.log","var/log/postgresql/postgresql-9.0-main.log","var/log/postgresql/postgresql-9.1-main.log","var/log/pgsql8.log","var/log/postgresql/postgres.log","var/log/pgsql_log","var/log/postgresql/main.log","var/log/cron","var/log/postgres.log","var/log/proftpd","var/log/proftpd/xferlog.legacy","var/log/proftpd.access_log","var/log/proftpd.xferlog","var/log/vsftpd.log","var/log/xferlog","var/log/pure-ftpd/pure-ftpd.log","var/log/pureftpd.log","var/log/muddleftpd","var/log/muddleftpd.conf","var/log/ftp-proxy/ftp-proxy.log","var/log/ftp-proxy","var/log/ftplog","var/log/exim_mainlog","var/log/exim/mainlog","var/log/maillog","var/log/exim_paniclog","var/log/exim/paniclog","var/log/exim/rejectlog","var/log/exim_rejectlog","var/log/webmin/miniserv.log","var/log/httpd/access_log","var/log/httpd/error_log","var/log/httpd/access.log","var/log/httpd/error.log","var/log/apache/access_log","var/log/apache/access.log","var/log/apache/error_log","var/log/apache/error.log","var/log/apache2/access_log","var/log/apache2/access.log","var/log/apache2/error_log","var/log/apache2/error.log","var/log/access_log","var/log/access.log","var/log/error_log","var/log/error.log","var/log/tomcat6/catalina.out","var/log/lighttpd.error.log","var/log/lighttpd.access.log","var/logs/access.log","var/log/lighttpd/","var/log/lighttpd/error.log","var/log/lighttpd/access.www.log","var/log/lighttpd/error.www.log","var/log/lighttpd/access.log","var/log/lighttpd/{domain}/access.log","var/log/lighttpd/{domain}/error.log","var/log/nginx/access_log","var/log/nginx/error_log","var/log/nginx/access.log","var/log/nginx/error.log","var/log/nginx.access_log","var/log/nginx.error_log","var/log/samba/log.smbd","var/log/samba/log.nmbd","var/log/samba.log","var/log/samba.log1","var/log/samba.log2","var/log/log.smb","var/log/ipfw.log","var/log/ipfw","var/log/ipfw/ipfw.log","var/log/ipfw.today","var/log/poplog","var/log/authlog","var/log/news.all","var/log/news/news.all","var/log/news/news.crit","var/log/news/news.err","var/log/news/news.notice","var/log/news/suck.err","var/log/news/suck.notice","var/log/messages","var/log/messages.1","var/log/user.log","var/log/user.log.1","var/log/auth.log","var/log/pm-powersave.log","var/log/xorg.0.log","var/log/daemon.log","var/log/daemon.log.1","var/log/kern.log","var/log/kern.log.1","var/log/mail.err","var/log/mail.info","var/log/mail.warn","var/log/ufw.log","var/log/boot.log","var/log/syslog","var/log/syslog.1","var/log/squirrelmail.log","var/log/apache2/squirrelmail.log","var/log/apache2/squirrelmail.err.log","var/log/mail.log","var/log/vmware/hostd.log","var/log/vmware/hostd-1.log","/wp-config.php","/wp-config.bak","/wp-config.old","/wp-config.temp","/wp-config.tmp","/wp-config.txt","/config.yml","/config_dev.yml","/config_prod.yml","/config_test.yml","/parameters.yml","/routing.yml","/security.yml","/services.yml","sites/default/default.settings.php","sites/default/settings.php","sites/default/settings.local.php","app/etc/local.xml","/sftp-config.json","/web.config","includes/config.php","includes/configure.php","/config.inc.php","/localsettings.php","inc/config.php","typo3conf/localconf.php","config/app.php","config/custom.php","config/database.php","/configuration.php","/config.php","var/mail/www-data","etc/network/","etc/init/","inetpub/wwwroot/global.asa","system32/inetsrv/config/applicationhost.config","system32/inetsrv/config/administration.config","system32/inetsrv/config/redirection.config","system32/config/default","system32/config/sam","system32/config/system","system32/config/software","winnt/repair/sam._","/package.json","/package-lock.json","/gruntfile.js","/npm-debug.log","/ormconfig.json","/tsconfig.json","/webpack.config.js","/yarn.lock","proc/0","proc/1","proc/2","proc/3","proc/4","proc/5","proc/6","proc/7","proc/8","proc/9","proc/acpi","proc/asound","proc/bootconfig","proc/buddyinfo","proc/bus","proc/cgroups","proc/cmdline","proc/config.gz","proc/consoles","proc/cpuinfo","proc/crypto","proc/devices","proc/diskstats","proc/dma","proc/docker","proc/driver","proc/dynamic_debug","proc/execdomains","proc/fb","proc/filesystems","proc/fs","proc/interrupts","proc/iomem","proc/ioports","proc/ipmi","proc/irq","proc/kallsyms","proc/kcore","proc/keys","proc/keys","proc/key-users","proc/kmsg","proc/kpagecgroup","proc/kpagecount","proc/kpageflags","proc/latency_stats","proc/loadavg","proc/locks","proc/mdstat","proc/meminfo","proc/misc","proc/modules","proc/mounts","proc/mpt","proc/mtd","proc/mtrr","proc/net","proc/net/tcp","proc/net/udp","proc/pagetypeinfo","proc/partitions","proc/pressure","proc/sched_debug","proc/schedstat","proc/scsi","proc/self","proc/self/cmdline","proc/self/environ","proc/self/fd/0","proc/self/fd/1","proc/self/fd/10","proc/self/fd/11","proc/self/fd/12","proc/self/fd/13","proc/self/fd/14","proc/self/fd/15","proc/self/fd/2","proc/self/fd/3","proc/self/fd/4","proc/self/fd/5","proc/self/fd/6","proc/self/fd/7","proc/self/fd/8","proc/self/fd/9","proc/self/mounts","proc/self/stat","proc/self/status","proc/slabinfo","proc/softirqs","proc/stat","proc/swaps","proc/sys","proc/sysrq-trigger","proc/sysvipc","proc/thread-self","proc/timer_list","proc/timer_stats","proc/tty","proc/uptime","proc/version","proc/version_signature","proc/vmallocinfo","proc/vmstat","proc/zoneinfo","sys/block","sys/bus","sys/class","sys/dev","sys/devices","sys/firmware","sys/fs","sys/hypervisor","sys/kernel","sys/module","sys/power","windows\\win.ini","default\\ntuser.dat","/var/run/secrets/kubernetes.io/serviceaccount"]},operator:"phrase_match"}],transformers:["lowercase","normalizePath"]},{id:"crs-931-110",name:"RFI: Common RFI Vulnerable Parameter Name used w/ URL Payload",tags:{type:"rfi",crs_id:"931110",category:"attack_attempt",cwe:"98",capec:"1000/152/175/253/193",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"}],regex:"(?:\\binclude\\s*\\([^)]*|mosConfig_absolute_path|_CONF\\[path\\]|_SERVER\\[DOCUMENT_ROOT\\]|GALLERY_BASEDIR|path\\[docroot\\]|appserv_root|config\\[root_dir\\])=(?:file|ftps?|https?)://",options:{min_length:15}},operator:"match_regex"}],transformers:[]},{id:"crs-931-120",name:"RFI: URL Payload Used w/Trailing Question Mark Character (?)",tags:{type:"rfi",crs_id:"931120",category:"attack_attempt",cwe:"98",capec:"1000/152/175/253/193"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"^(?i:file|ftps?)://.*?\\?+$",options:{case_sensitive:!0,min_length:4}},operator:"match_regex"}],transformers:[]},{id:"crs-932-160",name:"Remote Command Execution: Unix Shell Code Found",tags:{type:"command_injection",crs_id:"932160",category:"attack_attempt",cwe:"77",capec:"1000/152/248/88",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["${cdpath}","${dirstack}","${home}","${hostname}","${ifs}","${oldpwd}","${ostype}","${path}","${pwd}","$cdpath","$dirstack","$home","$hostname","$ifs","$oldpwd","$ostype","$path","$pwd","dev/fd/","dev/null","dev/stderr","dev/stdin","dev/stdout","dev/tcp/","dev/udp/","dev/zero","etc/master.passwd","etc/pwd.db","etc/shells","etc/spwd.db","proc/self/","bin/7z","bin/7za","bin/7zr","bin/ab","bin/agetty","bin/ansible-playbook","bin/apt","bin/apt-get","bin/ar","bin/aria2c","bin/arj","bin/arp","bin/as","bin/ascii-xfr","bin/ascii85","bin/ash","bin/aspell","bin/at","bin/atobm","bin/awk","bin/base32","bin/base64","bin/basenc","bin/bash","bin/bpftrace","bin/bridge","bin/bundler","bin/bunzip2","bin/busctl","bin/busybox","bin/byebug","bin/bzcat","bin/bzcmp","bin/bzdiff","bin/bzegrep","bin/bzexe","bin/bzfgrep","bin/bzgrep","bin/bzip2","bin/bzip2recover","bin/bzless","bin/bzmore","bin/bzz","bin/c89","bin/c99","bin/cancel","bin/capsh","bin/cat","bin/cc","bin/certbot","bin/check_by_ssh","bin/check_cups","bin/check_log","bin/check_memory","bin/check_raid","bin/check_ssl_cert","bin/check_statusfile","bin/chmod","bin/choom","bin/chown","bin/chroot","bin/clang","bin/clang++","bin/cmp","bin/cobc","bin/column","bin/comm","bin/composer","bin/core_perl/zipdetails","bin/cowsay","bin/cowthink","bin/cp","bin/cpan","bin/cpio","bin/cpulimit","bin/crash","bin/crontab","bin/csh","bin/csplit","bin/csvtool","bin/cupsfilter","bin/curl","bin/cut","bin/dash","bin/date","bin/dd","bin/dev/fd/","bin/dev/null","bin/dev/stderr","bin/dev/stdin","bin/dev/stdout","bin/dev/tcp/","bin/dev/udp/","bin/dev/zero","bin/dialog","bin/diff","bin/dig","bin/dmesg","bin/dmidecode","bin/dmsetup","bin/dnf","bin/docker","bin/dosbox","bin/dpkg","bin/du","bin/dvips","bin/easy_install","bin/eb","bin/echo","bin/ed","bin/efax","bin/emacs","bin/env","bin/eqn","bin/es","bin/esh","bin/etc/group","bin/etc/master.passwd","bin/etc/passwd","bin/etc/pwd.db","bin/etc/shadow","bin/etc/shells","bin/etc/spwd.db","bin/ex","bin/exiftool","bin/expand","bin/expect","bin/expr","bin/facter","bin/fetch","bin/file","bin/find","bin/finger","bin/fish","bin/flock","bin/fmt","bin/fold","bin/fping","bin/ftp","bin/gawk","bin/gcc","bin/gcore","bin/gdb","bin/gem","bin/genie","bin/genisoimage","bin/ghc","bin/ghci","bin/gimp","bin/ginsh","bin/git","bin/grc","bin/grep","bin/gtester","bin/gunzip","bin/gzexe","bin/gzip","bin/hd","bin/head","bin/hexdump","bin/highlight","bin/hping3","bin/iconv","bin/id","bin/iftop","bin/install","bin/ionice","bin/ip","bin/irb","bin/ispell","bin/jjs","bin/join","bin/journalctl","bin/jq","bin/jrunscript","bin/knife","bin/ksh","bin/ksshell","bin/latex","bin/ld","bin/ldconfig","bin/less","bin/lftp","bin/ln","bin/loginctl","bin/logsave","bin/look","bin/lp","bin/ls","bin/ltrace","bin/lua","bin/lualatex","bin/luatex","bin/lwp-download","bin/lwp-request","bin/lz","bin/lz4","bin/lz4c","bin/lz4cat","bin/lzcat","bin/lzcmp","bin/lzdiff","bin/lzegrep","bin/lzfgrep","bin/lzgrep","bin/lzless","bin/lzma","bin/lzmadec","bin/lzmainfo","bin/lzmore","bin/mail","bin/make","bin/man","bin/mawk","bin/mkfifo","bin/mknod","bin/more","bin/mosquitto","bin/mount","bin/msgattrib","bin/msgcat","bin/msgconv","bin/msgfilter","bin/msgmerge","bin/msguniq","bin/mtr","bin/mv","bin/mysql","bin/nano","bin/nasm","bin/nawk","bin/nc","bin/ncat","bin/neofetch","bin/nice","bin/nl","bin/nm","bin/nmap","bin/node","bin/nohup","bin/npm","bin/nroff","bin/nsenter","bin/octave","bin/od","bin/openssl","bin/openvpn","bin/openvt","bin/opkg","bin/paste","bin/pax","bin/pdb","bin/pdflatex","bin/pdftex","bin/pdksh","bin/perf","bin/perl","bin/pg","bin/php","bin/php-cgi","bin/php5","bin/php7","bin/pic","bin/pico","bin/pidstat","bin/pigz","bin/pip","bin/pkexec","bin/pkg","bin/pr","bin/printf","bin/proc/self/","bin/pry","bin/ps","bin/psed","bin/psftp","bin/psql","bin/ptx","bin/puppet","bin/pxz","bin/python","bin/python2","bin/python3","bin/rake","bin/rbash","bin/rc","bin/readelf","bin/red","bin/redcarpet","bin/restic","bin/rev","bin/rlogin","bin/rlwrap","bin/rpm","bin/rpmquery","bin/rsync","bin/ruby","bin/run-mailcap","bin/run-parts","bin/rview","bin/rvim","bin/sash","bin/sbin/capsh","bin/sbin/logsave","bin/sbin/service","bin/sbin/start-stop-daemon","bin/scp","bin/screen","bin/script","bin/sed","bin/service","bin/setarch","bin/sftp","bin/sg","bin/sh","bin/shuf","bin/sleep","bin/slsh","bin/smbclient","bin/snap","bin/socat","bin/soelim","bin/sort","bin/split","bin/sqlite3","bin/ss","bin/ssh","bin/ssh-keygen","bin/ssh-keyscan","bin/sshpass","bin/start-stop-daemon","bin/stdbuf","bin/strace","bin/strings","bin/su","bin/sysctl","bin/systemctl","bin/systemd-resolve","bin/tac","bin/tail","bin/tar","bin/task","bin/taskset","bin/tbl","bin/tclsh","bin/tcpdump","bin/tcsh","bin/tee","bin/telnet","bin/tex","bin/tftp","bin/tic","bin/time","bin/timedatectl","bin/timeout","bin/tmux","bin/top","bin/troff","bin/tshark","bin/ul","bin/uname","bin/uncompress","bin/unexpand","bin/uniq","bin/unlz4","bin/unlzma","bin/unpigz","bin/unrar","bin/unshare","bin/unxz","bin/unzip","bin/unzstd","bin/update-alternatives","bin/uudecode","bin/uuencode","bin/valgrind","bin/vi","bin/view","bin/vigr","bin/vim","bin/vimdiff","bin/vipw","bin/virsh","bin/volatility","bin/wall","bin/watch","bin/wc","bin/wget","bin/whiptail","bin/who","bin/whoami","bin/whois","bin/wireshark","bin/wish","bin/xargs","bin/xelatex","bin/xetex","bin/xmodmap","bin/xmore","bin/xpad","bin/xxd","bin/xz","bin/xzcat","bin/xzcmp","bin/xzdec","bin/xzdiff","bin/xzegrep","bin/xzfgrep","bin/xzgrep","bin/xzless","bin/xzmore","bin/yarn","bin/yelp","bin/yes","bin/yum","bin/zathura","bin/zip","bin/zipcloak","bin/zipcmp","bin/zipdetails","bin/zipgrep","bin/zipinfo","bin/zipmerge","bin/zipnote","bin/zipsplit","bin/ziptool","bin/zsh","bin/zsoelim","bin/zstd","bin/zstdcat","bin/zstdgrep","bin/zstdless","bin/zstdmt","bin/zypper"]},operator:"phrase_match"}],transformers:["lowercase","cmdLine"]},{id:"crs-932-171",name:"Remote Command Execution: Shellshock (CVE-2014-6271)",tags:{type:"command_injection",crs_id:"932171",category:"attack_attempt",cwe:"77",capec:"1000/152/248/88",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"^\\(\\s*\\)\\s+{",options:{case_sensitive:!0,min_length:4}},operator:"match_regex"}],transformers:[]},{id:"crs-932-180",name:"Restricted File Upload Attempt",tags:{type:"command_injection",crs_id:"932180",category:"attack_attempt",cwe:"706",capec:"1000/225/122/17/177",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["x-filename"]},{address:"server.request.headers.no_cookies",key_path:["x_filename"]},{address:"server.request.headers.no_cookies",key_path:["x-file-name"]}],list:[".htaccess",".htdigest",".htpasswd","wp-config.php","config.yml","config_dev.yml","config_prod.yml","config_test.yml","parameters.yml","routing.yml","security.yml","services.yml","default.settings.php","settings.php","settings.local.php","local.xml",".env"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-933-111",name:"PHP Injection Attack: PHP Script File Upload Found",tags:{type:"unrestricted_file_upload",crs_id:"933111",category:"attack_attempt",cwe:"434",capec:"1000/225/122/17/650",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["x-filename"]},{address:"server.request.headers.no_cookies",key_path:["x_filename"]},{address:"server.request.headers.no_cookies",key_path:["x.filename"]},{address:"server.request.headers.no_cookies",key_path:["x-file-name"]}],regex:".*\\.(?:php\\d*|phtml)\\..*$",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-933-130",name:"PHP Injection Attack: Global Variables Found",tags:{type:"php_code_injection",crs_id:"933130",category:"attack_attempt",cwe:"94",capec:"1000/225/122/17/650",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["$globals","$_cookie","$_env","$_files","$_get","$_post","$_request","$_server","$_session","$argc","$argv","$http_\\u200bresponse_\\u200bheader","$php_\\u200berrormsg","$http_cookie_vars","$http_env_vars","$http_get_vars","$http_post_files","$http_post_vars","$http_raw_post_data","$http_request_vars","$http_server_vars"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-933-131",name:"PHP Injection Attack: HTTP Headers Values Found",tags:{type:"php_code_injection",crs_id:"933131",category:"attack_attempt",cwe:"94",capec:"1000/225/122/17/650"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:HTTP_(?:ACCEPT(?:_(?:ENCODING|LANGUAGE|CHARSET))?|(?:X_FORWARDED_FO|REFERE)R|(?:USER_AGEN|HOS)T|CONNECTION|KEEP_ALIVE)|PATH_(?:TRANSLATED|INFO)|ORIG_PATH_INFO|QUERY_STRING|REQUEST_URI|AUTH_TYPE)",options:{case_sensitive:!0,min_length:9}},operator:"match_regex"}],transformers:[]},{id:"crs-933-140",name:"PHP Injection Attack: I/O Stream Found",tags:{type:"php_code_injection",crs_id:"933140",category:"attack_attempt",cwe:"94",capec:"1000/225/122/17/650",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"php://(?:std(?:in|out|err)|(?:in|out)put|fd|memory|temp|filter)",options:{min_length:8}},operator:"match_regex"}],transformers:[]},{id:"crs-933-150",name:"PHP Injection Attack: High-Risk PHP Function Name Found",tags:{type:"php_code_injection",crs_id:"933150",category:"attack_attempt",cwe:"94",capec:"1000/225/122/17/650",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["__halt_compiler","apache_child_terminate","base64_decode","bzdecompress","call_user_func","call_user_func_array","call_user_method","call_user_method_array","convert_uudecode","file_get_contents","file_put_contents","fsockopen","get_class_methods","get_class_vars","get_defined_constants","get_defined_functions","get_defined_vars","gzdecode","gzinflate","gzuncompress","include_once","invokeargs","pcntl_exec","pcntl_fork","pfsockopen","posix_getcwd","posix_getpwuid","posix_getuid","posix_uname","reflectionfunction","require_once","shell_exec","str_rot13","sys_get_temp_dir","wp_remote_fopen","wp_remote_get","wp_remote_head","wp_remote_post","wp_remote_request","wp_safe_remote_get","wp_safe_remote_head","wp_safe_remote_post","wp_safe_remote_request","zlib_decode"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-933-160",name:"PHP Injection Attack: High-Risk PHP Function Call Found",tags:{type:"php_code_injection",crs_id:"933160",category:"attack_attempt",cwe:"94",capec:"1000/225/122/17/650"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:'\\b(?:s(?:e(?:t(?:_(?:e(?:xception|rror)_handler|magic_quotes_runtime|include_path)|defaultstub)|ssion_s(?:et_save_handler|tart))|qlite_(?:(?:(?:unbuffered|single|array)_)?query|create_(?:aggregate|function)|p?open|exec)|tr(?:eam_(?:context_create|socket_client)|ipc?slashes|rev)|implexml_load_(?:string|file)|ocket_c(?:onnect|reate)|h(?:ow_sourc|a1_fil)e|pl_autoload_register|ystem)|p(?:r(?:eg_(?:replace(?:_callback(?:_array)?)?|match(?:_all)?|split)|oc_(?:(?:terminat|clos|nic)e|get_status|open)|int_r)|o(?:six_(?:get(?:(?:e[gu]|g)id|login|pwnam)|mk(?:fifo|nod)|ttyname|kill)|pen)|hp(?:_(?:strip_whitespac|unam)e|version|info)|g_(?:(?:execut|prepar)e|connect|query)|a(?:rse_(?:ini_file|str)|ssthru)|utenv)|r(?:unkit_(?:function_(?:re(?:defin|nam)e|copy|add)|method_(?:re(?:defin|nam)e|copy|add)|constant_(?:redefine|add))|e(?:(?:gister_(?:shutdown|tick)|name)_function|ad(?:(?:gz)?file|_exif_data|dir))|awurl(?:de|en)code)|i(?:mage(?:createfrom(?:(?:jpe|pn)g|x[bp]m|wbmp|gif)|(?:jpe|pn)g|g(?:d2?|if)|2?wbmp|xbm)|s_(?:(?:(?:execut|write?|read)ab|fi)le|dir)|ni_(?:get(?:_all)?|set)|terator_apply|ptcembed)|g(?:et(?:_(?:c(?:urrent_use|fg_va)r|meta_tags)|my(?:[gpu]id|inode)|(?:lastmo|cw)d|imagesize|env)|z(?:(?:(?:defla|wri)t|encod|fil)e|compress|open|read)|lob)|a(?:rray_(?:u(?:intersect(?:_u?assoc)?|diff(?:_u?assoc)?)|intersect_u(?:assoc|key)|diff_u(?:assoc|key)|filter|reduce|map)|ssert(?:_options)?|tob)|h(?:tml(?:specialchars(?:_decode)?|_entity_decode|entities)|(?:ash(?:_(?:update|hmac))?|ighlight)_file|e(?:ader_register_callback|x2bin))|f(?:i(?:le(?:(?:[acm]tim|inod)e|(?:_exist|perm)s|group)?|nfo_open)|tp_(?:nb_(?:ge|pu)|connec|ge|pu)t|(?:unction_exis|pu)ts|write|open)|o(?:b_(?:get_(?:c(?:ontents|lean)|flush)|end_(?:clean|flush)|clean|flush|start)|dbc_(?:result(?:_all)?|exec(?:ute)?|connect)|pendir)|m(?:b_(?:ereg(?:_(?:replace(?:_callback)?|match)|i(?:_replace)?)?|parse_str)|(?:ove_uploaded|d5)_file|ethod_exists|ysql_query|kdir)|e(?:x(?:if_(?:t(?:humbnail|agname)|imagetype|read_data)|ec)|scapeshell(?:arg|cmd)|rror_reporting|val)|c(?:url_(?:file_create|exec|init)|onvert_uuencode|reate_function|hr)|u(?:n(?:serialize|pack)|rl(?:de|en)code|[ak]?sort)|b(?:(?:son_(?:de|en)|ase64_en)code|zopen|toa)|(?:json_(?:de|en)cod|debug_backtrac|tmpfil)e|var_dump)(?:\\s|/\\*.*\\*/|//.*|#.*|\\"|\')*\\((?:(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:\\$\\w+|[A-Z\\d]\\w*|\\w+\\(.*\\)|\\\\?"(?:[^"]|\\\\"|""|"\\+")*\\\\?"|\\\\?\'(?:[^\']|\'\'|\'\\+\')*\\\\?\')(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:(?:::|\\.|->)(?:\\s|/\\*.*\\*/|//.*|#.*)*\\w+(?:\\(.*\\))?)?,)*(?:(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:\\$\\w+|[A-Z\\d]\\w*|\\w+\\(.*\\)|\\\\?"(?:[^"]|\\\\"|""|"\\+")*\\\\?"|\\\\?\'(?:[^\']|\'\'|\'\\+\')*\\\\?\')(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:(?:::|\\.|->)(?:\\s|/\\*.*\\*/|//.*|#.*)*\\w+(?:\\(.*\\))?)?)?\\)',options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-933-170",name:"PHP Injection Attack: Serialized Object Injection",tags:{type:"php_code_injection",crs_id:"933170",category:"attack_attempt",cwe:"502",capec:"1000/152/586",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies"},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:'[oOcC]:\\d+:\\".+?\\":\\d+:{[\\W\\w]*}',options:{case_sensitive:!0,min_length:12}},operator:"match_regex"}],transformers:[]},{id:"crs-933-200",name:"PHP Injection Attack: Wrapper scheme detected",tags:{type:"php_code_injection",crs_id:"933200",category:"attack_attempt",cwe:"502",capec:"1000/152/586"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:(?:bzip|ssh)2|z(?:lib|ip)|(?:ph|r)ar|expect|glob|ogg)://",options:{case_sensitive:!0,min_length:6}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-934-100",name:"Node.js Injection Attack 1/2",tags:{type:"js_code_injection",crs_id:"934100",category:"attack_attempt",cwe:"94",capec:"1000/152/242"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:(?:l(?:(?:utimes|chmod)(?:Sync)?|(?:stat|ink)Sync)|w(?:rite(?:(?:File|v)(?:Sync)?|Sync)|atchFile)|u(?:n(?:watchFile|linkSync)|times(?:Sync)?)|s(?:(?:ymlink|tat)Sync|pawn(?:File|Sync))|ex(?:ec(?:File(?:Sync)?|Sync)|istsSync)|a(?:ppendFile|ccess)(?:Sync)?|(?:Caveat|Inode)s|open(?:dir)?Sync|new\\s+Function|Availability|\\beval)\\s*\\(|m(?:ain(?:Module\\s*(?:\\W*\\s*(?:constructor|require)|\\[)|\\s*(?:\\W*\\s*(?:constructor|require)|\\[))|kd(?:temp(?:Sync)?|irSync)\\s*\\(|odule\\.exports\\s*=)|c(?:(?:(?:h(?:mod|own)|lose)Sync|reate(?:Write|Read)Stream|p(?:Sync)?)\\s*\\(|o(?:nstructor\\s*(?:\\W*\\s*_load|\\[)|pyFile(?:Sync)?\\s*\\())|f(?:(?:(?:s(?:(?:yncS)?|tatS)|datas(?:yncS)?)ync|ch(?:mod|own)(?:Sync)?)\\s*\\(|u(?:nction\\s*\\(\\s*\\)\\s*{|times(?:Sync)?\\s*\\())|r(?:e(?:(?:ad(?:(?:File|link|dir)?Sync|v(?:Sync)?)|nameSync)\\s*\\(|quire\\s*(?:\\W*\\s*main|\\[))|m(?:Sync)?\\s*\\()|process\\s*(?:\\W*\\s*(?:mainModule|binding)|\\[)|t(?:his\\.constructor|runcateSync\\s*\\()|_(?:\\$\\$ND_FUNC\\$\\$_|_js_function)|global\\s*(?:\\W*\\s*process|\\[)|String\\s*\\.\\s*fromCharCode|binding\\s*\\[)",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:[]},{id:"crs-934-101",name:"Node.js Injection Attack 2/2",tags:{type:"js_code_injection",crs_id:"934101",category:"attack_attempt",confidence:"1",cwe:"94",capec:"1000/152/242"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:w(?:atch|rite)|(?:spaw|ope)n|exists|close|fork|read)\\s*\\(",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-941-110",name:"XSS Filter - Category 1: Script Tag Vector",tags:{type:"xss",crs_id:"941110",category:"attack_attempt",cwe:"80",capec:"1000/152/242/63/591",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<script[^>]*>[\\s\\S]*?",options:{case_sensitive:!1,min_length:8}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-120",name:"XSS Filter - Category 2: Event Handler Vector",tags:{type:"xss",crs_id:"941120",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bon(?:d(?:r(?:ag(?:en(?:ter|d)|leave|start|over)?|op)|urationchange|blclick)|s(?:e(?:ek(?:ing|ed)|arch|lect)|u(?:spend|bmit)|talled|croll|how)|m(?:ouse(?:(?:lea|mo)ve|o(?:ver|ut)|enter|down|up)|essage)|p(?:a(?:ge(?:hide|show)|(?:st|us)e)|lay(?:ing)?|rogress|aste|ointer(?:cancel|down|enter|leave|move|out|over|rawupdate|up))|c(?:anplay(?:through)?|o(?:ntextmenu|py)|hange|lick|ut)|a(?:nimation(?:iteration|start|end)|(?:fterprin|bor)t|uxclick|fterscriptexecute)|t(?:o(?:uch(?:cancel|start|move|end)|ggle)|imeupdate)|f(?:ullscreen(?:change|error)|ocus(?:out|in)?|inish)|(?:(?:volume|hash)chang|o(?:ff|n)lin)e|b(?:efore(?:unload|print)|lur)|load(?:ed(?:meta)?data|start|end)?|r(?:es(?:ize|et)|atechange)|key(?:press|down|up)|w(?:aiting|heel)|in(?:valid|put)|e(?:nded|rror)|unload)[\\s\\x0B\\x09\\x0C\\x3B\\x2C\\x28\\x3B]*?=[^=]",options:{min_length:8}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-140",name:"XSS Filter - Category 4: Javascript URI Vector",tags:{type:"xss",crs_id:"941140",category:"attack_attempt",cwe:"84",capec:"1000/152/242/63/591/244",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"[a-z]+=(?:[^:=]+:.+;)*?[^:=]+:url\\(javascript",options:{min_length:18}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-170",name:"NoScript XSS InjectionChecker: Attribute Injection",tags:{type:"xss",crs_id:"941170",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:\\W|^)(?:javascript:(?:[\\s\\S]+[=\\x5c\\(\\[\\.<]|[\\s\\S]*?(?:\\bname\\b|\\x5c[ux]\\d)))|@\\W*?i\\W*?m\\W*?p\\W*?o\\W*?r\\W*?t\\W*?(?:/\\*[\\s\\S]*?)?(?:[\\\"']|\\W*?u\\W*?r\\W*?l[\\s\\S]*?\\()|[^-]*?-\\W*?m\\W*?o\\W*?z\\W*?-\\W*?b\\W*?i\\W*?n\\W*?d\\W*?i\\W*?n\\W*?g[^:]*?:\\W*?u\\W*?r\\W*?l[\\s\\S]*?\\(",options:{min_length:6}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-180",name:"Node-Validator Deny List Keywords",tags:{type:"xss",crs_id:"941180",category:"attack_attempt",cwe:"79",capec:"1000/152/242/63/591"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["document.cookie","document.write",".parentnode",".innerhtml","window.location","-moz-binding"]},operator:"phrase_match"}],transformers:["removeNulls","lowercase"]},{id:"crs-941-200",name:"IE XSS Filters - Attack Detected via vmlframe tag",tags:{type:"xss",crs_id:"941200",category:"attack_attempt",cwe:"80",capec:"1000/152/242/63/591",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:<.*[:]?vmlframe.*?[\\s/+]*?src[\\s/+]*=)",options:{case_sensitive:!0,min_length:13}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-210",name:"IE XSS Filters - Obfuscated Attack Detected via javascript injection",tags:{type:"xss",crs_id:"941210",category:"attack_attempt",cwe:"80",capec:"1000/152/242/63/591",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:(?:j|&#x?0*(?:74|4A|106|6A);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:a|&#x?0*(?:65|41|97|61);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:v|&#x?0*(?:86|56|118|76);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:a|&#x?0*(?:65|41|97|61);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:s|&#x?0*(?:83|53|115|73);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:c|&#x?0*(?:67|43|99|63);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:r|&#x?0*(?:82|52|114|72);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:i|&#x?0*(?:73|49|105|69);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:p|&#x?0*(?:80|50|112|70);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:t|&#x?0*(?:84|54|116|74);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?::|&(?:#x?0*(?:58|3A);?|colon;)).)",options:{case_sensitive:!0,min_length:12}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-220",name:"IE XSS Filters - Obfuscated Attack Detected via vbscript injection",tags:{type:"xss",crs_id:"941220",category:"attack_attempt",cwe:"80",capec:"1000/152/242/63/591",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:(?:v|&#x?0*(?:86|56|118|76);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:b|&#x?0*(?:66|42|98|62);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:s|&#x?0*(?:83|53|115|73);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:c|&#x?0*(?:67|43|99|63);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:r|&#x?0*(?:82|52|114|72);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:i|&#x?0*(?:73|49|105|69);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:p|&#x?0*(?:80|50|112|70);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:t|&#x?0*(?:84|54|116|74);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?::|&(?:#x?0*(?:58|3A);?|colon;)).)",options:{case_sensitive:!0,min_length:10}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-230",name:"IE XSS Filters - Attack Detected via embed tag",tags:{type:"xss",crs_id:"941230",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<EMBED[\\s/+].*?(?:src|type).*?=",options:{min_length:11}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-240",name:"IE XSS Filters - Attack Detected via import tag",tags:{type:"xss",crs_id:"941240",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<[?]?import[\\s/+\\S]*?implementation[\\s/+]*?=",options:{case_sensitive:!0,min_length:22}},operator:"match_regex"}],transformers:["lowercase","removeNulls"]},{id:"crs-941-270",name:"IE XSS Filters - Attack Detected via link tag",tags:{type:"xss",crs_id:"941270",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<LINK[\\s/+].*?href[\\s/+]*=",options:{min_length:11}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-280",name:"IE XSS Filters - Attack Detected via base tag",tags:{type:"xss",crs_id:"941280",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<BASE[\\s/+].*?href[\\s/+]*=",options:{min_length:11}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-290",name:"IE XSS Filters - Attack Detected via applet tag",tags:{type:"xss",crs_id:"941290",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<APPLET[\\s/+>]",options:{min_length:8}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-300",name:"IE XSS Filters - Attack Detected via object tag",tags:{type:"xss",crs_id:"941300",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<OBJECT[\\s/+].*?(?:type|codetype|classid|code|data)[\\s/+]*=",options:{min_length:13}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-350",name:"UTF-7 Encoding IE XSS - Attack Detected",tags:{type:"xss",crs_id:"941350",category:"attack_attempt",cwe:"87",capec:"1000/152/242/63/591/199",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\+ADw-.*(?:\\+AD4-|>)|<.*\\+AD4-",options:{case_sensitive:!0,min_length:6}},operator:"match_regex"}],transformers:[]},{id:"crs-941-360",name:"JSFuck / Hieroglyphy obfuscation detected",tags:{type:"xss",crs_id:"941360",category:"attack_attempt",cwe:"87",capec:"1000/152/242/63/591/199"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"![!+ ]\\[\\]",options:{case_sensitive:!0,min_length:4}},operator:"match_regex"}],transformers:[]},{id:"crs-941-390",name:"Javascript method detected",tags:{type:"xss",crs_id:"941390",category:"attack_attempt",confidence:"1",cwe:"79",capec:"1000/152/242/63/591"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?i:eval|settimeout|setinterval|new\\s+Function|alert|prompt)[\\s+]*\\([^\\)]",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-942-100",name:"SQL Injection Attack Detected via libinjection",tags:{type:"sql_injection",crs_id:"942100",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}]},operator:"is_sqli"}],transformers:["removeNulls"]},{id:"crs-942-160",name:"Detects blind sqli tests using sleep() or benchmark()",tags:{type:"sql_injection",crs_id:"942160",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66/7",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:sleep\\(\\s*?\\d*?\\s*?\\)|benchmark\\(.*?\\,.*?\\))",options:{case_sensitive:!0,min_length:7}},operator:"match_regex"}],transformers:[]},{id:"crs-942-240",name:"Detects MySQL charset switch and MSSQL DoS attempts",tags:{type:"sql_injection",crs_id:"942240",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66/7",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:[\\\"'`](?:;*?\\s*?waitfor\\s+(?:delay|time)\\s+[\\\"'`]|;.*?:\\s*?goto)|alter\\s*?\\w+.*?cha(?:racte)?r\\s+set\\s+\\w+)",options:{min_length:7}},operator:"match_regex"}],transformers:[]},{id:"crs-942-250",name:"Detects MATCH AGAINST, MERGE and EXECUTE IMMEDIATE injections",tags:{type:"sql_injection",crs_id:"942250",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:merge.*?using\\s*?\\(|execute\\s*?immediate\\s*?[\\\"'`]|match\\s*?[\\w(?:),+-]+\\s*?against\\s*?\\()",options:{case_sensitive:!0,min_length:11}},operator:"match_regex"}],transformers:[]},{id:"crs-942-270",name:"Basic SQL injection",tags:{type:"sql_injection",crs_id:"942270",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"union.*?select.*?from",options:{min_length:15}},operator:"match_regex"}],transformers:[]},{id:"crs-942-280",name:"SQL Injection with delay functions",tags:{type:"sql_injection",crs_id:"942280",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66/7",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:;\\s*?shutdown\\s*?(?:[#;{]|\\/\\*|--)|waitfor\\s*?delay\\s?[\\\"'`]+\\s?\\d|select\\s*?pg_sleep)",options:{min_length:10}},operator:"match_regex"}],transformers:[]},{id:"crs-942-290",name:"Finds basic MongoDB SQL injection attempts",tags:{type:"nosql_injection",crs_id:"942290",category:"attack_attempt",cwe:"943",capec:"1000/152/248/676"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:(?:\\[?\\$(?:(?:s(?:lic|iz)|wher)e|e(?:lemMatch|xists|q)|n(?:o[rt]|in?|e)|l(?:ike|te?)|t(?:ext|ype)|a(?:ll|nd)|jsonSchema|between|regex|x?or|div|mod)\\]?)\\b)",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:["keys_only"]},{id:"crs-942-360",name:"Detects concatenated basic SQL injection and SQLLFI attempts",tags:{type:"sql_injection",crs_id:"942360",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66/470"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:^[\\W\\d]+\\s*?(?:alter\\s*(?:a(?:(?:pplication\\s*rol|ggregat)e|s(?:ymmetric\\s*ke|sembl)y|u(?:thorization|dit)|vailability\\s*group)|c(?:r(?:yptographic\\s*provider|edential)|o(?:l(?:latio|um)|nversio)n|ertificate|luster)|s(?:e(?:rv(?:ice|er)|curity|quence|ssion|arch)|y(?:mmetric\\s*key|nonym)|togroup|chema)|m(?:a(?:s(?:ter\\s*key|k)|terialized)|e(?:ssage\\s*type|thod)|odule)|l(?:o(?:g(?:file\\s*group|in)|ckdown)|a(?:ngua|r)ge|ibrary)|t(?:(?:abl(?:espac)?|yp)e|r(?:igger|usted)|hreshold|ext)|p(?:a(?:rtition|ckage)|ro(?:cedur|fil)e|ermission)|d(?:i(?:mension|skgroup)|atabase|efault|omain)|r(?:o(?:l(?:lback|e)|ute)|e(?:sourc|mot)e)|f(?:u(?:lltext|nction)|lashback|oreign)|e(?:xte(?:nsion|rnal)|(?:ndpoi|ve)nt)|in(?:dex(?:type)?|memory|stance)|b(?:roker\\s*priority|ufferpool)|x(?:ml\\s*schema|srobject)|w(?:ork(?:load)?|rapper)|hi(?:erarchy|stogram)|o(?:perator|utline)|(?:nicknam|queu)e|us(?:age|er)|group|java|view)|union\\s*(?:(?:distin|sele)ct|all))\\b|\\b(?:(?:(?:trunc|cre|upd)at|renam)e|(?:inser|selec)t|de(?:lete|sc)|alter|load)\\s+(?:group_concat|load_file|char)\\b\\s*\\(?|[\\s(]load_file\\s*?\\(|[\\\"'`]\\s+regexp\\W)",options:{min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-942-500",name:"MySQL in-line comment detected",tags:{type:"sql_injection",crs_id:"942500",category:"attack_attempt",cwe:"89",capec:"1000/152/248/66"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:/\\*[!+](?:[\\w\\s=_\\-(?:)]+)?\\*/)",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-943-100",name:"Possible Session Fixation Attack: Setting Cookie Values in HTML",tags:{type:"http_protocol_violation",crs_id:"943100",category:"attack_attempt",cwe:"384",capec:"1000/225/21/593/61",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i:\\.cookie\\b.*?;\\W*?(?:expires|domain)\\W*?=|\\bhttp-equiv\\W+set-cookie\\b)",options:{case_sensitive:!0,min_length:15}},operator:"match_regex"}],transformers:[]},{id:"crs-944-100",name:"Remote Command Execution: Suspicious Java class detected",tags:{type:"java_code_injection",crs_id:"944100",category:"attack_attempt",cwe:"94",capec:"1000/152/242",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"java\\.lang\\.(?:runtime|processbuilder)",options:{case_sensitive:!0,min_length:17}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-944-110",name:"Remote Command Execution: Java process spawn (CVE-2017-9805)",tags:{type:"java_code_injection",category:"attack_attempt",cwe:"94",capec:"1000/152/242"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:unmarshaller|base64data|java\\.).*(?:runtime|processbuilder)",options:{case_sensitive:!1,min_length:13}},operator:"match_regex"}],transformers:[]},{id:"crs-944-130",name:"Suspicious Java class detected",tags:{type:"java_code_injection",crs_id:"944130",category:"attack_attempt",cwe:"94",capec:"1000/152/242"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],list:["com.opensymphony.xwork2","com.sun.org.apache","java.io.bufferedinputstream","java.io.bufferedreader","java.io.bytearrayinputstream","java.io.bytearrayoutputstream","java.io.chararrayreader","java.io.datainputstream","java.io.file","java.io.fileoutputstream","java.io.filepermission","java.io.filewriter","java.io.filterinputstream","java.io.filteroutputstream","java.io.filterreader","java.io.inputstream","java.io.inputstreamreader","java.io.linenumberreader","java.io.objectoutputstream","java.io.outputstream","java.io.pipedoutputstream","java.io.pipedreader","java.io.printstream","java.io.pushbackinputstream","java.io.reader","java.io.stringreader","java.lang.class","java.lang.integer","java.lang.number","java.lang.object","java.lang.process","java.lang.reflect","java.lang.runtime","java.lang.string","java.lang.stringbuilder","java.lang.system","javax.script.scriptenginemanager","org.apache.commons","org.apache.struts","org.apache.struts2","org.omg.corba","java.beans.xmldecode"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-944-260",name:"Remote Command Execution: Malicious class-loading payload",tags:{type:"java_code_injection",crs_id:"944260",category:"attack_attempt",cwe:"94",capec:"1000/152/242",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:class\\.module\\.classLoader\\.resources\\.context\\.parent\\.pipeline|springframework\\.context\\.support\\.FileSystemXmlApplicationContext)",options:{case_sensitive:!0,min_length:58}},operator:"match_regex"}],transformers:[]},{id:"dog-000-001",name:"Look for Cassandra injections",tags:{type:"nosql_injection",category:"attack_attempt",cwe:"943",capec:"1000/152/248/676"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"},{address:"server.request.headers.no_cookies"}],regex:"\\ballow\\s+filtering\\b"},operator:"match_regex"}],transformers:["removeComments"]},{id:"dog-000-002",name:"OGNL - Look for formatting injection patterns",tags:{type:"java_code_injection",category:"attack_attempt",cwe:"94",capec:"1000/152/242"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"},{address:"server.request.headers.no_cookies"}],regex:"[#%$]{(?:[^}]+[^\\w\\s}\\-_][^}]+|\\d+-\\d+)}",options:{case_sensitive:!0}}}],transformers:[]},{id:"dog-000-003",name:"OGNL - Detect OGNL exploitation primitives",tags:{type:"java_code_injection",category:"attack_attempt",cwe:"94",capec:"1000/152/242",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"[@#]ognl",options:{case_sensitive:!0}}}],transformers:[]},{id:"dog-000-004",name:"Spring4Shell - Attempts to exploit the Spring4shell vulnerability",tags:{type:"exploit_detection",category:"attack_attempt",cwe:"94",capec:"1000/152/242",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.request.body"}],regex:"^class\\.module\\.classLoader\\.",options:{case_sensitive:!1}}}],transformers:["keys_only"]},{id:"dog-000-005",name:"Node.js: Prototype pollution through __proto__",tags:{type:"js_code_injection",category:"attack_attempt",cwe:"1321",capec:"1000/152/242",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"}],regex:"^__proto__$"},operator:"match_regex"}],transformers:["keys_only"]},{id:"dog-000-006",name:"Node.js: Prototype pollution through constructor.prototype",tags:{type:"js_code_injection",category:"attack_attempt",cwe:"1321",capec:"1000/152/242",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"}],regex:"^constructor$"},operator:"match_regex"},{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"}],regex:"^prototype$"},operator:"match_regex"}],transformers:["keys_only"]},{id:"dog-000-007",name:"Server side template injection: Velocity & Freemarker",tags:{type:"java_code_injection",category:"attack_attempt",cwe:"1336",capec:"1000/152/242/19",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"#(?:set|foreach|macro|parse|if)\\(.*\\)|<#assign.*>"},operator:"match_regex"}],transformers:[]},{id:"dog-913-001",name:"BurpCollaborator OOB domain",tags:{type:"attack_tool",category:"attack_attempt",tool_name:"BurpCollaborator",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:burpcollaborator\\.net|oastify\\.com)\\b"},operator:"match_regex"}],transformers:[]},{id:"dog-913-002",name:"Qualys OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"Qualys",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bqualysperiscope\\.com\\b|\\.oscomm\\."},operator:"match_regex"}],transformers:[]},{id:"dog-913-003",name:"Probely OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"Probely",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bprbly\\.win\\b"},operator:"match_regex"}],transformers:[]},{id:"dog-913-004",name:"Known malicious out-of-band interaction domain",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:webhook\\.site|\\.canarytokens\\.com|vii\\.one|act1on3\\.ru|gdsburp\\.com|arcticwolf\\.net|oob\\.li|htbiw\\.com|h4\\.vc|mochan\\.cloud|imshopping\\.com|bootstrapnodejs\\.com|mooo-ng\\.com|securitytrails\\.com|canyouhackit\\.io|7bae\\.xyz)\\b"},operator:"match_regex"}],transformers:[]},{id:"dog-913-005",name:"Known suspicious out-of-band interaction domain",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:\\.ngrok\\.io|requestbin\\.com|requestbin\\.net)\\b"},operator:"match_regex"}],transformers:[]},{id:"dog-913-006",name:"Rapid7 OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"Rapid7",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bappspidered\\.rapid7\\."},operator:"match_regex"}],transformers:[]},{id:"dog-913-007",name:"Interact.sh OOB domain",tags:{type:"attack_tool",category:"attack_attempt",tool_name:"interact.sh",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:interact\\.sh|oast\\.(?:pro|live|site|online|fun|me)|indusfacefinder\\.in|where\\.land|syhunt\\.net|tssrt\\.de|boardofcyber\\.io|assetnote-callback\\.com|praetorianlabs\\.dev|netspi\\.sh)\\b"},operator:"match_regex"}],transformers:[]},{id:"dog-913-008",name:"Netsparker OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"Netsparker",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b(?:\\.|(?:\\\\|&#)(?:0*46|x0*2e);)?r87(?:\\.|(?:\\\\|&#)(?:0*46|x0*2e);)(?:me|com)\\b",options:{case_sensitive:!1,min_length:7}},operator:"match_regex"}],transformers:[]},{id:"dog-913-009",name:"WhiteHat Security OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"WhiteHatSecurity",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bwhsec(?:\\.|(?:\\\\|&#)(?:0*46|x0*2e);)us\\b",options:{case_sensitive:!1,min_length:8}},operator:"match_regex"}],transformers:[]},{id:"dog-913-010",name:"Nessus OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"Nessus",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\b\\.nessus\\.org\\b",options:{case_sensitive:!1,min_length:8}},operator:"match_regex"}],transformers:[]},{id:"dog-913-011",name:"Watchtowr OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"Watchtowr",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bwatchtowr\\.com\\b",options:{case_sensitive:!1,min_length:8}},operator:"match_regex"}],transformers:[]},{id:"dog-913-012",name:"AppCheck NG OOB domain",tags:{type:"commercial_scanner",category:"attack_attempt",tool_name:"AppCheckNG",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\bptst\\.io\\b",options:{case_sensitive:!1,min_length:7}},operator:"match_regex"}],transformers:[]},{id:"dog-931-001",name:"RFI: URL Payload to well known RFI target",tags:{type:"rfi",category:"attack_attempt",cwe:"98",capec:"1000/152/175/253/193",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"^(?i:file|ftps?|https?).*/rfiinc\\.txt\\?+$",options:{case_sensitive:!0,min_length:17}},operator:"match_regex"}],transformers:[]},{id:"dog-932-100",name:"Shell spawn executing network command",tags:{type:"command_injection",category:"attack_attempt",cwe:"77",capec:"1000/152/248/88",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:(?:['\"\\x60({|;&]|(?:^|['\"\\x60({|;&])(?:cmd(?:\\.exe)?\\s+(?:/\\w(?::\\w+)?\\s+)*))(?:ping|curl|wget|telnet)|\\bnslookup)[\\s,]",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"dog-934-001",name:"XXE - XML file loads external entity",tags:{type:"xxe",category:"attack_attempt",cwe:"91",capec:"1000/152/248/250",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.body"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?:<\\?xml[^>]*>.*)<!ENTITY[^>]+SYSTEM\\s+[^>]+>",options:{case_sensitive:!1,min_length:24}},operator:"match_regex"}],transformers:[]},{id:"dog-941-001",name:"XSS in source property",tags:{type:"xss",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"<(?:iframe|esi:include)(?:(?:\\s|/)*\\w+=[\"'\\w]+)*(?:\\s|/)*src(?:doc)?=[\"']?(?:data:|javascript:|http:|dns:|//)[^\\s'\"]+['\"]?",options:{min_length:14}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"dog-942-001",name:"Blind XSS callback domains",tags:{type:"xss",category:"attack_attempt",cwe:"83",capec:"1000/152/242/63/591/243",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"https?:\\/\\/(?:.*\\.)?(?:bxss\\.(?:in|me)|xss\\.ht|js\\.rip)",options:{case_sensitive:!1}},operator:"match_regex"}],transformers:[]},{id:"nfd-000-001",name:"Detect common directory discovery scans",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"phrase_match",parameters:{inputs:[{address:"server.request.uri.raw"}],list:["/wordpress/","/etc/","/login.php","/install.php","/administrator","/admin.php","/wp-config","/phpmyadmin","/fckeditor","/mysql","/manager/html",".htaccess","/config.php","/configuration","/cgi-bin/php","/search.php","/tinymce","/tiny_mce","/settings.php","../../..","/install/","/download.php","/webdav","/forum.php","/user.php","/style.php","/jmx-console","/modules.php","/include.php","/default.asp","/help.php","/database.yml","/database.yml.pgsql","/database.yml.sqlite3","/database.yml.sqlite","/database.yml.mysql",".%2e/","/view.php","/header.php","/search.asp","%5c%5c","/server/php/","/invoker/jmxinvokerservlet","/phpmyadmin/index.php","/data/admin/allowurl.txt","/verify.php","/misc/ajax.js","/.idea","/module.php","/backup.rar","/backup.tar","/backup.zip","/backup.7z","/backup.gz","/backup.tgz","/backup.tar.gz","waitfor%20delay","/calendar.php","/news.php","/dompdf.php","))))))))))))))))","/web.config","tree.php","/cgi-bin-sdb/printenv","/comments.php","/detail.asp","/license.txt","/admin.asp","/auth.php","/list.php","/content.php","/mod.php","/mini.php","/install.pgsql","/install.mysql","/install.sqlite","/install.sqlite3","/install.txt","/install.md","/doku.php","/main.asp","/myadmin","/force-download.php","/iisprotect/admin","/.gitignore","/print.php","/common.php","/mainfile.php","/functions.php","/scripts/setup.php","/faq.php","/op/op.login.php","/home.php","/includes/hnmain.inc.php3","/preview.php","/dump.rar","/dump.tar","/dump.zip","/dump.7z","/dump.gz","/dump.tgz","/dump.tar.gz","/thumbnail.php","/sendcard.php","/global.asax","/directory.php","/footer.php","/error.asp","/forum.asp","/save.php","/htmlsax3.php","/adm/krgourl.php","/includes/converter.inc.php","/nucleus/libs/pluginadmin.php","/base_qry_common.php","/fileadmin","/bitrix/admin/","/adm.php","/util/barcode.php","/action.php","/rss.asp","/downloads.php","/page.php","/snarf_ajax.php","/fck/editor","/sendmail.php","/detail.php","/iframe.php","/swfupload.swf","/jenkins/login","/phpmyadmin/main.php","/phpmyadmin/scripts/setup.php","/user/index.php","/checkout.php","/process.php","/ks_inc/ajax.js","/export.php","/register.php","/cart.php","/console.php","/friend.php","/readmsg.php","/install.asp","/dagent/downloadreport.asp","/system/index.php","/core/changelog.txt","/js/util.js","/interna.php","/gallery.php","/links.php","/data/admin/ver.txt","/language/zh-cn.xml","/productdetails.asp","/admin/template/article_more/config.htm","/components/com_moofaq/includes/file_includer.php","/licence.txt","/rss.xsl","/vtigerservice.php","/mysql/main.php","/passwiki.php","/scr/soustab.php","/global.php","/email.php","/user.asp","/msd","/products.php","/cultbooking.php","/cron.php","/static/js/admincp.js","/comment.php","/maintainers","/modules/plain/adminpart/addplain.php","/wp-content/plugins/ungallery/source_vuln.php","/upgrade.txt","/category.php","/index_logged.php","/members.asp","/script/html.js","/images/ad.js","/awstats/awstats.pl","/includes/esqueletos/skel_null.php","/modules/profile/user.php","/window_top.php","/openbrowser.php","/thread.php","tinfoil_xss","/includes/include.php","/urheber.php","/header.inc.php","/mysqldumper","/display.php","/website.php","/stats.php","/assets/plugins/mp3_id/mp3_id.php","/siteminderagent/forms/smpwservices.fcc"]}}],transformers:["lowercase"]},{id:"nfd-000-002",name:"Detect failed attempt to fetch readme files",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"readme\\.[\\.a-z0-9]+$",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-003",name:"Detect failed attempt to fetch Java EE resource files",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"^(?:.*web\\-inf)(?:.*web\\.xml).*$",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-004",name:"Detect failed attempt to fetch code files",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\.(java|pyc?|rb|class)\\b",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-005",name:"Detect failed attempt to fetch source code archives",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\.(sql|log|ndb|gz|zip|tar\\.gz|tar|regVV|reg|conf|bz2|ini|db|war|bat|inc|btr|server|ds|conf|config|admin|master|sln|bak)\\b(?:[^.]|$)",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-006",name:"Detect failed attempt to fetch sensitive files",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\.(cgi|bat|dll|exe|key|cert|crt|pem|der|pkcs|pkcs|pkcs[0-9]*|nsf|jsa|war|java|class|vb|vba|so|git|svn|hg|cvs)([^a-zA-Z0-9_]|$)",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-007",name:"Detect failed attempt to fetch archives",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"/[\\d\\-_]*\\.(rar|tar|zip|7z|gz|tgz|tar.gz)",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-008",name:"Detect failed attempt to trigger incorrect application behavior",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"(/(administrator/components/com.*\\.php|response\\.write\\(.+\\))|select\\(.+\\)from|\\(.*sleep\\(.+\\)|(%[a-zA-Z0-9]{2}[a-zA-Z]{0,1})+\\))",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-009",name:"Detect failed attempt to leak the structure of the application",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"/(login\\.rol|LICENSE|[\\w-]+\\.(plx|pwd))$",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-010",name:"Detect failed attempts to find API documentation",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"0"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"(?:/swagger\\b|/api[-/]docs?\\b)",options:{case_sensitive:!1}}}],transformers:[]},{id:"sqr-000-001",name:"SSRF: Try to access the credential manager of the main cloud services",tags:{type:"ssrf",category:"attack_attempt",cwe:"918",capec:"1000/225/115/664",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i)^\\W*((http|ftp)s?://)?\\W*((::f{4}:)?(169|(0x)?0*a9|0+251)\\.?(254|(0x)?0*fe|0+376)[0-9a-fx\\.:]+|metadata\\.google\\.internal|metadata\\.goog)\\W*/",options:{min_length:4}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"sqr-000-002",name:"Server-side Javascript injection: Try to detect obvious JS injection",tags:{type:"js_code_injection",category:"attack_attempt",cwe:"94",capec:"1000/152/242"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"require\\(['\"][\\w\\.]+['\"]\\)|process\\.\\w+\\([\\w\\.]*\\)|\\.toString\\(\\)",options:{min_length:4}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"sqr-000-008",name:"Windows: Detect attempts to exfiltrate .ini files",tags:{type:"command_injection",category:"attack_attempt",cwe:"78",capec:"1000/152/248/88",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i)[&|]\\s*type\\s+%\\w+%\\\\+\\w+\\.ini\\s*[&|]"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-009",name:"Linux: Detect attempts to exfiltrate passwd files",tags:{type:"command_injection",category:"attack_attempt",cwe:"78",capec:"1000/152/248/88",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i)[&|]\\s*cat\\s*\\/etc\\/[\\w\\.\\/]*passwd\\s*[&|]"},operator:"match_regex"}],transformers:["cmdLine"]},{id:"sqr-000-010",name:"Windows: Detect attempts to timeout a shell",tags:{type:"command_injection",category:"attack_attempt",cwe:"78",capec:"1000/152/248/88",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(?i)[&|]\\s*timeout\\s+/t\\s+\\d+\\s*[&|]"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-011",name:"SSRF: Try to access internal OMI service (CVE-2021-38647)",tags:{type:"ssrf",category:"attack_attempt",cwe:"918",capec:"1000/225/115/664",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"http(s?):\\/\\/([A-Za-z0-9\\.\\-\\_]+|\\[[A-Fa-f0-9\\:]+\\]|):5986\\/wsman",options:{min_length:4}},operator:"match_regex"}],transformers:[]},{id:"sqr-000-012",name:"SSRF: Detect SSRF attempt on internal service",tags:{type:"ssrf",category:"attack_attempt",cwe:"918",capec:"1000/225/115/664",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"^(jar:)?(http|https):\\/\\/([0-9oq]{1,5}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}|[0-9]{1,10})(:[0-9]{1,5})?(\\/[^:@]*)?$"},operator:"match_regex"}],transformers:["lowercase"]},{id:"sqr-000-013",name:"SSRF: Detect SSRF attempts using IPv6 or octal/hexdecimal obfuscation",tags:{type:"ssrf",category:"attack_attempt",cwe:"918",capec:"1000/225/115/664",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"^(jar:)?(http|https):\\/\\/((\\[)?[:0-9a-f\\.x]{2,}(\\])?)(:[0-9]{1,5})?(\\/[^:@]*)?$"},operator:"match_regex"}],transformers:["lowercase"]},{id:"sqr-000-014",name:"SSRF: Detect SSRF domain redirection bypass",tags:{type:"ssrf",category:"attack_attempt",cwe:"918",capec:"1000/225/115/664",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"(http|https):\\/\\/(?:.*\\.)?(?:burpcollaborator\\.net|localtest\\.me|mail\\.ebc\\.apple\\.com|bugbounty\\.dod\\.network|.*\\.[nx]ip\\.io|oastify\\.com|oast\\.(?:pro|live|site|online|fun|me)|sslip\\.io|requestbin\\.com|requestbin\\.net|hookbin\\.com|webhook\\.site|canarytokens\\.com|interact\\.sh|ngrok\\.io|bugbounty\\.click|prbly\\.win|qualysperiscope\\.com|vii\\.one|act1on3\\.ru)"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-015",name:"SSRF: Detect SSRF attempt using non HTTP protocol",tags:{type:"ssrf",category:"attack_attempt",cwe:"918",capec:"1000/225/115/664",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"^(jar:)?((file|netdoc):\\/\\/[\\\\\\/]+|(dict|gopher|ldap|sftp|tftp):\\/\\/.*:[0-9]{1,5})"},operator:"match_regex"}],transformers:["lowercase"]},{id:"sqr-000-017",name:"Log4shell: Attempt to exploit log4j CVE-2021-44228",tags:{type:"exploit_detection",category:"attack_attempt",cwe:"94",capec:"1000/152/242",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"},{address:"graphql.server.all_resolvers"},{address:"graphql.server.resolver"}],regex:"\\${[^j]*j[^n]*n[^d]*d[^i]*i[^:]*:[^}]*}"},operator:"match_regex"}],transformers:["unicode_normalize"]},{id:"ua0-600-0xx",name:"Joomla exploitation tool",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Joomla exploitation tool",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"JDatabaseDriverMysqli"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-10x",name:"Nessus",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nessus",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^Nessus(/|([ :]+SOAP))"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-12x",name:"Arachni",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Arachni",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^Arachni\\/v"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-13x",name:"Jorgee",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Jorgee",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bJorgee\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-14x",name:"Probely",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Probely",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bProbely\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-15x",name:"Metis",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Metis",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bmetis\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-16x",name:"SQL power injector",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"SQLPowerInjector",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"sql power injector"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-18x",name:"N-Stealth",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"N-Stealth",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bn-stealth\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-19x",name:"Brutus",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Brutus",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bbrutus\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-1xx",name:"Shellshock exploitation tool",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\(\\) \\{ :; *\\}"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-20x",name:"Netsparker",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Netsparker",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\bnetsparker\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-22x",name:"JAASCois",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"JAASCois",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bjaascois\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-26x",name:"Nsauditor",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nsauditor",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bnsauditor\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-27x",name:"Paros",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Paros",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)Mozilla/.* Paros/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-28x",name:"DirBuster",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"DirBuster",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bdirbuster\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-29x",name:"Pangolin",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Pangolin",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bpangolin\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-2xx",name:"Qualys",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Qualys",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bqualys\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-30x",name:"SQLNinja",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"SQLNinja",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bsqlninja\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-31x",name:"Nikto",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nikto",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\(Nikto/[\\d\\.]+\\)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-33x",name:"BlackWidow",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"BlackWidow",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bblack\\s?widow\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-34x",name:"Grendel-Scan",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Grendel-Scan",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bgrendel-scan\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-35x",name:"Havij",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Havij",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bhavij\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-36x",name:"w3af",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"w3af",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bw3af\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-37x",name:"Nmap",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nmap",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"nmap (nse|scripting engine)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-39x",name:"Nessus Scripted",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nessus",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^'?[a-z0-9_]+\\.nasl'?$"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-3xx",name:"Evil Scanner",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"EvilScanner",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bevilScanner\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-40x",name:"WebFuck",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"WebFuck",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bWebFuck\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-42x",name:"OpenVAS",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"OpenVAS",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)OpenVAS\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-43x",name:"Spider-Pig",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Spider-Pig",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"Powered by Spider-Pig by tinfoilsecurity\\.com"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-44x",name:"Zgrab",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Zgrab",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"Mozilla/\\d+.\\d+ zgrab"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-45x",name:"Zmeu",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Zmeu",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bZmEu\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-47x",name:"GoogleSecurityScanner",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"GoogleSecurityScanner",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bGoogleSecurityScanner\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-48x",name:"Commix",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Commix",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^commix\\/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-49x",name:"Gobuster",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Gobuster",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^gobuster\\/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-4xx",name:"CGIchk",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"CGIchk",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bcgichk\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-51x",name:"FFUF",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"FFUF",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^Fuzz Faster U Fool\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-52x",name:"Nuclei",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nuclei",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^Nuclei\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-53x",name:"Tsunami",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Tsunami",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bTsunamiSecurityScanner\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-54x",name:"Nimbostratus",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Nimbostratus",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bnimbostratus-bot\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-55x",name:"Datadog test scanner: user-agent",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Datadog Canary Test",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"grpc.server.request.metadata",key_path:["dd-canary"]}],regex:"^dd-test-scanner-log(?:$|/|\\s)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-56x",name:"Datadog test scanner - blocking version: user-agent",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Datadog Canary Test",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"grpc.server.request.metadata",key_path:["dd-canary"]}],regex:"^dd-test-scanner-log-block(?:$|/|\\s)"},operator:"match_regex"}],transformers:[],on_match:["block"]},{id:"ua0-600-57x",name:"AlertLogic",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"AlertLogic",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\bAlertLogic-MDR-"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-58x",name:"wfuzz",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"wfuzz",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\bwfuzz\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-59x",name:"Detectify",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Detectify",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\bdetectify\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-5xx",name:"Blind SQL Injection Brute Forcer",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"BSQLBF",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bbsqlbf\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-60x",name:"masscan",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"masscan",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^masscan/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-61x",name:"WPScan",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"WPScan",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^wpscan\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-62x",name:"Aon pentesting services",tags:{type:"commercial_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Aon",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^Aon/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-63x",name:"FeroxBuster",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"feroxbuster",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^feroxbuster/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-6xx",name:"Stealthy scanner",tags:{type:"security_scanner",category:"attack_attempt",cwe:"200",capec:"1000/118/169",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"mozilla/4\\.0 \\(compatible(; msie (?:6\\.0; (?:win32|Windows NT 5\\.0)|4\\.0; Windows NT))?\\)",options:{case_sensitive:!1}},operator:"match_regex"}],transformers:[]},{id:"ua0-600-7xx",name:"SQLmap",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"SQLmap",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^sqlmap/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-9xx",name:"Skipfish",tags:{type:"attack_tool",category:"attack_attempt",cwe:"200",capec:"1000/118/169",tool_name:"Skipfish",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)mozilla/5\\.0 sf/"},operator:"match_regex"}],transformers:[]}],processors=[{id:"extract-content",generator:"extract_schema",conditions:[{operator:"equals",parameters:{inputs:[{address:"waf.context.processor",key_path:["extract-schema"]}],type:"boolean",value:!0}}],parameters:{mappings:[{inputs:[{address:"server.request.body"}],output:"_dd.appsec.s.req.body"},{inputs:[{address:"server.request.cookies"}],output:"_dd.appsec.s.req.cookies"},{inputs:[{address:"server.request.query"}],output:"_dd.appsec.s.req.query"},{inputs:[{address:"server.request.path_params"}],output:"_dd.appsec.s.req.params"},{inputs:[{address:"server.response.body"}],output:"_dd.appsec.s.res.body"},{inputs:[{address:"graphql.server.all_resolvers"}],output:"_dd.appsec.s.graphql.all_resolvers"},{inputs:[{address:"graphql.server.resolver"}],output:"_dd.appsec.s.graphql.resolver"}],scanners:[{tags:{category:"payment"}},{tags:{category:"pii"}}]},evaluate:!1,output:!0},{id:"extract-headers",generator:"extract_schema",conditions:[{operator:"equals",parameters:{inputs:[{address:"waf.context.processor",key_path:["extract-schema"]}],type:"boolean",value:!0}}],parameters:{mappings:[{inputs:[{address:"server.request.headers.no_cookies"}],output:"_dd.appsec.s.req.headers"},{inputs:[{address:"server.response.headers.no_cookies"}],output:"_dd.appsec.s.res.headers"}],scanners:[{tags:{category:"credentials"}},{tags:{category:"pii"}}]},evaluate:!1,output:!0}],scanners=[{id:"JU1sRk3mSzqSUJn6GrVn7g",name:"American Express Card Scanner (4+4+4+3 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b3[47]\\d{2}(?:(?:\\s\\d{4}\\s\\d{4}\\s\\d{3})|(?:\\,\\d{4}\\,\\d{4}\\,\\d{3})|(?:-\\d{4}-\\d{4}-\\d{3})|(?:\\.\\d{4}\\.\\d{4}\\.\\d{3}))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"amex",category:"payment"}},{id:"edmH513UTQWcRiQ9UnzHlw-mod",name:"American Express Card Scanner (4+6|5+5|6 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b3[47]\\d{2}(?:(?:\\s\\d{5,6}\\s\\d{5,6})|(?:\\.\\d{5,6}\\.\\d{5,6})|(?:-\\d{5,6}-\\d{5,6})|(?:,\\d{5,6},\\d{5,6}))\\b",options:{case_sensitive:!1,min_length:17}}},tags:{type:"card",card_type:"amex",category:"payment"}},{id:"e6K4h_7qTLaMiAbaNXoSZA",name:"American Express Card Scanner (8+7 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b3[47]\\d{6}(?:(?:\\s\\d{7})|(?:\\,\\d{7})|(?:-\\d{7})|(?:\\.\\d{7}))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"amex",category:"payment"}},{id:"K2rZflWzRhGM9HiTc6whyQ",name:"American Express Card Scanner (1x15 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b3[47]\\d{13}\\b",options:{case_sensitive:!1,min_length:15}}},tags:{type:"card",card_type:"amex",category:"payment"}},{id:"9d7756e343cefa22a5c098e1092590f806eb5446",name:"Basic Authentication Scanner",key:{operator:"match_regex",parameters:{regex:"\\bauthorization\\b",options:{case_sensitive:!1,min_length:13}}},value:{operator:"match_regex",parameters:{regex:"^basic\\s+[A-Za-z0-9+/=]+",options:{case_sensitive:!1,min_length:7}}},tags:{type:"basic_auth",category:"credentials"}},{id:"mZy8XjZLReC9smpERXWnnw",name:"Bearer Authentication Scanner",key:{operator:"match_regex",parameters:{regex:"\\bauthorization\\b",options:{case_sensitive:!1,min_length:13}}},value:{operator:"match_regex",parameters:{regex:"^bearer\\s+[-a-z0-9._~+/]{4,}",options:{case_sensitive:!1,min_length:11}}},tags:{type:"bearer_token",category:"credentials"}},{id:"450239afc250a19799b6c03dc0e16fd6a4b2a1af",name:"Canadian Social Insurance Number Scanner",key:{operator:"match_regex",parameters:{regex:"\\b(?:social[\\s_]?(?:insurance(?:\\s+number)?)?|SIN|Canadian[\\s_]?(?:social[\\s_]?(?:insurance)?|insurance[\\s_]?number)?)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b\\d{3}-\\d{3}-\\d{3}\\b",options:{case_sensitive:!1,min_length:11}}},tags:{type:"canadian_sin",category:"pii"}},{id:"87a879ff33693b46c8a614d8211f5a2c289beca0",name:"Digest Authentication Scanner",key:{operator:"match_regex",parameters:{regex:"\\bauthorization\\b",options:{case_sensitive:!1,min_length:13}}},value:{operator:"match_regex",parameters:{regex:"^digest\\s+",options:{case_sensitive:!1,min_length:7}}},tags:{type:"digest_auth",category:"credentials"}},{id:"qWumeP1GQUa_E4ffAnT-Yg",name:"American Express Card Scanner (1x14 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"(?:30[0-59]\\d|3[689]\\d{2})(?:\\d{10})",options:{case_sensitive:!1,min_length:14}}},tags:{type:"card",card_type:"diners",category:"payment"}},{id:"NlTWWM5LS6W0GSqBLuvtRw",name:"Diners Card Scanner (4+4+4+2 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:30[0-59]\\d|3[689]\\d{2})(?:(?:\\s\\d{4}\\s\\d{4}\\s\\d{2})|(?:\\,\\d{4}\\,\\d{4}\\,\\d{2})|(?:-\\d{4}-\\d{4}-\\d{2})|(?:\\.\\d{4}\\.\\d{4}\\.\\d{2}))\\b",options:{case_sensitive:!1,min_length:17}}},tags:{type:"card",card_type:"diners",category:"payment"}},{id:"Xr5VdbQSTXitYGGiTfxBpw",name:"Diners Card Scanner (4+6+4 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:30[0-59]\\d|3[689]\\d{2})(?:(?:\\s\\d{6}\\s\\d{4})|(?:\\.\\d{6}\\.\\d{4})|(?:-\\d{6}-\\d{4})|(?:,\\d{6},\\d{4}))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"diners",category:"payment"}},{id:"gAbunN_WQNytxu54DjcbAA-mod",name:"Diners Card Scanner (8+6 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:30[0-59]\\d{5}|3[689]\\d{6})\\s?(?:(?:\\s\\d{6})|(?:\\,\\d{6})|(?:-\\d{6})|(?:\\.\\d{6}))\\b",options:{case_sensitive:!1,min_length:14}}},tags:{type:"card",card_type:"diners",category:"payment"}},{id:"9cs4qCfEQBeX17U7AepOvQ",name:"MasterCard Scanner (2x8 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:6221(?:2[6-9]|[3-9][0-9])\\d{2}(?:,\\d{8}|\\s\\d{8}|-\\d{8}|\\.\\d{8})|6229(?:[01][0-9]|2[0-5])\\d{2}(?:,\\d{8}|\\s\\d{8}|-\\d{8}|\\.\\d{8})|(?:6011|65\\d{2}|64[4-9]\\d|622[2-8])\\d{4}(?:,\\d{8}|\\s\\d{8}|-\\d{8}|\\.\\d{8}))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"discover",category:"payment"}},{id:"YBIDWJIvQWW_TFOyU0CGJg",name:"Discover Card Scanner (4x4 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:(?:(?:6221(?:2[6-9]|[3-9][0-9])\\d{2}(?:,\\d{4}){2})|(?:6221\\s(?:2[6-9]|[3-9][0-9])\\d{2}(?:\\s\\d{4}){2})|(?:6221\\.(?:2[6-9]|[3-9][0-9])\\d{2}(?:\\.\\d{4}){2})|(?:6221-(?:2[6-9]|[3-9][0-9])\\d{2}(?:-\\d{4}){2}))|(?:(?:6229(?:[01][0-9]|2[0-5])\\d{2}(?:,\\d{4}){2})|(?:6229\\s(?:[01][0-9]|2[0-5])\\d{2}(?:\\s\\d{4}){2})|(?:6229\\.(?:[01][0-9]|2[0-5])\\d{2}(?:\\.\\d{4}){2})|(?:6229-(?:[01][0-9]|2[0-5])\\d{2}(?:-\\d{4}){2}))|(?:(?:6011|65\\d{2}|64[4-9]\\d|622[2-8])(?:(?:\\s\\d{4}){3}|(?:\\.\\d{4}){3}|(?:-\\d{4}){3}|(?:,\\d{4}){3})))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"discover",category:"payment"}},{id:"12cpbjtVTMaMutFhh9sojQ",name:"Discover Card Scanner (1x16 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:6221(?:2[6-9]|[3-9][0-9])\\d{10}|6229(?:[01][0-9]|2[0-5])\\d{10}|(?:6011|65\\d{2}|64[4-9]\\d|622[2-8])\\d{12})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"discover",category:"payment"}},{id:"PuXiVTCkTHOtj0Yad1ppsw",name:"Standard E-mail Address",key:{operator:"match_regex",parameters:{regex:"\\b(?:(?:e[-\\s]?)?mail|address|sender|\\bto\\b|from|recipient)\\b",options:{case_sensitive:!1,min_length:2}}},value:{operator:"match_regex",parameters:{regex:"\\b[\\w!#$%&'*+/=?`{|}~^-]+(?:\\.[\\w!#$%&'*+/=?`{|}~^-]+)*(%40|@)(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,6}\\b",options:{case_sensitive:!1,min_length:5}}},tags:{type:"email",category:"pii"}},{id:"8VS2RKxzR8a_95L5fuwaXQ",name:"IBAN",key:{operator:"match_regex",parameters:{regex:"\\b(?:iban|account|sender|receiver)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:NO\\d{2}(?:[ \\-]?\\d{4}){2}[ \\-]?\\d{3}|BE\\d{2}(?:[ \\-]?\\d{4}){3}|(?:DK|FO|FI|GL|SD)\\d{2}(?:[ \\-]?\\d{4}){3}[ \\-]?\\d{2}|NL\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?\\d{4}){2}[ \\-]?\\d{2}|MK\\d{2}[ \\-]?\\d{3}[A-Z0-9](?:[ \\-]?[A-Z0-9]{4}){2}[ \\-]?[A-Z0-9]\\d{2}|SI\\d{17}|(?:AT|BA|EE|LT|XK)\\d{18}|(?:LU|KZ|EE|LT)\\d{5}[A-Z0-9]{13}|LV\\d{2}[A-Z]{4}[A-Z0-9]{13}|(?:LI|CH)\\d{2}[ \\-]?\\d{4}[ \\-]?\\d[A-Z0-9]{3}(?:[ \\-]?[A-Z0-9]{4}){2}[ \\-]?[A-Z0-9]|HR\\d{2}(?:[ \\-]?\\d{4}){4}[ \\-]?\\d|GE\\d{2}[ \\-]?[A-Z0-9]{2}\\d{2}\\d{14}|VA\\d{20}|BG\\d{2}[A-Z]{4}\\d{6}[A-Z0-9]{8}|BH\\d{2}[A-Z]{4}[A-Z0-9]{14}|GB\\d{2}[A-Z]{4}(?:[ \\-]?\\d{4}){3}[ \\-]?\\d{2}|IE\\d{2}[ \\-]?[A-Z0-9]{4}(?:[ \\-]?\\d{4}){3}[ \\-]?\\d{2}|(?:CR|DE|ME|RS)\\d{2}(?:[ \\-]?\\d{4}){4}[ \\-]?\\d{2}|(?:AE|TL|IL)\\d{2}(?:[ \\-]?\\d{4}){4}[ \\-]?\\d{3}|GI\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?[A-Z0-9]{4}){3}[ \\-]?[A-Z0-9]{3}|IQ\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?\\d{4}){3}[ \\-]?\\d{3}|MD\\d{2}(?:[ \\-]?[A-Z0-9]{4}){5}|SA\\d{2}[ \\-]?\\d{2}[A-Z0-9]{2}(?:[ \\-]?[A-Z0-9]{4}){4}|RO\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?[A-Z0-9]{4}){4}|(?:PK|VG)\\d{2}[ \\-]?[A-Z0-9]{4}(?:[ \\-]?\\d{4}){4}|AD\\d{2}(?:[ \\-]?\\d{4}){2}(?:[ \\-]?[A-Z0-9]{4}){3}|(?:CZ|SK|ES|SE|TN)\\d{2}(?:[ \\-]?\\d{4}){5}|(?:LY|PT|ST)\\d{2}(?:[ \\-]?\\d{4}){5}[ \\-]?\\d|TR\\d{2}[ \\-]?\\d{4}[ \\-]?\\d[A-Z0-9]{3}(?:[ \\-]?[A-Z0-9]{4}){3}[ \\-]?[A-Z0-9]{2}|IS\\d{2}(?:[ \\-]?\\d{4}){5}[ \\-]?\\d{2}|(?:IT|SM)\\d{2}[ \\-]?[A-Z]\\d{3}[ \\-]?\\d{4}[ \\-]?\\d{3}[A-Z0-9](?:[ \\-]?[A-Z0-9]{4}){2}[ \\-]?[A-Z0-9]{3}|GR\\d{2}[ \\-]?\\d{4}[ \\-]?\\d{3}[A-Z0-9](?:[ \\-]?[A-Z0-9]{4}){3}[A-Z0-9]{3}|(?:FR|MC)\\d{2}(?:[ \\-]?\\d{4}){2}[ \\-]?\\d{2}[A-Z0-9]{2}(?:[ \\-]?[A-Z0-9]{4}){2}[ \\-]?[A-Z0-9]\\d{2}|MR\\d{2}(?:[ \\-]?\\d{4}){5}[ \\-]?\\d{3}|(?:SV|DO)\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?\\d{4}){5}|BY\\d{2}[ \\-]?[A-Z]{4}[ \\-]?\\d{4}(?:[ \\-]?[A-Z0-9]{4}){4}|GT\\d{2}(?:[ \\-]?[A-Z0-9]{4}){6}|AZ\\d{2}[ \\-]?[A-Z0-9]{4}(?:[ \\-]?\\d{5}){4}|LB\\d{2}[ \\-]?\\d{4}(?:[ \\-]?[A-Z0-9]{5}){4}|(?:AL|CY)\\d{2}(?:[ \\-]?\\d{4}){2}(?:[ \\-]?[A-Z0-9]{4}){4}|(?:HU|PL)\\d{2}(?:[ \\-]?\\d{4}){6}|QA\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?[A-Z0-9]{4}){5}[ \\-]?[A-Z0-9]|PS\\d{2}[ \\-]?[A-Z0-9]{4}(?:[ \\-]?\\d{4}){5}[ \\-]?\\d|UA\\d{2}[ \\-]?\\d{4}[ \\-]?\\d{2}[A-Z0-9]{2}(?:[ \\-]?[A-Z0-9]{4}){4}[ \\-]?[A-Z0-9]|BR\\d{2}(?:[ \\-]?\\d{4}){5}[ \\-]?\\d{3}[A-Z0-9][ \\-]?[A-Z0-9]|EG\\d{2}(?:[ \\-]?\\d{4}){6}\\d|MU\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?\\d{4}){4}\\d{3}[A-Z][ \\-]?[A-Z]{2}|(?:KW|JO)\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?[A-Z0-9]{4}){5}[ \\-]?[A-Z0-9]{2}|MT\\d{2}[ \\-]?[A-Z]{4}[ \\-]?\\d{4}[ \\-]?\\d[A-Z0-9]{3}(?:[ \\-]?[A-Z0-9]{3}){4}[ \\-]?[A-Z0-9]{3}|SC\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?\\d{4}){5}[ \\-]?[A-Z]{3}|LC\\d{2}[ \\-]?[A-Z]{4}(?:[ \\-]?[A-Z0-9]{4}){6})\\b",options:{case_sensitive:!1,min_length:15}}},tags:{type:"iban",category:"payment"}},{id:"h6WJcecQTwqvN9KeEtwDvg",name:"JCB Card Scanner (1x16 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b35(?:2[89]|[3-9][0-9])(?:\\d{12})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"jcb",category:"payment"}},{id:"gcEaMu_VSJ2-bGCEkgyC0w",name:"JCB Card Scanner (2x8 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b35(?:2[89]|[3-9][0-9])\\d{4}(?:(?:,\\d{8})|(?:-\\d{8})|(?:\\s\\d{8})|(?:\\.\\d{8}))\\b",options:{case_sensitive:!1,min_length:17}}},tags:{type:"card",card_type:"jcb",category:"payment"}},{id:"imTliuhXT5GAeRNhqChXQQ",name:"JCB Card Scanner (4x4 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b35(?:2[89]|[3-9][0-9])(?:(?:\\s\\d{4}){3}|(?:\\.\\d{4}){3}|(?:-\\d{4}){3}|(?:,\\d{4}){3})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"jcb",category:"payment"}},{id:"9osY3xc9Q7ONAV0zw9Uz4A",name:"JSON Web Token",value:{operator:"match_regex",parameters:{regex:"\\bey[I-L][\\w=-]+\\.ey[I-L][\\w=-]+(\\.[\\w.+\\/=-]+)?\\b",options:{case_sensitive:!1,min_length:20}}},tags:{type:"json_web_token",category:"credentials"}},{id:"d1Q9D3YMRxuVKf6CZInJPw",name:"Maestro Card Scanner (1x16 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:5[06-9]\\d{2}|6\\d{3})(?:\\d{12})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"maestro",category:"payment"}},{id:"M3YIQKKjRVmoeQuM3pjzrw",name:"Maestro Card Scanner (2x8 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:5[06-9]\\d{6}|6\\d{7})(?:\\s\\d{8}|\\.\\d{8}|-\\d{8}|,\\d{8})\\b",options:{case_sensitive:!1,min_length:17}}},tags:{type:"card",card_type:"maestro",category:"payment"}},{id:"hRxiQBlSSVKcjh5U7LZYLA",name:"Maestro Card Scanner (4x4 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:5[06-9]\\d{2}|6\\d{3})(?:(?:\\s\\d{4}){3}|(?:\\.\\d{4}){3}|(?:-\\d{4}){3}|(?:,\\d{4}){3})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"maestro",category:"payment"}},{id:"NwhIYNS4STqZys37WlaIKA",name:"MasterCard Scanner (2x8 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:(?:5[1-5]\\d{2})|(?:222[1-9])|(?:22[3-9]\\d)|(?:2[3-6]\\d{2})|(?:27[0-1]\\d)|(?:2720))(?:(?:\\d{4}(?:(?:,\\d{8})|(?:-\\d{8})|(?:\\s\\d{8})|(?:\\.\\d{8}))))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"mastercard",category:"payment"}},{id:"axxJkyjhRTOuhjwlsA35Vw",name:"MasterCard Scanner (4x4 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:(?:5[1-5]\\d{2})|(?:222[1-9])|(?:22[3-9]\\d)|(?:2[3-6]\\d{2})|(?:27[0-1]\\d)|(?:2720))(?:(?:\\s\\d{4}){3}|(?:\\.\\d{4}){3}|(?:-\\d{4}){3}|(?:,\\d{4}){3})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"mastercard",category:"payment"}},{id:"76EhmoK3TPqJcpM-fK0pLw",name:"MasterCard Scanner (1x16 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b(?:(?:5[1-5]\\d{2})|(?:222[1-9])|(?:22[3-9]\\d)|(?:2[3-6]\\d{2})|(?:27[0-1]\\d)|(?:2720))(?:\\d{12})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"mastercard",category:"payment"}},{id:"de0899e0cbaaa812bb624cf04c912071012f616d-mod",name:"UK National Insurance Number Scanner",key:{operator:"match_regex",parameters:{regex:"^nin$|\\binsurance\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b[A-Z]{2}[\\s-]?\\d{6}[\\s-]?[A-Z]?\\b",options:{case_sensitive:!1,min_length:8}}},tags:{type:"uk_nin",category:"pii"}},{id:"d962f7ddb3f55041e39195a60ff79d4814a7c331",name:"US Passport Scanner",key:{operator:"match_regex",parameters:{regex:"\\bpassport\\b",options:{case_sensitive:!1,min_length:8}}},value:{operator:"match_regex",parameters:{regex:"\\b[0-9A-Z]{9}\\b|\\b[0-9]{6}[A-Z][0-9]{2}\\b",options:{case_sensitive:!1,min_length:8}}},tags:{type:"passport_number",category:"pii"}},{id:"7771fc3b-b205-4b93-bcef-28608c5c1b54",name:"United States Social Security Number Scanner",key:{operator:"match_regex",parameters:{regex:"\\b(?:SSN|(?:(?:social)?[\\s_]?(?:security)?[\\s_]?(?:number)?)?)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b\\d{3}[-\\s\\.]{1}\\d{2}[-\\s\\.]{1}\\d{4}\\b",options:{case_sensitive:!1,min_length:11}}},tags:{type:"us_ssn",category:"pii"}},{id:"ac6d683cbac77f6e399a14990793dd8fd0fca333",name:"US Vehicle Identification Number Scanner",key:{operator:"match_regex",parameters:{regex:"\\b(?:vehicle[_\\s-]*identification[_\\s-]*number|vin)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b[A-HJ-NPR-Z0-9]{17}\\b",options:{case_sensitive:!1,min_length:17}}},tags:{type:"vin",category:"pii"}},{id:"wJIgOygRQhKkR69b_9XbRQ",name:"Visa Card Scanner (2x8 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b4\\d{3}(?:(?:\\d{4}(?:(?:,\\d{8})|(?:-\\d{8})|(?:\\s\\d{8})|(?:\\.\\d{8}))))\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"visa",category:"payment"}},{id:"0o71SJxXQNK7Q6gMbBesFQ",name:"Visa Card Scanner (4x4 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"\\b4\\d{3}(?:(?:,\\d{4}){3}|(?:\\s\\d{4}){3}|(?:\\.\\d{4}){3}|(?:-\\d{4}){3})\\b",options:{case_sensitive:!1,min_length:16}}},tags:{type:"card",card_type:"visa",category:"payment"}},{id:"QrHD6AfgQm6z-j0wStxTvA",name:"Visa Card Scanner (1x15 & 1x16 & 1x19 digits)",key:{operator:"match_regex",parameters:{regex:"\\b(?:card|cc|credit|debit|payment|amex|visa|mastercard|maestro|discover|jcb|diner)\\b",options:{case_sensitive:!1,min_length:3}}},value:{operator:"match_regex",parameters:{regex:"4[0-9]{12}(?:[0-9]{3})?",options:{case_sensitive:!1,min_length:13}}},tags:{type:"card",card_type:"visa",category:"payment"}}],require$$4={version:version$3,metadata:metadata,rules:rules,processors:processors,scanners:scanners},rule_manager,hasRequiredRule_manager,utils$1,hasRequiredUtils$1,set_user,hasRequiredSet_user,track_event,hasRequiredTrack_event,passport,hasRequiredPassport,graphql,hasRequiredGraphql,appsec,hasRequiredAppsec,remote_config,hasRequiredRemote_config,user_blocking,hasRequiredUser_blocking,sdk,hasRequiredSdk;function requireRule_manager(){if(hasRequiredRule_manager)return rule_manager;hasRequiredRule_manager=1;const e=require$$0$6,t=requireWaf(),{ACKNOWLEDGED:r,ERROR:s}=requireApply_states(),n=requireBlocking();let i,a,o=new Map,c=new Map,u=new Map,l=new Map,p=new Map;class d extends Map{constructor(e){super(e),this.modified=!1}set(e,t){return this.modified=!0,super.set(e,t)}delete(e){const t=super.delete(e);return t&&(this.modified=!0),t}clear(){return this.modified=!1,super.clear()}}function h(e){return Array.from(e.values()).flat()}function f(e,t){const r=e.find((e=>e.value===t.value));return r&&!("expiration"in r)||(r&&"expiration"in t&&t.expiration>r.expiration?r.expiration=t.expiration:r&&!("expiration"in t)?delete r.expiration:r||e.push({...t})),e}function g(e){const t={...e};if(t.data){const e=[];t.data.forEach((t=>{e.push({...t})})),t.data=e}return t}return rule_manager={loadRules:function(r){i=r.rules?JSON.parse(e.readFileSync(r.rules)):require$$4,t.init(i,r),i.actions&&n.updateBlockingConfiguration(i.actions.find((e=>"block"===e.id)))},updateWafFromRC:function({toUnapply:e,toApply:m,toModify:_}){const b=new Set,y=new d(o);let v,S;const q=new d(c),E=new d(u),R=new d(l),T=new d(p);for(const t of e){const{product:e,id:r}=t;"ASM_DATA"===e?y.delete(r):"ASM_DD"===e?a===r&&(v=i):"ASM"===e&&(q.delete(r),E.delete(r),R.delete(r),T.delete(r))}for(const e of[...m,..._]){const{product:t,id:r,file:n}=e;if("ASM_DATA"===t)n&&n.rules_data&&n.rules_data.length&&y.set(r,n.rules_data),b.add(e);else if("ASM_DD"===t)if(a&&a!==r&&v!==i)e.apply_state=s,e.apply_error="Multiple ruleset received in ASM_DD";else{if(n&&n.rules&&n.rules.length){const{version:e,metadata:t,rules:s,processors:i,scanners:a}=n;v={version:e,metadata:t,rules:s,processors:i,scanners:a},S=r}b.add(e)}else if("ASM"===t){let t=!1;n&&n.rules_override&&n.rules_override.length&&(t=!0,q.set(r,n.rules_override)),n&&n.exclusions&&n.exclusions.length&&(t=!0,E.set(r,n.exclusions)),n&&n.custom_rules&&n.custom_rules.length&&(t=!0,R.set(r,n.custom_rules)),n&&n.actions&&n.actions.length&&T.set(r,n.actions),t&&b.add(e)}}let A,w=r;if(y.modified||v||q.modified||E.modified||R.modified){const e=v||{};y.modified&&(e.rules_data=function(e){const t=new Map;for(const[,r]of e)for(const e of r){const r=`${e.id}+${e.type}`;if(t.has(r)){const s=t.get(r);e.data.reduce(f,s.data)}else t.set(r,g(e))}return Array.from(t.values())}(y)),q.modified&&(e.rules_override=h(q)),E.modified&&(e.exclusions=h(E)),R.modified&&(e.custom_rules=h(R));try{t.update(e),y.modified&&(o=y),v&&(a=S),q.modified&&(c=q),E.modified&&(u=E),R.modified&&(l=R)}catch(e){w=s,A=e.toString()}}for(const e of b)e.apply_state=w,A&&(e.apply_error=A);T.modified&&(n.updateBlockingConfiguration(h(T).find((e=>"block"===e.id))),p=T)},clearAllRules:function(){t.destroy(),n.updateBlockingConfiguration(void 0),i=void 0,o.clear(),a=void 0,c.clear(),u.clear(),l.clear(),p.clear()}},rule_manager}function requireUtils$1(){if(hasRequiredUtils$1)return utils$1;return hasRequiredUtils$1=1,utils$1={getRootSpan:function(e){const t=e.scope().active();return t&&t.context()._trace.started[0]}},utils$1}function requireSet_user(){if(hasRequiredSet_user)return set_user;hasRequiredSet_user=1;const{getRootSpan:e}=requireUtils$1(),t=requireLog$2();function r(e,t){for(const r of Object.keys(e))t.setTag(`usr.${r}`,""+e[r])}return set_user={setUserTags:r,setUser:function(s,n){if(!n||!n.id)return void t.warn("Invalid user provided to setUser");const i=e(s);i?r(n,i):t.warn("Root span not available in setUser")}},set_user}function requireTrack_event(){if(hasRequiredTrack_event)return track_event;hasRequiredTrack_event=1;const e=requireLog$2(),{getRootSpan:t}=requireUtils$1(),{MANUAL_KEEP:r}=requireTags$2(),{setUserTags:s}=requireSet_user();function n(t,s,n,i,a){if(!i)return void e.warn(`Root span not available in ${n}`);const o={[`appsec.events.${t}.track`]:"true",[r]:"true"};if("sdk"===a&&(o[`_dd.appsec.events.${t}.sdk`]="true"),"safe"!==a&&"extended"!==a||(o[`_dd.appsec.events.${t}.auto.mode`]=a),s)for(const e of Object.keys(s))o[`appsec.events.${t}.${e}`]=""+s[e];i.addTags(o)}return track_event={trackUserLoginSuccessEvent:function(r,i,a){if(!i||!i.id)return void e.warn("Invalid user provided to trackUserLoginSuccessEvent");const o=t(r);o?(s(i,o),n("users.login.success",a,"trackUserLoginSuccessEvent",o,"sdk")):e.warn("Root span not available in trackUserLoginSuccessEvent")},trackUserLoginFailureEvent:function(r,s,i,a){if(!s||"string"!=typeof s)return void e.warn("Invalid userId provided to trackUserLoginFailureEvent");n("users.login.failure",{"usr.id":s,"usr.exists":i?"true":"false",...a},"trackUserLoginFailureEvent",t(r),"sdk")},trackCustomEvent:function(r,s,i){s&&"string"==typeof s?n(s,i,"trackCustomEvent",t(r),"sdk"):e.warn("Invalid eventName provided to trackCustomEvent")},trackEvent:n},track_event}function requirePassport(){if(hasRequiredPassport)return passport;hasRequiredPassport=1;const e=requireLog$2(),{trackEvent:t}=requireTrack_event(),{setUserTags:r}=requireSet_user(),s=new RegExp("^[0-9A-F]{8}-[0-9A-F]{4}-[1-5][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$","i"),n=new RegExp("^_dd\\.appsec\\.events\\.users\\.[\\W\\w+]+\\.sdk$","i");return passport={passportTrackEvent:function(i,a,o,c){if(function(e){let t=!1;return e&&"object"==typeof e&&(t=Object.entries(e).some((([e,t])=>n.test(e)&&"true"===t))),t}(o&&o.context()&&o.context()._tags))return;const u=function(e,t,r){const n={"usr.id":e};return n["usr.id"]?(t&&(t.id?n["usr.id"]=t.id:t._id&&(n["usr.id"]=t._id),"extended"===r&&(e&&(n["usr.login"]=e),t.email&&(n["usr.email"]=t.email),t.username?n["usr.username"]=t.username:t.name&&(n["usr.username"]=t.name))),"safe"===r&&(s.test(n["usr.id"])||(n["usr.id"]="")),n):n}(function(e){const t=e&&e.type;let r;return"local"!==t&&"http"!==t||(r=e.username),r}(i),a,c);if(void 0!==u["usr.id"])if(a){const e={};Object.entries(u).forEach((([t,r])=>{const s=t.split(".",2)[1];e[s]=r})),r(e,o),t("users.login.success",null,"passportTrackEvent",o,c)}else t("users.login.failure",u,"passportTrackEvent",o,c);else e.warn("No user ID found in authentication instrumentation")}},passport}function requireGraphql(){if(hasRequiredGraphql)return graphql;hasRequiredGraphql=1;const{storage:e}=requireDatadogCore(),{addSpecificEndpoint:t,specificBlockingTypes:r,getBlockingData:s}=requireBlocking(),n=requireWaf(),i=requireAddresses(),a=requireWeb(),{startGraphqlResolve:o,graphqlMiddlewareChannel:c,apolloChannel:u,apolloServerCoreChannel:l}=requireChannels(),p=new WeakMap;function d({context:t,resolverInfo:r}){const s=e.getStore()?.req;if(!s)return;if(!r||"object"!=typeof r)return;const a=n.run({ephemeral:{[i.HTTP_INCOMING_GRAPHQL_RESOLVER]:r}},s);if(a?.includes("block")){const e=p.get(s);e?.isInGraphqlRequest&&(e.blocked=!0,t?.abortController?.abort())}}function h(t){const r=t?.req||e.getStore()?.req;r&&p.set(r,{inApolloMiddleware:!0,blocked:!1})}function f(){const t=e.getStore()?.req;t&&p.set(t,{isInGraphqlRequest:!0,blocked:!1})}function g(t){const r=t?.req||e.getStore()?.req,s=p.get(r);s&&(s.inApolloMiddleware=!1)}function m(){const s=e.getStore()?.req,n=p.get(s);n?.inApolloMiddleware&&(n.isInGraphqlRequest=!0,t(s.method,s.originalUrl||s.url,r.GRAPHQL))}function _({abortController:t,abortData:n}){const i=e.getStore()?.req;if(!i)return;const o=p.get(i);if(o?.blocked){const e=a.root(i);if(!e)return;const o=s(i,r.GRAPHQL,e);n.statusCode=o.statusCode,n.headers=o.headers,n.message=o.body,t?.abort()}p.delete(i)}return graphql={enable:function(){c.subscribe({start:h,end:g}),l.subscribe({start:f,asyncEnd:_}),u.subscribe({start:m,asyncEnd:_}),o.subscribe(d)},disable:function(){c.unsubscribe({start:h,end:g}),l.unsubscribe({start:f,asyncEnd:_}),u.unsubscribe({start:m,asyncEnd:_}),o.hasSubscribers&&o.unsubscribe(d)}}}function requireAppsec(){if(hasRequiredAppsec)return appsec;hasRequiredAppsec=1;const e=requireLog$2(),t=requireRule_manager(),r=requireRemote_config(),{bodyParser:s,cookieParser:n,incomingHttpRequestStart:i,incomingHttpRequestEnd:a,passportVerify:o,queryParser:c,nextBodyParsed:u,nextQueryParsed:l,responseBody:p}=requireChannels(),d=requireWaf(),h=requireAddresses(),f=requireReporter(),g=requireTelemetry$1(),m=requireApi_security_sampler(),_=requireWeb(),{extractIp:b}=requireIp_extractor(),{HTTP_CLIENT_IP:y}=requireTags$2(),{block:v,setTemplates:S}=requireBlocking(),{passportTrackEvent:q}=requirePassport(),{storage:E}=requireDatadogCore(),R=requireGraphql();let T,A=!1;function w({req:e,res:t,abortController:r}){const s=_.root(e);if(!s)return;const n=b(T,e);s.addTags({"_dd.appsec.enabled":1,"_dd.runtime_family":"nodejs",[y]:n});const i=Object.assign({},e.headers);delete i.cookie;const a={[h.HTTP_INCOMING_URL]:e.url,[h.HTTP_INCOMING_HEADERS]:i,[h.HTTP_INCOMING_METHOD]:e.method};n&&(a[h.HTTP_CLIENT_IP]=n),m.sampleRequest(e)&&(a[h.WAF_CONTEXT_PROCESSOR]={"extract-schema":!0});P(d.run({persistent:a},e),e,t,s,r)}function x({req:e,res:t}){const r=Object.assign({},t.getHeaders());delete r["set-cookie"];const s={[h.HTTP_INCOMING_RESPONSE_CODE]:""+t.statusCode,[h.HTTP_INCOMING_RESPONSE_HEADERS]:r};void 0!==e.body&&null!==e.body&&(s[h.HTTP_INCOMING_BODY]=e.body),e.params&&"object"==typeof e.params&&(s[h.HTTP_INCOMING_PARAMS]=e.params),e.cookies&&"object"==typeof e.cookies&&(s[h.HTTP_INCOMING_COOKIES]=e.cookies),e.query&&"object"==typeof e.query&&(s[h.HTTP_INCOMING_QUERY]=e.query),d.run({persistent:s},e),d.disposeContext(e),f.finishRequest(e,t)}function I({req:e,res:t,body:r,abortController:s}){if(null==r)return;if(!e){const t=E.getStore();e=t?.req}const n=_.root(e);if(!n)return;P(d.run({persistent:{[h.HTTP_INCOMING_BODY]:r}},e),e,t,n,s)}function C({req:e,res:t,query:r,abortController:s}){if(!r||"object"!=typeof r)return;if(!e){const t=E.getStore();e=t?.req}const n=_.root(e);if(!n)return;P(d.run({persistent:{[h.HTTP_INCOMING_QUERY]:r}},e),e,t,n,s)}function O({req:e,res:t,abortController:r,cookies:s}){if(!s||"object"!=typeof s)return;const n=_.root(e);if(!n)return;P(d.run({persistent:{[h.HTTP_INCOMING_COOKIES]:s}},e),e,t,n,r)}function $({req:e,body:t}){t&&"object"==typeof t&&m.isSampled(e)&&d.run({persistent:{[h.HTTP_OUTGOING_BODY]:t}},e)}function k({credentials:t,user:r}){const s=E.getStore(),n=s?.req&&_.root(s.req);n?q(t,r,n,T.appsec.eventTracking.mode):e.warn("No rootSpan found in onPassportVerify")}function P(e,t,r,s,n){e&&t&&r&&s&&n&&e.includes("block")&&v(t,r,s,n)}function N(){A=!1,T=null,t.clearAllRules(),g.disable(),R.disable(),r.disableWafUpdate(),m.disable(),s.hasSubscribers&&s.unsubscribe(I),i.hasSubscribers&&i.unsubscribe(w),a.hasSubscribers&&a.unsubscribe(x),c.hasSubscribers&&c.unsubscribe(C),n.hasSubscribers&&n.unsubscribe(O),p.hasSubscribers&&p.unsubscribe($),o.hasSubscribers&&o.unsubscribe(k)}return appsec={enable:function(d){if(!A)try{g.enable(d.telemetry),R.enable(),S(d),t.loadRules(d.appsec),r.enableWafUpdate(d.appsec),f.setRateLimit(d.appsec.rateLimit),m.configure(d.appsec),i.subscribe(w),a.subscribe(x),s.subscribe(I),u.subscribe(I),l.subscribe(C),c.subscribe(C),n.subscribe(O),p.subscribe($),d.appsec.eventTracking.enabled&&o.subscribe(k),A=!0,T=d}catch(t){e.error("Unable to start AppSec"),e.error(t),N()}},disable:N,incomingHttpStartTranslator:w,incomingHttpEndTranslator:x}}function requireRemote_config(){if(hasRequiredRemote_config)return remote_config;hasRequiredRemote_config=1;const e=requireActivation(),t=requireManager(),r=requireCapabilities(),s=requireApi_security_sampler();let n;function i(){}return remote_config={enable:function(i){n=new t(i),n.updateCapabilities(r.APM_TRACING_CUSTOM_TAGS,!0),n.updateCapabilities(r.APM_TRACING_HTTP_HEADER_TAGS,!0),n.updateCapabilities(r.APM_TRACING_LOGS_INJECTION,!0),n.updateCapabilities(r.APM_TRACING_SAMPLE_RATE,!0),n.updateCapabilities(r.APM_TRACING_ENABLED,!0);const a=e.fromConfig(i);return a!==e.DISABLED&&(a===e.ONECLICK&&n.updateCapabilities(r.ASM_ACTIVATION,!0),i.appsec.apiSecurity?.enabled&&n.updateCapabilities(r.ASM_API_SECURITY_SAMPLE_RATE,!0),n.on("ASM_FEATURES",((t,r)=>{r&&(a===e.ONECLICK&&function(e,t,r){if("boolean"==typeof t.asm?.enabled){let s;s="apply"===e||"modify"===e?t.asm.enabled:r.appsec.enabled,s?requireAppsec().enable(r):requireAppsec().disable()}}(t,r,i),s.setRequestSampling(r.api_security?.request_sample_rate))}))),n},enableWafUpdate:function(e){if(n&&e&&!e.customRulesProvided){const e=requireRule_manager();n.updateCapabilities(r.ASM_IP_BLOCKING,!0),n.updateCapabilities(r.ASM_USER_BLOCKING,!0),n.updateCapabilities(r.ASM_DD_RULES,!0),n.updateCapabilities(r.ASM_EXCLUSIONS,!0),n.updateCapabilities(r.ASM_REQUEST_BLOCKING,!0),n.updateCapabilities(r.ASM_CUSTOM_RULES,!0),n.updateCapabilities(r.ASM_CUSTOM_BLOCKING_RESPONSE,!0),n.updateCapabilities(r.ASM_TRUSTED_IPS,!0),n.on("ASM_DATA",i),n.on("ASM_DD",i),n.on("ASM",i),n.on(t.kPreUpdate,e.updateWafFromRC)}},disableWafUpdate:function(){if(n){const e=requireRule_manager();n.updateCapabilities(r.ASM_IP_BLOCKING,!1),n.updateCapabilities(r.ASM_USER_BLOCKING,!1),n.updateCapabilities(r.ASM_DD_RULES,!1),n.updateCapabilities(r.ASM_EXCLUSIONS,!1),n.updateCapabilities(r.ASM_REQUEST_BLOCKING,!1),n.updateCapabilities(r.ASM_CUSTOM_RULES,!1),n.updateCapabilities(r.ASM_CUSTOM_BLOCKING_RESPONSE,!1),n.updateCapabilities(r.ASM_TRUSTED_IPS,!1),n.off("ASM_DATA",i),n.off("ASM_DD",i),n.off("ASM",i),n.off(t.kPreUpdate,e.updateWafFromRC)}}},remote_config}function requireUser_blocking(){if(hasRequiredUser_blocking)return user_blocking;hasRequiredUser_blocking=1;const{USER_ID:e}=requireAddresses(),t=requireWaf(),{getRootSpan:r}=requireUtils$1(),{block:s}=requireBlocking(),{storage:n}=requireDatadogCore(),{setUserTags:i}=requireSet_user(),a=requireLog$2();return user_blocking={checkUserAndSetUser:function(s,n){if(!n||!n.id)return a.warn("Invalid user provided to isUserBlocked"),!1;const o=r(s);return o?o.context()._tags["usr.id"]||i(n,o):a.warn("Root span not available in isUserBlocked"),function(r){const s=t.run({persistent:{[e]:r.id}});return!!s&&s.includes("block")}(n)},blockRequest:function(e,t,i){if(!t||!i){const e=n.getStore();e&&(t=t||e.req,i=i||e.res)}if(!t||!i)return a.warn("Requests or response object not available in blockRequest"),!1;const o=r(e);return o?(s(t,i,o),!0):(a.warn("Root span not available in blockRequest"),!1)}},user_blocking}function requireSdk(){if(hasRequiredSdk)return sdk;hasRequiredSdk=1;const{trackUserLoginSuccessEvent:e,trackUserLoginFailureEvent:t,trackCustomEvent:r}=requireTrack_event(),{checkUserAndSetUser:s,blockRequest:n}=requireUser_blocking(),{setTemplates:i}=requireBlocking(),{setUser:a}=requireSet_user();return sdk=class{constructor(e,t){this._tracer=e,t&&i(t)}trackUserLoginSuccessEvent(t,r){return e(this._tracer,t,r)}trackUserLoginFailureEvent(e,r,s){return t(this._tracer,e,r,s)}trackCustomEvent(e,t){return r(this._tracer,e,t)}isUserBlocked(e){return s(this._tracer,e)}blockRequest(e,t){return n(this._tracer,e,t)}setUser(e){return a(this._tracer,e)}},sdk}var retry$1={},retry_operation,hasRequiredRetry_operation,hasRequiredRetry$1,retry,hasRequiredRetry,agent,hasRequiredAgent,file,hasRequiredFile,console_1,hasRequiredConsole;function requireRetry_operation(){if(hasRequiredRetry_operation)return retry_operation;function e(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return hasRequiredRetry_operation=1,retry_operation=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var s=this;return this._timer=setTimeout((function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout((function(){s._operationTimeoutCb(s._attempts)}),s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)}),r),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},e.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},e.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,s=0;s<this._errors.length;s++){var n=this._errors[s],i=n.message,a=(e[i]||0)+1;e[i]=a,a>=r&&(t=n,r=a)}return t},retry_operation}function requireRetry$1(){return hasRequiredRetry$1||(hasRequiredRetry$1=1,function(e){var t=requireRetry_operation();e.operation=function(r){var s=e.timeouts(r);return new t(s,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},e.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],n=0;n<t.retries;n++)s.push(this.createTimeout(n,t));return e&&e.forever&&!s.length&&s.push(this.createTimeout(n,t)),s.sort((function(e,t){return e-t})),s},e.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,s=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return s=Math.min(s,t.maxTimeout)},e.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s)for(var n in s=[],t)"function"==typeof t[n]&&s.push(n);for(var i=0;i<s.length;i++){var a=s[i],o=t[a];t[a]=function(s){var n=e.operation(r),i=Array.prototype.slice.call(arguments,1),a=i.pop();i.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),a.apply(this,arguments))})),n.attempt((function(){s.apply(t,i)}))}.bind(t,o),t[a].options=r}}}(retry$1)),retry$1}function requireRetry(){return hasRequiredRetry?retry:(hasRequiredRetry=1,retry=requireRetry$1())}function requireAgent(){if(hasRequiredAgent)return agent;hasRequiredAgent=1;const e=requireRetry(),{request:t}=require$$1$1,{request:r}=require$$2$1,s=requireDocker(),n=requireFormData(),{storage:i}=requireDatadogCore(),a=require$$6.version,o=s.id();function c(e){let t=0;for(;t<2||e>1e3;)t++,e/=2;return[t,Math.floor(e)]}return agent={AgentExporter:class{constructor({url:e,logger:t,uploadTimeout:r}={}){this._url=e,this._logger=t;const[s,n]=c(r);this._backoffTime=n,this._backoffTries=s}export({profiles:s,start:c,end:u,tags:l}){const p=Object.keys(s),d=[["recording-start",c.toISOString()],["recording-end",u.toISOString()],["language","javascript"],["runtime","nodejs"],["runtime_version",process.version],["profiler_version",a],["format","pprof"],["tags[]","language:javascript"],["tags[]","runtime:nodejs"],["tags[]",`runtime_version:${process.version}`],["tags[]",`process_id:${process.pid}`],["tags[]",`profiler_version:${a}`],["tags[]","format:pprof"],...Object.entries(l).map((([e,t])=>["tags[]",`${e}:${t}`]))];this._logger.debug((()=>"Building agent export report: "+("\n"+d.map((([e,t])=>`  ${e}: ${t}`)).join("\n"))));for(let e=0;e<p.length;e++){const t=p[e],r=s[t];this._logger.debug((()=>{const e=r.toString("hex").match(/../g).join(" ");return`Adding ${t} profile to agent export: `+e})),d.push([`types[${e}]`,t]),d.push([`data[${e}]`,r,{filename:`${t}.pb.gz`,contentType:"application/octet-stream",knownLength:r.length}])}return new Promise(((s,a)=>{const c=e.operation({randomize:!0,minTimeout:this._backoffTime,retries:this._backoffTries,unref:!0});c.attempt((e=>{const u=new n;for(const[e,t,r]of d)u.append(e,t,r);const l={method:"POST",path:"/profiling/v1/input",headers:u.getHeaders(),timeout:this._backoffTime*Math.pow(2,e)};o&&(l.headers["Datadog-Container-ID"]=o),"unix:"===this._url.protocol?l.socketPath=this._url.pathname:(l.protocol=this._url.protocol,l.hostname=this._url.hostname,l.port=this._url.port),this._logger.debug((()=>`Submitting profiler agent report attempt #${e} to: ${JSON.stringify(l)}`)),function(e,s,n){const a="https:"===e.protocol?r:t,o=i.getStore();i.enterWith({noop:!0});const c=a(e,(e=>{if(e.statusCode>=400){const t=new Error(`HTTP Error ${e.statusCode}`);t.status=e.statusCode,n(t)}else n(null,e)}));c.on("error",n),s&&s.pipe(c),i.enterWith(o)}(l,u,((e,t)=>{c.retry(e)?this._logger.error(`Error from the agent: ${e.message}`):e?a(new Error("Profiler agent export back-off period expired")):(!function(e,t){const r=[];e.on("error",t),e.on("data",(e=>r.push(e))),e.on("end",(()=>{t(null,Buffer.concat(r))}))}(t,((e,t)=>{e?this._logger.error(`Error reading agent response: ${e.message}`):this._logger.debug((()=>`Agent export response: ${(t.toString("hex").match(/../g)||[]).join(" ")}`))})),s())}))}))}))}},computeRetries:c},agent}function requireFile(){if(hasRequiredFile)return file;hasRequiredFile=1;const e=require$$0$6,{promisify:t}=require$$0$3,{threadId:r}=require$$2$4,s=t(e.writeFile);return file={FileExporter:class{constructor({pprofPrefix:e}={}){this._pprofPrefix=e||""}export({profiles:e,end:t}){const n=Object.keys(e),i=function(e){const t=e=>String(e).padStart(2,"0");return`${e.getUTCFullYear()}${t(e.getUTCMonth()+1)}${t(e.getUTCDate())}T${t(e.getUTCHours())}${t(e.getUTCMinutes())}${t(e.getUTCSeconds())}Z`}(t),a=n.map((t=>s(`${this._pprofPrefix}${t}_worker_${r}_${i}.pprof`,e[t])));return Promise.all(a)}}},file}function requireConsole(){if(hasRequiredConsole)return console_1;hasRequiredConsole=1;const e={error:3,warn:4,info:6,debug:7};return console_1={ConsoleLogger:class{constructor(t={}){this._level=e[t.level]||e.error}debug(e){this._log("debug",e)}info(e){this._log("info",e)}warn(e){this._log("warn",e)}error(e){this._log("error",e)}_log(t,r){e[t]>this._level||console[t](r)}}}}var src$1={exports:{}},heapProfiler={},heapProfilerBindings={},hasRequiredHeapProfilerBindings;function requireHeapProfilerBindings(){if(hasRequiredHeapProfilerBindings)return heapProfilerBindings;hasRequiredHeapProfilerBindings=1;var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),t=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=commonjsGlobal&&commonjsGlobal.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(s,r,n);return t(s,r),s};Object.defineProperty(heapProfilerBindings,"__esModule",{value:!0}),heapProfilerBindings.monitorOutOfMemory=heapProfilerBindings.getAllocationProfile=heapProfilerBindings.stopSamplingHeapProfiler=heapProfilerBindings.startSamplingHeapProfiler=void 0;const s=r(require$$0$1),n=requireNodeGypBuild()(s.join(__dirname,"..",".."));return heapProfilerBindings.startSamplingHeapProfiler=function(e,t){n.heapProfiler.startSamplingHeapProfiler(e,t)},heapProfilerBindings.stopSamplingHeapProfiler=function(){n.heapProfiler.stopSamplingHeapProfiler()},heapProfilerBindings.getAllocationProfile=function(){return n.heapProfiler.getAllocationProfile()},heapProfilerBindings.monitorOutOfMemory=function(e,t,r,s,i,a,o){n.heapProfiler.monitorOutOfMemory(e,t,r,s,i,a,o)},heapProfilerBindings}var profileSerializer={},dist={},hasRequiredDist,hasRequiredProfileSerializer,hasRequiredHeapProfiler;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,function(e){var t,r,s=commonjsGlobal&&commonjsGlobal.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};Object.defineProperty(e,"__esModule",{value:!0}),e.Profile=e.Function=e.Location=e.Line=e.Mapping=e.Sample=e.Label=e.ValueType=e.StringTable=e.emptyTableToken=void 0;
/*!
		 * Private helpers. These are only used by other helpers.
		 */
const n=2n**32n-1n,i=2**32-1,a=i+1,o="undefined"==typeof Buffer?e=>(new TextEncoder).encode(e):e=>Buffer.from(e,"utf8");function c(e){if(!e.length)return 0;let t=0;for(;t<e.length&&e[t++]>=128;);return t}function u(e,t=0){return{value:e,offset:t}}function l(e,t){switch(e){case d:for(let e=0;e<t.length;e++)if(!(128&t[e]))return u(t.slice(0,e+1));return u(t);case h:{const e=c(t),r=f(t);return u(t.slice(e,Number(r)+e),e)}default:throw new Error(`Unrecognized value type: ${e}`)}}function p(e){const t=e<0;t&&(e=-e);let r=function(e){return"bigint"!=typeof e?(e>>>0)%a:Number(e&n)}(e),s=function(e){return"bigint"!=typeof e?e/a>>>0:Number(e>>32n&n)}(e);return t&&(s=~s>>>0,r=~r>>>0,++r>i&&(r=0,++s>i&&(s=0))),[s,r]}const d=0,h=2;function f(e){if(c(e)>4)return function(e){if(!e.length)return BigInt(0);let t=BigInt(127&e[0]),r=0;for(;e[r++]>=128;)t|=BigInt(127&e[r])<<BigInt(7*r);return t}(e);if(!e.length)return 0;let t=127&e[0],r=0;for(;e[r++]>=128;)t|=(127&e[r])<<7*r;return t}function g(e){const t=[];let r=0;for(let s=0;s<e.length;s++)128&e[s]||(t.push(f(e.slice(r,s+1))),r=s+1);return t}function m(e,t){return null==t?[e]:(t.push(e),t)}function _(e){if(0===e||0n===e)return 0;const[t,r]=p(e),s=(r>>>28|t<<4)>>>0,n=t>>>24;return 0!==n?n<128?9:10:0!==s?s<16384?s<128?5:6:s<2097152?7:8:r<16384?r<128?1:2:r<2097152?3:4}function b(e){return void 0===e?0:"number"==typeof e||"bigint"==typeof e?_(e)||1:e.length}function y(e){let t=0;for(const r of e)t+=b(r);return t}function v(e){const t=_(e);return t?1+t:0}function S(e){let t=0;for(const r of e)t+=_(r)||1;return t?1+_(t)+t:0}function q(e){const t=b(e);return t?1+_(t)+t:0}function E(e){let t=0;for(const r of e)t+=q(r);return t}function R(e,t,r){if(0===r||0n===r)return e[t++]=0,t;let[s,n]=p(r);for(;s;)e[t++]=127&n|128,n=(n>>>7|s<<25)>>>0,s>>>=7;for(;n>127;)e[t++]=127&n|128,n>>>=7;return e[t++]=n,t}e.emptyTableToken=Symbol();class T{constructor(s){this.strings=new Array,t.set(this,new Array),r.set(this,new Map),s!==e.emptyTableToken&&this.dedup("")}get encodedLength(){let e=0;for(const r of s(this,t,"f"))e+=r.length;return e}_encodeToBuffer(e,r){for(const n of s(this,t,"f"))e.set(n,r),r+=n.length;return r}encode(e=new Uint8Array(this.encodedLength)){return this._encodeToBuffer(e,0),e}static _encodeStringFromUtf8(e){const t=new Uint8Array(1+e.length+(_(e.length)||1));let r=0;return t[r++]=50,r=R(t,r,e.length),e.length>0&&t.set(e,r++),t}static _encodeString(e){return T._encodeStringFromUtf8(o(e))}dedup(e){if("number"==typeof e)return e;if(!s(this,r,"f").has(e)){const n=this.strings.push(e)-1;s(this,r,"f").set(e,n),s(this,t,"f").push(T._encodeString(e))}return s(this,r,"f").get(e)}_decodeString(e){const n=(new TextDecoder).decode(e);s(this,r,"f").set(n,this.strings.push(n)-1),s(this,t,"f").push(T._encodeStringFromUtf8(e))}}function A(e,t){const r={};let s=0;for(;s<e.length;){const n=e[s]>>3,i=7&e[s];s++;const{offset:a,value:o}=l(i,e.slice(s));s+=o.length+a,t(r,n,o)}return r}e.StringTable=T,t=new WeakMap,r=new WeakMap;class w{constructor(e){this.type=e.type||0,this.unit=e.unit||0}get length(){let e=0;return e+=v(this.type),e+=v(this.unit),e}_encodeToBuffer(e,t=0){return this.type&&(e[t++]=8,t=R(e,t,this.type)),this.unit&&(e[t++]=16,t=R(e,t,this.unit)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.type=f(r);break;case 2:e.unit=f(r)}}static decode(e){return new this(A(e,this.decodeValue))}}e.ValueType=w;class x{constructor(e){this.key=e.key||0,this.str=e.str||0,this.num=e.num||0,this.numUnit=e.numUnit||0}get length(){let e=0;return e+=v(this.key),e+=v(this.str),e+=v(this.num),e+=v(this.numUnit),e}_encodeToBuffer(e,t=0){return this.key&&(e[t++]=8,t=R(e,t,this.key)),this.str&&(e[t++]=16,t=R(e,t,this.str)),this.num&&(e[t++]=24,t=R(e,t,this.num)),this.numUnit&&(e[t++]=32,t=R(e,t,this.numUnit)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.key=f(r);break;case 2:e.str=f(r);break;case 3:e.num=f(r);break;case 4:e.numUnit=f(r)}}static decode(e){return new this(A(e,this.decodeValue))}}e.Label=x;class I{constructor(e){this.locationId=e.locationId||[],this.value=e.value||[],this.label=(e.label||[]).map((e=>new x(e)))}get length(){let e=0;return e+=S(this.locationId),e+=S(this.value),e+=E(this.label),e}_encodeToBuffer(e,t=0){if(this.locationId.length){e[t++]=10,t=R(e,t,y(this.locationId));for(const r of this.locationId)t=R(e,t,r)}if(this.value.length){e[t++]=18,t=R(e,t,y(this.value));for(const r of this.value)t=R(e,t,r)}for(const r of this.label)e[t++]=26,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);return t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.locationId=g(r);break;case 2:e.value=g(r);break;case 3:e.label=m(x.decode(r),e.label)}}static decode(e){return new this(A(e,this.decodeValue))}}e.Sample=I;class C{constructor(e){this.id=e.id||0,this.memoryStart=e.memoryStart||0,this.memoryLimit=e.memoryLimit||0,this.fileOffset=e.fileOffset||0,this.filename=e.filename||0,this.buildId=e.buildId||0,this.hasFunctions=!!e.hasFunctions,this.hasFilenames=!!e.hasFilenames,this.hasLineNumbers=!!e.hasLineNumbers,this.hasInlineFrames=!!e.hasInlineFrames}get length(){let e=0;return e+=v(this.id),e+=v(this.memoryStart),e+=v(this.memoryLimit),e+=v(this.fileOffset),e+=v(this.filename),e+=v(this.buildId),e+=v(this.hasFunctions?1:0),e+=v(this.hasFilenames?1:0),e+=v(this.hasLineNumbers?1:0),e+=v(this.hasInlineFrames?1:0),e}_encodeToBuffer(e,t=0){return this.id&&(e[t++]=8,t=R(e,t,this.id)),this.memoryStart&&(e[t++]=16,t=R(e,t,this.memoryStart)),this.memoryLimit&&(e[t++]=24,t=R(e,t,this.memoryLimit)),this.fileOffset&&(e[t++]=32,t=R(e,t,this.fileOffset)),this.filename&&(e[t++]=40,t=R(e,t,this.filename)),this.buildId&&(e[t++]=48,t=R(e,t,this.buildId)),this.hasFunctions&&(e[t++]=56,t=R(e,t,1)),this.hasFilenames&&(e[t++]=64,t=R(e,t,1)),this.hasLineNumbers&&(e[t++]=72,t=R(e,t,1)),this.hasInlineFrames&&(e[t++]=80,t=R(e,t,1)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.id=f(r);break;case 2:e.memoryStart=f(r);break;case 3:e.memoryLimit=f(r);break;case 4:e.fileOffset=f(r);break;case 5:e.filename=f(r);break;case 6:e.buildId=f(r);break;case 7:e.hasFunctions=!!f(r);break;case 8:e.hasFilenames=!!f(r);break;case 9:e.hasLineNumbers=!!f(r);break;case 10:e.hasInlineFrames=!!f(r)}}static decode(e){return new this(A(e,this.decodeValue))}}e.Mapping=C;class O{constructor(e){this.functionId=e.functionId||0,this.line=e.line||0}get length(){let e=0;return e+=v(this.functionId),e+=v(this.line),e}_encodeToBuffer(e,t=0){return this.functionId&&(e[t++]=8,t=R(e,t,this.functionId)),this.line&&(e[t++]=16,t=R(e,t,this.line)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.functionId=f(r);break;case 2:e.line=f(r)}}static decode(e){return new this(A(e,this.decodeValue))}}e.Line=O;class ${constructor(e){this.id=e.id||0,this.mappingId=e.mappingId||0,this.address=e.address||0,this.line=(e.line||[]).map((e=>new O(e))),this.isFolded=!!e.isFolded}get length(){let e=0;return e+=v(this.id),e+=v(this.mappingId),e+=v(this.address),e+=E(this.line),e+=v(this.isFolded?1:0),e}_encodeToBuffer(e,t=0){this.id&&(e[t++]=8,t=R(e,t,this.id)),this.mappingId&&(e[t++]=16,t=R(e,t,this.mappingId)),this.address&&(e[t++]=24,t=R(e,t,this.address));for(const r of this.line)e[t++]=34,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);return this.isFolded&&(e[t++]=40,t=R(e,t,1)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.id=f(r);break;case 2:e.mappingId=f(r);break;case 3:e.address=f(r);break;case 4:e.line=m(O.decode(r),e.line);break;case 5:e.isFolded=!!f(r)}}static decode(e){return new this(A(e,this.decodeValue))}}e.Location=$;class k{constructor(e){this.id=e.id||0,this.name=e.name||0,this.systemName=e.systemName||0,this.filename=e.filename||0,this.startLine=e.startLine||0}get length(){let e=0;return e+=v(this.id),e+=v(this.name),e+=v(this.systemName),e+=v(this.filename),e+=v(this.startLine),e}_encodeToBuffer(e,t=0){return this.id&&(e[t++]=8,t=R(e,t,this.id)),this.name&&(e[t++]=16,t=R(e,t,this.name)),this.systemName&&(e[t++]=24,t=R(e,t,this.systemName)),this.filename&&(e[t++]=32,t=R(e,t,this.filename)),this.startLine&&(e[t++]=40,t=R(e,t,this.startLine)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(e,t,r){switch(t){case 1:e.id=f(r);break;case 2:e.name=f(r);break;case 3:e.systemName=f(r);break;case 4:e.filename=f(r);break;case 5:e.startLine=f(r)}}static decode(e){return new this(A(e,this.decodeValue))}}e.Function=k;e.Profile=class{constructor(e={}){this.sampleType=(e.sampleType||[]).map((e=>new w(e))),this.sample=(e.sample||[]).map((e=>new I(e))),this.mapping=(e.mapping||[]).map((e=>new C(e))),this.location=(e.location||[]).map((e=>new $(e))),this.function=(e.function||[]).map((e=>new k(e))),this.stringTable=e.stringTable||new T,this.dropFrames=e.dropFrames||0,this.keepFrames=e.keepFrames||0,this.timeNanos=e.timeNanos||0,this.durationNanos=e.durationNanos||0,this.periodType=e.periodType?new w(e.periodType):void 0,this.period=e.period||0,this.comment=e.comment||[],this.defaultSampleType=e.defaultSampleType||0}get length(){let e=0;return e+=E(this.sampleType),e+=E(this.sample),e+=E(this.mapping),e+=E(this.location),e+=E(this.function),e+=this.stringTable.encodedLength,e+=v(this.dropFrames),e+=v(this.keepFrames),e+=v(this.timeNanos),e+=v(this.durationNanos),e+=q(this.periodType),e+=v(this.period),e+=S(this.comment),e+=v(this.defaultSampleType),e}_encodeToBuffer(e,t=0){for(const r of this.sampleType)e[t++]=10,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);for(const r of this.sample)e[t++]=18,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);for(const r of this.mapping)e[t++]=26,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);for(const r of this.location)e[t++]=34,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);for(const r of this.function)e[t++]=42,t=R(e,t,r.length),t=r._encodeToBuffer(e,t);if(t=this.stringTable._encodeToBuffer(e,t),this.dropFrames&&(e[t++]=56,t=R(e,t,this.dropFrames)),this.keepFrames&&(e[t++]=64,t=R(e,t,this.keepFrames)),this.timeNanos&&(e[t++]=72,t=R(e,t,this.timeNanos)),this.durationNanos&&(e[t++]=80,t=R(e,t,this.durationNanos)),void 0!==this.periodType&&(e[t++]=90,t=R(e,t,this.periodType.length),t=this.periodType._encodeToBuffer(e,t)),this.period&&(e[t++]=96,t=R(e,t,this.period)),this.comment.length){e[t++]=106,t=R(e,t,y(this.comment));for(const r of this.comment)t=R(e,t,r)}return this.defaultSampleType&&(e[t++]=112,t=R(e,t,this.defaultSampleType)),t}encode(e=new Uint8Array(this.length)){return this._encodeToBuffer(e,0),e}static decodeValue(t,r,s){switch(r){case 1:t.sampleType=m(w.decode(s),t.sampleType);break;case 2:t.sample=m(I.decode(s),t.sample);break;case 3:t.mapping=m(C.decode(s),t.mapping);break;case 4:t.location=m($.decode(s),t.location);break;case 5:t.function=m(k.decode(s),t.function);break;case 6:void 0===t.stringTable&&(t.stringTable=new T(e.emptyTableToken)),t.stringTable._decodeString(s);break;case 7:t.dropFrames=f(s);break;case 8:t.keepFrames=f(s);break;case 9:t.timeNanos=f(s);break;case 10:t.durationNanos=f(s);break;case 11:t.periodType=w.decode(s);break;case 12:t.period=f(s);break;case 13:t.comment=g(s);break;case 14:t.defaultSampleType=f(s)}}static decode(e){return new this(A(e,this.decodeValue))}}}(dist)),dist}function requireProfileSerializer(){return hasRequiredProfileSerializer||(hasRequiredProfileSerializer=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serializeHeapProfile=e.serializeTimeProfile=e.NON_JS_THREADS_FUNCTION_NAME=void 0;const t=requireDist();function r(e,r,s,n,i,a){const o=[],c=[],u=[],l=new Map,p=new Map,d=r.children.map((e=>({node:e,stack:[]})));for(;d.length>0;){const e=d.pop(),t=e.node;if(i&&t.scriptName.indexOf(i)>-1)continue;if("(idle)"===t.name||"(program)"===t.name)continue;const r=e.stack,n=h(t,a);r.unshift(n.id),s(e,o);for(const e of t.children)d.push({node:e,stack:r.slice()})}function h(e,r){let s={file:e.scriptName||"",line:e.lineNumber,column:e.columnNumber,name:e.name};s.line&&r&&function(e){return void 0!==e.column&&void 0!==e.line&&e.line>0}(s)&&(s=r.mappingInfo(s));const n=`${e.scriptId}:${s.line}:${s.column}:${s.name}`;let i=p.get(n);if(void 0!==i)return c[i-1];i=c.length+1,p.set(n,i);const a=(o=s,u=e.scriptId,new t.Line({functionId:f(o,u).id,line:o.line}));var o,u;const l=new t.Location({id:i,line:[a]});return c.push(l),l}function f(e,r){let s=e.name;const i=s?`${r}:${s}`:`${r}:${e.line}:${e.column}`;let a=l.get(i);if(void 0!==a)return u[a-1];a=u.length+1,l.set(i,a),s||(s=e.line?e.column?`(anonymous:L#${e.line}:C#${e.column})`:`(anonymous:L#${e.line})`:"(anonymous)");const o=n.dedup(s),c=new t.Function({id:a,name:o,systemName:o,filename:n.dedup(e.file||"")});return u.push(c),c}e.sample=o,e.location=c,e.function=u,e.stringTable=n}function s(e){return e.hitCount+e.children.reduce(((e,t)=>e+s(t)),0)}function n(e,r){const s=[];for(const[n,i]of Object.entries(e)){const e={key:r.dedup(n)};switch(typeof i){case"string":e.str=r.dedup(i);break;case"number":case"bigint":e.num=i;break;default:continue}s.push(new t.Label(e))}return s}e.NON_JS_THREADS_FUNCTION_NAME="(non-JS threads)",e.serializeTimeProfile=function(i,a,o,c=!1,u){if(c){const e=s(i.topDownRoot);e>0&&(a=Math.min(Math.max(Math.floor((i.endTime-i.startTime)/e),a),2*a))}const l=1e3*a,p=new t.StringTable,d=(h=p,new t.ValueType({type:h.dedup("sample"),unit:h.dedup("count")}));var h;const f=function(e){return new t.ValueType({type:e.dedup("wall"),unit:e.dedup("nanoseconds")})}(p),g=[d,f];if(i.hasCpuTime){const e=function(e){return new t.ValueType({type:e.dedup("cpu"),unit:e.dedup("nanoseconds")})}(p);g.push(e)}const m={sampleType:g,timeNanos:1e3*Date.now()*1e3,durationNanos:1e3*(i.endTime-i.startTime),periodType:f,period:l};if(i.nonJSThreadsCpuTime){const t={name:e.NON_JS_THREADS_FUNCTION_NAME,scriptName:"",scriptId:0,lineNumber:0,columnNumber:0,children:[],hitCount:0,contexts:[{context:{},timestamp:BigInt(0),cpuTime:i.nonJSThreadsCpuTime}]};i.topDownRoot.children.push(t)}return r(m,i.topDownRoot,((e,r)=>{let s=e.node.hitCount,a=0;for(const o of e.node.contexts||[]){const c=u?u({node:e.node,context:o}):o.context;if(Object.keys(c).length>0){const a=[1,l];i.hasCpuTime&&a.push(o.cpuTime);const u=new t.Sample({locationId:e.stack,value:a,label:n(c,p)});r.push(u),s--}else i.hasCpuTime&&(a+=o.cpuTime)}if(s>0||a>0){const o=u?u({node:e.node}):{},c=[s,s*l];i.hasCpuTime&&c.push(a);const d=new t.Sample({locationId:e.stack,value:c,label:n(o,p)});r.push(d)}}),p,void 0,o),new t.Profile(m)},e.serializeHeapProfile=function(e,s,i,a,o,c){const u=new t.StringTable,l=(p=u,new t.ValueType({type:p.dedup("objects"),unit:p.dedup("count")}));var p;const d=function(e){return new t.ValueType({type:e.dedup("space"),unit:e.dedup("bytes")})}(u),h={sampleType:[l,d],timeNanos:s,periodType:d,period:i};return r(h,e,((e,r)=>{if(e.node.allocations.length>0){const s=c?n(c({node:e.node}),u):[];for(const n of e.node.allocations){const i=new t.Sample({locationId:e.stack,value:[n.count,n.sizeBytes*n.count],label:s});r.push(i)}}}),u,a,o),new t.Profile(h)}}(profileSerializer)),profileSerializer}function requireHeapProfiler(){return hasRequiredHeapProfiler||(hasRequiredHeapProfiler=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.monitorOutOfMemory=e.CallbackMode=e.stop=e.start=e.convertProfile=e.profile=e.v8Profile=void 0;const t=requireHeapProfilerBindings(),r=requireProfileSerializer(),s=require$$2$5;let n=!1,i=0,a=0;function o(){if(!n)throw new Error("Heap profiler is not enabled.");return(0,t.getAllocationProfile)()}function c(e,t,s,n){const a=1e3*Date.now()*1e3,{external:o}=process.memoryUsage();if(o>0){const t={name:"(external)",scriptName:"",children:[],allocations:[{sizeBytes:o,count:1}]};e.children.push(t)}return(0,r.serializeHeapProfile)(e,a,i,t,s,n)}e.v8Profile=o,e.profile=function(e,t,r){return c(o(),e,t,r)},e.convertProfile=c,e.start=function(e,r){if(n)throw new Error(`Heap profiler is already started  with intervalBytes ${i} and stackDepth ${r}`);i=e,a=r,(0,t.startSamplingHeapProfiler)(i,a),n=!0},e.stop=function(){n&&(n=!1,(0,t.stopSamplingHeapProfiler)())},e.CallbackMode={Async:1,Interrupt:2,Both:3},e.monitorOutOfMemory=function(r,i,a,o,u,l){if(!n)throw new Error("Heap profiler must already be started to call monitorOutOfMemory");let p;void 0!==u&&(p=e=>{u(c(e))}),(0,t.monitorOutOfMemory)(r,i,a,o||[],p,void 0!==l?l:e.CallbackMode.Async,s.isMainThread)}}(heapProfiler)),heapProfiler}var profileEncoder={},hasRequiredProfileEncoder;function requireProfileEncoder(){if(hasRequiredProfileEncoder)return profileEncoder;hasRequiredProfileEncoder=1,Object.defineProperty(profileEncoder,"__esModule",{value:!0}),profileEncoder.encodeSync=profileEncoder.encode=void 0;const e=require$$5,t=(0,require$$0$3.promisify)(e.gzip);return profileEncoder.encode=async function(e){return t(e.encode())},profileEncoder.encodeSync=function(t){return(0,e.gzipSync)(t.encode())},profileEncoder}var timeProfiler={},delay={exports:{}},hasRequiredDelay;function requireDelay(){if(hasRequiredDelay)return delay.exports;hasRequiredDelay=1;const e=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},t=({clearTimeout:t,setTimeout:r,willResolve:s})=>(n,{value:i,signal:a}={})=>{if(a&&a.aborted)return Promise.reject(e());let o,c,u;const l=t||clearTimeout,p=()=>{l(o),u(e())},d=new Promise(((e,t)=>{c=()=>{a&&a.removeEventListener("abort",p),s?e(i):t(i)},u=t,o=(r||setTimeout)(c,n)}));return a&&a.addEventListener("abort",p,{once:!0}),d.clear=()=>{l(o),o=null,c()},d},r=e=>{const r=t({...e,willResolve:!0});return r.reject=t({...e,willResolve:!1}),r.range=(e,t,s)=>r(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,t),s),r},s=r();return s.createWithTimers=r,delay.exports=s,delay.exports.default=s,delay.exports}var timeProfilerBindings={},hasRequiredTimeProfilerBindings,hasRequiredTimeProfiler;function requireTimeProfilerBindings(){if(hasRequiredTimeProfilerBindings)return timeProfilerBindings;hasRequiredTimeProfilerBindings=1,Object.defineProperty(timeProfilerBindings,"__esModule",{value:!0}),timeProfilerBindings.getNativeThreadId=timeProfilerBindings.constants=timeProfilerBindings.TimeProfiler=void 0;const e=require$$0$1,t=requireNodeGypBuild()((0,e.join)(__dirname,"..",".."));return timeProfilerBindings.TimeProfiler=t.TimeProfiler,timeProfilerBindings.constants=t.constants,timeProfilerBindings.getNativeThreadId=t.getNativeThreadId,timeProfilerBindings}function requireTimeProfiler(){return hasRequiredTimeProfiler||(hasRequiredTimeProfiler=1,function(e){var t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.getNativeThreadId=e.constants=e.v8ProfilerStuckEventLoopDetected=e.isStarted=e.getContext=e.setContext=e.getState=e.stop=e.start=e.profile=void 0;const r=t(requireDelay()),s=requireProfileSerializer(),n=requireTimeProfilerBindings();Object.defineProperty(e,"getNativeThreadId",{enumerable:!0,get:function(){return n.getNativeThreadId}});const i=require$$2$5,{kSampleCount:a}=n.constants;let o,c,u,l=0;process.once("exit",(()=>{g()&&h()}));const p={durationMillis:6e4,intervalMicros:1e3,lineNumbers:!1,withContexts:!1,workaroundV8Bug:!0,collectCpuTime:!1};function d(e={}){if(e={...p,...e},o)throw new Error("Wall profiler is already started");o=new n.TimeProfiler({...e,isMainThread:i.isMainThread}),c=e.sourceMapper,u=e.intervalMicros,l=0,o.start(),e.withContexts&&f({})}function h(e=!1,t){if(!o)throw new Error("Wall profiler is not started");const r=o.stop(e);e?(l=o.v8ProfilerStuckEventLoopDetected(),l>0&&(o.stop(!1),o.start())):l=0;const n=(0,s.serializeTimeProfile)(r,u,c,!0,t);return e||(o=void 0,c=void 0),n}function f(e){if(!o)throw new Error("Wall profiler is not started");o.context=e}function g(){return!!o}e.profile=async function(e={}){return d(e={...p,...e}),await(0,r.default)(e.durationMillis),h()},e.start=d,e.stop=h,e.getState=function(){if(!o)throw new Error("Wall profiler is not started");return o.state},e.setContext=f,e.getContext=function(){if(!o)throw new Error("Wall profiler is not started");return o.context},e.isStarted=g,e.v8ProfilerStuckEventLoopDetected=function(){return l},e.constants={kSampleCount:a,NON_JS_THREADS_FUNCTION_NAME:s.NON_JS_THREADS_FUNCTION_NAME}}(timeProfiler)),timeProfiler}var sourcemapper={},sourceMap$1={},sourceMapGenerator={},base64Vlq={},base64={},hasRequiredBase64,hasRequiredBase64Vlq;function requireBase64(){if(hasRequiredBase64)return base64;hasRequiredBase64=1;const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return base64.encode=function(t){if(0<=t&&t<e.length)return e[t];throw new TypeError("Must be between 0 and 63: "+t)},base64}function requireBase64Vlq(){if(hasRequiredBase64Vlq)return base64Vlq;hasRequiredBase64Vlq=1;const e=requireBase64();return base64Vlq.encode=function(t){let r,s="",n=function(e){return e<0?1+(-e<<1):0+(e<<1)}(t);do{r=31&n,n>>>=5,n>0&&(r|=32),s+=e.encode(r)}while(n>0);return s},base64Vlq}var util$6={},hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,function(e){e.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};const t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(e){const r=e.match(t);return r?{scheme:r[1],auth:r[2],host:r[3],port:r[4],path:r[5]}:null}function n(e){let t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}e.urlParse=s,e.urlGenerate=n;const i=function(e){const t=[];return function(r){for(let e=0;e<t.length;e++)if(t[e].input===r){const r=t[0];return t[0]=t[e],t[e]=r,t[0].result}const s=e(r);return t.unshift({input:r,result:s}),t.length>32&&t.pop(),s}}((function(t){let r=t;const i=s(t);if(i){if(!i.path)return t;r=i.path}const a=e.isAbsolute(r),o=[];let c=0,u=0;for(;;){if(c=u,u=r.indexOf("/",c),-1===u){o.push(r.slice(c));break}for(o.push(r.slice(c,u));u<r.length&&"/"===r[u];)u++}let l=0;for(u=o.length-1;u>=0;u--){const e=o[u];"."===e?o.splice(u,1):".."===e?l++:l>0&&(""===e?(o.splice(u+1,l),l=0):(o.splice(u,2),l--))}return r=o.join("/"),""===r&&(r=a?"/":"."),i?(i.path=r,n(i)):r}));function a(e,t){""===e&&(e="."),""===t&&(t=".");const a=s(t),o=s(e);if(o&&(e=o.path||"/"),a&&!a.scheme)return o&&(a.scheme=o.scheme),n(a);if(a||t.match(r))return t;if(o&&!o.host&&!o.path)return o.host=t,n(o);const c="/"===t.charAt(0)?t:i(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=c,n(o)):c}e.normalize=i,e.join=a,e.isAbsolute=function(e){return"/"===e.charAt(0)||t.test(e)},e.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");let r=0;for(;0!==t.indexOf(e+"/");){const s=e.lastIndexOf("/");if(s<0)return t;if((e=e.slice(0,s)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};const o=!("__proto__"in Object.create(null));function c(e){return e}function u(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function l(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}e.toSetString=o?c:function(e){return u(e)?"$"+e:e},e.fromSetString=o?c:function(e){return u(e)?e.slice(1):e},e.compareByOriginalPositions=function(e,t,r){let s=l(e.source,t.source);return 0!==s?s:(s=e.originalLine-t.originalLine,0!==s?s:(s=e.originalColumn-t.originalColumn,0!==s||r?s:(s=e.generatedColumn-t.generatedColumn,0!==s?s:(s=e.generatedLine-t.generatedLine,0!==s?s:l(e.name,t.name)))))},e.compareByGeneratedPositionsDeflated=function(e,t,r){let s=e.generatedLine-t.generatedLine;return 0!==s?s:(s=e.generatedColumn-t.generatedColumn,0!==s||r?s:(s=l(e.source,t.source),0!==s?s:(s=e.originalLine-t.originalLine,0!==s?s:(s=e.originalColumn-t.originalColumn,0!==s?s:l(e.name,t.name)))))},e.compareByGeneratedPositionsInflated=function(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=l(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:l(e.name,t.name)))))},e.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},e.computeSourceURL=function(e,t,r){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),r){const e=s(r);if(!e)throw new Error("sourceMapURL could not be parsed");if(e.path){const t=e.path.lastIndexOf("/");t>=0&&(e.path=e.path.substring(0,t+1))}t=a(n(e),t)}return i(t)}}(util$6)),util$6}var arraySet={},hasRequiredArraySet;function requireArraySet(){if(hasRequiredArraySet)return arraySet;hasRequiredArraySet=1;class e{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const s=new e;for(let e=0,n=t.length;e<n;e++)s.add(t[e],r);return s}size(){return this._set.size}add(e,t){const r=this.has(e),s=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,s)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}}return arraySet.ArraySet=e,arraySet}var mappingList={},hasRequiredMappingList,hasRequiredSourceMapGenerator;function requireMappingList(){if(hasRequiredMappingList)return mappingList;hasRequiredMappingList=1;const e=requireUtil();return mappingList.MappingList=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(t){!function(t,r){const s=t.generatedLine,n=r.generatedLine,i=t.generatedColumn,a=r.generatedColumn;return n>s||n==s&&a>=i||e.compareByGeneratedPositionsInflated(t,r)<=0}(this._last,t)?(this._sorted=!1,this._array.push(t)):(this._last=t,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(e.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}},mappingList}function requireSourceMapGenerator(){if(hasRequiredSourceMapGenerator)return sourceMapGenerator;hasRequiredSourceMapGenerator=1;const e=requireBase64Vlq(),t=requireUtil(),r=requireArraySet().ArraySet,s=requireMappingList().MappingList;class n{constructor(e){e||(e={}),this._file=t.getArg(e,"file",null),this._sourceRoot=t.getArg(e,"sourceRoot",null),this._skipValidation=t.getArg(e,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new s,this._sourcesContents=null}static fromSourceMap(e){const r=e.sourceRoot,s=new n({file:e.file,sourceRoot:r});return e.eachMapping((function(e){const n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=r&&(n.source=t.relative(r,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),s.addMapping(n)})),e.sources.forEach((function(n){let i=n;null!==r&&(i=t.relative(r,n)),s._sources.has(i)||s._sources.add(i);const a=e.sourceContentFor(n);null!=a&&s.setSourceContent(n,a)})),s}addMapping(e){const r=t.getArg(e,"generated"),s=t.getArg(e,"original",null);let n=t.getArg(e,"source",null),i=t.getArg(e,"name",null);this._skipValidation||this._validateMapping(r,s,n,i),null!=n&&(n=String(n),this._sources.has(n)||this._sources.add(n)),null!=i&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:null!=s&&s.line,originalColumn:null!=s&&s.column,source:n,name:i})}setSourceContent(e,r){let s=e;null!=this._sourceRoot&&(s=t.relative(this._sourceRoot,s)),null!=r?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[t.toSetString(s)]=r):this._sourcesContents&&(delete this._sourcesContents[t.toSetString(s)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,s,n){let i=s;if(null==s){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');i=e.file}const a=this._sourceRoot;null!=a&&(i=t.relative(a,i));const o=this._mappings.toArray().length>0?new r:this._sources,c=new r;this._mappings.unsortedForEach((function(r){if(r.source===i&&null!=r.originalLine){const s=e.originalPositionFor({line:r.originalLine,column:r.originalColumn});null!=s.source&&(r.source=s.source,null!=n&&(r.source=t.join(n,r.source)),null!=a&&(r.source=t.relative(a,r.source)),r.originalLine=s.line,r.originalColumn=s.column,null!=s.name&&(r.name=s.name))}const s=r.source;null==s||o.has(s)||o.add(s);const u=r.name;null==u||c.has(u)||c.add(u)}),this),this._sources=o,this._names=c,e.sources.forEach((function(r){const s=e.sourceContentFor(r);null!=s&&(null!=n&&(r=t.join(n,r)),null!=a&&(r=t.relative(a,r)),this.setSourceContent(r,s))}),this)}_validateMapping(e,t,r,s){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!s);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:s}))}_serializeMappings(){let r,s,n,i,a=0,o=1,c=0,u=0,l=0,p=0,d="";const h=this._mappings.toArray();for(let f=0,g=h.length;f<g;f++){if(s=h[f],r="",s.generatedLine!==o)for(a=0;s.generatedLine!==o;)r+=";",o++;else if(f>0){if(!t.compareByGeneratedPositionsInflated(s,h[f-1]))continue;r+=","}r+=e.encode(s.generatedColumn-a),a=s.generatedColumn,null!=s.source&&(i=this._sources.indexOf(s.source),r+=e.encode(i-p),p=i,r+=e.encode(s.originalLine-1-u),u=s.originalLine-1,r+=e.encode(s.originalColumn-c),c=s.originalColumn,null!=s.name&&(n=this._names.indexOf(s.name),r+=e.encode(n-l),l=n)),d+=r}return d}_generateSourcesContent(e,r){return e.map((function(e){if(!this._sourcesContents)return null;null!=r&&(e=t.relative(r,e));const s=t.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}}return n.prototype._version=3,sourceMapGenerator.SourceMapGenerator=n,sourceMapGenerator}var sourceMapConsumer={},binarySearch={},hasRequiredBinarySearch;function requireBinarySearch(){return hasRequiredBinarySearch||(hasRequiredBinarySearch=1,function(e){function t(r,s,n,i,a,o){const c=Math.floor((s-r)/2)+r,u=a(n,i[c],!0);return 0===u?c:u>0?s-c>1?t(c,s,n,i,a,o):o==e.LEAST_UPPER_BOUND?s<i.length?s:-1:c:c-r>1?t(r,c,n,i,a,o):o==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(r,s,n,i){if(0===s.length)return-1;let a=t(-1,s.length,r,s,n,i||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&0===n(s[a],s[a-1],!0);)--a;return a}}(binarySearch)),binarySearch}var readWasm={exports:{}},hasRequiredReadWasm,wasm,hasRequiredWasm,hasRequiredSourceMapConsumer;function requireReadWasm(){if(hasRequiredReadWasm)return readWasm.exports;hasRequiredReadWasm=1;if(function(){return"undefined"!=typeof window&&this===window}.call()){let e=null;readWasm.exports=function(){if("string"==typeof e)return fetch(e).then((e=>e.arrayBuffer()));if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},readWasm.exports.initialize=t=>e=t}else{const e=require$$0$6,t=require$$0$1;readWasm.exports=function(){return new Promise(((r,s)=>{const n=t.join(__dirname,"mappings.wasm");e.readFile(n,null,((e,t)=>{e?s(e):r(t.buffer)}))}))},readWasm.exports.initialize=e=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}return readWasm.exports}function requireWasm(){if(hasRequiredWasm)return wasm;hasRequiredWasm=1;const e=requireReadWasm();function t(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let r=null;return wasm=function(){if(r)return r;const s=[];return r=e().then((e=>WebAssembly.instantiate(e,{env:{mapping_callback(e,r,n,i,a,o,c,u,l,p){const d=new t;d.generatedLine=e+1,d.generatedColumn=r,n&&(d.lastGeneratedColumn=i-1),a&&(d.source=o,d.originalLine=c+1,d.originalColumn=u,l&&(d.name=p)),s[s.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}}))).then((e=>({exports:e.instance.exports,withMappingCallback:(e,t)=>{s.push(e);try{t()}finally{s.pop()}}}))).then(null,(e=>{throw r=null,e})),r},wasm}function requireSourceMapConsumer(){if(hasRequiredSourceMapConsumer)return sourceMapConsumer;hasRequiredSourceMapConsumer=1;const e=requireUtil(),t=requireBinarySearch(),r=requireArraySet().ArraySet;requireBase64Vlq();const s=requireReadWasm(),n=requireWasm(),i=Symbol("smcInternal");class a{constructor(t,r){return t==i?Promise.resolve(this):function(t,r){let s=t;"string"==typeof t&&(s=e.parseSourceMapInput(t));const n=null!=s.sections?new c(s,r):new o(s,r);return Promise.resolve(n)}(t,r)}static initialize(e){s.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,t){return function(e,t){return o.fromSourceMap(e,t)}(e,t)}static async with(e,t,r){const s=await new a(e,t);try{return await r(s)}finally{s.destroy()}}_parseMappings(e,t){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,t,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}a.prototype._version=3,a.GENERATED_ORDER=1,a.ORIGINAL_ORDER=2,a.GREATEST_LOWER_BOUND=1,a.LEAST_UPPER_BOUND=2,sourceMapConsumer.SourceMapConsumer=a;class o extends a{constructor(t,s){return super(i).then((i=>{let a=t;"string"==typeof t&&(a=e.parseSourceMapInput(t));const o=e.getArg(a,"version");let c=e.getArg(a,"sources");const u=e.getArg(a,"names",[]);let l=e.getArg(a,"sourceRoot",null);const p=e.getArg(a,"sourcesContent",null),d=e.getArg(a,"mappings"),h=e.getArg(a,"file",null);if(o!=i._version)throw new Error("Unsupported version: "+o);return l&&(l=e.normalize(l)),c=c.map(String).map(e.normalize).map((function(t){return l&&e.isAbsolute(l)&&e.isAbsolute(t)?e.relative(l,t):t})),i._names=r.fromArray(u.map(String),!0),i._sources=r.fromArray(c,!0),i._absoluteSources=i._sources.toArray().map((function(t){return e.computeSourceURL(l,t,s)})),i.sourceRoot=l,i.sourcesContent=p,i._mappings=d,i._sourceMapURL=s,i.file=h,i._computedColumnSpans=!1,i._mappingsPtr=0,i._wasm=null,n().then((e=>(i._wasm=e,i)))}))}_findSourceIndex(t){let r=t;if(null!=this.sourceRoot&&(r=e.relative(this.sourceRoot,r)),this._sources.has(r))return this._sources.indexOf(r);for(let e=0;e<this._absoluteSources.length;++e)if(this._absoluteSources[e]==t)return e;return-1}static fromSourceMap(e,t){return new o(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return 0===this._mappingsPtr&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,t){const r=e.length,s=this._wasm.exports.allocate_mappings(r),n=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let t=0;t<r;t++)n[t]=e.charCodeAt(t);const i=this._wasm.exports.parse_mappings(s);if(!i){const e=this._wasm.exports.get_last_error();let t=`Error parsing mappings (code ${e}): `;switch(e){case 1:t+="the mappings contained a negative line, column, source index, or name index";break;case 2:t+="the mappings contained a number larger than 2**32";break;case 3:t+="reached EOF while in the middle of parsing a VLQ";break;case 4:t+="invalid base 64 character while parsing a VLQ";break;default:t+="unknown error code"}throw new Error(t)}this._mappingsPtr=i}eachMapping(t,r,s){const n=r||null,i=s||a.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback((r=>{null!==r.source&&(r.source=this._sources.at(r.source),r.source=e.computeSourceURL(o,r.source,this._sourceMapURL),null!==r.name&&(r.name=this._names.at(r.name))),t.call(n,r)}),(()=>{switch(i){case a.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case a.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}}))}allGeneratedPositionsFor(t){let r=e.getArg(t,"source");const s=e.getArg(t,"line"),n=t.column||0;if(r=this._findSourceIndex(r),r<0)return[];if(s<1)throw new Error("Line numbers must be >= 1");if(n<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback((e=>{let t=e.lastGeneratedColumn;this._computedColumnSpans&&null===t&&(t=1/0),i.push({line:e.generatedLine,column:e.generatedColumn,lastColumn:t})}),(()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),r,s-1,"column"in t,n)})),i}destroy(){0!==this._mappingsPtr&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const r={generatedLine:e.getArg(t,"line"),generatedColumn:e.getArg(t,"column")};if(r.generatedLine<1)throw new Error("Line numbers must be >= 1");if(r.generatedColumn<0)throw new Error("Column numbers must be >= 0");let s,n=e.getArg(t,"bias",a.GREATEST_LOWER_BOUND);if(null==n&&(n=a.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>s=e),(()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),r.generatedLine-1,r.generatedColumn,n)})),s&&s.generatedLine===r.generatedLine){let t=e.getArg(s,"source",null);null!==t&&(t=this._sources.at(t),t=e.computeSourceURL(this.sourceRoot,t,this._sourceMapURL));let r=e.getArg(s,"name",null);return null!==r&&(r=this._names.at(r)),{source:t,line:e.getArg(s,"originalLine",null),column:e.getArg(s,"originalColumn",null),name:r}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e})))}sourceContentFor(t,r){if(!this.sourcesContent)return null;const s=this._findSourceIndex(t);if(s>=0)return this.sourcesContent[s];let n,i=t;if(null!=this.sourceRoot&&(i=e.relative(this.sourceRoot,i)),null!=this.sourceRoot&&(n=e.urlParse(this.sourceRoot))){const e=i.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];if((!n.path||"/"==n.path)&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(r)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let r=e.getArg(t,"source");if(r=this._findSourceIndex(r),r<0)return{line:null,column:null,lastColumn:null};const s={source:r,originalLine:e.getArg(t,"line"),originalColumn:e.getArg(t,"column")};if(s.originalLine<1)throw new Error("Line numbers must be >= 1");if(s.originalColumn<0)throw new Error("Column numbers must be >= 0");let n,i=e.getArg(t,"bias",a.GREATEST_LOWER_BOUND);if(null==i&&(i=a.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>n=e),(()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),s.source,s.originalLine-1,s.originalColumn,i)})),n&&n.source===s.source){let t=n.lastGeneratedColumn;return this._computedColumnSpans&&null===t&&(t=1/0),{line:e.getArg(n,"generatedLine",null),column:e.getArg(n,"generatedColumn",null),lastColumn:t}}return{line:null,column:null,lastColumn:null}}}o.prototype.consumer=a,sourceMapConsumer.BasicSourceMapConsumer=o;class c extends a{constructor(t,s){return super(i).then((n=>{let i=t;"string"==typeof t&&(i=e.parseSourceMapInput(t));const o=e.getArg(i,"version"),c=e.getArg(i,"sections");if(o!=n._version)throw new Error("Unsupported version: "+o);n._sources=new r,n._names=new r,n.__generatedMappings=null,n.__originalMappings=null,n.__generatedMappingsUnsorted=null,n.__originalMappingsUnsorted=null;let u={line:-1,column:0};return Promise.all(c.map((t=>{if(t.url)throw new Error("Support for url field in sections not implemented.");const r=e.getArg(t,"offset"),n=e.getArg(r,"line"),i=e.getArg(r,"column");if(n<u.line||n===u.line&&i<u.column)throw new Error("Section offsets must be ordered and non-overlapping.");u=r;return new a(e.getArg(t,"map"),s).then((e=>({generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:e})))}))).then((e=>(n._sections=e,n)))}))}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(e.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(e.compareByOriginalPositions),this.__originalMappings=t}get sources(){const e=[];for(let t=0;t<this._sections.length;t++)for(let r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}originalPositionFor(r){const s={generatedLine:e.getArg(r,"line"),generatedColumn:e.getArg(r,"column")},n=t.search(s,this._sections,(function(e,t){const r=e.generatedLine-t.generatedOffset.generatedLine;return r||e.generatedColumn-t.generatedOffset.generatedColumn})),i=this._sections[n];return i?i.consumer.originalPositionFor({line:s.generatedLine-(i.generatedOffset.generatedLine-1),column:s.generatedColumn-(i.generatedOffset.generatedLine===s.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:r.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))}sourceContentFor(e,t){for(let t=0;t<this._sections.length;t++){const r=this._sections[t].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(t){for(let r=0;r<this._sections.length;r++){const s=this._sections[r];if(-1===s.consumer._findSourceIndex(e.getArg(t,"source")))continue;const n=s.consumer.generatedPositionFor(t);if(n){return{line:n.line+(s.generatedOffset.generatedLine-1),column:n.column+(s.generatedOffset.generatedLine===n.line?s.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}}_parseMappings(t,r){const s=this.__generatedMappingsUnsorted=[],n=this.__originalMappingsUnsorted=[];for(let t=0;t<this._sections.length;t++){const r=this._sections[t],i=[];r.consumer.eachMapping((e=>i.push(e)));for(let t=0;t<i.length;t++){const a=i[t];let o=e.computeSourceURL(r.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(o),o=this._sources.indexOf(o);let c=null;a.name&&(this._names.add(a.name),c=this._names.indexOf(a.name));const u={source:o,generatedLine:a.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:a.generatedColumn+(r.generatedOffset.generatedLine===a.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:a.originalLine,originalColumn:a.originalColumn,name:c};s.push(u),"number"==typeof u.originalLine&&n.push(u)}}}eachMapping(t,r,s){const n=r||null;let i;switch(s||a.GENERATED_ORDER){case a.GENERATED_ORDER:i=this._generatedMappings;break;case a.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const o=this.sourceRoot;i.map((function(t){let r=null;return null!==t.source&&(r=this._sources.at(t.source),r=e.computeSourceURL(o,r,this._sourceMapURL)),{source:r,generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}}),this).forEach(t,n)}_findMapping(e,r,s,n,i,a){if(e[s]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[s]);if(e[n]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[n]);return t.search(e,r,i,a)}allGeneratedPositionsFor(r){const s=e.getArg(r,"line"),n={source:e.getArg(r,"source"),originalLine:s,originalColumn:e.getArg(r,"column",0)};if(n.source=this._findSourceIndex(n.source),n.source<0)return[];if(n.originalLine<1)throw new Error("Line numbers must be >= 1");if(n.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let a=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,t.LEAST_UPPER_BOUND);if(a>=0){let t=this._originalMappings[a];if(void 0===r.column){const r=t.originalLine;for(;t&&t.originalLine===r;){let r=t.lastGeneratedColumn;this._computedColumnSpans&&null===r&&(r=1/0),i.push({line:e.getArg(t,"generatedLine",null),column:e.getArg(t,"generatedColumn",null),lastColumn:r}),t=this._originalMappings[++a]}}else{const r=t.originalColumn;for(;t&&t.originalLine===s&&t.originalColumn==r;){let r=t.lastGeneratedColumn;this._computedColumnSpans&&null===r&&(r=1/0),i.push({line:e.getArg(t,"generatedLine",null),column:e.getArg(t,"generatedColumn",null),lastColumn:r}),t=this._originalMappings[++a]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}return sourceMapConsumer.IndexedSourceMapConsumer=c,sourceMapConsumer}var sourceNode={},hasRequiredSourceNode,hasRequiredSourceMap$1;function requireSourceNode(){if(hasRequiredSourceNode)return sourceNode;hasRequiredSourceNode=1;const e=requireSourceMapGenerator().SourceMapGenerator,t=requireUtil(),r=/(\r?\n)/,s="$$$isSourceNode$$$";class n{constructor(e,t,r,n,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[s]=!0,null!=n&&this.add(n)}static fromStringWithSourceMap(e,s,i){const a=new n,o=e.split(r);let c=0;const u=function(){return e()+(e()||"");function e(){return c<o.length?o[c++]:void 0}};let l,p=1,d=0,h=null;return s.eachMapping((function(e){if(null!==h){if(!(p<e.generatedLine)){l=o[c]||"";const t=l.substr(0,e.generatedColumn-d);return o[c]=l.substr(e.generatedColumn-d),d=e.generatedColumn,f(h,t),void(h=e)}f(h,u()),p++,d=0}for(;p<e.generatedLine;)a.add(u()),p++;d<e.generatedColumn&&(l=o[c]||"",a.add(l.substr(0,e.generatedColumn)),o[c]=l.substr(e.generatedColumn),d=e.generatedColumn),h=e}),this),c<o.length&&(h&&f(h,u()),a.add(o.splice(c).join(""))),s.sources.forEach((function(e){const r=s.sourceContentFor(e);null!=r&&(null!=i&&(e=t.join(i,e)),a.setSourceContent(e,r))})),a;function f(e,r){if(null===e||void 0===e.source)a.add(r);else{const s=i?t.join(i,e.source):e.source;a.add(new n(e.originalLine,e.originalColumn,s,r,e.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,n=this.children.length;r<n;r++)t=this.children[r],t[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const s=this.children.length;if(s>0){for(t=[],r=0;r<s-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[s]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,r){this.sourceContents[t.toSetString(e)]=r}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);const r=Object.keys(this.sourceContents);for(let s=0,n=r.length;s<n;s++)e(t.fromSetString(r[s]),this.sourceContents[r[s]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(t){const r={code:"",line:1,column:0},s=new e(t);let n=!1,i=null,a=null,o=null,c=null;return this.walk((function(e,t){r.code+=e,null!==t.source&&null!==t.line&&null!==t.column?(i===t.source&&a===t.line&&o===t.column&&c===t.name||s.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name}),i=t.source,a=t.line,o=t.column,c=t.name,n=!0):n&&(s.addMapping({generated:{line:r.line,column:r.column}}),i=null,n=!1);for(let a=0,o=e.length;a<o;a++)10===e.charCodeAt(a)?(r.line++,r.column=0,a+1===o?(i=null,n=!1):n&&s.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name})):r.column++})),this.walkSourceContents((function(e,t){s.setSourceContent(e,t)})),{code:r.code,map:s}}}return sourceNode.SourceNode=n,sourceNode}function requireSourceMap$1(){return hasRequiredSourceMap$1||(hasRequiredSourceMap$1=1,sourceMap$1.SourceMapGenerator=requireSourceMapGenerator().SourceMapGenerator,sourceMap$1.SourceMapConsumer=requireSourceMapConsumer().SourceMapConsumer,sourceMap$1.SourceNode=requireSourceNode().SourceNode),sourceMap$1}var logger={},hasRequiredLogger,yoctoQueue,hasRequiredYoctoQueue,pLimit_1,hasRequiredPLimit,hasRequiredSourcemapper,hasRequiredSrc$1,shared,hasRequiredShared,wall,hasRequiredWall,constants$1,hasRequiredConstants$1,space,hasRequiredSpace,events,hasRequiredEvents,tagger_1,hasRequiredTagger,config,hasRequiredConfig,profiler,hasRequiredProfiler$1,profiling,hasRequiredProfiling,profiler_1,hasRequiredProfiler,testApiManualPlugin,hasRequiredTestApiManualPlugin,iastLog_1,hasRequiredIastLog,vulnerabilities,hasRequiredVulnerabilities,rangeUtils,hasRequiredRangeUtils,commandSensitiveAnalyzer,hasRequiredCommandSensitiveAnalyzer,constants,hasRequiredConstants,headerSensitiveAnalyzer,hasRequiredHeaderSensitiveAnalyzer,sensitiveRegex,hasRequiredSensitiveRegex,utils,hasRequiredUtils,jsonSensitiveAnalyzer,hasRequiredJsonSensitiveAnalyzer,ldapSensitiveAnalyzer,hasRequiredLdapSensitiveAnalyzer,sqlSensitiveAnalyzer,hasRequiredSqlSensitiveAnalyzer,urlSensitiveAnalyzer,hasRequiredUrlSensitiveAnalyzer,sensitiveHandler,hasRequiredSensitiveHandler,vulnerabilitiesFormatter,hasRequiredVulnerabilitiesFormatter,tags,hasRequiredTags,vulnerabilityReporter,hasRequiredVulnerabilityReporter,pathLine_1,hasRequiredPathLine,iastContext,hasRequiredIastContext,overheadController,hasRequiredOverheadController,verbosity,hasRequiredVerbosity,spanTags,hasRequiredSpanTags,namespaces,hasRequiredNamespaces,telemetry,hasRequiredTelemetry,iastMetric,hasRequiredIastMetric,iastPlugin,hasRequiredIastPlugin,filter,hasRequiredFilter,csiMethods_1,hasRequiredCsiMethods,rewriterTelemetry,hasRequiredRewriterTelemetry,lruCache,hasRequiredLruCache,primordials_1,hasRequiredPrimordials,node_source_map,hasRequiredNode_source_map,sourceMap,hasRequiredSourceMap,stackTrace,hasRequiredStackTrace;function requireLogger(){if(hasRequiredLogger)return logger;hasRequiredLogger=1,Object.defineProperty(logger,"__esModule",{value:!0}),logger.setLogger=logger.logger=logger.NullLogger=void 0;class e{info(...e){}error(...e){}trace(...e){}warn(...e){}fatal(...e){}debug(...e){}}return logger.NullLogger=e,logger.logger=new e,logger.setLogger=function(e){logger.logger=e},logger}function requireYoctoQueue(){if(hasRequiredYoctoQueue)return yoctoQueue;hasRequiredYoctoQueue=1;class e{constructor(e){this.value=e,this.next=void 0}}class t{constructor(){this.clear()}enqueue(t){const r=new e(t);this._head?(this._tail.next=r,this._tail=r):(this._head=r,this._tail=r),this._size++}dequeue(){const e=this._head;if(e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}}return yoctoQueue=t}function requirePLimit(){if(hasRequiredPLimit)return pLimit_1;hasRequiredPLimit=1;const e=requireYoctoQueue();return pLimit_1=t=>{if(!Number.isInteger(t)&&t!==1/0||!(t>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const r=new e;let s=0;const n=async(e,t,...n)=>{s++;const i=(async()=>e(...n))();t(i);try{await i}catch{}s--,r.size>0&&r.dequeue()()},i=(e,...i)=>new Promise((a=>{((e,i,...a)=>{r.enqueue(n.bind(null,e,i,...a)),(async()=>{await Promise.resolve(),s<t&&r.size>0&&r.dequeue()()})()})(e,a,...i)}));return Object.defineProperties(i,{activeCount:{get:()=>s},pendingCount:{get:()=>r.size},clearQueue:{value:()=>{r.clear()}}}),i},pLimit_1}function requireSourcemapper(){if(hasRequiredSourcemapper)return sourcemapper;hasRequiredSourcemapper=1;var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),t=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=commonjsGlobal&&commonjsGlobal.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(s,r,n);return t(s,r),s},s=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sourcemapper,"__esModule",{value:!0}),sourcemapper.SourceMapper=void 0;const n=r(require$$0$6),i=r(require$$0$1),a=r(requireSourceMap$1()),o=requireLogger(),c=s(requirePLimit()),u=n.promises.readFile,l=".map";function p(e){return o.logger.debug(`Error: ${e}`),new Error(e)}class d{static async create(e,t=!1){t&&o.logger.debug(`Looking for source map files in dirs: [${e.join(", ")}]`);const r=[];for(const t of e)try{(await f(t)).forEach((e=>{r.push(i.resolve(t,e))}))}catch(e){throw p(`failed to get source maps from ${t}: ${e}`)}return t&&o.logger.debug(`Found source map files: [${r.join(", ")}]`),async function(e,t){const r=(0,c.default)(10),s=new d(t),h=e.map((e=>r((()=>async function(e,t,r){if(!t||!t.endsWith(l))throw p(`The path "${t}" does not specify a source map file`);let s,c;t=i.normalize(t);try{s=await u(t,"utf8")}catch(e){throw p("Could not read source map file "+t+": "+e)}try{c=await new a.SourceMapConsumer(s)}catch(e){throw p("An error occurred while reading the sourceMap file "+t+": "+e)}const d=i.dirname(t),h=[];c.file&&h.push(i.resolve(d,c.file));const f=i.resolve(d,i.basename(t,l));0!==h.length&&h[0]===f||h.push(f);for(const s of h)try{return await n.promises.access(s,n.constants.F_OK),e.set(s,{mapFileDir:d,mapConsumer:c}),void(r&&o.logger.debug(`Loaded source map for ${s} => ${t}`))}catch(e){r&&o.logger.debug(`Generated path ${s} does not exist`)}r&&o.logger.debug(`Unable to find generated file for ${t}`)}(s.infoMap,e,t)))));try{await Promise.all(h)}catch(e){throw p("An error occurred while processing the source map files"+e)}return s}(r,t)}constructor(e=!1){this.infoMap=new Map,this.debug=e}getMappingInfo(e){return this.infoMap.has(i.normalize(e))?this.infoMap.get(e):null}hasMappingInfo(e){return null!==this.getMappingInfo(e)}mappingInfo(e){const t=i.normalize(e.file),r=this.getMappingInfo(t);if(null===r)return this.debug&&o.logger.debug(`Source map lookup failed: no map found for ${e.file} (normalized: ${t})`),e;const s={line:e.line,column:e.column>0?e.column-1:0},n=r.mapConsumer.originalPositionFor(s);if(null===n.source)return this.debug&&o.logger.debug(`Source map lookup failed for ${e.name}(${e.file}:${e.line}:${e.column})`),e;const a={file:i.resolve(r.mapFileDir,n.source),line:n.line||void 0,name:n.name||e.name,column:null===n.column?void 0:n.column+1};return this.debug&&o.logger.debug(`Source map lookup succeeded for ${e.name}(${e.file}:${e.line}:${e.column}) => ${a.name}(${a.file}:${a.line}:${a.column})`),a}}function h(e){return(t=e)instanceof Error&&"code"in t&&e.code&&["ENOENT","EPERM","EACCES","ELOOP"].includes(e.code);var t}async function f(e){const t=[];for await(const r of async function*(e,t=(e=>!0),r=((e,t)=>!0)){yield*async function*e(s){try{for await(const a of await n.promises.opendir(s)){const o=i.join(s,a.name);a.isDirectory()&&r(s,a.name)?yield*e(o):a.isFile()&&t(a.name)&&(await n.promises.access(o,n.constants.R_OK),yield o)}}catch(e){if(!h(e))throw e;o.logger.debug((()=>`Non fatal error: ${e}`))}}(e)}(e,(e=>e.endsWith(".js.map")),((e,t)=>"/proc"!==e&&".git"!==t&&"node_modules"!==t)))t.push(i.relative(e,r));return t}return sourcemapper.SourceMapper=d,sourcemapper}function requireSrc$1(){return hasRequiredSrc$1||(hasRequiredSrc$1=1,function(e,t){var r=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),s=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.heap=t.time=t.getNativeThreadId=t.setLogger=t.SourceMapper=t.encodeSync=t.encode=void 0;const i=require$$0$6,a=n(requireHeapProfiler()),o=requireProfileEncoder(),c=n(requireTimeProfiler());var u=requireProfileEncoder();Object.defineProperty(t,"encode",{enumerable:!0,get:function(){return u.encode}}),Object.defineProperty(t,"encodeSync",{enumerable:!0,get:function(){return u.encodeSync}});var l=requireSourcemapper();Object.defineProperty(t,"SourceMapper",{enumerable:!0,get:function(){return l.SourceMapper}});var p=requireLogger();Object.defineProperty(t,"setLogger",{enumerable:!0,get:function(){return p.setLogger}});var d=requireTimeProfiler();Object.defineProperty(t,"getNativeThreadId",{enumerable:!0,get:function(){return d.getNativeThreadId}}),t.time={profile:c.profile,start:c.start,stop:c.stop,getContext:c.getContext,setContext:c.setContext,isStarted:c.isStarted,v8ProfilerStuckEventLoopDetected:c.v8ProfilerStuckEventLoopDetected,getState:c.getState,constants:c.constants},t.heap={start:a.start,stop:a.stop,profile:a.profile,convertProfile:a.convertProfile,v8Profile:a.v8Profile,monitorOutOfMemory:a.monitorOutOfMemory,CallbackMode:a.CallbackMode},e.parent&&"internal/preload"===e.parent.id&&(t.time.start({}),process.on("exit",(()=>{const e=t.time.stop(),r=(0,o.encodeSync)(e);(0,i.writeFileSync)(`pprof-profile-${process.pid}.pb.gz`,r)})))}(src$1,src$1.exports)),src$1.exports}function requireShared(){if(hasRequiredShared)return shared;hasRequiredShared=1;const{isMainThread:e,threadId:t}=require$$2$4,r="thread name",s="os thread id",n="thread id",i=e?"Main":`Worker #${t}`,a=`${i} Event Loop`;return shared={END_TIMESTAMP_LABEL:"end_timestamp_ns",THREAD_NAME_LABEL:r,THREAD_ID_LABEL:n,OS_THREAD_ID_LABEL:s,threadNamePrefix:i,eventLoopThreadName:a,getNonJSThreadsLabels:function(){return{[r]:"Non-JS threads",[n]:"NA",[s]:"NA"}},getThreadLabels:function(){let e;return()=>(e||(e=function(){const e=requireSrc$1().getNativeThreadId();return{[r]:a,[n]:`${t}`,[s]:`${e}`}}()),e)}()}}function requireWall(){if(hasRequiredWall)return wall;hasRequiredWall=1;const{storage:e}=requireDatadogCore(),t=requireDcPolyfill(),{HTTP_METHOD:r,HTTP_ROUTE:s,RESOURCE_NAME:n,SPAN_TYPE:i}=requireTags$2(),{WEB:a}=requireTypes$1(),o=requireRuntime_metrics(),c=requireMetrics(),{END_TIMESTAMP_LABEL:u,getNonJSThreadsLabels:l,getThreadLabels:p}=requireShared(),d=t.channel("dd-trace:storage:before"),h=t.channel("dd-trace:storage:enter"),f=t.channel("dd-trace:span:finish"),g=c.manager.namespace("profilers"),m=Symbol("NativeWallProfiler.MemoizedWebTags");let _;function b(e){return e[n]||[e[r],e[s]].filter((e=>e)).join(" ")}function y(e,t,r){const s=r[m];if(void 0!==s)return s;function n(e){return r[m]=e,e}const o=r.context(),c=o._tags;if(function(e){return e[i]===a}(c))return n(c);const u=o._parentId;for(;--t>=0;){const r=e[t];if(r.context()._spanId===u)return n(y(e,t,r))}return n(null)}return wall=class{constructor(e={}){this.type="wall",this._samplingIntervalMicros=e.samplingInterval||1e6/99,this._flushIntervalMillis=e.flushInterval||6e4,this._codeHotspotsEnabled=!!e.codeHotspotsEnabled,this._endpointCollectionEnabled=!!e.endpointCollectionEnabled,this._timelineEnabled=!!e.timelineEnabled,this._cpuProfilingEnabled=!!e.cpuProfilingEnabled,this._captureSpanData=this._codeHotspotsEnabled||this._endpointCollectionEnabled,this._withContexts=this._captureSpanData||this._timelineEnabled||this._cpuProfilingEnabled,this._v8ProfilerBugWorkaroundEnabled=!!e.v8ProfilerBugWorkaroundEnabled,this._mapper=void 0,this._pprof=void 0,this._withContexts&&this._captureSpanData&&(this._enter=this._enter.bind(this),this._spanFinished=this._spanFinished.bind(this)),this._generateLabels=this._generateLabels.bind(this),this._logger=e.logger,this._started=!1}codeHotspotsEnabled(){return this._codeHotspotsEnabled}endpointCollectionEnabled(){return this._endpointCollectionEnabled}start({mapper:e}={}){this._started||(this._mapper=e,this._pprof=requireSrc$1(),_=this._pprof.time.constants.kSampleCount,process._startProfilerIdleNotifier||(process._startProfilerIdleNotifier=()=>{}),process._stopProfilerIdleNotifier||(process._stopProfilerIdleNotifier=()=>{}),this._pprof.time.start({intervalMicros:this._samplingIntervalMicros,durationMillis:this._flushIntervalMillis,sourceMapper:this._mapper,withContexts:this._withContexts,lineNumbers:!1,workaroundV8Bug:this._v8ProfilerBugWorkaroundEnabled,collectCpuTime:this._cpuProfilingEnabled}),this._withContexts&&(this._currentContext={},this._pprof.time.setContext(this._currentContext),this._captureSpanData&&(this._profilerState=this._pprof.time.getState(),this._lastSpan=void 0,this._lastStartedSpans=void 0,this._lastWebTags=void 0,this._lastSampleCount=0,d.subscribe(this._enter),h.subscribe(this._enter),f.subscribe(this._spanFinished))),this._started=!0)}_enter(){if(!this._started)return;const t=this._profilerState[_];if(t!==this._lastSampleCount){this._lastSampleCount=t;const e=this._currentContext;this._currentContext={},this._pprof.time.setContext(this._currentContext),this._updateContext(e)}const r=function(){const t=e.getStore();return t&&t.span}();if(r){const e=r.context();this._lastSpan=r;const t=function(e){return e._trace.started}(e);this._lastStartedSpans=t,this._endpointCollectionEnabled&&(this._lastWebTags=y(t,t.length,r))}else this._lastStartedSpans=void 0,this._lastSpan=void 0,this._lastWebTags=void 0}_updateContext(e){if(this._lastSpan){if(this._codeHotspotsEnabled){e.spanId=this._lastSpan.context().toSpanId();const t=this._lastStartedSpans[0];t&&(e.rootSpanId=t.context().toSpanId())}this._lastWebTags&&(e.webTags=this._lastWebTags,e.endpoint=b(this._lastWebTags))}}_spanFinished(e){e[m]&&(e[m]=void 0)}_reportV8bug(e){const t=`v8_profiler_bug_workaround_enabled:${this._v8ProfilerBugWorkaroundEnabled}`,r=`v8_cpu_profiler${e?"_maybe":""}_stuck_event_loop`;this._logger?.warn(`Wall profiler: ${e?"possible ":""}v8 profiler stuck event loop detected.`),o.increment(`runtime.node.profiler.${r}`,t,!0),g.count(r,[t]).inc()}_stop(e){if(!this._started)return;this._captureSpanData&&(this._enter(),this._lastSampleCount=0);const t=this._pprof.time.stop(e,this._generateLabels);if(e){const e=this._pprof.time.v8ProfilerStuckEventLoopDetected();0!==e&&this._reportV8bug(1===e)}else this._captureSpanData&&(d.unsubscribe(this._enter),h.unsubscribe(this._enter),f.unsubscribe(this._spanFinished),this._profilerState=void 0,this._lastSpan=void 0,this._lastStartedSpans=void 0,this._lastWebTags=void 0),this._started=!1;return t}_generateLabels({node:e,context:t}){if(e.name===this._pprof.time.constants.NON_JS_THREADS_FUNCTION_NAME)return l();if(null==t)return p();const r={...p()},{context:{spanId:s,rootSpanId:n,webTags:i,endpoint:a},timestamp:o}=t;return this._timelineEnabled&&(r[u]=1000n*o),s&&(r["span id"]=s),n&&(r["local root span id"]=n),i&&0!==Object.keys(i).length?r["trace endpoint"]=b(i):a&&(r["trace endpoint"]=a),r}profile(e){return this._stop(e)}encode(e){return this._pprof.encode(e)}stop(){this._stop(!1)}isStarted(){return this._started}},wall}function requireConstants$1(){if(hasRequiredConstants$1)return constants$1;hasRequiredConstants$1=1;const e=Object.freeze({PERIODIC:"periodic",ON_SHUTDOWN:"on_shutdown",ON_OUT_OF_MEMORY:"on_oom"}),t=Object.freeze({PROCESS:"process",ASYNC_CALLBACK:"async",LOGS:"logs"});return constants$1={snapshotKinds:e,oomExportStrategies:t}}function requireSpace(){if(hasRequiredSpace)return space;hasRequiredSpace=1;const{oomExportStrategies:e}=requireConstants$1(),{getThreadLabels:t}=requireShared();return space=class{constructor(e={}){this.type="space",this._samplingInterval=e.samplingInterval||524288,this._stackDepth=e.stackDepth||64,this._pprof=void 0,this._oomMonitoring=e.oomMonitoring||{},this._started=!1}start({mapper:t,nearOOMCallback:r}={}){if(!this._started){if(this._mapper=t,this._pprof=requireSrc$1(),this._pprof.heap.start(this._samplingInterval,this._stackDepth),this._oomMonitoring.enabled){const t=this._oomMonitoring.exportStrategies;this._pprof.heap.monitorOutOfMemory(this._oomMonitoring.heapLimitExtensionSize,this._oomMonitoring.maxHeapExtensionCount,t.includes(e.LOGS),t.includes(e.PROCESS)?this._oomMonitoring.exportCommand:[],(e=>r(this.type,this._pprof.encodeSync(e))),function(t,r){return t.includes(e.ASYNC_CALLBACK)?r.Async:0}(t,this._pprof.heap.CallbackMode))}this._started=!0}}profile(e){const r=this._pprof.heap.profile(void 0,this._mapper,t);return e||this.stop(),r}encode(e){return this._pprof.encode(e)}stop(){this._started&&(this._pprof.heap.stop(),this._started=!1)}isStarted(){return this._started}}}function requireEvents(){if(hasRequiredEvents)return events;hasRequiredEvents=1;const{performance:e,constants:t,PerformanceObserver:r}=require$$0$5,{END_TIMESTAMP_LABEL:s}=requireShared(),n=requireSemver(),{Function:i,Label:a,Line:o,Location:c,Profile:u,Sample:l,StringTable:p,ValueType:d}=requireDist(),h=requireSrc$1(),f=n.gte(process.version,"16.0.0"),g=1e6;function m(e,t,r){return new a({key:t,str:e.dedup(r)})}function _(e,t,r){return m(e,e.dedup(t),r)}class b{constructor(e){this.stringTable=e,this.operationNameLabelKey=e.dedup("operation"),this.hostLabelKey=e.dedup("host"),this.addressLabelKey=e.dedup("address"),this.portLabelKey=e.dedup("port")}decorateSample(e,t){const r=e.label,s=this.stringTable;function n(e,t){r.push(m(s,e,t))}const i=t.name;n(this.operationNameLabelKey,t.name);const o=t.detail;switch(i){case"lookup":n(this.hostLabelKey,o.hostname);break;case"lookupService":n(this.addressLabelKey,o.host),r.push(new a({key:this.portLabelKey,num:o.port}));break;case"getHostByAddr":n(this.addressLabelKey,o.host);break;default:i.startsWith("query")&&n(this.hostLabelKey,o.host)}}}class y{constructor(e){this.stringTable=e,this.operationNameLabelKey=e.dedup("operation"),this.hostLabelKey=e.dedup("host"),this.portLabelKey=e.dedup("port")}decorateSample(e,t){const r=e.label,s=this.stringTable;function n(e,t){r.push(m(s,e,t))}const i=t.name;if(n(this.operationNameLabelKey,i),"connect"===i){const e=t.detail;n(this.hostLabelKey,e.host),r.push(new a({key:this.portLabelKey,num:e.port}))}}}const v={gc:class{constructor(e){this.stringTable=e,this.reasonLabelKey=e.dedup("gc reason"),this.kindLabels=[],this.reasonLabels=[],this.flagObj={};const r=e.dedup("gc type");for(const[s,n]of Object.entries(t))if(s.startsWith("NODE_PERFORMANCE_GC_FLAGS_"))this.flagObj[s.substring(26).toLowerCase()]=n;else if(s.startsWith("NODE_PERFORMANCE_GC_")){const t=s.substring(20).toLowerCase();this.kindLabels[n]=m(e,r,t)}}decorateSample(e,t){const{kind:r,flags:s}=f?t.detail:t;e.label.push(this.kindLabels[r]);const n=this.getReasonLabel(s);n&&e.label.push(n)}getReasonLabel(e){if(0===e)return null;let t=this.reasonLabels[e];if(!t){const r=[];for(const[t,s]of Object.entries(this.flagObj))s&e&&r.push(t);const s=r.join(",");t=m(this.stringTable,this.reasonLabelKey,s),this.reasonLabels[e]=t}return t}}};f&&(v.dns=b,v.net=y);return events=class{constructor(e={}){this.type="events",this._flushIntervalNanos=1e6*(e.flushInterval||6e4),this._observer=void 0,this.entries=[]}start(){this._observer||(this._observer=new r(function(e){this.entries.push(...e.getEntries())}.bind(this)),this._observer.observe({entryTypes:Object.keys(v)}))}stop(){this._observer&&(this._observer.disconnect(),this._observer=void 0)}profile(t,r,n){if(0===this.entries.length)return null;const h=new p,f=[],m=[],b=(()=>{const e=new i({id:m.length+1,name:h.dedup("")});m.push(e);const t=new o({functionId:e.id}),r=new c({id:f.length+1,line:[t]});return f.push(r),[r.id]})(),y={};for(const[e,t]of Object.entries(v)){const r=new t(h);r.eventTypeLabel=_(h,"event",e),y[e]=r}const S=h.dedup(s),q=BigInt(Math.round(e.timeOrigin*g)),E=[],R=n.getTime()-e.timeOrigin,T=this.entries.map((e=>{const t=y[e.entryType];if(!t)return null;const{startTime:r,duration:s}=e;if(r>=R)return E.push(e),null;const n=r+s,i={value:[Math.round(s*g)],locationId:b,label:[t.eventTypeLabel,new a({key:S,num:q+BigInt(Math.round(n*g))})]};return t.decorateSample(i,e),new l(i)})).filter((e=>e));this.entries=E;const A=new d({type:h.dedup("timeline"),unit:h.dedup("nanoseconds")});return t||this.stop(),new u({sampleType:[A],timeNanos:n.getTime()*g,periodType:A,period:1,durationNanos:(n.getTime()-r.getTime())*g,sample:T,location:f,function:m,stringTable:h})}encode(e){return h.encode(e)}}}function requireTagger(){if(hasRequiredTagger)return tagger_1;hasRequiredTagger=1;const e={parse(t){if(!t)return{};switch(typeof t){case"object":return Array.isArray(t)?t.reduce(((e,t)=>{const r=t.split(":"),s=r.shift().trim(),n=r.join(":").trim();return s&&n?Object.assign(e,{[s]:n}):e}),{}):e.parse(Object.keys(t).filter((e=>void 0!==t[e]&&null!==t[e])).map((e=>`${e}:${t[e]}`)));case"string":return e.parse(t.split(","));default:return{}}}};return tagger_1={tagger:e}}function requireConfig(){if(hasRequiredConfig)return config;hasRequiredConfig=1;const e=requireKoalas(),t=require$$0$a,r=require$$0$1,{URL:s,format:n,pathToFileURL:i}=require$$0$8,{AgentExporter:a}=requireAgent(),{FileExporter:o}=requireFile(),{ConsoleLogger:c}=requireConsole(),u=requireWall(),l=requireSpace(),p=requireEvents(),{oomExportStrategies:d,snapshotKinds:h}=requireConstants$1(),{GIT_REPOSITORY_URL:f,GIT_COMMIT_SHA:g}=requireTags$1(),{tagger:m}=requireTagger(),{isFalse:_,isTrue:b}=requireUtil$9();function y(e,t){const r=Object.values(d).find((t=>t===e));return void 0===r&&t.logger.error(`Unknown oom export strategy "${e}"`),r}function v(e,t){switch(e){case"agent":return new a(t);case"file":return new o(t)}}function S(e,t){switch(e){case"cpu":case"wall":return new u(t);case"space":return new l(t);default:t.logger.error(`Unknown profiler "${e}"`)}}return config={Config:class{constructor(u={}){const{DD_AGENT_HOST:l,DD_ENV:q,DD_PROFILING_CODEHOTSPOTS_ENABLED:E,DD_PROFILING_DEBUG_SOURCE_MAPS:R,DD_PROFILING_ENABLED:T,DD_PROFILING_ENDPOINT_COLLECTION_ENABLED:A,DD_PROFILING_EXPERIMENTAL_CODEHOTSPOTS_ENABLED:w,DD_PROFILING_EXPERIMENTAL_CPU_ENABLED:x,DD_PROFILING_EXPERIMENTAL_ENDPOINT_COLLECTION_ENABLED:I,DD_PROFILING_EXPERIMENTAL_OOM_EXPORT_STRATEGIES:C,DD_PROFILING_EXPERIMENTAL_OOM_HEAP_LIMIT_EXTENSION_SIZE:O,DD_PROFILING_EXPERIMENTAL_OOM_MAX_HEAP_EXTENSION_COUNT:$,DD_PROFILING_EXPERIMENTAL_OOM_MONITORING_ENABLED:k,DD_PROFILING_EXPERIMENTAL_TIMELINE_ENABLED:P,DD_PROFILING_HEAP_ENABLED:N,DD_PROFILING_PPROF_PREFIX:L,DD_PROFILING_PROFILERS:M,DD_PROFILING_SOURCE_MAP:D,DD_PROFILING_TIMELINE_ENABLED:j,DD_PROFILING_UPLOAD_PERIOD:U,DD_PROFILING_UPLOAD_TIMEOUT:B,DD_PROFILING_V8_PROFILER_BUG_WORKAROUND:G,DD_PROFILING_WALLTIME_ENABLED:F,DD_SERVICE:z,DD_TAGS:V,DD_TRACE_AGENT_PORT:H,DD_TRACE_AGENT_URL:W,DD_VERSION:K}=process.env,Y=b(e(u.enabled,T,!0)),J=e(u.env,q),X=u.service||z||"node",Q=t.hostname(),Z=e(u.version,K),ee=process.env.AWS_LAMBDA_FUNCTION_NAME,te=e(u.interval,1e3*Number(U),65e3),re=e(u.uploadTimeout,Number(B),6e4),se=e(u.sourceMap,D,!0),ne=e(u.pprofPrefix,L,"");this.enabled=Y,this.service=X,this.env=J,this.host=Q,this.functionname=ee,this.version=Z,this.tags=Object.assign(m.parse(V),m.parse(u.tags),m.parse({env:J,host:Q,service:X,version:Z,functionname:ee})),u.repositoryUrl&&u.commitSHA&&(this.tags[f]=u.repositoryUrl,this.tags[g]=u.commitSHA),this.logger=function(e){if("object"!=typeof e||"function"!=typeof e.debug||"function"!=typeof e.info||"function"!=typeof e.warn||"function"!=typeof e.error)return new c;return e}(u.logger);const ie=this.logger;function ae(e){const t=`DD_PROFILING_EXPERIMENTAL_${e}`,r=process.env[t];null!=r&&r==r&&ie.warn(`${t} is deprecated. Use DD_PROFILING_${e} instead.`)}const oe="win32"!==process.platform;function ce(e,t,r){if(e&&!r)throw new Error(`${t} not supported on ${process.platform}.`)}function ue(e,t){ce(e,t,oe)}this.flushInterval=te,this.uploadTimeout=re,this.sourceMap=se,this.debugSourceMaps=b(e(u.debugSourceMaps,R,!1)),this.endpointCollectionEnabled=b(e(u.endpointCollection,A,I,oe)),ae("ENDPOINT_COLLECTION_ENABLED"),ue(this.endpointCollectionEnabled,"Endpoint collection"),this.pprofPrefix=ne,this.v8ProfilerBugWorkaroundEnabled=b(e(u.v8ProfilerBugWorkaround,G,!0));const le=e(u.hostname,l)||"localhost",pe=e(u.port,H)||8126;this.url=new s(e(u.url,W,n({protocol:"http:",hostname:le,port:pe}))),this.exporters=function(e,t){"string"==typeof e&&(e=e.split(","));for(let r=0;r<e.length;r++){const s=e[r];"string"==typeof s&&(e[r]=v(s,t))}return e}(u.exporters||[new a(this)],this);const de="win32"!==process.platform,he=b(e(u.oomMonitoring,k,de));ce(he,"OOM monitoring",de);const fe=e(u.oomHeapLimitExtensionSize,Number(O),0),ge=e(u.oomMaxHeapExtensionCount,Number($),0),me=he?function(e,t){if(!e)return[];"string"==typeof e&&(e=e.split(","));for(let r=0;r<e.length;r++){const s=e[r];"string"==typeof s&&(e[r]=y(s,t))}return[...new Set(e)]}(e(u.oomExportStrategies,C,[d.PROCESS]),this):[],_e=he?function(e){const t=[...Object.entries(e.tags),["snapshot",h.ON_OUT_OF_MEMORY]].map((([e,t])=>`${e}:${t}`)).join(","),s=[];for(const t of e.exporters)t instanceof a?s.push(e.url.toString()):t instanceof o&&s.push(i(e.pprofPrefix).toString());return[process.execPath,r.join(__dirname,"exporter_cli.js"),s.join(","),t,"space"]}(this):void 0;this.oomMonitoring={enabled:he,heapLimitExtensionSize:fe,maxHeapExtensionCount:ge,exportStrategies:me,exportCommand:_e};const be=u.profilers?u.profilers:function({DD_PROFILING_HEAP_ENABLED:t,DD_PROFILING_WALLTIME_ENABLED:r,DD_PROFILING_PROFILERS:s}){const n=new Set(e(s,"wall,space").split(","));null!=r&&(b(r)?n.add("wall"):_(r)&&n.delete("wall"));null!=t&&(b(t)?n.add("space"):_(t)&&n.delete("space"));return[...n]}({DD_PROFILING_HEAP_ENABLED:N,DD_PROFILING_WALLTIME_ENABLED:F,DD_PROFILING_PROFILERS:M});this.timelineEnabled=b(e(u.timelineEnabled,j,P,!1)),ae("TIMELINE_ENABLED"),ue(this.timelineEnabled,"Timeline view"),this.codeHotspotsEnabled=b(e(u.codeHotspotsEnabled,E,w,oe)),ae("CODEHOTSPOTS_ENABLED"),ue(this.codeHotspotsEnabled,"Code hotspots"),this.cpuProfilingEnabled=b(e(u.cpuProfilingEnabled,x,!1)),ue(this.cpuProfilingEnabled,"CPU profiling"),this.profilers=function(e,t){"string"==typeof e&&(e=e.split(","));for(let r=0;r<e.length;r++){const s=e[r];"string"==typeof s&&(e[r]=S(s,t))}t.timelineEnabled&&e.push(new p(t));return e.filter((e=>e))}(be,this)}}},config}function requireProfiler$1(){if(hasRequiredProfiler$1)return profiler;hasRequiredProfiler$1=1;const{EventEmitter:e}=require$$0$f,{Config:t}=requireConfig(),{snapshotKinds:r}=requireConstants$1(),{threadNamePrefix:s}=requireShared();class n extends e{constructor(){super(),this._enabled=!1,this._logger=void 0,this._config=void 0,this._timer=void 0,this._lastStart=void 0,this._timeoutInterval=void 0}start(e){return this._start(e).catch((t=>(e.logger&&e.logger.error(t),!1)))}async _start(e){if(this._enabled)return!0;const r=this._config=new t(e);if(!r.enabled)return!1;let n;this._logger=r.logger,this._enabled=!0,this._setInterval();try{const{setLogger:e,SourceMapper:t}=requireSrc$1();e(r.logger),n=await function(e,t,r){if(e)return t.create([process.cwd()],r)}(r.sourceMap,t,r.debugSourceMaps),r.SourceMap&&r.debugSourceMaps&&this._logger.debug((()=>0===n.infoMap.size?"Found no source maps":`Found source maps for following files: [${Array.from(n.infoMap.keys()).join(", ")}]`))}catch(e){this._logger.error(e)}try{const e=new Date;for(const e of r.profilers)e.start({mapper:n,nearOOMCallback:this._nearOOMExport.bind(this)}),this._logger.debug(`Started ${e.type} profiler in ${s} thread`);return this._capture(this._timeoutInterval,e),!0}catch(e){return this._logger.error(e),this._stop(),!1}}_nearOOMExport(e,t){const s=this._lastStart,n=new Date;this._submit({[e]:t},s,n,r.ON_OUT_OF_MEMORY)}_setInterval(){this._timeoutInterval=this._config.flushInterval}async stop(){this._enabled&&(this._collect(r.ON_SHUTDOWN,!1),this._stop())}_stop(){if(this._enabled){this._enabled=!1;for(const e of this._config.profilers)e.stop(),this._logger.debug(`Stopped ${e.type} profiler in ${s} thread`);clearTimeout(this._timer),this._timer=void 0}}_capture(e,t){this._enabled&&(this._lastStart=t,this._timer&&e===this._timeoutInterval?this._timer.refresh():(this._timer=setTimeout((()=>this._collect(r.PERIODIC)),e),this._timer.unref()))}async _collect(e,t=!0){if(!this._enabled)return;const r=this._lastStart,n=new Date,i=[],a={};try{for(const e of this._config.profilers){const a=e.profile(t,r,n);t||this._logger.debug(`Stopped ${e.type} profiler in ${s} thread`),a&&i.push({profiler:e,profile:a})}for(const{profiler:e,profile:t}of i)a[e.type]=await e.encode(t),this._logger.debug((()=>{const r=JSON.stringify(t,((e,t)=>"bigint"==typeof t?t.toString():t));return`Collected ${e.type} profile: `+r}));t&&this._capture(this._timeoutInterval,n),await this._submit(a,r,n,e),this._logger.debug("Submitted profiles")}catch(e){this._logger.error(e),this._stop()}}_submit(e,t,r,s){if(!Object.keys(e).length)return Promise.reject(new Error("No profiles to submit"));const{tags:n}=this._config,i=[];n.snapshot=s;for(const s of this._config.exporters){const a=s.export({profiles:e,start:t,end:r,tags:n}).catch((e=>this._logger.error(e)));i.push(a)}return Promise.all(i)}}return profiler={Profiler:n,ServerlessProfiler:class extends n{constructor(){super(),this._profiledIntervals=0,this._interval=1,this._flushAfterIntervals=void 0}_setInterval(){this._timeoutInterval=1e3*this._interval,this._flushAfterIntervals=this._config.flushInterval/1e3}async _collect(e,t=!0){this._profiledIntervals>=this._flushAfterIntervals||!t?(this._profiledIntervals=0,await super._collect(e,t)):(this._profiledIntervals+=1,this._capture(this._timeoutInterval,new Date))}}}}function requireProfiling(){if(hasRequiredProfiling)return profiling;hasRequiredProfiling=1;const{Profiler:e,ServerlessProfiler:t}=requireProfiler$1(),r=requireWall(),s=requireSpace(),{AgentExporter:n}=requireAgent(),{FileExporter:i}=requireFile(),{ConsoleLogger:a}=requireConsole(),o=process.env.AWS_LAMBDA_FUNCTION_NAME?new t:new e;return profiling={profiler:o,AgentExporter:n,FileExporter:i,WallProfiler:r,SpaceProfiler:s,ConsoleLogger:a}}function requireProfiler(){if(hasRequiredProfiler)return profiler_1;hasRequiredProfiler=1;const e=requireLog$2(),{profiler:t}=requireProfiling();return process.once("beforeExit",(()=>{t.stop()})),profiler_1={start:r=>{const{service:s,version:n,env:i,url:a,hostname:o,port:c,tags:u,repositoryUrl:l,commitSHA:p}=r,{enabled:d,sourceMap:h,exporters:f}=r.profiling,g={debug:t=>e.debug(t),info:t=>e.info(t),warn:t=>e.warn(t),error:t=>e.error(t)};return t.start({enabled:d,service:s,version:n,env:i,logger:g,sourceMap:h,exporters:f,url:a,hostname:o,port:c,tags:u,repositoryUrl:l,commitSHA:p})},stop:()=>{t.stop()}},profiler_1}function requireTestApiManualPlugin(){if(hasRequiredTestApiManualPlugin)return testApiManualPlugin;hasRequiredTestApiManualPlugin=1;const e=requireCi_plugin(),{TEST_STATUS:t,finishAllTraceSpans:r,getTestSuitePath:s}=requireTest(),{storage:n}=requireDatadogCore();return testApiManualPlugin=class extends e{static get id(){return"test-api-manual"}constructor(...e){super(...e),this.sourceRoot=process.cwd(),this.addSub("dd-trace:ci:manual:test:start",(({testName:e,testSuite:t})=>{const r=n.getStore(),i=s(t,this.sourceRoot),a=this.startTestSpan(e,i);this.enter(a,r)})),this.addSub("dd-trace:ci:manual:test:finish",(({status:e,error:s})=>{const i=n.getStore(),a=i&&i.span;a&&(a.setTag(t,e),s&&a.setTag("error",s),a.finish(),r(a))})),this.addSub("dd-trace:ci:manual:test:addTags",(e=>{const t=n.getStore(),r=t&&t.span;r&&r.addTags(e)}))}},testApiManualPlugin}function requireIastLog(){if(hasRequiredIastLog)return iastLog_1;hasRequiredIastLog=1;const e=requireDcPolyfill(),t=requireLog$2(),{calculateDDBasePath:r}=requireUtil$9(),s=e.channel("datadog:telemetry:log"),n=r(__dirname),i="\n",a=/^\s*at\s/gm;function o(e,r){try{let t;e="function"==typeof e?e():e,t=String("object"==typeof e&&e&&e.message||e);let s={message:t,level:r};if(e.stack&&(s=function(e,t){if(!t)return e;let r=t.split(i);const s=r.findIndex((e=>e.match(a))),o=s>-1&&r[s].includes(n);return r=r.filter(((e,t)=>o&&t<s||e.includes(n))).map((e=>e.replace(n,""))),e.stack_trace=r.join(i),o||(e.message="omitted"),e}(s,e.stack),""===s.stack_trace))return;return s}catch(e){t.error(e)}}return iastLog_1={debug(e){return t.debug(e),this},info(e){return t.info(e),this},warn(e){return t.warn(e),this},error(e){return t.error(e),this},publish(e,t){return s.hasSubscribers&&s.publish(o(e,t)),this},debugAndPublish(e){return this.debug(e),this.publish(e,"DEBUG")},infoAndPublish(e){return this.info(e),this.publish(e,"DEBUG")},warnAndPublish(e){return this.warn(e),this.publish(e,"WARN")},errorAndPublish(e){return this.error(e),this.publish(e,"ERROR")}}}function requireVulnerabilities(){return hasRequiredVulnerabilities?vulnerabilities:(hasRequiredVulnerabilities=1,vulnerabilities={COMMAND_INJECTION:"COMMAND_INJECTION",HARDCODED_SECRET:"HARDCODED_SECRET",HEADER_INJECTION:"HEADER_INJECTION",HSTS_HEADER_MISSING:"HSTS_HEADER_MISSING",INSECURE_COOKIE:"INSECURE_COOKIE",LDAP_INJECTION:"LDAP_INJECTION",NO_HTTPONLY_COOKIE:"NO_HTTPONLY_COOKIE",NO_SAMESITE_COOKIE:"NO_SAMESITE_COOKIE",NOSQL_MONGODB_INJECTION:"NOSQL_MONGODB_INJECTION",PATH_TRAVERSAL:"PATH_TRAVERSAL",SQL_INJECTION:"SQL_INJECTION",SSRF:"SSRF",UNVALIDATED_REDIRECT:"UNVALIDATED_REDIRECT",WEAK_CIPHER:"WEAK_CIPHER",WEAK_HASH:"WEAK_HASH",WEAK_RANDOMNESS:"WEAK_RANDOMNESS",XCONTENTTYPE_HEADER_MISSING:"XCONTENTTYPE_HEADER_MISSING"})}function requireRangeUtils(){if(hasRequiredRangeUtils)return rangeUtils;function e(e,t){return!(e.start>t.start)&&e.end>=t.end}function t(e,t){return t.start<e.end&&t.end>e.start}return hasRequiredRangeUtils=1,rangeUtils={contains:e,intersects:t,remove:function(r,s){if(t(r,s)){if(e(s,r))return[];{const e=[];if(s.start>r.start){const t=s.start-r.start;e.push({start:r.start,end:r.start+t})}if(s.end<r.end){const t=r.end-s.end;e.push({start:s.end,end:s.end+t})}return e}}return[r]}},rangeUtils}function requireCommandSensitiveAnalyzer(){if(hasRequiredCommandSensitiveAnalyzer)return commandSensitiveAnalyzer;hasRequiredCommandSensitiveAnalyzer=1;const e=requireIastLog(),t=new RegExp("^(?:\\s*(?:sudo|doas)\\s+)?\\b\\S+\\b\\s(.*)","gmi");return commandSensitiveAnalyzer=function(r){try{t.lastIndex=0;const e=t.exec(r.value);if(e&&e.length>1){const t=e.index+(e[0].length-e[1].length);return[{start:t,end:t+e[1].length}]}}catch(t){e.debug(t)}return[]}}function requireConstants(){if(hasRequiredConstants)return constants;hasRequiredConstants=1;return constants={HEADER_NAME_VALUE_SEPARATOR:": "}}function requireHeaderSensitiveAnalyzer(){if(hasRequiredHeaderSensitiveAnalyzer)return headerSensitiveAnalyzer;hasRequiredHeaderSensitiveAnalyzer=1;const{HEADER_NAME_VALUE_SEPARATOR:e}=requireConstants();return headerSensitiveAnalyzer=function(t,r,s){const n=t.value,i=n.split(e),a=i[0],o=i.slice(1).join(e);return r.lastIndex=0,s.lastIndex=0,r.test(a)||s.test(o)?[{start:a.length+e.length,end:n.length}]:[]}}function requireSensitiveRegex(){if(hasRequiredSensitiveRegex)return sensitiveRegex;hasRequiredSensitiveRegex=1;return sensitiveRegex={DEFAULT_IAST_REDACTION_NAME_PATTERN:"(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?|access_?|secret_?)key(?:_?id)?|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)?|auth(?:entication|orization)?)",DEFAULT_IAST_REDACTION_VALUE_PATTERN:"(?:bearer\\s+[a-z0-9\\._\\-]+|glpat-[\\w\\-]{20}|gh[opsu]_[0-9a-zA-Z]{36}|ey[I-L][\\w=\\-]+\\.ey[I-L][\\w=\\-]+(?:\\.[\\w.+/=\\-]+)?|(?:[\\-]{5}BEGIN[a-z\\s]+PRIVATE\\sKEY[\\-]{5}[^\\-]+[\\-]{5}END[a-z\\s]+PRIVATE\\sKEY[\\-]{5}|ssh-rsa\\s*[a-z0-9/\\.+]{100,}))"}}function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const e=require$$0$2,{DEFAULT_IAST_REDACTION_VALUE_PATTERN:t}=requireSensitiveRegex(),r="DD_"+e.randomBytes(20).toString("hex"),s=r+"SENSITIVE",n=s+"NOTSTRING",i=new RegExp(`(?:"(${r}_\\d+_))|(?:"(${s}_\\d+_(\\d+)_))|("${n}_\\d+_([\\s0-9.a-zA-Z]*)")`,"gm"),a=new RegExp(`"(${r}_\\d+_)`,"gm"),o=new RegExp(t,"gmi");function c(e,t,r=[],s=50){Object.keys(e).forEach((n=>{const i=[...r,n],a=e[n];t(a,i,e,n),null!==a&&"object"==typeof a&&s>0&&c(a,t,i,s-1)}))}return utils={stringifyWithRanges:function(e,t,u=!1){let l;const p=[],d=[];if((t=t||{})||u){const h=Array.isArray(e)?[]:{};let f=0;const g={},m={};if(c(e,((e,i,a,c)=>{let l=h;for(let e=0;e<i.length-1;e++){let t=i[e];if(!l[t]){const e=m[t];l[e]&&(t=e)}l=l[t]}if(u){const e=m[c];if(e)c=e;else if(o.lastIndex=0,o.test(c)){const e=f++;c=`${`${s}_${e}_${c.length}_`}${c}`}}if("string"==typeof e){const n=t[i.join(".")];if(n){const t=f++,s=`${r}_${t}_`;g[s]=n,l[c]=`${s}${e}`}else l[c]=e;if(u){const t=f++,r=`${s}_${t}_${e.length}_`;l[c]=`${r}${l[c]}`}}else if("object"!=typeof e||null===e)if(u){const t=f++,r=`${n}_${t}_`;l[c]=r+e}else l[c]=e;else Array.isArray(e)?l[c]=[]:l[c]={}})),l=JSON.stringify(h,null,2),f>0){let e;e=u?i:a,e.lastIndex=0;let t=e.exec(l);for(;t;){const r=t.index+1;if(t[1]){const e=t[1];l=l.replace(e,"");const s=g[e].map((e=>({...e,start:e.start+r,end:e.end+r})));p.push(...s)}else if(t[2]){const e=t[2];d.push({start:r,end:r+parseInt(t[3])}),l=l.replace(e,"")}else if(t[4]){const e=t[4],r=t[5];d.push({start:t.index,end:t.index+r.length}),l=l.replace(e,r)}e.lastIndex=0,t=e.exec(l)}}}else l=JSON.stringify(e,null,2);return{value:l,ranges:p,sensitiveRanges:d}}},utils}function requireJsonSensitiveAnalyzer(){if(hasRequiredJsonSensitiveAnalyzer)return jsonSensitiveAnalyzer;hasRequiredJsonSensitiveAnalyzer=1;const{stringifyWithRanges:e}=requireUtils();return jsonSensitiveAnalyzer=function(t){const{value:r,ranges:s,sensitiveRanges:n}=e(t.value,t.rangesToApply,!0);return t.value=r,t.ranges=s,n}}function requireLdapSensitiveAnalyzer(){if(hasRequiredLdapSensitiveAnalyzer)return ldapSensitiveAnalyzer;hasRequiredLdapSensitiveAnalyzer=1;const e=requireIastLog(),t=new RegExp("\\(.*?(?:~=|=|<=|>=)(?<LITERAL>[^)]+)\\)","gmi");return ldapSensitiveAnalyzer=function(r){try{t.lastIndex=0;const e=[];let s=t.exec(r.value);for(;null!=s;){if(!s.groups.LITERAL)continue;const n=s.index+(s[0].length-s.groups.LITERAL.length-1),i=n+s.groups.LITERAL.length;e.push({start:n,end:i}),s=t.exec(r.value)}return e}catch(t){e.debug(t)}return[]}}function requireSqlSensitiveAnalyzer(){if(hasRequiredSqlSensitiveAnalyzer)return sqlSensitiveAnalyzer;hasRequiredSqlSensitiveAnalyzer=1;const e=requireIastLog(),t="'(?:''|[^'])*'",r="--.*$",s="/\\*[\\s\\S]*\\*/",n="(?:E[-+]?\\d+[fd]?)?",i=`[-+]?(?:${["x'[0-9a-f]+'|0x[0-9a-f]+","b'[0-9a-f]+'|0b[0-9a-f]+","\\d*\\.\\d+"+n,"(?<!\\w)\\d+"+n].join("|")})`,a={ANSI:new RegExp([i,t,r,s].join("|"),"gmi"),MYSQL:new RegExp([i,"\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'",r,s].join("|"),"gmi"),POSTGRES:new RegExp([i,"\\$([^$]*)\\$.*?\\$\\1\\$",t,r,s].join("|"),"gmi"),ORACLE:new RegExp([i,"q'<.*?>'|q'\\(.*?\\)'|q'\\{.*?\\}'|q'\\[.*?\\]'|q'(?<ESCAPE>.).*?\\k<ESCAPE>'",t,r,s].join("|"),"gmi")};return a.SQLITE=a.MYSQL,a.MARIADB=a.MYSQL,sqlSensitiveAnalyzer=function(t){try{let e=a[t.dialect];e||(e=a.ANSI),e.lastIndex=0;const r=[];let s=e.exec(t.value);for(;null!=s;){let n=s.index,i=s.index+s[0].length;const a=t.value.charAt(n);if("'"===a||'"'===a)n++,i--;else if(i>n+1){const e=t.value.charAt(n+1);if("/"===a&&"*"===e)n+=2,i-=2;else if("-"===a&&a===e)n+=2;else if("q"===a.toLowerCase()&&"'"===e)n+=3,i-=2;else if("$"===a){const e=s[0].indexOf("$",1)+1;e>1&&(n+=e,i-=e)}}r.push({start:n,end:i}),s=e.exec(t.value)}return r}catch(t){e.debug(t)}return[]}}function requireUrlSensitiveAnalyzer(){if(hasRequiredUrlSensitiveAnalyzer)return urlSensitiveAnalyzer;hasRequiredUrlSensitiveAnalyzer=1;const e=requireIastLog(),t=new RegExp(["^(?:[^:]+:)?//([^@]+)@","[?#&]([^=&;]+)=([^?#&]+)"].join("|"),"gmi");return urlSensitiveAnalyzer=function(r){try{const e=[];let s=t.exec(r.value);for(;null!=s;){if("string"==typeof s[1]){const t=s.index+(s[0].length-1),r=t-s[1].length;e.push({start:r,end:t})}if("string"==typeof s[3]){const t=s.index+s[0].length,r=t-s[3].length;e.push({start:r,end:t})}s=t.exec(r.value)}return e}catch(t){e.debug(t)}return[]}}function requireSensitiveHandler(){if(hasRequiredSensitiveHandler)return sensitiveHandler;hasRequiredSensitiveHandler=1;const e=requireIastLog(),t=requireVulnerabilities(),{contains:r,intersects:s,remove:n}=requireRangeUtils(),i=requireCommandSensitiveAnalyzer(),a=requireHeaderSensitiveAnalyzer(),o=requireJsonSensitiveAnalyzer(),c=requireLdapSensitiveAnalyzer(),u=requireSqlSensitiveAnalyzer(),l=requireUrlSensitiveAnalyzer(),{DEFAULT_IAST_REDACTION_NAME_PATTERN:p,DEFAULT_IAST_REDACTION_VALUE_PATTERN:d}=requireSensitiveRegex(),h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return sensitiveHandler=new class{constructor(){this._namePattern=new RegExp(p,"gmi"),this._valuePattern=new RegExp(d,"gmi"),this._sensitiveAnalyzers=new Map,this._sensitiveAnalyzers.set(t.COMMAND_INJECTION,i),this._sensitiveAnalyzers.set(t.NOSQL_MONGODB_INJECTION,o),this._sensitiveAnalyzers.set(t.LDAP_INJECTION,c),this._sensitiveAnalyzers.set(t.SQL_INJECTION,u),this._sensitiveAnalyzers.set(t.SSRF,l),this._sensitiveAnalyzers.set(t.UNVALIDATED_REDIRECT,l),this._sensitiveAnalyzers.set(t.HEADER_INJECTION,(e=>a(e,this._namePattern,this._valuePattern)))}isSensibleName(e){return this._namePattern.lastIndex=0,this._namePattern.test(e)}isSensibleValue(e){return this._valuePattern.lastIndex=0,this._valuePattern.test(e)}isSensibleSource(e){return null!=e&&(this.isSensibleName(e.name)||this.isSensibleValue(e.value))}scrubEvidence(e,t,r,s){const n=this._sensitiveAnalyzers.get(e);if(n){const e=n(t);return this.toRedactedJson(t,e,r,s)}return null}toRedactedJson(e,t,i,a){const o=[],c=[],u=[],{value:l,ranges:p}=e;let d,f=0,g=0,m=p.shift(),_=t.shift();for(let e=0;e<l.length;e++)if(null!=m&&m.start===e){for(this.writeValuePart(o,l.substring(f,e),d),d=i[g];null!=_&&r(m,_);){const e=_.start-m.start,r=_.end-m.start;e===r?this.writeRedactedValuePart(o,0):this.redactSource(a,c,u,d,e,r),_=t.shift()}if(null!=_&&s(_,m)){const e=_.start-m.start,t=_.end-m.start;this.redactSource(a,c,u,d,e,t);const r=n(_,m);_=r.length>0?r[0]:null}if(this.isSensibleSource(a[d])&&(a[d].redacted||(c.push(d),a[d].pattern="".padEnd(a[d].value.length,h),a[d].redacted=!0)),c.indexOf(d)>-1){const t=l.substring(e,e+(m.end-m.start));this.writeRedactedValuePart(o,t.length,d,t,a[d],u[d],this.isSensibleSource(a[d])),u[d]=[]}else{const e=Math.min(m.end,l.length);this.writeValuePart(o,l.substring(m.start,e),d)}f=e+(m.end-m.start),e=f-1,m=p.shift(),g++,d=null}else if(null!=_&&_.start===e){if(this.writeValuePart(o,l.substring(f,e),d),null!=m&&s(_,m)){d=i[g];const r=_.start-m.start,s=_.end-m.start;this.redactSource(a,c,u,d,r,s);for(const r of n(_,m))r.start===e?_=r:t.unshift(r)}const r=_.end-_.start;this.writeRedactedValuePart(o,r),f=e+r,e=f-1,_=t.shift()}return f<l.length&&this.writeValuePart(o,l.substring(f)),{redactedValueParts:o,redactedSources:c}}redactSource(e,t,r,s,n,i){null!=s&&(e[s].redacted||(t.push(s),e[s].pattern="".padEnd(e[s].value.length,h),e[s].redacted=!0),r[s]||(r[s]=[]),r[s].push({start:n,end:i}))}writeValuePart(e,t,r){t.length>0&&(null!=r?e.push({value:t,source:r}):e.push({value:t}))}writeRedactedValuePart(e,t,r,s,n,i,a){if(null!=r){const o=n.value.includes(s)?n.pattern:"*".repeat(t);if(a)e.push({redacted:!0,source:r,pattern:o});else{let t=s;const a=[];i.forEach((e=>{a.some((t=>t.start===e.start&&t.end===e.end))||a.push(e)}));let c=0;a.forEach((s=>{s.start>0&&(e.push({source:r,value:t.substring(0,s.start-c)}),t=t.substring(s.start-c),c=s.start);const i=t.substring(s.start-c,s.end-c),a=n.value.indexOf(i),u=a>-1?o.substring(a,a+i.length):o.substring(s.start,s.end);e.push({redacted:!0,source:r,pattern:u}),t=t.substring(u.length),c+=u.length})),t.length&&e.push({source:r,value:t})}}else e.push({redacted:!0})}setRedactionPatterns(t,r){if(t)try{this._namePattern=new RegExp(t,"gmi")}catch(t){e.warn("Redaction name pattern is not valid")}if(r)try{this._valuePattern=new RegExp(r,"gmi")}catch(t){e.warn("Redaction value pattern is not valid")}}},sensitiveHandler}function requireVulnerabilitiesFormatter(){if(hasRequiredVulnerabilitiesFormatter)return vulnerabilitiesFormatter;hasRequiredVulnerabilitiesFormatter=1;const e=requireSensitiveHandler(),{stringifyWithRanges:t}=requireUtils();return vulnerabilitiesFormatter=new class{constructor(){this._redactVulnearbilities=!0}setRedactVulnerabilities(t,r,s){this._redactVulnearbilities=t,e.setRedactionPatterns(r,s)}extractSourcesFromVulnerability(e){return e.evidence.ranges?e.evidence.ranges.map((e=>({origin:e.iinfo.type,name:e.iinfo.parameterName,value:e.iinfo.parameterValue}))):[]}getRedactedValueParts(t,r,s,n){const i=e.scrubEvidence(t,r,s,n);if(i){const{redactedValueParts:e,redactedSources:t}=i;return t.forEach((e=>{delete n[e].value})),{valueParts:e}}return this.getUnredactedValueParts(r,s)}getUnredactedValueParts(e,r){const s=[];let n=0;if("object"==typeof e.value&&e.rangesToApply){const{value:r,ranges:s}=t(e.value,e.rangesToApply);e.value=r,e.ranges=s}return e.ranges.forEach(((t,i)=>{n<t.start&&s.push({value:e.value.substring(n,t.start)}),s.push({value:e.value.substring(t.start,t.end),source:r[i]}),n=t.end})),n<e.value.length&&s.push({value:e.value.substring(n)}),{valueParts:s}}formatEvidence(e,t,r,s){return t.ranges||t.rangesToApply?this._redactVulnearbilities?this.getRedactedValueParts(e,t,r,s):this.getUnredactedValueParts(t,r):void 0===t.value?void 0:{value:t.value}}formatVulnerability(e,t,r){const s={type:e.type,hash:e.hash,evidence:this.formatEvidence(e.type,e.evidence,t,r),location:{spanId:e.location.spanId}};return e.location.path&&(s.location.path=e.location.path),e.location.line&&(s.location.line=e.location.line),s}toJson(e){const t=[],r=e.map((e=>{const r=this.extractSourcesFromVulnerability(e),s=[];return r.forEach((e=>{let r=t.findIndex((t=>t.origin===e.origin&&t.name===e.name&&t.value===e.value));-1===r&&(r=t.length,t.push(e)),s.push(r)})),this.formatVulnerability(e,s,t)}));return{sources:t,vulnerabilities:r}}},vulnerabilitiesFormatter}function requireTags(){return hasRequiredTags?tags:(hasRequiredTags=1,tags={IAST_ENABLED_TAG_KEY:"_dd.iast.enabled",IAST_JSON_TAG_KEY:"_dd.iast.json",IAST_TRACE_METRIC_PREFIX:"_dd.iast.telemetry"})}function requireVulnerabilityReporter(){if(hasRequiredVulnerabilityReporter)return vulnerabilityReporter;hasRequiredVulnerabilityReporter=1;const{MANUAL_KEEP:e}=requireTags$2(),t=requireLruCache$1(),r=requireVulnerabilitiesFormatter(),{IAST_ENABLED_TAG_KEY:s,IAST_JSON_TAG_KEY:n}=requireTags(),i="vulnerabilities",a=new t({max:1e3}),o=36e5;let c,u,l=!0;function p(e){return e&&e.type&&e.evidence&&e.location&&e.location.spanId}function d(t,i){if(t&&t.length){let o=i;if(!o&&c&&(o=c.startSpan("vulnerability",{type:"vulnerability"}),t.forEach((e=>{e.location.spanId=o.context().toSpanId()})),o.addTags({[s]:1})),o&&o.addTags){const s=function(e){if(!l)return e;const t=e.filter((e=>{const t=`${e.type}${e.hash}`;return!a.get(t)&&(a.set(t,!0),!0)}));return t}(t).filter(p),c=r.toJson(s);if(c.vulnerabilities.length>0){const t={};t[n]=JSON.stringify(c),t[e]="true",o.addTags(t),i||o.finish()}}}return n}function h(){a.clear()}return vulnerabilityReporter={addVulnerability:function(e,t){t&&t.evidence&&t.type&&t.location&&(e&&e.rootSpan?(e[i]=e[i]||[],e[i].push(t)):d([t]))},sendVulnerabilities:d,clearCache:h,start:function(e,t){l=e.iast.deduplicationEnabled,r.setRedactVulnerabilities(e.iast.redactionEnabled,e.iast.redactionNamePattern,e.iast.redactionValuePattern),l&&(u=setInterval(h,o),u.unref()),c=t},stop:function(){u&&(clearInterval(u),u=null)}},vulnerabilityReporter}function requirePathLine(){if(hasRequiredPathLine)return pathLine_1;hasRequiredPathLine=1;const e=require$$0$1,t=require$$1$5,{calculateDDBasePath:r}=requireUtil$9(),s={getFirstNonDDPathAndLine:function(e){return a(function(){const e=Error.prepareStackTrace,t=Error.stackTraceLimit;let r;Error.stackTraceLimit=100,Error.prepareStackTrace=function(e,t){r=t};return(new Error).stack,Error.prepareStackTrace=e,Error.stackTraceLimit=t,r}(),e)},getNodeModulesPaths:function(...t){const r=[];return t.forEach((t=>{const s=t.split("/");r.push(e.join("node_modules",...s))})),r},getRelativePath:o,getFirstNonDDPathAndLineFromCallsites:a,calculateDDBasePath:r,ddBasePath:r(__dirname)},n=[e.join(e.sep,"node_modules","dc-polyfill")],i=["node:diagnostics_channel","diagnostics_channel","node:child_process","child_process","node:async_hooks","async_hooks"];function a(t,r){if(t)for(let n=0;n<t.length;n++){const i=t[n],a=i.getFileName();if(!c(i,r)&&-1===a.indexOf(s.ddBasePath))return{path:o(a),line:i.getLineNumber(),column:i.getColumnNumber(),isInternal:!e.isAbsolute(a)}}return null}function o(r){return e.relative(t.cwd(),r)}function c(e,t){if(e.isNative())return!0;const r=e.getFileName();if(!r)return!0;let s=n;t&&(s=[...s,...t]);for(let e=0;e<s.length;e++)if(r.indexOf(s[e])>-1)return!0;for(let e=0;e<i.length;e++)if(0===r.indexOf(i[e]))return!0;return!1}return pathLine_1=s}function requireIastContext(){if(hasRequiredIastContext)return iastContext;hasRequiredIastContext=1;const e=Symbol("_dd.iast.context"),t=Symbol("_dd.iast.transactionId");return iastContext={getIastContext:function(t,r){let s=t&&t[e];return s||(s=r&&r[e]),s},saveIastContext:function(t,r,s){if(t&&r)return t[e]=s,r[e]=s,t[e]},cleanIastContext:function(t,r,s){return t&&(s||(s=t[e]),t[e]=null),r&&(s||(s=r[e]),r[e]=null),!!s&&(Object.keys(s).forEach((e=>delete s[e])),!0)},IAST_CONTEXT_KEY:e,IAST_TRANSACTION_ID:t},iastContext}function requireOverheadController(){if(hasRequiredOverheadController)return overheadController;hasRequiredOverheadController=1;const e="oce",t="REPORT_VULNERABILITY",r={};let s,n={},i=0;const a={REPORT_VULNERABILITY:{hasQuota:e=>{const r=e&&e.tokens&&e.tokens[t]>0;return r&&e.tokens[t]--,r},name:t,initialTokenBucketSize:()=>"number"==typeof n.maxContextOperations?n.maxContextOperations:2,initContext:function(e){e.tokens[t]=this.initialTokenBucketSize()}}};function o(){const e={tokens:{}};for(const t in a)a[t].initContext(e);return e}function c(){Object.assign(r,o())}return overheadController={OVERHEAD_CONTROLLER_CONTEXT_KEY:e,OPERATIONS:a,startGlobalContext:function(){s||(c(),s=setInterval((()=>{c()}),6e4),s.unref&&s.unref())},finishGlobalContext:function(){s&&(clearInterval(s),s=null)},_resetGlobalContext:c,initializeRequestContext:function(t){t&&(t[e]=o())},hasQuota:function(t,s){const n=function(t){return t&&t[e]?t[e]:r}(s);return t.hasQuota(n)},acquireRequest:function(e){if(i>0&&e){const t=n&&"number"==typeof n.requestSampling?n.requestSampling:30;if(e.context().toSpanId().slice(-2)<=t)return i--,!0}return!1},releaseRequest:function(){i<n.maxConcurrentRequests&&i++},configure:function(e){n=e,i=n.maxConcurrentRequests}},overheadController}function requireVerbosity(){if(hasRequiredVerbosity)return verbosity;hasRequiredVerbosity=1;const e={OFF:0,MANDATORY:1,INFORMATION:2,DEBUG:3};return verbosity={Verbosity:e,isDebugAllowed:function(t){return t>=e.DEBUG},isInfoAllowed:function(t){return t>=e.INFORMATION},getVerbosity:function(t){return t?(t=t.toUpperCase(),void 0!==e[t]?e[t]:e.INFORMATION):e.INFORMATION},getName:function(t){for(const r in e)if(e[r]===t)return r;return"OFF"}},verbosity}function requireSpanTags(){if(hasRequiredSpanTags)return spanTags;function e(e){return e.filter((e=>!e.startsWith("lib_language")&&!e.startsWith("version")))}return hasRequiredSpanTags=1,spanTags={addMetricsToSpan:function(t,r,s){if(!t||!t.addTags||!r)return;const n=new Map;r.filter((e=>e&&e.metric)).forEach((t=>{const r=function(t){const r=t.metric,s=t.tags&&e(t.tags);return s&&s.length?`${r}.${function(e){return e.map((e=>e.includes(":")?e.split(":")[1]:e)).join("_").replace(/\./g,"_")}(s)}`:r}(t);let s=n.get(r);const i=(a=t).points&&a.points.map((e=>e[1])).reduce(((e,t)=>e+t),0);var a;s?s+=i:s=i,n.set(r,s)}));for(const[e,r]of n){const n=`${s}.${e}`;t.addTags({[n]:r})}},filterTags:e},spanTags}function requireNamespaces(){if(hasRequiredNamespaces)return namespaces;hasRequiredNamespaces=1;const e=requireLog$2(),{Namespace:t}=requireMetrics(),{addMetricsToSpan:r,filterTags:s}=requireSpanTags(),{IAST_TRACE_METRIC_PREFIX:n}=requireTags(),i=Symbol("_dd.iast.request.metrics.namespace");function a(e){return e&&e[i]}const o=new class extends t{constructor(){super("iast")}reset(){this.metrics.clear(),this.distributions.clear()}};return namespaces={initRequestNamespace:function(e){if(!e)return;const r=new t("iast");return e[i]=r,r},getNamespaceFromContext:a,finalizeRequestNamespace:function(t,c){try{const e=a(t);if(!e)return;const i=[...e.metrics.values()];e.metrics.clear(),r(c,i,n),function(e){e.forEach((e=>e.points.forEach((t=>{o.count(e.metric,function(e){if(e&&e.length>0)return s(e)}(e.tags)).inc(t[1])}))))}(i)}catch(t){e.error(t)}finally{t&&delete t[i]}},globalNamespace:o,DD_IAST_METRICS_NAMESPACE:i},namespaces}function requireTelemetry(){if(hasRequiredTelemetry)return telemetry;hasRequiredTelemetry=1;const e=requireMetrics(),{Verbosity:t,getVerbosity:r}=requireVerbosity(),{initRequestNamespace:s,finalizeRequestNamespace:n,globalNamespace:i}=requireNamespaces();return telemetry=new class{configure(s,n){const a=s?.telemetry?.enabled&&s.telemetry.metrics;this.verbosity=a?r(n):t.OFF,this.enabled=this.verbosity!==t.OFF,this.enabled&&e.manager.set("iast",i)}stop(){this.enabled=!1,e.manager.delete("iast")}isEnabled(){return this.enabled}onRequestStart(e){this.isEnabled()&&s(e)}onRequestEnd(e,t){this.isEnabled()&&n(e,t)}},telemetry}function requireIastMetric(){if(hasRequiredIastMetric)return iastMetric;hasRequiredIastMetric=1;const{getNamespaceFromContext:e,globalNamespace:t}=requireNamespaces(),r="GLOBAL",s="REQUEST",n={VULNERABILITY_TYPE:"vulnerability_type",SOURCE_TYPE:"source_type",PROPAGATION_TYPE:"propagation_type"};class i{constructor(e,t,r){this.name=e,this.scope=t,this.tagKey=r}getNamespace(r){return e(r)||t}getTag(e){return e?{[this.tagKey]:e}:void 0}addValue(e,t,r){this.getNamespace(r).count(this.name,this.getTag(t)).inc(e)}add(e,t,r){Array.isArray(t)?t.forEach((t=>this.addValue(e,t,r))):this.addValue(e,t,r)}inc(e,t){this.add(1,e,t)}}const a=new i("instrumented.propagation",r),o=new i("instrumented.source",r,n.SOURCE_TYPE),c=new i("instrumented.sink",r,n.VULNERABILITY_TYPE),u=new i("executed.source",s,n.SOURCE_TYPE),l=new i("executed.sink",s,n.VULNERABILITY_TYPE),p=new i("request.tainted",s),d=new i("executed.propagation",s),h=new i("executed.tainted",s),f=new i("instrumentation.time",r);return iastMetric={INSTRUMENTED_PROPAGATION:a,INSTRUMENTED_SOURCE:o,INSTRUMENTED_SINK:c,EXECUTED_PROPAGATION:d,EXECUTED_SOURCE:u,EXECUTED_SINK:l,EXECUTED_TAINTED:h,REQUEST_TAINTED:p,INSTRUMENTATION_TIME:f,PropagationType:{STRING:"STRING",JSON:"JSON",URL:"URL"},TagKey:n,IastMetric:i,getExecutedMetric:function(e){return e===n.VULNERABILITY_TYPE?l:u},getInstrumentedMetric:function(e){return e===n.VULNERABILITY_TYPE?c:o}}}function requireIastPlugin(){if(hasRequiredIastPlugin)return iastPlugin;hasRequiredIastPlugin=1;const{channel:e}=requireDcPolyfill(),t=requireIastLog(),r=requirePlugin$1(),s=requireTelemetry(),{getInstrumentedMetric:n,getExecutedMetric:i,TagKey:a,EXECUTED_SOURCE:o}=requireIastMetric(),{storage:c}=requireDatadogCore(),{getIastContext:u}=requireIastContext(),l=requireInstrumentations();class p{constructor(e,t,r,s=a.VULNERABILITY_TYPE){this.moduleName=e,this.channelName=t,this.tag=r,this.tagKey=s,this.executedMetric=i(this.tagKey),this.instrumentedMetric=n(this.tagKey),this.moduleInstrumented=!1}increaseInstrumented(){this.moduleInstrumented||(this.moduleInstrumented=!0,this.instrumentedMetric.inc(this.tag))}increaseExecuted(e){this.executedMetric.inc(this.tag,e)}matchesModuleInstrumented(e){return e="https"===e?"http":e,this.moduleName===e}}class d extends r{constructor(){super(),this.configured=!1,this.pluginSubs=[]}_wrapHandler(e){return(r,s)=>{try{e(r,s)}catch(e){t.errorAndPublish(e)}}}_getTelemetryHandler(e){return()=>{try{const t=u(c.getStore());e.increaseExecuted(t)}catch(e){t.errorAndPublish(e)}}}_execHandlerAndIncMetric({handler:e,metric:r,tag:n,iastContext:i=u(c.getStore())}){try{const t=e();return s.isEnabled()&&r.inc(n,i),t}catch(e){t.errorAndPublish(e)}}addSub(e,t){"string"==typeof e?super.addSub(e,this._wrapHandler(t)):(e=this._getAndRegisterSubscription(e))&&(super.addSub(e.channelName,this._wrapHandler(t)),s.isEnabled()&&super.addSub(e.channelName,this._getTelemetryHandler(e)))}enable(){this.configure(!0)}disable(){this.configure(!1)}onConfigure(){}configure(e){"object"!=typeof e&&(e={enabled:e}),e.enabled&&!this.configured&&(this.onConfigure(),this.configured=!0),s.isEnabled()&&(e.enabled?this.enableTelemetry():this.disableTelemetry()),super.configure(e)}_getAndRegisterSubscription({moduleName:e,channelName:t,tag:r,tagKey:s}){if(!t&&!e)return;if(!e){let r=t.indexOf(":");if(-1===r)e=t;else{t.startsWith("tracing:")&&(r=t.indexOf(":",9));const s=t.indexOf(":",r+1);e=t.substring(r+1,-1!==s?s:t.length)}}const n=new p(e,t,r,s);return this.pluginSubs.push(n),n}enableTelemetry(){if(this.onInstrumentationLoadedListener)return;this.onInstrumentationLoadedListener=({name:e})=>this._onInstrumentationLoaded(e);e("dd-trace:instrumentation:load").subscribe(this.onInstrumentationLoadedListener);for(const e in l)this._onInstrumentationLoaded(e)}disableTelemetry(){if(!this.onInstrumentationLoadedListener)return;const t=e("dd-trace:instrumentation:load");t.hasSubscribers&&t.unsubscribe(this.onInstrumentationLoadedListener),this.onInstrumentationLoadedListener=null}_onInstrumentationLoaded(e){this.pluginSubs.filter((t=>t.matchesModuleInstrumented(e))).forEach((e=>e.increaseInstrumented()))}}return iastPlugin={SourceIastPlugin:class extends d{addSub(e,t){return super.addSub({tagKey:a.SOURCE_TYPE,...e},t)}addInstrumentedSource(e,t){this._getAndRegisterSubscription({moduleName:e,tag:t,tagKey:a.SOURCE_TYPE})}execSource(e){this._execHandlerAndIncMetric({metric:o,...e})}},SinkIastPlugin:class extends d{addSub(e,t){return super.addSub({tagKey:a.VULNERABILITY_TYPE,...e},t)}addNotSinkSub(e,t){return super.addSub(e,t)}},IastPlugin:d},iastPlugin}function requireFilter(){if(hasRequiredFilter)return filter;hasRequiredFilter=1;return filter={isPrivateModule:function(e){return e&&-1===e.indexOf("node_modules")},isNotLibraryFile:function(e){return e&&-1===e.indexOf("dd-trace-js")&&-1===e.indexOf("dd-trace")}},filter}function requireCsiMethods(){if(hasRequiredCsiMethods)return csiMethods_1;hasRequiredCsiMethods=1;return csiMethods_1={csiMethods:[{src:"concat"},{src:"parse"},{src:"plusOperator",operator:!0},{src:"random"},{src:"replace"},{src:"slice"},{src:"substr"},{src:"substring"},{src:"trim"},{src:"trimEnd"},{src:"trimStart",dst:"trim"}]}}function requireRewriterTelemetry(){if(hasRequiredRewriterTelemetry)return rewriterTelemetry;hasRequiredRewriterTelemetry=1;const e=requireTelemetry(),{Verbosity:t}=requireVerbosity(),{INSTRUMENTED_PROPAGATION:r}=requireIastMetric(),s={off:(e,t,r)=>r.rewrite(e,t),information(e,t,s){const n=this.off(e,t,s),i=n.metrics;return i&&i.instrumentedPropagation&&r.add(i.instrumentedPropagation),n}};return rewriterTelemetry={getRewriteFunction:function(r){return e.verbosity===t.OFF?(e,t)=>s.off(e,t,r):(e,t)=>s.information(e,t,r)}}}function requireLruCache(){if(hasRequiredLruCache)return lruCache;hasRequiredLruCache=1;const e="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,t="function"==typeof AbortController?AbortController:class{constructor(){this.signal=new n}abort(e=new Error("This operation was aborted")){this.signal.reason=this.signal.reason||e,this.signal.aborted=!0,this.signal.dispatchEvent({type:"abort",target:this.signal})}},r="function"==typeof AbortSignal,s="function"==typeof t.AbortSignal,n=r?AbortSignal:s?t.AbortController:class{constructor(){this.reason=void 0,this.aborted=!1,this._listeners=[]}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,this.onabort(e),this._listeners.forEach((t=>t(e)),this))}onabort(){}addEventListener(e,t){"abort"===e&&this._listeners.push(t)}removeEventListener(e,t){"abort"===e&&(this._listeners=this._listeners.filter((e=>e!==t)))}},i=new Set,a=(e,t)=>{const r=`LRU_CACHE_OPTION_${e}`;u(r)&&l(r,`${e} option`,`options.${t}`,g)},o=(e,t)=>{const r=`LRU_CACHE_METHOD_${e}`;if(u(r)){const{prototype:s}=g,{get:n}=Object.getOwnPropertyDescriptor(s,e);l(r,`${e} method`,`cache.${t}()`,n)}},c=(...e)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...e):console.error(...e)},u=e=>!i.has(e),l=(e,t,r,s)=>{i.add(e);c(`The ${t} is deprecated. Please use ${r} instead.`,"DeprecationWarning",e,s)},p=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),d=e=>p(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?h:null:null;class h extends Array{constructor(e){super(e),this.fill(0)}}class f{constructor(e){if(0===e)return[];const t=d(e);this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class g{constructor(e={}){const{max:t=0,ttl:r,ttlResolution:s=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:l,allowStale:h,dispose:m,disposeAfter:_,noDisposeOnSet:b,noUpdateTTL:y,maxSize:v=0,maxEntrySize:S=0,sizeCalculation:q,fetchMethod:E,fetchContext:R,noDeleteOnFetchRejection:T,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:x,ignoreFetchAbort:I}=e,{length:C,maxAge:O,stale:$}=e instanceof g?{}:e;if(0!==t&&!p(t))throw new TypeError("max option must be a nonnegative integer");const k=t?d(t):Array;if(!k)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=v,this.maxEntrySize=S||this.maxSize,this.sizeCalculation=q||C,this.sizeCalculation){if(!this.maxSize&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=E||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=R,!this.fetchMethod&&void 0!==R)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new k(t),this.prev=new k(t),this.head=0,this.tail=0,this.free=new f(t),this.initialFill=1,this.size=0,"function"==typeof m&&(this.dispose=m),"function"==typeof _?(this.disposeAfter=_,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!b,this.noUpdateTTL=!!y,this.noDeleteOnFetchRejection=!!T,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!x,this.ignoreFetchAbort=!!I,0!==this.maxEntrySize){if(0!==this.maxSize&&!p(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");if(!p(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!h||!!$,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!l,this.ttlResolution=p(s)||0===s?s:1,this.ttlAutopurge=!!n,this.ttl=r||O||0,this.ttl){if(!p(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(u(e)){i.add(e);c("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,g)}}$&&a("stale","allowStale"),O&&a("maxAge","ttl"),C&&a("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new h(this.max),this.starts=new h(this.max),this.setItemTTL=(t,r,s=e.now())=>{if(this.starts[t]=0!==r?s:0,this.ttls[t]=r,0!==r&&this.ttlAutopurge){const e=setTimeout((()=>{this.isStale(t)&&this.delete(this.keyList[t])}),r+1);e.unref&&e.unref()}},this.updateItemAge=t=>{this.starts[t]=0!==this.ttls[t]?e.now():0},this.statusTTL=(e,s)=>{e&&(e.ttl=this.ttls[s],e.start=this.starts[s],e.now=t||r(),e.remainingTTL=e.now+e.ttl-e.start)};let t=0;const r=()=>{const r=e.now();if(this.ttlResolution>0){t=r;const e=setTimeout((()=>t=0),this.ttlResolution);e.unref&&e.unref()}return r};this.getRemainingTTL=e=>{const s=this.keyMap.get(e);return void 0===s?0:0===this.ttls[s]||0===this.starts[s]?1/0:this.starts[s]+this.ttls[s]-(t||r())},this.isStale=e=>0!==this.ttls[e]&&0!==this.starts[e]&&(t||r())-this.starts[e]>this.ttls[e]}updateItemAge(e){}statusTTL(e,t){}setItemTTL(e,t,r){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new h(this.max),this.removeItemSize=e=>{this.calculatedSize-=this.sizes[e],this.sizes[e]=0},this.requireSize=(e,t,r,s)=>{if(this.isBackgroundFetch(t))return 0;if(!p(r)){if(!s)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof s)throw new TypeError("sizeCalculation must be a function");if(r=s(t,e),!p(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.addItemSize=(e,t,r)=>{if(this.sizes[e]=t,this.maxSize){const t=this.maxSize-this.sizes[e];for(;this.calculatedSize>t;)this.evict(!0)}this.calculatedSize+=this.sizes[e],r&&(r.entrySize=t,r.totalCalculatedSize=this.calculatedSize)}}removeItemSize(e){}addItemSize(e,t){}requireSize(e,t,r,s){if(r||s)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return void 0!==e&&this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())void 0===this.valList[e]||void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield[this.keyList[e],this.valList[e]])}*rentries(){for(const e of this.rindexes())void 0===this.valList[e]||void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield[this.keyList[e],this.valList[e]])}*keys(){for(const e of this.indexes())void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.keyList[e])}*rkeys(){for(const e of this.rindexes())void 0===this.keyList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.keyList[e])}*values(){for(const e of this.indexes())void 0===this.valList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.valList[e])}*rvalues(){for(const e of this.rindexes())void 0===this.valList[e]||this.isBackgroundFetch(this.valList[e])||(yield this.valList[e])}[Symbol.iterator](){return this.entries()}find(e,t){for(const r of this.indexes()){const s=this.valList[r],n=this.isBackgroundFetch(s)?s.__staleWhileFetching:s;if(void 0!==n&&e(n,this.keyList[r],this))return this.get(this.keyList[r],t)}}forEach(e,t=this){for(const r of this.indexes()){const s=this.valList[r],n=this.isBackgroundFetch(s)?s.__staleWhileFetching:s;void 0!==n&&e.call(t,n,this.keyList[r],this)}}rforEach(e,t=this){for(const r of this.rindexes()){const s=this.valList[r],n=this.isBackgroundFetch(s)?s.__staleWhileFetching:s;void 0!==n&&e.call(t,n,this.keyList[r],this)}}get prune(){return o("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const t=[];for(const r of this.indexes({allowStale:!0})){const s=this.keyList[r],n=this.valList[r],i=this.isBackgroundFetch(n)?n.__staleWhileFetching:n;if(void 0===i)continue;const a={value:i};if(this.ttls){a.ttl=this.ttls[r];const t=e.now()-this.starts[r];a.start=Math.floor(Date.now()-t)}this.sizes&&(a.size=this.sizes[r]),t.unshift([s,a])}return t}load(t){this.clear();for(const[r,s]of t){if(s.start){const t=Date.now()-s.start;s.start=e.now()-t}this.set(r,s.value,s)}}dispose(e,t,r){}set(e,t,{ttl:r=this.ttl,start:s,noDisposeOnSet:n=this.noDisposeOnSet,size:i=0,sizeCalculation:a=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL,status:c}={}){if(i=this.requireSize(e,t,i,a),this.maxEntrySize&&i>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(e),this;let u=0===this.size?void 0:this.keyMap.get(e);if(void 0===u)u=this.newIndex(),this.keyList[u]=e,this.valList[u]=t,this.keyMap.set(e,u),this.next[this.tail]=u,this.prev[u]=this.tail,this.tail=u,this.size++,this.addItemSize(u,i,c),c&&(c.set="add"),o=!1;else{this.moveToTail(u);const r=this.valList[u];if(t!==r){if(this.isBackgroundFetch(r)?r.__abortController.abort(new Error("replaced")):n||(this.dispose(r,e,"set"),this.disposeAfter&&this.disposed.push([r,e,"set"])),this.removeItemSize(u),this.valList[u]=t,this.addItemSize(u,i,c),c){c.set="replace";const e=r&&this.isBackgroundFetch(r)?r.__staleWhileFetching:r;void 0!==e&&(c.oldValue=e)}}else c&&(c.set="update")}if(0===r||0!==this.ttl||this.ttls||this.initializeTTLTracking(),o||this.setItemTTL(u,r,s),this.statusTTL(c,u),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max&&0!==this.max?this.evict(!1):0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(!0),e}}evict(e){const t=this.head,r=this.keyList[t],s=this.valList[t];return this.isBackgroundFetch(s)?s.__abortController.abort(new Error("evicted")):(this.dispose(s,r,"evict"),this.disposeAfter&&this.disposed.push([s,r,"evict"])),this.removeItemSize(t),e&&(this.keyList[t]=null,this.valList[t]=null,this.free.push(t)),this.head=this.next[t],this.keyMap.delete(r),this.size--,t}has(e,{updateAgeOnHas:t=this.updateAgeOnHas,status:r}={}){const s=this.keyMap.get(e);if(void 0!==s){if(!this.isStale(s))return t&&this.updateItemAge(s),r&&(r.has="hit"),this.statusTTL(r,s),!0;r&&(r.has="stale",this.statusTTL(r,s))}else r&&(r.has="miss");return!1}peek(e,{allowStale:t=this.allowStale}={}){const r=this.keyMap.get(e);if(void 0!==r&&(t||!this.isStale(r))){const e=this.valList[r];return this.isBackgroundFetch(e)?e.__staleWhileFetching:e}}backgroundFetch(e,r,s,n){const i=void 0===r?void 0:this.valList[r];if(this.isBackgroundFetch(i))return i;const a=new t;s.signal&&s.signal.addEventListener("abort",(()=>a.abort(s.signal.reason)));const o={signal:a.signal,options:s,context:n},c=(t,n=!1)=>{const{aborted:i}=a.signal,c=s.ignoreFetchAbort&&void 0!==t;return s.status&&(i&&!n?(s.status.fetchAborted=!0,s.status.fetchError=a.signal.reason,c&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),!i||c||n?(this.valList[r]===l&&(void 0===t?l.__staleWhileFetching?this.valList[r]=l.__staleWhileFetching:this.delete(e):(s.status&&(s.status.fetchUpdated=!0),this.set(e,t,o.options))),t):u(a.signal.reason)},u=t=>{const{aborted:n}=a.signal,i=n&&s.allowStaleOnFetchAbort,o=i||s.allowStaleOnFetchRejection,c=o||s.noDeleteOnFetchRejection;if(this.valList[r]===l){!c||void 0===l.__staleWhileFetching?this.delete(e):i||(this.valList[r]=l.__staleWhileFetching)}if(o)return s.status&&void 0!==l.__staleWhileFetching&&(s.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw t};s.status&&(s.status.fetchDispatched=!0);const l=new Promise(((t,r)=>{this.fetchMethod(e,i,o).then((e=>t(e)),r),a.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(t(),s.allowStaleOnFetchAbort&&(t=e=>c(e,!0)))}))})).then(c,(e=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=e),u(e))));return l.__abortController=a,l.__staleWhileFetching=i,l.__returned=null,void 0===r?(this.set(e,l,{...o.options,status:void 0}),r=this.keyMap.get(e)):this.valList[r]=l,l}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(e,"__returned")&&(e.__returned===e||null===e.__returned)}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:n=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:a=0,sizeCalculation:o=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:l=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:d=this.allowStaleOnFetchAbort,fetchContext:h=this.fetchContext,forceRefresh:f=!1,status:g,signal:m}={}){if(!this.fetchMethod)return g&&(g.fetch="get"),this.get(e,{allowStale:t,updateAgeOnGet:r,noDeleteOnStaleGet:s,status:g});const _={allowStale:t,updateAgeOnGet:r,noDeleteOnStaleGet:s,ttl:n,noDisposeOnSet:i,size:a,sizeCalculation:o,noUpdateTTL:c,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:l,allowStaleOnFetchAbort:d,ignoreFetchAbort:p,status:g,signal:m};let b=this.keyMap.get(e);if(void 0===b){g&&(g.fetch="miss");const t=this.backgroundFetch(e,b,_,h);return t.__returned=t}{const s=this.valList[b];if(this.isBackgroundFetch(s)){const e=t&&void 0!==s.__staleWhileFetching;return g&&(g.fetch="inflight",e&&(g.returnedStale=!0)),e?s.__staleWhileFetching:s.__returned=s}const n=this.isStale(b);if(!f&&!n)return g&&(g.fetch="hit"),this.moveToTail(b),r&&this.updateItemAge(b),this.statusTTL(g,b),s;const i=this.backgroundFetch(e,b,_,h),a=void 0!==i.__staleWhileFetching,o=a&&t;return g&&(g.fetch=a&&n?"stale":"refresh",o&&n&&(g.returnedStale=!0)),o?i.__staleWhileFetching:i.__returned=i}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:n}={}){const i=this.keyMap.get(e);if(void 0!==i){const a=this.valList[i],o=this.isBackgroundFetch(a);return this.statusTTL(n,i),this.isStale(i)?(n&&(n.get="stale"),o?(n&&(n.returnedStale=t&&void 0!==a.__staleWhileFetching),t?a.__staleWhileFetching:void 0):(s||this.delete(e),n&&(n.returnedStale=t),t?a:void 0)):(n&&(n.get="hit"),o?a.__staleWhileFetching:(this.moveToTail(i),r&&this.updateItemAge(i),a))}n&&(n.get="miss")}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return o("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const r=this.keyMap.get(e);if(void 0!==r)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(r);const t=this.valList[r];this.isBackgroundFetch(t)?t.__abortController.abort(new Error("deleted")):(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[r]=null,this.valList[r]=null,r===this.tail?this.tail=this.prev[r]:r===this.head?this.head=this.next[r]:(this.next[this.prev[r]]=this.next[r],this.prev[this.next[r]]=this.prev[r]),this.size--,this.free.push(r)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort(new Error("deleted"));else{const r=this.keyList[e];this.dispose(t,r,"delete"),this.disposeAfter&&this.disposed.push([t,r,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return o("reset","clear"),this.clear}get length(){return((e,t)=>{const r=`LRU_CACHE_PROPERTY_${e}`;if(u(r)){const{prototype:s}=g,{get:n}=Object.getOwnPropertyDescriptor(s,e);l(r,`${e} property`,`cache.${t}`,n)}})("length","size"),this.size}static get AbortController(){return t}static get AbortSignal(){return n}}return lruCache=g}function requirePrimordials(){if(hasRequiredPrimordials)return primordials_1;function e(e){return function(t,...r){return e.apply(t,r)}}hasRequiredPrimordials=1;const t={ArrayPrototypePush:e(Array.prototype.push),ArrayPrototypeSlice:e(Array.prototype.slice),ArrayPrototypeSort:e(Array.prototype.sort),ArrayIsArray:Array.isArray,ObjectPrototypeHasOwnProperty:e(Object.prototype.hasOwnProperty),StringPrototypeCharAt:e(String.prototype.charAt)};return primordials_1=t}function requireNode_source_map(){if(hasRequiredNode_source_map)return node_source_map;hasRequiredNode_source_map=1;const{ArrayPrototypePush:e,ArrayPrototypeSlice:t,ArrayPrototypeSort:r,ArrayIsArray:s,ObjectPrototypeHasOwnProperty:n,StringPrototypeCharAt:i}=requirePrimordials();let a;class o{constructor(e){this._string=e,this._position=0}next(){return i(this._string,this._position++)}peek(){return i(this._string,this._position)}hasNext(){return this._position<this._string.length}}function c(e){return","===e||";"===e}function u(e){let t,r=0,s=0;do{t=a[e.next()],r+=(31&t)<<s,s+=5}while(32&t);const n=1&r;return r>>>=1,n?-r|1<<31:r}function l(e,t){const{0:r,1:s}=e,{0:n,1:i}=t;return r!==n?r-n:s-i}return node_source_map={SourceMap:class{constructor(e){if(this._mappings=[],this._sources={},this._sources={},!a){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";a={};for(let t=0;t<e.length;++t)a[e[t]]=t}this._payload=function(e){e={...e};for(const r in e)n(e,r)&&s(e[r])&&(e[r]=t(e[r]));return e}(e),this._parseMappingPayload()}_parseMappingPayload(){this._payload.sections?this._parseSections(this._payload.sections):this._parseMap(this._payload,0,0),r(this._mappings,l)}_parseSections(e){for(let t=0;t<e.length;++t){const r=e[t];this._parseMap(r.map,r.offset.line,r.offset.column)}}findEntry(e,t){let r=0,s=this._mappings.length;for(;s>1;){const n=s>>1,i=r+n,a=this._mappings[i];e<a[0]||e===a[0]&&t<a[1]?s=n:(r=i,s-=n)}const n=this._mappings[r];return!r&&n&&(e<n[0]||e===n[0]&&t<n[1])?{}:n?{generatedLine:n[0],generatedColumn:n[1],originalSource:n[2],originalLine:n[3],originalColumn:n[4],name:n[5]}:{}}_parseMap(t,r,s){let n=0,i=0,a=0,l=0;const p=[];for(let r=0;r<t.sources.length;++r){const s=t.sources[r];e(p,s),this._sources[s]=!0,t.sourcesContent&&t.sourcesContent[r]&&(this._sources[s]=t.sourcesContent[r])}const d=new o(t.mappings);let h=p[n];for(;;){if(","===d.peek())d.next();else{for(;";"===d.peek();)r+=1,s=0,d.next();if(!d.hasNext())break}if(s+=u(d),c(d.peek())){e(this._mappings,[r,s]);continue}const o=u(d);let f;o&&(n+=o,h=p[n]),i+=u(d),a+=u(d),c(d.peek())||(l+=u(d),f=t.names?t.names[l]:void 0),e(this._mappings,[r,s,h,i,a,f])}}}},node_source_map}function requireSourceMap(){if(hasRequiredSourceMap)return sourceMap;hasRequiredSourceMap=1;const e=require$$0$1,t=require$$0$6,r=requireLruCache(),{SourceMap:s}=requireNode_source_map(),n="//# sourceMappingURL=",i="//# sourceMappingURL=data:application/json;base64,",a=new Map,o=new r({max:1e3});function c(r,a){const o=r.trim().split("\n"),c=o[o.length-1];let u;if(0===c.indexOf(i)){const e=c.substring(i.length);u=Buffer.from(e,"base64").toString("utf8")}else if(0===c.indexOf(n)){let r=c.substring(n.length);r&&(r=e.isAbsolute(r)?r:e.join(a,r),u=t.readFileSync(r).toString())}if(u)return new s(JSON.parse(u))}function u(t){const r=t.split(e.sep);return r.pop(),r.join(e.sep)}function l(t,r,s,n){try{if(t){const i=u(r),{originalSource:a,originalLine:o,originalColumn:c}=t.findEntry(s-1,n-1);return{path:e.join(i,a),line:o+1,column:c+1}}}catch(e){}return{path:r,line:s,column:n}}return sourceMap={getSourcePathAndLineFromSourceMaps:function(e,t,r=0){return l(a.get(e),e,t,r)},getOriginalPathAndLineFromSourceMap:function(e,r,s=0){if(e&&r){let n;try{if(n=o.get(e),void 0===n){if(t.existsSync(e)){const r=u(e);n=c(t.readFileSync(e).toString(),r)}o.set(e,n||null)}return l(n,e,r,s)}catch(t){void 0===n&&o.set(e,null)}}return{path:e,line:r,column:s}},cacheRewrittenSourceMap:function(e,t){if(t){const r=c(t,u(e));a.set(e,r)}},generateSourceMapFromFileContent:c}}function requireStackTrace(){if(hasRequiredStackTrace)return stackTrace;hasRequiredStackTrace=1;const{getSourcePathAndLineFromSourceMaps:e}=requireSourceMap(),t=Symbol("_ddiastPrepareStackTrace");class r{constructor(t){const{path:r,line:s,column:n}=e(t.getFileName(),t.getLineNumber(),t.getColumnNumber());this.source=r,this.lineNumber=s,this.columnNumber=n,this.callSite=t}getThis(){return this.callSite}getTypeName(){return this.callSite.getTypeName()}getFunction(){return this.callSite.getFunction()}getFunctionName(){return this.callSite.getFunctionName()}getMethodName(){return this.callSite.getMethodName()}getFileName(){return this.source}getScriptNameOrSourceURL(){return null}getLineNumber(){return this.lineNumber}getColumnNumber(){return this.columnNumber}getEvalOrigin(){return this.callSite.getEvalOrigin()}isToplevel(){return this.callSite.isToplevel()}isEval(){return this.callSite.isEval()}isNative(){return this.callSite.isNative()}isConstructor(){return this.callSite.isConstructor()}toString(){return this.callSite.toString()}toLocaleString(){return this.callSite.toLocaleString()}}return stackTrace={getPrepareStackTrace:function(s){if(s&&s[t])return s;const n=(t,n)=>{if(s){const e=n.map((e=>new r(e)));return s(t,e)}const i=t.stack.split("\n");let a=-1;for(let e=0;e<i.length;e++)if(i[e].match(/^\s*at/gm)){a=e;break}return i.map(((t,r)=>{if(r<a)return t;const s=n[r-=a];if(!s)return t;let i=s.getFileName(),o=s.getLineNumber(),c=s.getColumnNumber();if(s.isEval()){const e=s.getEvalOrigin(),r=/.*\(((?:.:[/\\]?)?[/\\].*):(\d*):(\d*)\)/g.exec(e);if(!r)return t;i=r[1],o=r[2],c=r[3]}const{path:u,line:l,column:p}=e(i,o,c);return u!==i||l!==o||p!==c?t.replace(`${i}:${o}:${c}`,`${u}:${l}:${p}`):t})).join("\n")};return Object.defineProperty(n,t,{value:!0}),n}},stackTrace}var wasm_iast_rewriter={exports:{}},hasRequiredWasm_iast_rewriter,main,hasRequiredMain,rewriter_1,hasRequiredRewriter,vulnerabilityAnalyzer,hasRequiredVulnerabilityAnalyzer,replace,hasRequiredReplace,nativeIastTaintTracking,hasRequiredNativeIastTaintTracking,operationsTaintObject,hasRequiredOperationsTaintObject,taintTrackingImpl,hasRequiredTaintTrackingImpl,operations,hasRequiredOperations,injectionAnalyzer,hasRequiredInjectionAnalyzer,commandInjectionAnalyzer,hasRequiredCommandInjectionAnalyzer,hardcodedSecretsRules,hasRequiredHardcodedSecretsRules,hardcodedSecretAnalyzer,hasRequiredHardcodedSecretAnalyzer,sourceTypes,hasRequiredSourceTypes,headerInjectionAnalyzer,hasRequiredHeaderInjectionAnalyzer,missingHeaderAnalyzer,hasRequiredMissingHeaderAnalyzer,hstsHeaderMissingAnalyzer,hasRequiredHstsHeaderMissingAnalyzer,cookieAnalyzer,hasRequiredCookieAnalyzer,insecureCookieAnalyzer,hasRequiredInsecureCookieAnalyzer,ldapInjectionAnalyzer,hasRequiredLdapInjectionAnalyzer,noHttponlyCookieAnalyzer,hasRequiredNoHttponlyCookieAnalyzer,noSamesiteCookieAnalyzer,hasRequiredNoSamesiteCookieAnalyzer;function requireWasm_iast_rewriter(){return hasRequiredWasm_iast_rewriter||(hasRequiredWasm_iast_rewriter=1,function(e){let t,r={};r.__wbindgen_placeholder__=e.exports;const{log:s,setLogger:n}=commonjsRequire(String.raw`./snippets/native-iast-rewriter-6a3bf7270b595175/tracer_logger.js`),{readFileSync:i}=require$$0$6,{dirname:a}=require$$0$1,{TextEncoder:o,TextDecoder:c}=require$$0$3,u=new Array(128).fill(void 0);function l(e){return u[e]}u.push(void 0,null,!0,!1);let p=u.length;function d(e){const t=l(e);return function(e){e<132||(u[e]=p,p=e)}(e),t}let h=0,f=null;function g(){return null!==f&&0!==f.byteLength||(f=new Uint8Array(t.memory.buffer)),f}let m=new o("utf-8");const _="function"==typeof m.encodeInto?function(e,t){return m.encodeInto(e,t)}:function(e,t){const r=m.encode(e);return t.set(r),{read:e.length,written:r.length}};function b(e,t,r){if(void 0===r){const r=m.encode(e),s=t(r.length)>>>0;return g().subarray(s,s+r.length).set(r),h=r.length,s}let s=e.length,n=t(s)>>>0;const i=g();let a=0;for(;a<s;a++){const t=e.charCodeAt(a);if(t>127)break;i[n+a]=t}if(a!==s){0!==a&&(e=e.slice(a)),n=r(n,s,s=a+3*e.length)>>>0;const t=g().subarray(n+a,n+s);a+=_(e,t).written}return h=a,n}function y(e){return null==e}let v=null;function S(){return null!==v&&0!==v.byteLength||(v=new Int32Array(t.memory.buffer)),v}let q=new c("utf-8",{ignoreBOM:!0,fatal:!0});function E(e,t){return e>>>=0,q.decode(g().subarray(e,e+t))}function R(e){p===u.length&&u.push(u.length+1);const t=p;return p=u[t],u[t]=e,t}q.decode();let T=null;function A(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=A(e[0]));for(let s=1;s<t;s++)r+=", "+A(e[s]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let s;if(!(r.length>1))return toString.call(e);if(s=r[1],"Object"==s)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:s}function w(e,r){try{return e.apply(this,r)}catch(e){t.__wbindgen_exn_store(R(e))}}let x=128;class I{static __wrap(e){e>>>=0;const t=Object.create(I.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();t.__wbg_rewriter_free(e)}constructor(e){const r=t.rewriter_new(R(e));return I.__wrap(r)}rewrite(e,r){try{const i=t.__wbindgen_add_to_stack_pointer(-16),a=b(e,t.__wbindgen_malloc,t.__wbindgen_realloc),o=h,c=b(r,t.__wbindgen_malloc,t.__wbindgen_realloc),u=h;t.rewriter_rewrite(i,this.__wbg_ptr,a,o,c,u);var s=S()[i/4+0],n=S()[i/4+1];if(S()[i/4+2])throw d(n);return d(s)}finally{t.__wbindgen_add_to_stack_pointer(16)}}csiMethods(){try{const s=t.__wbindgen_add_to_stack_pointer(-16);t.rewriter_csiMethods(s,this.__wbg_ptr);var e=S()[s/4+0],r=S()[s/4+1];if(S()[s/4+2])throw d(r);return d(e)}finally{t.__wbindgen_add_to_stack_pointer(16)}}setLogger(e,r){try{const n=t.__wbindgen_add_to_stack_pointer(-16),i=b(r,t.__wbindgen_malloc,t.__wbindgen_realloc),a=h;t.rewriter_setLogger(n,this.__wbg_ptr,function(e){if(1==x)throw new Error("out of js stack");return u[--x]=e,x}(e),i,a);var s=S()[n/4+0];if(S()[n/4+1])throw d(s)}finally{t.__wbindgen_add_to_stack_pointer(16),u[x++]=void 0}}}e.exports.Rewriter=I,e.exports.__wbindgen_object_drop_ref=function(e){d(e)},e.exports.__wbindgen_boolean_get=function(e){const t=l(e);return"boolean"==typeof t?t?1:0:2},e.exports.__wbindgen_string_get=function(e,r){const s=l(r),n="string"==typeof s?s:void 0;var i=y(n)?0:b(n,t.__wbindgen_malloc,t.__wbindgen_realloc),a=h;S()[e/4+1]=a,S()[e/4+0]=i},e.exports.__wbindgen_is_object=function(e){const t=l(e);return"object"==typeof t&&null!==t},e.exports.__wbindgen_is_undefined=function(e){return void 0===l(e)},e.exports.__wbindgen_in=function(e,t){return l(e)in l(t)},e.exports.__wbindgen_error_new=function(e,t){return R(new Error(E(e,t)))},e.exports.__wbindgen_string_new=function(e,t){return R(E(e,t))},e.exports.__wbg_log_d880dadb9e7bc467=function(){return w((function(e,t){return R(s(l(e),l(t)))}),arguments)},e.exports.__wbg_readFileSync_1fd06101be5c2bb6=function(){return w((function(e,t){return R(i(E(e,t)))}),arguments)},e.exports.__wbg_dirname_5e825c10ae41566f=function(){return w((function(e,t){return R(a(E(e,t)))}),arguments)},e.exports.__wbg_setLogger_d6ff5c4767b0a460=function(){return w((function(e){return R(n(l(e)))}),arguments)},e.exports.__wbindgen_is_string=function(e){return"string"==typeof l(e)},e.exports.__wbindgen_object_clone_ref=function(e){return R(l(e))},e.exports.__wbindgen_jsval_loose_eq=function(e,t){return l(e)==l(t)},e.exports.__wbindgen_number_get=function(e,r){const s=l(r),n="number"==typeof s?s:void 0;(null!==T&&0!==T.byteLength||(T=new Float64Array(t.memory.buffer)),T)[e/8+1]=y(n)?0:n,S()[e/4+0]=!y(n)},e.exports.__wbg_String_91fba7ded13ba54c=function(e,r){const s=b(String(l(r)),t.__wbindgen_malloc,t.__wbindgen_realloc),n=h;S()[e/4+1]=n,S()[e/4+0]=s},e.exports.__wbindgen_number_new=function(e){return R(e)},e.exports.__wbindgen_bigint_from_u64=function(e){return R(BigInt.asUintN(64,e))},e.exports.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){return R(l(e)[l(t)])},e.exports.__wbg_set_20cbc34131e76824=function(e,t,r){l(e)[d(t)]=d(r)},e.exports.__wbg_new_abda76e883ba8a5f=function(){return R(new Error)},e.exports.__wbg_stack_658279fe44541cf6=function(e,r){const s=b(l(r).stack,t.__wbindgen_malloc,t.__wbindgen_realloc),n=h;S()[e/4+1]=n,S()[e/4+0]=s},e.exports.__wbg_error_f851667af71bcfc6=function(e,r){let s,n;try{s=e,n=r,console.error(E(e,r))}finally{t.__wbindgen_free(s,n)}},e.exports.__wbg_get_7303ed2ef026b2f5=function(e,t){return R(l(e)[t>>>0])},e.exports.__wbg_length_820c786973abdd8a=function(e){return l(e).length},e.exports.__wbg_new_0394642eae39db16=function(){return R(new Array)},e.exports.__wbindgen_is_function=function(e){return"function"==typeof l(e)},e.exports.__wbg_new_0f2b71ca2f2a6029=function(){return R(new Map)},e.exports.__wbg_next_f4bc0e96ea67da68=function(e){return R(l(e).next)},e.exports.__wbg_next_ec061e48a0e72a96=function(){return w((function(e){return R(l(e).next())}),arguments)},e.exports.__wbg_done_b6abb27d42b63867=function(e){return l(e).done},e.exports.__wbg_value_2f4ef2036bfad28e=function(e){return R(l(e).value)},e.exports.__wbg_iterator_7c7e58f62eb84700=function(){return R(Symbol.iterator)},e.exports.__wbg_get_f53c921291c381bd=function(){return w((function(e,t){return R(Reflect.get(l(e),l(t)))}),arguments)},e.exports.__wbg_call_557a2f2deacc4912=function(){return w((function(e,t){return R(l(e).call(l(t)))}),arguments)},e.exports.__wbg_new_2b6fea4ea03b1b95=function(){return R(new Object)},e.exports.__wbg_set_b4da98d504ac6091=function(e,t,r){l(e)[t>>>0]=d(r)},e.exports.__wbg_isArray_04e59fb73f78ab5b=function(e){return Array.isArray(l(e))},e.exports.__wbg_instanceof_ArrayBuffer_ef2632aa0d4bfff8=function(e){let t;try{t=l(e)instanceof ArrayBuffer}catch{t=!1}return t},e.exports.__wbg_set_da7be7bf0e037b14=function(e,t,r){return R(l(e).set(l(t),l(r)))},e.exports.__wbg_now_c857fb0367c762cc=function(){return Date.now()},e.exports.__wbg_buffer_55ba7a6b1b92e2ac=function(e){return R(l(e).buffer)},e.exports.__wbg_new_09938a7d020f049b=function(e){return R(new Uint8Array(l(e)))},e.exports.__wbg_set_3698e3ca519b3c3c=function(e,t,r){l(e).set(l(t),r>>>0)},e.exports.__wbg_length_0aab7ffd65ad19ed=function(e){return l(e).length},e.exports.__wbg_instanceof_Uint8Array_1349640af2da2e88=function(e){let t;try{t=l(e)instanceof Uint8Array}catch{t=!1}return t},e.exports.__wbindgen_debug_string=function(e,r){const s=b(A(l(r)),t.__wbindgen_malloc,t.__wbindgen_realloc),n=h;S()[e/4+1]=n,S()[e/4+0]=s},e.exports.__wbindgen_throw=function(e,t){throw new Error(E(e,t))},e.exports.__wbindgen_memory=function(){return R(t.memory)};const C=require$$0$1.join(__dirname,"wasm_iast_rewriter_bg.wasm"),O=require$$0$6.readFileSync(C),$=new WebAssembly.Module(O),k=new WebAssembly.Instance($,r);t=k.exports,e.exports.__wasm=t}(wasm_iast_rewriter)),wasm_iast_rewriter.exports}function requireMain(){if(hasRequiredMain)return main;hasRequiredMain=1;const{getPrepareStackTrace:e}=requireStackTrace(),{cacheRewrittenSourceMap:t,getOriginalPathAndLineFromSourceMap:r}=requireSourceMap();class s{rewrite(e,t){return{content:e}}csiMethods(){return[]}}let n;class i{constructor(e){n?(this.nativeRewriter=new n(e),this.setLogger(e)):this.nativeRewriter=new s}rewrite(e,r){const s=this.nativeRewriter.rewrite(e,r);try{const{metrics:e,content:n}=s;"modified"===e?.status&&t(r,n)}catch(e){this.logError(e)}return s}csiMethods(){return this.nativeRewriter.csiMethods()}setLogger(e){if(e&&(e.logger||e.logLevel)){this.logger=e.logger||console;const t=e.logLevel||"ERROR";try{this.nativeRewriter.setLogger(this.logger,t)}catch(e){this.logError(e)}}}logError(e){this.logger?.error?.(e)}}return main={Rewriter:function(){try{const e=requireWasm_iast_rewriter();return n=e.Rewriter,i}catch(e){return s}}(),DummyRewriter:s,getPrepareStackTrace:e,getOriginalPathAndLineFromSourceMap:r}}function requireRewriter(){if(hasRequiredRewriter)return rewriter_1;hasRequiredRewriter=1;const e=require$$1$4,t=requireDatadogShimmer(),r=requireIastLog(),{isPrivateModule:s,isNotLibraryFile:n}=requireFilter(),{csiMethods:i}=requireCsiMethods(),{getName:a}=requireVerbosity(),{getRewriteFunction:o}=requireRewriterTelemetry(),c=requireDcPolyfill().channel("datadog:secrets:result");let u,l,p=function(e,t,r){return{path:e,line:t,column:r}};function d(e){if(!u)try{const r=requireMain(),o=r.Rewriter;l=r.getPrepareStackTrace;const c=(t="--enable-source-maps",process.env.NODE_OPTIONS?.includes(t)||process.execArgv?.some((e=>e.includes(t)))),d=r.getOriginalPathAndLineFromSourceMap;d&&(p=function(e,t){return e?function(e,r,i){return s(e)&&n(e)?{path:e,line:r,column:i}:t(e,r,i)}:t}(c,d)),u=new o({csiMethods:i,telemetryVerbosity:a(e),chainSourceMap:c})}catch(e){r.error("Unable to initialize TaintTracking Rewriter").errorAndPublish(e)}var t;return u}let h=Error.prepareStackTrace;function f(e){const t=o(u);return function(i,a){try{if(s(a)&&n(a)){const r=t(i,a);if(r?.literalsResult&&c.hasSubscribers&&c.publish(r.literalsResult),r?.content)return e.apply(this,[r.content,a])}}catch(e){r.error(`Error rewriting ${a}`).errorAndPublish(e)}return e.apply(this,[i,a])}}return rewriter_1={enableRewriter:function(s){try{if(d(s)){const r=Object.getOwnPropertyDescriptor(commonjsGlobal.Error,"prepareStackTrace");r&&!r.configurable||Object.defineProperty(commonjsGlobal.Error,"prepareStackTrace",function(){let e=l(h);return{configurable:!0,get:()=>e,set(t){e=l(t),h=t}}}()),t.wrap(e.prototype,"_compile",(e=>f(e)))}}catch(e){r.error("Error enabling TaintTracking Rewriter").errorAndPublish(e)}},disableRewriter:function(){t.unwrap(e.prototype,"_compile"),Error.prepareStackTrace=h},getOriginalPathAndLineFromSourceMap:function({path:e,line:t,column:r}){return p(e,t,r)}}}function requireVulnerabilityAnalyzer(){if(hasRequiredVulnerabilityAnalyzer)return vulnerabilityAnalyzer;hasRequiredVulnerabilityAnalyzer=1;const{storage:e}=requireDatadogCore(),{getFirstNonDDPathAndLine:t}=requirePathLine(),{addVulnerability:r}=requireVulnerabilityReporter(),{getIastContext:s}=requireIastContext(),n=requireOverheadController(),{SinkIastPlugin:i}=requireIastPlugin(),{getOriginalPathAndLineFromSourceMap:a}=requireRewriter();return vulnerabilityAnalyzer=class extends i{constructor(e){super(),this._type=e}_isVulnerable(e,t){return!1}_isExcluded(e){return!1}_report(e,t,r){const s=this._getEvidence(e,t,r);this._reportEvidence(e,t,s)}_reportEvidence(e,t,s){const n=this._getLocation(e);if(!this._isExcluded(n)){const e=this._replaceLocationFromSourceMap(n),i=t&&t.rootSpan&&t.rootSpan.context().toSpanId(),a=this._createVulnerability(this._type,s,i,e);r(t,a)}}_reportIfVulnerable(e,t,r){return!(!this._isVulnerable(e,t)||!this._checkOCE(t,e))&&(this._report(e,t,r),!0)}_getEvidence(e){return{value:e}}_getLocation(){return t(this._getExcludedPaths())}_replaceLocationFromSourceMap(e){if(e){const{path:t,line:r,column:s}=a(e);t&&(e.path=t),r&&(e.line=r),s&&(e.column=s)}return e}_getExcludedPaths(){}_isInvalidContext(e,t){return e&&!t}analyze(t,r=e.getStore(),n){const i=s(r);this._isInvalidContext(r,i)||this._reportIfVulnerable(t,i,n)}analyzeAll(...t){const r=e.getStore(),n=s(r);if(!this._isInvalidContext(r,n))for(let e=0;e<t.length;e++){const r=t[e];if(this._isVulnerable(r,n)){this._checkOCE(n,r)&&this._report(r,n);break}}}_checkOCE(e){return n.hasQuota(n.OPERATIONS.REPORT_VULNERABILITY,e)}_createVulnerability(e,t,r,s){if(e&&t){return{type:e,evidence:t,location:{spanId:r||0,...s},hash:this._createHash(this._createHashSource(e,t,s))}}return null}_createHashSource(e,t,r){return r?`${e}:${r.path}:${r.line}`:e}_createHash(e){let t=0,r=0;const s=e.length;for(let n=0;n<s;n++)t=(t<<5)-t+e.charCodeAt(r++);return t}addSub(e,t){const r="string"==typeof e?{channelName:e}:e;super.addSub({tag:this._type,...r},t)}},vulnerabilityAnalyzer}function requireReplace(){if(hasRequiredReplace)return replace;hasRequiredReplace=1;const e=/(\$\$)|(\$&)|(\$`)|(\$')|(\$\d)/;return replace=function(t){function r(r,s,n){return t.isTainted(r,s,n)&&!function(t){return t.indexOf("$")>-1&&!!t.match(e)}(n)}return t.replace?t.replace:function(e,s,n,i,a){if(e&&"string"==typeof n&&"string"==typeof a)if("string"==typeof i){if(r(e,n,a)){const r=n.indexOf(i);if(r>-1)return t.replaceStringByString(e,s,n,i,a,r)}}else if(i instanceof RegExp&&r(e,n,a)){const r=[];let o=-1;for(let e=i.exec(n),t=0;null!=e;e=i.exec(n),t++){const t=e.index;if(t===o)break;r.push([t,e[0]]),o=t}return t.replaceStringByStringUsingRegex(e,s,n,i,a,r)}return s}},replace}function requireNativeIastTaintTracking(){if(hasRequiredNativeIastTaintTracking)return nativeIastTaintTracking;let e;hasRequiredNativeIastTaintTracking=1;try{e=requireNodeGypBuild()(__dirname)}catch(t){e={createTransaction:e=>e,newTaintedString:(e,t)=>t,newTaintedObject:(e,t)=>t,addSecureMarksToTaintedString:(e,t)=>t,isTainted:()=>!1,getMetrics(){},getRanges(){},removeTransaction(){},setMaxTransactions(){},replace:(e,t)=>t,concat:(e,t)=>t,trim:(e,t)=>t,trimEnd:(e,t)=>t,slice:(e,t)=>t,substring:(e,t)=>t,substr:(e,t)=>t}}const t={newTaintedString:e.newTaintedString,newTaintedObject:e.newTaintedObject,addSecureMarksToTaintedString:e.addSecureMarksToTaintedString,isTainted:e.isTainted,getMetrics:e.getMetrics,getRanges:e.getRanges,createTransaction:e.createTransaction,removeTransaction:e.removeTransaction,setMaxTransactions:e.setMaxTransactions,replace:requireReplace()(e),concat:e.concat,trim:e.trim,trimEnd:e.trimEnd,slice:e.slice,substring:e.substring,substr:e.substr};return nativeIastTaintTracking=t}function requireOperationsTaintObject(){if(hasRequiredOperationsTaintObject)return operationsTaintObject;hasRequiredOperationsTaintObject=1;const e=requireNativeIastTaintTracking(),{IAST_TRANSACTION_ID:t}=requireIastContext(),r=requireIastLog();return operationsTaintObject={taintObject:function(s,n,i,a,o){let c=n;const u=s?.[t];if(u){const t=[{parent:null,property:null,value:n}],s=new WeakSet;for(;t.length>0;){const{parent:n,property:l,value:p,key:d}=t.pop();if(null!==p)try{if("string"==typeof p){const t=e.newTaintedString(u,p,l,i);if(n)if(a&&d){n[e.newTaintedString(u,d,l,o)]=t}else n[d]=t;else c=t}else if("object"==typeof p&&!s.has(p)){s.add(p);for(const e of Object.keys(p))t.push({parent:p,property:l?`${l}.${e}`:e,value:p[e],key:e});if(n&&a&&d){n[e.newTaintedString(u,d,l,o)]=p}}}catch(e){r.error(`Error visiting property : ${l}`).errorAndPublish(e)}}}return c}},operationsTaintObject}function requireTaintTrackingImpl(){if(hasRequiredTaintTrackingImpl)return taintTrackingImpl;hasRequiredTaintTrackingImpl=1;const e=requireDcPolyfill(),t=requireNativeIastTaintTracking(),{storage:r}=requireDatadogCore(),s=requireIastContext(),n=requireIastLog(),{EXECUTED_PROPAGATION:i}=requireIastMetric(),{isDebugAllowed:a}=requireVerbosity(),{taintObject:o}=requireOperationsTaintObject(),c=e.channel("datadog:random:call"),u="json.value";function l(e){return e}const p={concat:l,parse:l,plusOperator:l,random:l,replace:l,slice:l,substr:l,substring:l,trim:l,trimEnd:l};function d(e){return e?.[s.IAST_TRANSACTION_ID]}function h(){const e=r.getStore();return s.getIastContext(e)}function f(){const e=h();return i.inc(null,e),e}function g(){return Array.prototype.some.call(arguments,(e=>"string"!=typeof e))}function m(e,t,...r){let s;if(r&&0!==r.length)if(1===r.length){const e=r[0];s=(t,r,s)=>g(t,s)||r!==e}else s=(e,t,s)=>g(e,s)||!function(e,t){return t.some((t=>e===t))}(t,r);else s=(e,t,r)=>g(e,r);return function(e,t,r){return function(s,i,a,...o){try{if(t(s,i,a))return s;const n=d(r());if(n)return e(n,s,a,...o)}catch(e){n.error(`Error invoking CSI ${a}`).errorAndPublish(e)}return s}}(e,s,t)}function _(e,r,s){const n={};return e.forEach((e=>{-1===r.indexOf(e)&&(n[e]=m(((r,s,n,...i)=>t[e](r,s,n,...i)),s,String.prototype[e]))})),n}function b(e){const r=Object.keys(p),s=function(e){return{plusOperator:function(r,s,i){try{if(g(r)||g(s)&&g(i))return r;const n=d(e());if(n)return t.concat(n,r,s,i)}catch(e){n.error("Error invoking CSI plusOperator").errorAndPublish(e)}return r},trim:m(((e,r,s)=>t.trim(e,r,s)),e,String.prototype.trim,String.prototype.trimStart),random:function(e,t){return c.hasSubscribers&&c.publish({fn:t}),e},parse:function(r,s,i,a){if(s===JSON.parse)try{const s=e(),n=d(s);if(n){const e=t.getRanges(n,a);if(e?.length>0){const t=e.find((e=>e.iinfo?.type));r=o(s,r,t?.iinfo.type||u)}}}catch(e){n.error(e)}return r}}}(e);return{..._(r,Object.keys(s),e),...s}}function y(e,t=!1){return t?p:a(e)?b(f):b(h)}return taintTrackingImpl={getTaintTrackingImpl:y,getTaintTrackingNoop:function(){return y(null,!0)}}}function requireOperations(){if(hasRequiredOperations)return operations;hasRequiredOperations=1;const e=requireNativeIastTaintTracking(),{IAST_TRANSACTION_ID:t}=requireIastContext(),r=requireTelemetry(),{REQUEST_TAINTED:s}=requireIastMetric(),{isInfoAllowed:n}=requireVerbosity(),{getTaintTrackingImpl:i,getTaintTrackingNoop:a}=requireTaintTrackingImpl(),{taintObject:o}=requireOperationsTaintObject();let c=(e,t)=>{};function u(t,n){const i=e.getMetrics(t,r.verbosity);i?.requestCount&&s.add(i.requestCount,null,n)}return operations={addSecureMark:function(r,s,n){const i=r?.[t];return i?e.addSecureMarksToTaintedString(i,s,n):s},createTransaction:function(r,s){r&&s&&(s[t]=e.createTransaction(r))},removeTransaction:function(r){const s=r?.[t];s&&(c(s,r),e.removeTransaction(s),delete r[t])},newTaintedString:function(r,s,n,i){let a;const o=r?.[t];return a=o?e.newTaintedString(o,s,n,i):s,a},newTaintedObject:function(r,s,n,i){let a;const o=r?.[t];return a=o?e.newTaintedObject(o,s,n,i):s,a},taintObject:o,isTainted:function(r,s){let n;const i=r?.[t];return n=!!i&&e.isTainted(i,s),n},getRanges:function(r,s){let n;const i=r?.[t];return n=i?e.getRanges(i,s):[],n},enableTaintOperations:function(e){n(e)&&(c=u),commonjsGlobal._ddiast=i(e)},disableTaintOperations:function(){commonjsGlobal._ddiast=a()},setMaxTransactions:function(t){t&&e.setMaxTransactions(t)},IAST_TRANSACTION_ID:t},operations}function requireInjectionAnalyzer(){if(hasRequiredInjectionAnalyzer)return injectionAnalyzer;hasRequiredInjectionAnalyzer=1;const e=requireVulnerabilityAnalyzer(),{isTainted:t,getRanges:r}=requireOperations();return injectionAnalyzer=class extends e{_isVulnerable(e,r){return!!e&&t(r,e)}_getEvidence(e,t){return{value:e,ranges:r(t,e)}}},injectionAnalyzer}function requireCommandInjectionAnalyzer(){if(hasRequiredCommandInjectionAnalyzer)return commandInjectionAnalyzer;hasRequiredCommandInjectionAnalyzer=1;const e=requireInjectionAnalyzer(),{COMMAND_INJECTION:t}=requireVulnerabilities();return commandInjectionAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("tracing:datadog:child_process:execution:start",(({command:e})=>this.analyze(e)))}}}function requireHardcodedSecretsRules(){return hasRequiredHardcodedSecretsRules?hardcodedSecretsRules:(hasRequiredHardcodedSecretsRules=1,hardcodedSecretsRules=[{id:"adobe-client-secret",regex:/\b((p8e-)[a-z0-9]{32})(?:['"\s\x60;]|$)/i},{id:"age-secret-key",regex:/AGE-SECRET-KEY-1[QPZRY9X8GF2TVDW0S3JN54KHCE6MUA7L]{58}/},{id:"alibaba-access-key-id",regex:/\b((LTAI)[a-z0-9]{20})(?:['"\s\x60;]|$)/i},{id:"authress-service-client-access-key",regex:/\b((?:sc|ext|scauth|authress)_[a-z0-9]{5,30}\.[a-z0-9]{4,6}\.acc[_-][a-z0-9-]{10,32}\.[a-z0-9+/_=-]{30,120})(?:['"\s\x60;]|$)/i},{id:"aws-access-token",regex:/\b((A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16})(?:['"\s\x60;]|$)/},{id:"clojars-api-token",regex:/(CLOJARS_)[a-z0-9]{60}/i},{id:"databricks-api-token",regex:/\b(dapi[a-h0-9]{32})(?:['"\s\x60;]|$)/i},{id:"digitalocean-access-token",regex:/\b(doo_v1_[a-f0-9]{64})(?:['"\s\x60;]|$)/i},{id:"digitalocean-pat",regex:/\b(dop_v1_[a-f0-9]{64})(?:['"\s\x60;]|$)/i},{id:"digitalocean-refresh-token",regex:/\b(dor_v1_[a-f0-9]{64})(?:['"\s\x60;]|$)/i},{id:"doppler-api-token",regex:/(dp\.pt\.)[a-z0-9]{43}/i},{id:"duffel-api-token",regex:/duffel_(test|live)_[a-z0-9_\-=]{43}/i},{id:"dynatrace-api-token",regex:/dt0c01\.[a-z0-9]{24}\.[a-z0-9]{64}/i},{id:"easypost-api-token",regex:/\bEZAK[a-z0-9]{54}/i},{id:"flutterwave-public-key",regex:/FLWPUBK_TEST-[a-h0-9]{32}-X/i},{id:"frameio-api-token",regex:/fio-u-[a-z0-9\-_=]{64}/i},{id:"gcp-api-key",regex:/\b(AIza[0-9a-z\-_]{35})(?:['"\s\x60;]|$)/i},{id:"github-app-token",regex:/(ghu|ghs)_[0-9a-zA-Z]{36}/},{id:"github-fine-grained-pat",regex:/github_pat_[0-9a-zA-Z_]{82}/},{id:"github-oauth",regex:/gho_[0-9a-zA-Z]{36}/},{id:"github-pat",regex:/ghp_[0-9a-zA-Z]{36}/},{id:"gitlab-pat",regex:/glpat-[0-9a-zA-Z\-_]{20}/},{id:"gitlab-ptt",regex:/glptt-[0-9a-f]{40}/},{id:"gitlab-rrt",regex:/GR1348941[0-9a-zA-Z\-_]{20}/},{id:"grafana-api-key",regex:/\b(eyJrIjoi[a-z0-9]{70,400}={0,2})(?:['"\s\x60;]|$)/i},{id:"grafana-cloud-api-token",regex:/\b(glc_[a-z0-9+/]{32,400}={0,2})(?:['"\s\x60;]|$)/i},{id:"grafana-service-account-token",regex:/\b(glsa_[a-z0-9]{32}_[a-f0-9]{8})(?:['"\s\x60;]|$)/i},{id:"hashicorp-tf-api-token",regex:/[a-z0-9]{14}\.atlasv1\.[a-z0-9\-_=]{60,70}/i},{id:"jwt",regex:/\b(ey[a-zA-Z0-9]{17,}\.ey[a-zA-Z0-9/_-]{17,}\.(?:[a-zA-Z0-9/_-]{10,}={0,2})?)(?:['"\s\x60;]|$)/},{id:"linear-api-key",regex:/lin_api_[a-z0-9]{40}/i},{id:"npm-access-token",regex:/\b(npm_[a-z0-9]{36})(?:['"\s\x60;]|$)/i},{id:"openai-api-key",regex:/\b(sk-[a-z0-9]{20}T3BlbkFJ[a-z0-9]{20})(?:['"\s\x60;]|$)/i},{id:"planetscale-api-token",regex:/\b(pscale_tkn_[a-z0-9=\-_.]{32,64})(?:['"\s\x60;]|$)/i},{id:"planetscale-oauth-token",regex:/\b(pscale_oauth_[a-z0-9=\-_.]{32,64})(?:['"\s\x60;]|$)/i},{id:"planetscale-password",regex:/\b(pscale_pw_[a-z0-9=\-_.]{32,64})(?:['"\s\x60;]|$)/i},{id:"postman-api-token",regex:/\b(PMAK-[a-f0-9]{24}-[a-f0-9]{34})(?:['"\s\x60;]|$)/i},{id:"prefect-api-token",regex:/\b(pnu_[a-z0-9]{36})(?:['"\s\x60;]|$)/i},{id:"private-key",regex:/-----BEGIN[ A-Z0-9_-]{0,100}PRIVATE KEY( BLOCK)?-----[\s\S]*KEY( BLOCK)?----/i},{id:"pulumi-api-token",regex:/\b(pul-[a-f0-9]{40})(?:['"\s\x60;]|$)/i},{id:"pypi-upload-token",regex:/pypi-AgEIcHlwaS5vcmc[A-Za-z0-9\-_]{50,1000}/},{id:"readme-api-token",regex:/\b(rdme_[a-z0-9]{70})(?:['"\s\x60;]|$)/i},{id:"rubygems-api-token",regex:/\b(rubygems_[a-f0-9]{48})(?:['"\s\x60;]|$)/i},{id:"scalingo-api-token",regex:/tk-us-[a-zA-Z0-9-_]{48}/},{id:"sendgrid-api-token",regex:/\b(SG\.[a-z0-9=_\-.]{66})(?:['"\s\x60;]|$)/i},{id:"sendinblue-api-token",regex:/\b(xkeysib-[a-f0-9]{64}-[a-z0-9]{16})(?:['"\s\x60;]|$)/i},{id:"shippo-api-token",regex:/\b(shippo_(live|test)_[a-f0-9]{40})(?:['"\s\x60;]|$)/i},{id:"shopify-access-token",regex:/shpat_[a-fA-F0-9]{32}/},{id:"shopify-custom-access-token",regex:/shpca_[a-fA-F0-9]{32}/},{id:"shopify-private-app-access-token",regex:/shppa_[a-fA-F0-9]{32}/},{id:"shopify-shared-secret",regex:/shpss_[a-fA-F0-9]{32}/},{id:"slack-app-token",regex:/(xapp-\d-[A-Z0-9]+-\d+-[a-z0-9]+)/i},{id:"slack-bot-token",regex:/(xoxb-[0-9]{10,13}-[0-9]{10,13}[a-zA-Z0-9-]*)/},{id:"slack-config-access-token",regex:/(xoxe.xox[bp]-\d-[A-Z0-9]{163,166})/i},{id:"slack-config-refresh-token",regex:/(xoxe-\d-[A-Z0-9]{146})/i},{id:"slack-legacy-bot-token",regex:/(xoxb-[0-9]{8,14}-[a-zA-Z0-9]{18,26})/},{id:"slack-legacy-token",regex:/(xox[os]-\d+-\d+-\d+-[a-fA-F\d]+)/},{id:"slack-legacy-workspace-token",regex:/(xox[ar]-(?:\d-)?[0-9a-zA-Z]{8,48})/},{id:"slack-user-token",regex:/(xox[pe](?:-[0-9]{10,13}){3}-[a-zA-Z0-9-]{28,34})/},{id:"slack-webhook-url",regex:/(https?:\/\/)?hooks.slack.com\/(services|workflows)\/[A-Za-z0-9+/]{43,46}/},{id:"square-access-token",regex:/\b(sq0atp-[0-9a-z\-_]{22})(?:['"\s\x60;]|$)/i},{id:"square-secret",regex:/\b(sq0csp-[0-9a-z\-_]{43})(?:['"\s\x60;]|$)/i},{id:"stripe-access-token",regex:/(sk|pk)_(test|live)_[0-9a-z]{10,32}/i},{id:"telegram-bot-api-token",regex:/(?:^|[^0-9])([0-9]{5,16}:A[a-z0-9_-]{34})(?:$|[^a-z0-9_-])/i},{id:"twilio-api-key",regex:/SK[0-9a-fA-F]{32}/},{id:"vault-batch-token",regex:/\b(hvb\.[a-z0-9_-]{138,212})(?:['"\s\x60;]|$)/i},{id:"vault-service-token",regex:/\b(hvs\.[a-z0-9_-]{90,100})(?:['"\s\x60;]|$)/i}])}function requireHardcodedSecretAnalyzer(){if(hasRequiredHardcodedSecretAnalyzer)return hardcodedSecretAnalyzer;hasRequiredHardcodedSecretAnalyzer=1;const e=requireVulnerabilityAnalyzer(),{HARDCODED_SECRET:t}=requireVulnerabilities(),{getRelativePath:r}=requirePathLine(),s=requireHardcodedSecretsRules();return hardcodedSecretAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("datadog:secrets:result",(e=>{this.analyze(e)}))}analyze(e){if(!e?.file||!e.literals)return;const t=e.literals.filter((e=>e.value&&e.locations?.length)).map((e=>{const t=s.find((t=>e.value.match(t.regex)));return t?{locations:e.locations,ruleId:t.id}:void 0})).filter((e=>!!e));if(t.length){const s=r(e.file);t.forEach((e=>{e.locations.filter((e=>e.line)).forEach((t=>this._report({file:s,line:t.line,column:t.column,data:e.ruleId})))}))}}_getEvidence(e){return{value:`${e.data}`}}_getLocation(e){return{path:e.file,line:e.line,column:e.column,isInternal:!1}}},hardcodedSecretAnalyzer}function requireSourceTypes(){return hasRequiredSourceTypes?sourceTypes:(hasRequiredSourceTypes=1,sourceTypes={HTTP_REQUEST_BODY:"http.request.body",HTTP_REQUEST_COOKIE_VALUE:"http.request.cookie.value",HTTP_REQUEST_COOKIE_NAME:"http.request.cookie.name",HTTP_REQUEST_HEADER_NAME:"http.request.header.name",HTTP_REQUEST_HEADER_VALUE:"http.request.header",HTTP_REQUEST_PARAMETER:"http.request.parameter",HTTP_REQUEST_PATH:"http.request.path",HTTP_REQUEST_PATH_PARAM:"http.request.path.parameter",HTTP_REQUEST_URI:"http.request.uri",KAFKA_MESSAGE_KEY:"kafka.message.key",KAFKA_MESSAGE_VALUE:"kafka.message.value"})}function requireHeaderInjectionAnalyzer(){if(hasRequiredHeaderInjectionAnalyzer)return headerInjectionAnalyzer;hasRequiredHeaderInjectionAnalyzer=1;const e=requireInjectionAnalyzer(),{HEADER_INJECTION:t}=requireVulnerabilities(),{getNodeModulesPaths:r}=requirePathLine(),{HEADER_NAME_VALUE_SEPARATOR:s}=requireConstants(),{getRanges:n}=requireOperations(),{HTTP_REQUEST_COOKIE_NAME:i,HTTP_REQUEST_COOKIE_VALUE:a,HTTP_REQUEST_HEADER_VALUE:o}=requireSourceTypes(),c=r("express"),u=["location","sec-websocket-location","sec-websocket-accept","upgrade","connection"];return headerInjectionAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("datadog:http:server:response:set-header:finish",(({name:e,value:t})=>{if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];this.analyze({name:e,value:s})}else this.analyze({name:e,value:t})}))}_isVulnerable({name:e,value:t},r){const s=e?.trim().toLowerCase();if(this.isExcludedHeaderName(s)||"string"!=typeof t)return;const i=n(r,t);return i?.length>0&&!(this.isCookieExclusion(s,i)||this.isSameHeaderExclusion(s,i)||this.isAccessControlAllowExclusion(s,i))}_getEvidence(e,t){const r=e.name+s,n=r.length,i=super._getEvidence(e.value,t);return i.value=r+i.value,i.ranges=i.ranges.map((e=>({...e,start:e.start+n,end:e.end+n}))),i}isExcludedHeaderName(e){return u.includes(e)}isCookieExclusion(e,t){return"set-cookie"===e&&t.every((e=>e.iinfo.type===a||e.iinfo.type===i))}isAccessControlAllowExclusion(e,t){return!!e?.startsWith("access-control-allow-")&&t.every((e=>e.iinfo.type===o))}isSameHeaderExclusion(e,t){return 1===t.length&&e===t[0].iinfo.parameterName?.toLowerCase()}_getExcludedPaths(){return c}},headerInjectionAnalyzer}function requireMissingHeaderAnalyzer(){if(hasRequiredMissingHeaderAnalyzer)return missingHeaderAnalyzer;hasRequiredMissingHeaderAnalyzer=1;const e=requireVulnerabilityAnalyzer(),t=[301,302,304,307,404,410,500],r=["text/html","application/xhtml+xml"];return missingHeaderAnalyzer={MissingHeaderAnalyzer:class extends e{constructor(e,t){super(e),this.headerName=t}onConfigure(){this.addSub({channelName:"datadog:iast:response-end",moduleName:"http"},(e=>this.analyze(e)))}_getHeaderValues(e,t){const r=e.getHeader(t);return Array.isArray(r)?r:r?[r.toString()]:[]}_getLocation(){}_checkOCE(e){return!0}_createHashSource(e,t,r){return`${e}:${this.config.tracerConfig.service}`}_getEvidence({res:e}){const t=this._getHeaderValues(e,this.headerName);let r;return 1===t.length?r=t[0]:t.length>0&&(r=JSON.stringify(t)),{value:r}}_isVulnerable({req:e,res:r},s){return!(t.includes(r.statusCode)||!this._isResponseHtml(r))&&this._isVulnerableFromRequestAndResponse(e,r)}_isVulnerableFromRequestAndResponse(e,t){return!1}_isResponseHtml(e){return this._getHeaderValues(e,"content-type").some((e=>e&&r.some((t=>t===e||e.startsWith(t+";")))))}}}}function requireHstsHeaderMissingAnalyzer(){if(hasRequiredHstsHeaderMissingAnalyzer)return hstsHeaderMissingAnalyzer;hasRequiredHstsHeaderMissingAnalyzer=1;const{HSTS_HEADER_MISSING:e}=requireVulnerabilities(),{MissingHeaderAnalyzer:t}=requireMissingHeaderAnalyzer(),r="Strict-Transport-Security",s="max-age";return hstsHeaderMissingAnalyzer=new class extends t{constructor(){super(e,r)}_isVulnerableFromRequestAndResponse(e,t){const s=this._getHeaderValues(t,r);return this._isHttpsProtocol(e)&&(0===s.length||s.some((e=>!this._isHeaderValid(e))))}_isHeaderValid(e){if(!e)return!1;if(!(e=e.trim()).startsWith(s))return!1;const t=e.indexOf(";");let r;r=t>-1?e.substring(8,t):e.substring(8);const n=parseInt(r);return n==r&&n>0}_isHttpsProtocol(e){return"https"===e.protocol||"https"===e.headers["x-forwarded-proto"]}}}function requireCookieAnalyzer(){if(hasRequiredCookieAnalyzer)return cookieAnalyzer;hasRequiredCookieAnalyzer=1;const e=requireVulnerabilityAnalyzer(),{getNodeModulesPaths:t}=requirePathLine(),r=t("express/lib/response.js");return cookieAnalyzer=class extends e{constructor(e,t){super(e),this.propertyToBeSafe=t.toLowerCase()}onConfigure(){this.addSub({channelName:"datadog:iast:set-cookie",moduleName:"http"},(e=>this.analyze(e)))}_isVulnerable({cookieProperties:e,cookieValue:t}){return t&&!(e&&e.map((e=>e.toLowerCase().trim())).includes(this.propertyToBeSafe))}_getEvidence({cookieName:e}){return{value:e}}_createHashSource(e,t,r){return`${e}:${t.value}`}_getExcludedPaths(){return r}_checkOCE(e,t){return!(!t||!t.location)||super._checkOCE(e,t)}_getLocation(e){if(!e)return super._getLocation();if(e.location)return e.location;const t=super._getLocation(e);return e.location=t,t}},cookieAnalyzer}function requireInsecureCookieAnalyzer(){if(hasRequiredInsecureCookieAnalyzer)return insecureCookieAnalyzer;hasRequiredInsecureCookieAnalyzer=1;const{INSECURE_COOKIE:e}=requireVulnerabilities(),t=requireCookieAnalyzer();return insecureCookieAnalyzer=new class extends t{constructor(){super(e,"secure")}}}function requireLdapInjectionAnalyzer(){if(hasRequiredLdapInjectionAnalyzer)return ldapInjectionAnalyzer;hasRequiredLdapInjectionAnalyzer=1;const e=requireInjectionAnalyzer(),{LDAP_INJECTION:t}=requireVulnerabilities(),{getNodeModulesPaths:r}=requirePathLine(),s=r("ldapjs-promise");return ldapInjectionAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("datadog:ldapjs:client:search",(({base:e,filter:t})=>this.analyzeAll(e,t)))}_getExcludedPaths(){return s}},ldapInjectionAnalyzer}function requireNoHttponlyCookieAnalyzer(){if(hasRequiredNoHttponlyCookieAnalyzer)return noHttponlyCookieAnalyzer;hasRequiredNoHttponlyCookieAnalyzer=1;const{NO_HTTPONLY_COOKIE:e}=requireVulnerabilities(),t=requireCookieAnalyzer();return noHttponlyCookieAnalyzer=new class extends t{constructor(){super(e,"HttpOnly")}}}function requireNoSamesiteCookieAnalyzer(){if(hasRequiredNoSamesiteCookieAnalyzer)return noSamesiteCookieAnalyzer;hasRequiredNoSamesiteCookieAnalyzer=1;const{NO_SAMESITE_COOKIE:e}=requireVulnerabilities(),t=requireCookieAnalyzer();return noSamesiteCookieAnalyzer=new class extends t{constructor(){super(e,"SameSite=strict")}}}wasm_iast_rewriter.exports;var nosqlInjectionMongodbAnalyzer={exports:{}},secureMarksGenerator,hasRequiredSecureMarksGenerator,hasRequiredNosqlInjectionMongodbAnalyzer,pathTraversalAnalyzer,hasRequiredPathTraversalAnalyzer,sqlInjectionAnalyzer,hasRequiredSqlInjectionAnalyzer,ssrfAnalyzer,hasRequiredSsrfAnalyzer,unvalidatedRedirectAnalyzer,hasRequiredUnvalidatedRedirectAnalyzer,weakCipherAnalyzer,hasRequiredWeakCipherAnalyzer,weakHashAnalyzer,hasRequiredWeakHashAnalyzer,weakRandomnessAnalyzer,hasRequiredWeakRandomnessAnalyzer,xcontenttypeHeaderMissingAnalyzer,hasRequiredXcontenttypeHeaderMissingAnalyzer,analyzers,hasRequiredAnalyzers$1,setCookiesHeaderInterceptor,hasRequiredSetCookiesHeaderInterceptor,analyzers_1,hasRequiredAnalyzers,plugin,hasRequiredPlugin,kafka,hasRequiredKafka,contextPlugin,hasRequiredContextPlugin,kafkaCtxPlugin,hasRequiredKafkaCtxPlugin,taintTracking,hasRequiredTaintTracking,iast,hasRequiredIast,proxy,hasRequiredProxy,src,hasRequiredSrc,ddTrace$1,hasRequiredDdTrace;function requireSecureMarksGenerator(){if(hasRequiredSecureMarksGenerator)return secureMarksGenerator;hasRequiredSecureMarksGenerator=1;let e=0;return secureMarksGenerator={getNextSecureMark:function(){return 1<<e++},reset:function(){e=0}}}function requireNosqlInjectionMongodbAnalyzer(){if(hasRequiredNosqlInjectionMongodbAnalyzer)return nosqlInjectionMongodbAnalyzer.exports;hasRequiredNosqlInjectionMongodbAnalyzer=1;const e=requireInjectionAnalyzer(),{NOSQL_MONGODB_INJECTION:t}=requireVulnerabilities(),{getRanges:r,addSecureMark:s}=requireOperations(),{getNodeModulesPaths:n}=requirePathLine(),{getNextSecureMark:i}=requireSecureMarksGenerator(),{storage:a}=requireDatadogCore(),{getIastContext:o}=requireIastContext(),{HTTP_REQUEST_PARAMETER:c,HTTP_REQUEST_BODY:u}=requireSourceTypes(),l=n("mongodb","mongoose","mquery"),p=i();function d(e,t,r=[],s=50,n=new Set){e&&"object"==typeof e&&Object.keys(e).forEach((i=>{const a=[...r,i],o=e[i];"string"==typeof o?t(o,a,e,i):s>0&&!n.has(o)&&(d(o,t,a,s-1,n),n.add(o))}))}return nosqlInjectionMongodbAnalyzer.exports=new class extends e{constructor(){super(t),this.sanitizedObjects=new WeakSet}onConfigure(){this.configureSanitizers();const e=({filters:e})=>{const t=a.getStore();return t&&!t.nosqlAnalyzed&&e?.length&&e.forEach((e=>{this.analyze({filter:e},t)})),t},t=t=>{const r=e(t||{});r&&a.enterWith({...r,nosqlAnalyzed:!0,nosqlParentStore:r})},r=()=>{const e=a.getStore();e?.nosqlParentStore&&a.enterWith(e.nosqlParentStore)};this.addSub("datadog:mongodb:collection:filter:start",e),this.addSub("datadog:mongoose:model:filter:start",t),this.addSub("datadog:mongoose:model:filter:finish",r),this.addSub("datadog:mquery:filter:prepare",e),this.addSub("tracing:datadog:mquery:filter:start",t),this.addSub("tracing:datadog:mquery:filter:asyncEnd",r)}configureSanitizers(){this.addNotSinkSub("datadog:express-mongo-sanitize:filter:finish",(({sanitizedProperties:e,req:t})=>{const r=a.getStore(),n=o(r);n&&e.forEach((e=>{d(t[e],(function(r,i){if("string"==typeof r){let a=t[e];const o=i.length;for(let e=0;e<o;e++){const t=i[e];e===o-1?a[t]=s(n,r,p):a=a[t]}}}))}))})),this.addNotSinkSub("datadog:express-mongo-sanitize:sanitize:finish",(({sanitizedObject:e})=>{const t=a.getStore(),r=o(t);r&&d(e,(function(e,t,n,i){try{n[i]=s(r,e,p)}catch{}}))})),this.addNotSinkSub("datadog:mongoose:sanitize-filter:finish",(({sanitizedObject:e})=>{this.sanitizedObjects.add(e)}))}_isVulnerableRange(e){const t=e?.iinfo?.type;return(t===c||t===u)&&(e.secureMarks&p)!==p}_isVulnerable(e,t){if(e?.filter&&t){let s=!1;if(this.sanitizedObjects.has(e.filter))return!1;const n={},i=[];return d(e.filter,((e,a)=>{const o=r(t,e);if(o?.length){const e=[];for(const t of o)this._isVulnerableRange(t)&&(s=!0,e.push(t));e.length>0&&(n[a.join(".")]=e,i.push(...e))}}),[],4),s&&(e.rangesToApply=n,e.ranges=i),s}return!1}_getEvidence(e,t){return{value:e.filter,rangesToApply:e.rangesToApply,ranges:e.ranges}}_getExcludedPaths(){return l}},nosqlInjectionMongodbAnalyzer.exports.MONGODB_NOSQL_SECURE_MARK=p,nosqlInjectionMongodbAnalyzer.exports}function requirePathTraversalAnalyzer(){if(hasRequiredPathTraversalAnalyzer)return pathTraversalAnalyzer;hasRequiredPathTraversalAnalyzer=1;const e=require$$0$1,t=requireInjectionAnalyzer(),{getIastContext:r}=requireIastContext(),{storage:s}=requireDatadogCore(),{PATH_TRAVERSAL:n}=requireVulnerabilities(),i=["dir.close","close"];return pathTraversalAnalyzer=new class extends t{constructor(){super(n),this.exclusionList=[e.join("node_modules","send")+e.sep],this.internalExclusionList=["node:fs","node:internal/fs","node:internal\\fs","fs.js","internal/fs","internal\\fs"]}onConfigure(){this.addSub("apm:fs:operation:start",(e=>{if(i.includes(e.operation))return;const t=[];e.dest&&t.push(e.dest),e.existingPath&&t.push(e.existingPath),e.file&&t.push(e.file),e.newPath&&t.push(e.newPath),e.oldPath&&t.push(e.oldPath),e.path&&t.push(e.path),e.prefix&&t.push(e.prefix),e.src&&t.push(e.src),e.target&&t.push(e.target),this.analyze(t)}))}_isExcluded(e){let t=!0;return e&&e.path&&(t=e.isInternal?this.internalExclusionList.some((t=>e.path.includes(t))):this.exclusionList.some((t=>e.path.includes(t)))),t}analyze(e){const t=r(s.getStore());if(t&&e&&e.constructor===Array)for(const r of e)if(this._isVulnerable(r,t)&&this._checkOCE(t)){this._report(r,t);break}}},pathTraversalAnalyzer}function requireSqlInjectionAnalyzer(){if(hasRequiredSqlInjectionAnalyzer)return sqlInjectionAnalyzer;hasRequiredSqlInjectionAnalyzer=1;const e=requireInjectionAnalyzer(),{SQL_INJECTION:t}=requireVulnerabilities(),{getRanges:r}=requireOperations(),{storage:s}=requireDatadogCore(),{getNodeModulesPaths:n}=requirePathLine(),i=n("mysql","mysql2","sequelize","pg-pool","knex");return sqlInjectionAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("apm:mysql:query:start",(({sql:e})=>this.analyze(e,void 0,"MYSQL"))),this.addSub("apm:mysql2:query:start",(({sql:e})=>this.analyze(e,void 0,"MYSQL"))),this.addSub("apm:pg:query:start",(({query:e})=>this.analyze(e.text,void 0,"POSTGRES"))),this.addSub("datadog:sequelize:query:start",(({sql:e,dialect:t})=>this.getStoreAndAnalyze(e,t.toUpperCase()))),this.addSub("datadog:sequelize:query:finish",(()=>this.returnToParentStore())),this.addSub("datadog:pg:pool:query:start",(({query:e})=>this.getStoreAndAnalyze(e.text,"POSTGRES"))),this.addSub("datadog:pg:pool:query:finish",(()=>this.returnToParentStore())),this.addSub("datadog:mysql:pool:query:start",(({sql:e})=>this.getStoreAndAnalyze(e,"MYSQL"))),this.addSub("datadog:mysql:pool:query:finish",(()=>this.returnToParentStore())),this.addSub("datadog:knex:raw:start",(({sql:e,dialect:t})=>{const r=this.normalizeKnexDialect(t);this.getStoreAndAnalyze(e,r)})),this.addSub("datadog:knex:raw:finish",(()=>this.returnToParentStore()))}getStoreAndAnalyze(e,t){const r=s.getStore();r&&(this.analyze(e,r,t),s.enterWith({...r,sqlAnalyzed:!0,sqlParentStore:r}))}returnToParentStore(){const e=s.getStore();e&&e.sqlParentStore&&s.enterWith(e.sqlParentStore)}_getEvidence(e,t,s){return{value:e,ranges:r(t,e),dialect:s}}analyze(e,t,r){(t=t||s.getStore())&&t.sqlAnalyzed||super.analyze(e,t,r)}_getExcludedPaths(){return i}normalizeKnexDialect(e){return"postgresql"===e?"POSTGRES":"sqlite3"===e?"SQLITE":"string"==typeof e?e.toUpperCase():void 0}},sqlInjectionAnalyzer}function requireSsrfAnalyzer(){if(hasRequiredSsrfAnalyzer)return ssrfAnalyzer;hasRequiredSsrfAnalyzer=1;const e=requireInjectionAnalyzer(),{SSRF:t}=requireVulnerabilities();return ssrfAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("apm:http:client:request:start",(({args:e})=>{"string"==typeof e.originalUrl?this.analyze(e.originalUrl):e.options&&e.options.host&&this.analyze(e.options.host)})),this.addSub("apm:http2:client:connect:start",(({authority:e})=>{e&&"string"==typeof e&&this.analyze(e)}))}}}function requireUnvalidatedRedirectAnalyzer(){if(hasRequiredUnvalidatedRedirectAnalyzer)return unvalidatedRedirectAnalyzer;hasRequiredUnvalidatedRedirectAnalyzer=1;const e=requireInjectionAnalyzer(),{UNVALIDATED_REDIRECT:t}=requireVulnerabilities(),{getNodeModulesPaths:r}=requirePathLine(),{getRanges:s}=requireOperations(),{HTTP_REQUEST_HEADER_VALUE:n,HTTP_REQUEST_PATH_PARAM:i,HTTP_REQUEST_URI:a}=requireSourceTypes(),o=r("express/lib/response.js");return unvalidatedRedirectAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("datadog:http:server:response:set-header:finish",(({name:e,value:t})=>this.analyze(e,t)))}analyze(e,t){this.isLocationHeader(e)&&"string"==typeof t&&super.analyze(t)}isLocationHeader(e){return e&&"location"===e.trim().toLowerCase()}_isVulnerable(e,t){if(!e)return!1;const r=s(t,e);return r&&r.length>0&&!this._areSafeRanges(r)}_areSafeRanges(e){return e&&e.every((e=>this._isPathParam(e)||this._isUrl(e)||this._isRefererHeader(e)))}_isRefererHeader(e){return e.iinfo.type===n&&e.iinfo.parameterName&&"referer"===e.iinfo.parameterName.toLowerCase()}_isPathParam(e){return e.iinfo.type===i}_isUrl(e){return e.iinfo.type===a}_getExcludedPaths(){return o}},unvalidatedRedirectAnalyzer}function requireWeakCipherAnalyzer(){if(hasRequiredWeakCipherAnalyzer)return weakCipherAnalyzer;hasRequiredWeakCipherAnalyzer=1;const e=requireVulnerabilityAnalyzer(),{WEAK_CIPHER:t}=requireVulnerabilities(),r=new Set(["des","des-cbc","des-cfb","des-cfb1","des-cfb8","des-ecb","des-ede","des-ede-cbc","des-ede-cfb","des-ede-ecb","des-ede-ofb","des-ede3","des-ede3-cbc","des-ede3-cfb","des-ede3-cfb1","des-ede3-cfb8","des-ede3-ecb","des-ede3-ofb","des-ofb","des3","des3-wrap","rc2","rc2-128","rc2-40","rc2-40-cbc","rc2-64","rc2-64-cbc","rc2-cbc","rc2-cfb","rc2-ecb","rc2-ofb","blowfish","rc4","rc4-40","rc4-hmac-md5"].map((e=>e.toLowerCase())));return weakCipherAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("datadog:crypto:cipher:start",(({algorithm:e})=>this.analyze(e)))}_isVulnerable(e){return!(!e||"string"!=typeof e)&&r.has(e.toLowerCase())}}}function requireWeakHashAnalyzer(){if(hasRequiredWeakHashAnalyzer)return weakHashAnalyzer;hasRequiredWeakHashAnalyzer=1;const e=require$$0$1,{getNodeModulesPaths:t}=requirePathLine(),r=requireVulnerabilityAnalyzer(),{WEAK_HASH:s}=requireVulnerabilities(),n=new Set(["md4","md4WithRSAEncryption","RSA-MD4","RSA-MD5","md5","md5-sha1","ssl3-md5","md5WithRSAEncryption","RSA-SHA1","RSA-SHA1-2","sha1","md5-sha1","sha1WithRSAEncryption","ssl3-sha1"].map((e=>e.toLowerCase()))),i=t("etag/index.js","@mikro-orm/core/utils/Utils.js","mongodb/lib/core/connection/connection.js","mysql2/lib/auth_41.js","pusher/lib/utils.js","redlock/dist/cjs","sqreen/lib/package-reader/index.js","ws/lib/websocket-server.js"),a=[e.join("node_modules","object-hash",e.sep)];return weakHashAnalyzer=new class extends r{constructor(){super(s)}onConfigure(){this.addSub("datadog:crypto:hashing:start",(({algorithm:e})=>this.analyze(e)))}_isVulnerable(e){return"string"==typeof e&&n.has(e.toLowerCase())}_isExcluded(e){return i.some((t=>e.path.includes(t)))}_getExcludedPaths(){return a}}}function requireWeakRandomnessAnalyzer(){if(hasRequiredWeakRandomnessAnalyzer)return weakRandomnessAnalyzer;hasRequiredWeakRandomnessAnalyzer=1;const e=requireVulnerabilityAnalyzer(),{WEAK_RANDOMNESS:t}=requireVulnerabilities();return weakRandomnessAnalyzer=new class extends e{constructor(){super(t)}onConfigure(){this.addSub("datadog:random:call",(({fn:e})=>this.analyze(e)))}_isVulnerable(e){return e===Math.random}}}function requireXcontenttypeHeaderMissingAnalyzer(){if(hasRequiredXcontenttypeHeaderMissingAnalyzer)return xcontenttypeHeaderMissingAnalyzer;hasRequiredXcontenttypeHeaderMissingAnalyzer=1;const{XCONTENTTYPE_HEADER_MISSING:e}=requireVulnerabilities(),{MissingHeaderAnalyzer:t}=requireMissingHeaderAnalyzer(),r="X-Content-Type-Options";return xcontenttypeHeaderMissingAnalyzer=new class extends t{constructor(){super(e,r)}_isVulnerableFromRequestAndResponse(e,t){const s=this._getHeaderValues(t,r);return 0===s.length||s.some((e=>"nosniff"!==e.trim().toLowerCase()))}}}function requireAnalyzers$1(){return hasRequiredAnalyzers$1?analyzers:(hasRequiredAnalyzers$1=1,analyzers={COMMAND_INJECTION_ANALYZER:requireCommandInjectionAnalyzer(),HARCODED_SECRET_ANALYZER:requireHardcodedSecretAnalyzer(),HEADER_INJECTION_ANALYZER:requireHeaderInjectionAnalyzer(),HSTS_HEADER_MISSING_ANALYZER:requireHstsHeaderMissingAnalyzer(),INSECURE_COOKIE_ANALYZER:requireInsecureCookieAnalyzer(),LDAP_ANALYZER:requireLdapInjectionAnalyzer(),NO_HTTPONLY_COOKIE_ANALYZER:requireNoHttponlyCookieAnalyzer(),NO_SAMESITE_COOKIE_ANALYZER:requireNoSamesiteCookieAnalyzer(),NOSQL_MONGODB_INJECTION:requireNosqlInjectionMongodbAnalyzer(),PATH_TRAVERSAL_ANALYZER:requirePathTraversalAnalyzer(),SQL_INJECTION_ANALYZER:requireSqlInjectionAnalyzer(),SSRF:requireSsrfAnalyzer(),UNVALIDATED_REDIRECT_ANALYZER:requireUnvalidatedRedirectAnalyzer(),WEAK_CIPHER_ANALYZER:requireWeakCipherAnalyzer(),WEAK_HASH_ANALYZER:requireWeakHashAnalyzer(),WEAK_RANDOMNESS_ANALYZER:requireWeakRandomnessAnalyzer(),XCONTENTTYPE_HEADER_MISSING_ANALYZER:requireXcontenttypeHeaderMissingAnalyzer()})}function requireSetCookiesHeaderInterceptor(){if(hasRequiredSetCookiesHeaderInterceptor)return setCookiesHeaderInterceptor;hasRequiredSetCookiesHeaderInterceptor=1;const e=requirePlugin$1(),{setCookieChannel:t}=requireChannels();return setCookiesHeaderInterceptor=new class extends e{constructor(){super(),this.cookiesInRequest=new WeakMap,this.addSub("datadog:http:server:response:set-header:finish",(({name:e,value:r,res:s})=>{if("set-cookie"===e.toLowerCase()){let e=r;"string"==typeof r&&(e=[r]);const n=this._getAlreadyCheckedCookiesInResponse(s);let i;e.forEach((e=>{if(!n.includes(e)){n.push(e);const r=this._parseCookie(e,i);t.publish(r),i=r.location}}))}}))}_parseCookie(e,t){const r=e.split(";"),s=r[0].split("=");return{cookieName:s[0],cookieValue:s.slice(1).join("="),cookieProperties:r.slice(1).map((e=>e.trim())),cookieString:e,location:t}}_getAlreadyCheckedCookiesInResponse(e){let t=this.cookiesInRequest.get(e);return t||(t=[],this.cookiesInRequest.set(e,t)),t}},setCookiesHeaderInterceptor}function requireAnalyzers(){if(hasRequiredAnalyzers)return analyzers_1;hasRequiredAnalyzers=1;const e=requireAnalyzers$1(),t=requireSetCookiesHeaderInterceptor();return analyzers_1={enableAllAnalyzers:function(r){t.configure({enabled:!0,tracerConfig:r});for(const t in e)e[t].configure({enabled:!0,tracerConfig:r})},disableAllAnalyzers:function(){t.configure(!1);for(const t in e)e[t].configure(!1)}}}function requirePlugin(){if(hasRequiredPlugin)return plugin;hasRequiredPlugin=1;const{SourceIastPlugin:e}=requireIastPlugin(),{getIastContext:t}=requireIastContext(),{storage:r}=requireDatadogCore(),{taintObject:s,newTaintedString:n,getRanges:i}=requireOperations(),{HTTP_REQUEST_BODY:a,HTTP_REQUEST_COOKIE_VALUE:o,HTTP_REQUEST_COOKIE_NAME:c,HTTP_REQUEST_HEADER_VALUE:u,HTTP_REQUEST_HEADER_NAME:l,HTTP_REQUEST_PARAMETER:p,HTTP_REQUEST_PATH_PARAM:d,HTTP_REQUEST_URI:h}=requireSourceTypes();return plugin=new class extends e{constructor(){super(),this._type="taint-tracking"}onConfigure(){this.addSub({channelName:"datadog:body-parser:read:finish",tag:a},(({req:e})=>{const s=t(r.getStore());s&&s.body!==e.body&&(this._taintTrackingHandler(a,e,"body",s),s.body=e.body)})),this.addSub({channelName:"datadog:qs:parse:finish",tag:p},(({qs:e})=>this._taintTrackingHandler(p,e))),this.addSub({channelName:"apm:express:middleware:next",tag:a},(({req:e})=>{if(e&&e.body&&"object"==typeof e.body){const s=t(r.getStore());s&&s.body!==e.body&&(this._taintTrackingHandler(a,e,"body",s),s.body=e.body)}})),this.addSub({channelName:"datadog:cookie:parse:finish",tag:[o,c]},(({cookies:e})=>this._cookiesTaintTrackingHandler(e))),this.addSub({channelName:"datadog:express:process_params:start",tag:d},(({req:e})=>{e&&e.params&&"object"==typeof e.params&&this._taintTrackingHandler(d,e,"params")})),this.addSub({channelName:"apm:graphql:resolve:start",tag:a},(e=>{const s=t(r.getStore()),n=e.context?.source,a=n&&i(s,n);a?.length&&this._taintTrackingHandler(a[0].iinfo.type,e.args,null,s)})),this.addInstrumentedSource("http",[u,l])}_taintTrackingHandler(e,n,i,a=t(r.getStore())){i?n[i]&&(n[i]=s(a,n[i],e)):s(a,n,e)}_cookiesTaintTrackingHandler(e){const n=t(r.getStore());s(n,e,o,!0,c)}taintHeaders(e,t){this.execSource({handler:()=>s(t,e,u,!0,l),tag:[u,l],iastContext:t})}taintUrl(e,t){this.execSource({handler:function(){e.url=n(t,e.url,h,h)},tag:[h],iastContext:t})}taintRequest(e,t){this.taintHeaders(e.headers,t),this.taintUrl(e,t)}},plugin}function requireKafka(){if(hasRequiredKafka)return kafka;hasRequiredKafka=1;const e=requireDatadogShimmer(),{storage:t}=requireDatadogCore(),{getIastContext:r}=requireIastContext(),{KAFKA_MESSAGE_KEY:s,KAFKA_MESSAGE_VALUE:n}=requireSourceTypes(),{newTaintedObject:i,newTaintedString:a}=requireOperations(),{SourceIastPlugin:o}=requireIastPlugin();return kafka=new class extends o{onConfigure(){this.addSub({channelName:"dd-trace:kafkajs:consumer:afterStart",tag:[s,n]},(({message:e})=>this.taintKafkaMessage(e)))}getToStringWrap(e,t,r){return function(){const s=e.apply(this,arguments);return a(t,s,void 0,r)}}taintKafkaMessage(a){const o=r(t.getStore());if(o&&a){const{key:t,value:r}=a;t&&"object"==typeof t&&(e.wrap(t,"toString",(e=>this.getToStringWrap(e,o,s))),i(o,t,void 0,s)),r&&"object"==typeof r&&(e.wrap(r,"toString",(e=>this.getToStringWrap(e,o,n))),i(o,r,void 0,n))}}},kafka}function requireContextPlugin(){if(hasRequiredContextPlugin)return contextPlugin;hasRequiredContextPlugin=1;const{storage:e}=requireDatadogCore(),t=requireIastContext(),r=requireOverheadController(),{IastPlugin:s}=requireIastPlugin(),{IAST_ENABLED_TAG_KEY:n}=requireTags(),{createTransaction:i,removeTransaction:a}=requireOperations(),o=requireVulnerabilityReporter(),{TagKey:c}=requireIastMetric();return contextPlugin=class extends s{startCtxOn(e,t){super.addSub(e,(e=>this.startContext())),this._getAndRegisterSubscription({channelName:e,tag:t,tagKey:c.SOURCE_TYPE})}finishCtxOn(e){super.addSub(e,(e=>this.finishContext()))}getRootSpan(e){return e?.span}getTopContext(){return{}}newIastContext(e){return{rootSpan:e}}addIastEnabledTag(e,t){t?.addTags&&t.addTags({[n]:e?1:0})}startContext(){let s,n=!1;const a=e.getStore();if(a){const e=this.getTopContext(),o=this.getRootSpan(a);n=r.acquireRequest(o),n&&(s=t.saveIastContext(a,e,this.newIastContext(o)),i(o.context().toSpanId(),s),r.initializeRequestContext(s)),this.addIastEnabledTag(n,o)}return{isRequestAcquired:n,iastContext:s,store:a}}finishContext(){const s=e.getStore();if(s){const e=this.getTopContext(),n=t.getIastContext(s,e),i=n?.rootSpan;n&&i&&(o.sendVulnerabilities(n.vulnerabilities,i),a(n)),t.cleanIastContext(s,e,n)&&r.releaseRequest()}}},contextPlugin}function requireKafkaCtxPlugin(){if(hasRequiredKafkaCtxPlugin)return kafkaCtxPlugin;hasRequiredKafkaCtxPlugin=1;const{KAFKA_MESSAGE_KEY:e,KAFKA_MESSAGE_VALUE:t}=requireSourceTypes(),r=requireContextPlugin();return kafkaCtxPlugin=new class extends r{onConfigure(){this.startCtxOn("dd-trace:kafkajs:consumer:afterStart",[e,t]),this.finishCtxOn("dd-trace:kafkajs:consumer:beforeFinish")}}}function requireTaintTracking(){if(hasRequiredTaintTracking)return taintTracking;hasRequiredTaintTracking=1;const{enableRewriter:e,disableRewriter:t}=requireRewriter(),{createTransaction:r,removeTransaction:s,setMaxTransactions:n,enableTaintOperations:i,disableTaintOperations:a}=requireOperations(),o=requirePlugin(),c=requireKafka(),u=requireKafkaCtxPlugin();return taintTracking={enableTaintTracking(t,r){e(r),i(r),o.enable(),u.enable(),c.enable(),n(t.maxConcurrentRequests)},disableTaintTracking(){t(),a(),o.disable(),u.disable(),c.disable()},setMaxTransactions:n,createTransaction:r,removeTransaction:s,taintTrackingPlugin:o},taintTracking}function requireIast(){if(hasRequiredIast)return iast;hasRequiredIast=1;const e=requireVulnerabilityReporter(),{enableAllAnalyzers:t,disableAllAnalyzers:r}=requireAnalyzers(),s=requireWeb(),{storage:n}=requireDatadogCore(),i=requireOverheadController(),a=requireDcPolyfill(),o=requireIastContext(),{enableTaintTracking:c,disableTaintTracking:u,createTransaction:l,removeTransaction:p,taintTrackingPlugin:d}=requireTaintTracking(),{IAST_ENABLED_TAG_KEY:h}=requireTags(),f=requireTelemetry(),g=a.channel("dd-trace:incomingHttpRequestStart"),m=a.channel("dd-trace:incomingHttpRequestEnd"),_=a.channel("datadog:iast:response-end");function b(e){if(e?.req){const t=n.getStore();if(t){const r=s.getContext(e.req);if(r){const s=r.span,n=i.acquireRequest(s);if(n){const n=o.saveIastContext(t,r,{rootSpan:s,req:e.req});l(s.context().toSpanId(),n),i.initializeRequestContext(n),f.onRequestStart(n),d.taintRequest(e.req,n)}s.addTags&&s.addTags({[h]:n?1:0})}}}}function y(t){if(t?.req){const r=n.getStore(),a=s.getContext(t.req),c=o.getIastContext(r,a);if(c?.rootSpan){_.publish(t);const r=c.vulnerabilities,s=c.rootSpan;e.sendVulnerabilities(r,s),p(c),f.onRequestEnd(c,c.rootSpan)}o.cleanIastContext(r,a,c)&&i.releaseRequest()}}return iast={enable:function(r,s){f.configure(r,r.iast?.telemetryVerbosity),t(r),c(r.iast,f.verbosity),g.subscribe(b),m.subscribe(y),i.configure(r.iast),i.startGlobalContext(),e.start(r,s)},disable:function(){f.stop(),r(),u(),i.finishGlobalContext(),g.hasSubscribers&&g.unsubscribe(b),m.hasSubscribers&&m.unsubscribe(y),e.stop()},onIncomingHttpRequestEnd:y,onIncomingHttpRequestStart:b},iast}function requireProxy(){if(hasRequiredProxy)return proxy;hasRequiredProxy=1;const e=requireProxy$1(),t=requireTracer(),r=requireConfig$1(),s=requireRuntime_metrics(),n=requireLog$2(),{setStartupLogPluginManager:i}=requireStartupLog(),a=requireTelemetry$2(),o=requirePlugin_manager(),c=requireRemote_config(),u=requireSdk(),l=requireDogstatsd(),p=requireSpanleak();return proxy=class extends e{constructor(){super(),this._initialized=!1,this._pluginManager=new o(this),this.dogstatsd=new l.NoopDogStatsDClient,this._tracingInitialized=!1}init(e){if(this._initialized)return this;this._initialized=!0;try{const t=new r(e);if(a.start(t,this._pluginManager),t.dogstatsd&&(this.dogstatsd=new l.CustomMetrics(t),setInterval((()=>{this.dogstatsd.flush()}),1e4).unref(),process.once("beforeExit",(()=>{this.dogstatsd.flush()}))),t.spanLeakDebug>0&&(t.spanLeakDebug===p.MODES.LOG?p.enableLogging():t.spanLeakDebug===p.MODES.GC_AND_LOG&&p.enableGarbageCollection(),p.startScrubber()),t.remoteConfig.enabled&&!t.isCiVisibility){c.enable(t).on("APM_TRACING",((e,r)=>{"unapply"===e?t.configure({},!0):t.configure(r.lib_config,!0),this._enableOrDisableTracing(t)}))}if((t.isGCPFunction||t.isAzureFunctionConsumptionPlan)&&requireServerless().maybeStartServerlessMiniAgent(t),t.profiling.enabled)try{const e=requireProfiler();this._profilerStarted=e.start(t)}catch(e){n.error(e)}if(this._profilerStarted||(this._profilerStarted=Promise.resolve(!1)),t.runtimeMetrics&&s.start(t),this._enableOrDisableTracing(t),t.tracing&&t.isManualApiEnabled){const e=requireTestApiManualPlugin();this._testApiManualPlugin=new e(this),this._testApiManualPlugin.configure({...t,enabled:!0})}}catch(e){n.error(e)}return this}_enableOrDisableTracing(e){!1!==e.tracing?(e.appsec.enabled&&requireAppsec().enable(e),this._tracingInitialized||(this._tracer=new t(e),this.appsec=new u(this._tracer,e),this._tracingInitialized=!0),e.iast.enabled&&requireIast().enable(e,this._tracer)):this._tracingInitialized&&(requireAppsec().disable(),requireIast().disable()),this._tracingInitialized&&(this._tracer.configure(e),this._pluginManager.configure(e),i(this._pluginManager))}profilerStarted(){if(!this._profilerStarted)throw new Error("profilerStarted() must be called after init()");return this._profilerStarted}use(){return this._pluginManager.configurePlugin(...arguments),this}get TracerProvider(){return requireTracer_provider()}},proxy}function requireSrc(){if(hasRequiredSrc)return src;hasRequiredSrc=1;const{isFalse:e}=requireUtil$9(),t="undefined"!=typeof jest;return src=e(process.env.DD_TRACE_ENABLED)||t?requireProxy$1():requireProxy()}function requireDdTrace(){if(hasRequiredDdTrace)return ddTrace$1;if(hasRequiredDdTrace=1,!commonjsGlobal._ddtrace){const e=requireSrc();Object.defineProperty(commonjsGlobal,"_ddtrace",{value:new e,enumerable:!1,configurable:!0,writable:!0}),commonjsGlobal._ddtrace.default=commonjsGlobal._ddtrace,commonjsGlobal._ddtrace.tracer=commonjsGlobal._ddtrace}return ddTrace$1=commonjsGlobal._ddtrace}var ddTrace=requireDdTrace(),tracer=getDefaultExportFromCjs(ddTrace);class DataDogClient{constructor(){tracer.init()}Count(e,t,r=1){tracer.dogstatsd.increment(e,r,t)}Histogram(e,t,r,s=1){tracer.dogstatsd.distribution(e,t,r)}Gauge(e,t,r,s=1){tracer.dogstatsd.gauge(e,t,r)}Summary(e,t,r,s=1){console.log("Summary is unsupported")}}var registry={exports:{}},util$5={};function fastHashObject(e,t){if(0===e.length)return"";let r="";for(let s=0;s<e.length;s++){const n=e[s],i=t[n];void 0!==i&&(r+=`${n}:${i},`)}return r}function hashObject$4(e,t){if(t)return fastHashObject(t,e);const r=Object.keys(e);return r.length>1&&r.sort(),fastHashObject(r,e)}util$5.getValueAsString=function(e){return Number.isNaN(e)?"Nan":Number.isFinite(e)?`${e}`:e<0?"-Inf":"+Inf"},util$5.removeLabels=function(e,t,r){delete e[hashObject$4(t,r)]},util$5.setValue=function(e,t,r){return e[hashObject$4(r)]={value:"number"==typeof t?t:0,labels:r||{}},e},util$5.setValueDelta=function(e,t,r,s=""){const n="number"==typeof t?t:0;return e[s]?e[s].value+=n:e[s]={value:n,labels:r},e},util$5.getLabels=function(e,t){if("object"==typeof t[0])return t[0];if(e.length!==t.length)throw new Error("Invalid number of arguments");const r={};for(let s=0;s<e.length;s++)r[e[s]]=t[s];return r},util$5.hashObject=hashObject$4,util$5.isObject=function(e){return null!==e&&"object"==typeof e},util$5.nowTimestamp=function(){return Date.now()/1e3};class Grouper extends Map{add(e,t){this.has(e)?this.get(e).push(t):this.set(e,[t])}}util$5.Grouper=Grouper;const{getValueAsString:getValueAsString}=util$5;let Registry$2=class e{static get PROMETHEUS_CONTENT_TYPE(){return"text/plain; version=0.0.4; charset=utf-8"}static get OPENMETRICS_CONTENT_TYPE(){return"application/openmetrics-text; version=1.0.0; charset=utf-8"}constructor(t=e.PROMETHEUS_CONTENT_TYPE){if(this._metrics={},this._collectors=[],this._defaultLabels={},t!==e.PROMETHEUS_CONTENT_TYPE&&t!==e.OPENMETRICS_CONTENT_TYPE)throw new TypeError(`Content type ${t} is unsupported`);this._contentType=t}getMetricsAsArray(){return Object.values(this._metrics)}async getMetricsAsString(t){const r="function"==typeof t.getForPromString?await t.getForPromString():await t.get(),s=escapeString(r.name),n=[`# HELP ${s} ${escapeString(r.help)}`,`# TYPE ${s} ${r.type}`],i=Object.keys(this._defaultLabels).length>0?this._defaultLabels:null,a=this.contentType===e.OPENMETRICS_CONTENT_TYPE;for(const e of r.values||[]){let{metricName:t=s,labels:o={}}=e;const{sharedLabels:c={}}=e;a&&"counter"===r.type&&(t=`${t}_total`),i&&(o={...o,...i,...o});const u=[...formatLabels(o,c),flattenSharedLabels(c)].filter(Boolean);let l=`${t}${u.length?`{${u.join(",")}}`:""} ${getValueAsString(e.value)}`;const{exemplar:p}=e;if(p&&a){l+=` # {${formatLabels(p.labelSet).join(",")}} ${getValueAsString(p.value)} ${p.timestamp}`}n.push(l)}return n.join("\n")}async metrics(){const t=this.contentType===e.OPENMETRICS_CONTENT_TYPE,r=this.getMetricsAsArray().map((e=>(t&&"counter"===e.type&&(e.name=standardizeCounterName(e.name)),this.getMetricsAsString(e)))),s=await Promise.all(r);return t?`${s.join("\n")}\n# EOF\n`:`${s.join("\n\n")}\n`}registerMetric(e){if(this._metrics[e.name]&&this._metrics[e.name]!==e)throw new Error(`A metric with the name ${e.name} has already been registered.`);this._metrics[e.name]=e}clear(){this._metrics={},this._defaultLabels={}}async getMetricsAsJSON(){const e=[],t=Object.keys(this._defaultLabels),r=[];for(const e of this.getMetricsAsArray())r.push(e.get());const s=await Promise.all(r);for(const r of s){if(r.values&&t.length>0)for(const e of r.values){e.labels=Object.assign({},e.labels);for(const r of t)e.labels[r]=e.labels[r]||this._defaultLabels[r]}e.push(r)}return e}removeSingleMetric(e){delete this._metrics[e]}getSingleMetricAsString(e){return this.getMetricsAsString(this._metrics[e])}getSingleMetric(e){return this._metrics[e]}setDefaultLabels(e){this._defaultLabels=e}resetMetrics(){for(const e in this._metrics)this._metrics[e].reset()}get contentType(){return this._contentType}setContentType(t){if(t!==e.OPENMETRICS_CONTENT_TYPE&&t!==e.PROMETHEUS_CONTENT_TYPE)throw new Error(`Content type ${t} is unsupported`);this._contentType=t}static merge(t){const r=t[0].contentType;for(const e of t)if(e.contentType!==r)throw new Error("Registers can only be merged if they have the same content type");const s=new e(r);return t.reduce(((e,t)=>e.concat(t.getMetricsAsArray())),[]).forEach(s.registerMetric,s),s}};function formatLabels(e,t){const{hasOwnProperty:r}=Object.prototype,s=[];for(const[n,i]of Object.entries(e))t&&r.call(t,n)||s.push(`${n}="${escapeLabelValue(i)}"`);return s}const sharedLabelCache=new WeakMap;function flattenSharedLabels(e){const t=sharedLabelCache.get(e);if(t)return t;const r=formatLabels(e).join(",");return sharedLabelCache.set(e,r),r}function escapeLabelValue(e){return"string"!=typeof e?e:escapeString(e).replace(/"/g,'\\"')}function escapeString(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n")}function standardizeCounterName(e){return e.replace(/_total$/,"")}registry.exports=Registry$2,registry.exports.globalRegistry=new Registry$2;var registryExports=registry.exports,validation={};const util$4=require$$0$3,metricRegexp=/^[a-zA-Z_:][a-zA-Z0-9_:]*$/,labelRegexp=/^[a-zA-Z_][a-zA-Z0-9_]*$/;validation.validateMetricName=function(e){return metricRegexp.test(e)},validation.validateLabelName=function(e=[]){return e.every((e=>labelRegexp.test(e)))},validation.validateLabel=function(e,t){for(const r in t)if(!e.includes(r))throw new Error(`Added label "${r}" is not included in initial labelset: ${util$4.inspect(e)}`)};const Registry$1=registryExports,{isObject:isObject$4}=util$5,{validateMetricName:validateMetricName,validateLabelName:validateLabelName}=validation;let Metric$4=class{constructor(e,t={}){if(!isObject$4(e))throw new TypeError("constructor expected a config object");if(Object.assign(this,{labelNames:[],registers:[Registry$1.globalRegistry],aggregator:"sum",enableExemplars:!1},t,e),this.registers||(this.registers=[Registry$1.globalRegistry]),!this.help)throw new Error("Missing mandatory help parameter");if(!this.name)throw new Error("Missing mandatory name parameter");if(!validateMetricName(this.name))throw new Error("Invalid metric name");if(!validateLabelName(this.labelNames))throw new Error("Invalid label name");if(this.collect&&"function"!=typeof this.collect)throw new Error('Optional "collect" parameter must be a function');this.labelNames?this.sortedLabelNames=[...this.labelNames].sort():this.sortedLabelNames=[],this.reset();for(const e of this.registers){if(this.enableExemplars&&e.contentType===Registry$1.PROMETHEUS_CONTENT_TYPE)throw new TypeError("Exemplars are supported only on OpenMetrics registries");e.registerMetric(this)}}reset(){}};var metric={Metric:Metric$4};let Exemplar$2=class{constructor(e={},t=null){this.labelSet=e,this.value=t}validateExemplarLabelSet(e){let t="";for(const[r,s]of Object.entries(e))t+=`${r}${s}`;if(t.length>128)throw new RangeError("Label set size must be smaller than 128 UTF-8 chars")}};var exemplar=Exemplar$2;const util$3=require$$0$3,{hashObject:hashObject$3,isObject:isObject$3,getLabels:getLabels$3,removeLabels:removeLabels$3,nowTimestamp:nowTimestamp$1}=util$5,{validateLabel:validateLabel$3}=validation,{Metric:Metric$3}=metric,Exemplar$1=exemplar;let Counter$2=class extends Metric$3{constructor(e){super(e),this.type="counter",this.defaultLabels={},this.defaultValue=1,this.defaultExemplarLabelSet={},e.enableExemplars?(this.enableExemplars=!0,this.inc=this.incWithExemplar):this.inc=this.incWithoutExemplar}incWithoutExemplar(e,t){let r="";if(isObject$3(e)?(r=hashObject$3(e,this.sortedLabelNames),validateLabel$3(this.labelNames,e)):(t=e,e={}),t&&!Number.isFinite(t))throw new TypeError(`Value is not a valid number: ${util$3.format(t)}`);if(t<0)throw new Error("It is not possible to decrease a counter");return null==t&&(t=1),setValue$1(this.hashMap,t,e,r),{labelHash:r}}incWithExemplar({labels:e=this.defaultLabels,value:t=this.defaultValue,exemplarLabels:r=this.defaultExemplarLabelSet}={}){const s=this.incWithoutExemplar(e,t);this.updateExemplar(r,t,s.labelHash)}updateExemplar(e,t,r){isObject$3(this.hashMap[r].exemplar)||(this.hashMap[r].exemplar=new Exemplar$1),this.hashMap[r].exemplar.validateExemplarLabelSet(e),this.hashMap[r].exemplar.labelSet=e,this.hashMap[r].exemplar.value=t||1,this.hashMap[r].exemplar.timestamp=nowTimestamp$1()}reset(){this.hashMap={},0===this.labelNames.length&&setValue$1(this.hashMap,0)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}labels(...e){const t=getLabels$3(this.labelNames,e)||{};return{inc:this.inc.bind(this,t)}}remove(...e){const t=getLabels$3(this.labelNames,e)||{};return validateLabel$3(this.labelNames,t),removeLabels$3.call(this,this.hashMap,t,this.sortedLabelNames)}};function setValue$1(e,t,r={},s=""){return e[s]?e[s].value+=t:e[s]={value:t,labels:r},e}var counter=Counter$2;const util$2=require$$0$3,{setValue:setValue,setValueDelta:setValueDelta,getLabels:getLabels$2,hashObject:hashObject$2,isObject:isObject$2,removeLabels:removeLabels$2}=util$5,{validateLabel:validateLabel$2}=validation,{Metric:Metric$2}=metric;let Gauge$d=class extends Metric$2{constructor(e){super(e),this.type="gauge"}set(e,t){t=getValueArg(e,t),set(this,e=getLabelArg(e),t)}reset(){this.hashMap={},0===this.labelNames.length&&setValue(this.hashMap,0,{})}inc(e,t){void 0===(t=getValueArg(e,t))&&(t=1),setDelta(this,e=getLabelArg(e),t)}dec(e,t){void 0===(t=getValueArg(e,t))&&(t=1),setDelta(this,e=getLabelArg(e),-t)}setToCurrentTime(e){const t=Date.now()/1e3;void 0===e?this.set(t):this.set(e,t)}startTimer(e){const t=process.hrtime();return r=>{const s=process.hrtime(t),n=s[0]+s[1]/1e9;return this.set(Object.assign({},e,r),n),n}}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}_getValue(e){const t=hashObject$2(e||{},this.sortedLabelNames);return this.hashMap[t]?this.hashMap[t].value:0}labels(...e){const t=getLabels$2(this.labelNames,e);return validateLabel$2(this.labelNames,t),{inc:this.inc.bind(this,t),dec:this.dec.bind(this,t),set:this.set.bind(this,t),setToCurrentTime:this.setToCurrentTime.bind(this,t),startTimer:this.startTimer.bind(this,t)}}remove(...e){const t=getLabels$2(this.labelNames,e);validateLabel$2(this.labelNames,t),removeLabels$2.call(this,this.hashMap,t,this.sortedLabelNames)}};function set(e,t,r){if("number"!=typeof r)throw new TypeError(`Value is not a valid number: ${util$2.format(r)}`);validateLabel$2(e.labelNames,t),setValue(e.hashMap,r,t)}function setDelta(e,t,r){if("number"!=typeof r)throw new TypeError(`Delta is not a valid number: ${util$2.format(r)}`);validateLabel$2(e.labelNames,t);const s=hashObject$2(t,e.sortedLabelNames);setValueDelta(e.hashMap,r,t,s)}function getLabelArg(e){return isObject$2(e)?e:{}}function getValueArg(e,t){return isObject$2(e)?t:e}var gauge=Gauge$d;const util$1=require$$0$3,{getLabels:getLabels$1,hashObject:hashObject$1,isObject:isObject$1,removeLabels:removeLabels$1,nowTimestamp:nowTimestamp}=util$5,{validateLabel:validateLabel$1}=validation,{Metric:Metric$1}=metric,Exemplar=exemplar;let Histogram$2=class extends Metric$1{constructor(e){super(e,{buckets:[.005,.01,.025,.05,.1,.25,.5,1,2.5,5,10]}),this.type="histogram",this.defaultLabels={},this.defaultExemplarLabelSet={},this.enableExemplars=!1,e.enableExemplars?(this.enableExemplars=!0,this.observe=this.observeWithExemplar):this.observe=this.observeWithoutExemplar;for(const e of this.labelNames)if("le"===e)throw new Error("le is a reserved label keyword");this.upperBounds=this.buckets,this.bucketValues=this.upperBounds.reduce(((e,t)=>(e[t]=0,e)),{}),this.bucketExemplars=this.upperBounds.reduce(((e,t)=>(e[t]=null,e)),{}),Object.freeze(this.bucketValues),Object.freeze(this.bucketExemplars),Object.freeze(this.upperBounds),0===this.labelNames.length&&(this.hashMap={[hashObject$1({})]:createBaseValues({},this.bucketValues,this.bucketExemplars)})}observeWithoutExemplar(e,t){observe$1.call(this,0===e?0:e||{})(t)}observeWithExemplar({labels:e=this.defaultLabels,value:t,exemplarLabels:r=this.defaultExemplarLabelSet}={}){observe$1.call(this,0===e?0:e||{})(t),this.updateExemplar(e,t,r)}updateExemplar(e,t,r){const s=hashObject$1(e,this.sortedLabelNames),n=findBound(this.upperBounds,t),{bucketExemplars:i}=this.hashMap[s];let a=i[n];isObject$1(a)||(a=new Exemplar,i[n]=a),a.validateExemplarLabelSet(r),a.labelSet=r,a.value=t,a.timestamp=nowTimestamp()}async get(){const e=await this.getForPromString();return e.values=e.values.map(splayLabels),e}async getForPromString(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.values(this.hashMap).map(extractBucketValuesForExport(this)).reduce(addSumAndCountForExport(this),[]);return{name:this.name,help:this.help,type:this.type,values:e,aggregator:this.aggregator}}reset(){this.hashMap={}}zero(e){const t=hashObject$1(e,this.sortedLabelNames);this.hashMap[t]=createBaseValues(e,this.bucketValues,this.bucketExemplars)}startTimer(e,t){return this.enableExemplars?startTimerWithExemplar.call(this,e,t)():startTimer$1.call(this,e)()}labels(...e){const t=getLabels$1(this.labelNames,e);return validateLabel$1(this.labelNames,t),{observe:observe$1.call(this,t),startTimer:startTimer$1.call(this,t)}}remove(...e){const t=getLabels$1(this.labelNames,e);validateLabel$1(this.labelNames,t),removeLabels$1.call(this,this.hashMap,t,this.sortedLabelNames)}};function startTimer$1(e){return()=>{const t=process.hrtime();return r=>{const s=process.hrtime(t),n=s[0]+s[1]/1e9;return this.observe(Object.assign({},e,r),n),n}}}function startTimerWithExemplar(e,t){return()=>{const r=process.hrtime();return(s,n)=>{const i=process.hrtime(r),a=i[0]+i[1]/1e9;return this.observe({labels:Object.assign({},e,s),value:a,exemplarLabels:Object.assign({},t,n)}),a}}}function setValuePair(e,t,r,s,n={}){return{labels:e,sharedLabels:n,value:t,metricName:r,exemplar:s}}function findBound(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(t<=s)return s}return-1}function observe$1(e){return t=>{const r=convertLabelsAndValues$1(e,t);if(validateLabel$1(this.labelNames,r.labels),!Number.isFinite(r.value))throw new TypeError(`Value is not a valid number: ${util$1.format(r.value)}`);const s=hashObject$1(r.labels,this.sortedLabelNames);let n=this.hashMap[s];n||(n=createBaseValues(r.labels,this.bucketValues,this.bucketExemplars));const i=findBound(this.upperBounds,r.value);n.sum+=r.value,n.count+=1,Object.prototype.hasOwnProperty.call(n.bucketValues,i)&&(n.bucketValues[i]+=1),this.hashMap[s]=n}}function createBaseValues(e,t,r){return{labels:e,bucketValues:{...t},bucketExemplars:{...r},sum:0,count:0}}function convertLabelsAndValues$1(e,t){return isObject$1(e)?{labels:e,value:t}:{value:e,labels:{}}}function extractBucketValuesForExport(e){const t=`${e.name}_bucket`;return r=>{let s=0;return{buckets:e.upperBounds.map((e=>(s+=r.bucketValues[e],setValuePair({le:e},s,t,r.bucketExemplars[e],r.labels)))),data:r}}}function addSumAndCountForExport(e){return(t,r)=>{t.push(...r.buckets);return t.push(setValuePair({le:"+Inf"},r.data.count,`${e.name}_bucket`,r.data.bucketExemplars[-1],r.data.labels),setValuePair({},r.data.sum,`${e.name}_sum`,void 0,r.data.labels),setValuePair({},r.data.count,`${e.name}_count`,void 0,r.data.labels)),t}}function splayLabels(e){const{sharedLabels:t,labels:r,...s}=e;for(const e of Object.keys(t))r[e]=t[e];return s.labels=r,s}var histogram=Histogram$2;function TreeBase$2(){}function Iterator(e){this._tree=e,this._ancestors=[],this._cursor=null}TreeBase$2.prototype.clear=function(){this._root=null,this.size=0},TreeBase$2.prototype.find=function(e){for(var t=this._root;null!==t;){var r=this._comparator(e,t.data);if(0===r)return t.data;t=t.get_child(r>0)}return null},TreeBase$2.prototype.findIter=function(e){for(var t=this._root,r=this.iterator();null!==t;){var s=this._comparator(e,t.data);if(0===s)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(s>0)}return null},TreeBase$2.prototype.lowerBound=function(e){for(var t=this._root,r=this.iterator(),s=this._comparator;null!==t;){var n=s(e,t.data);if(0===n)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(n>0)}for(var i=r._ancestors.length-1;i>=0;--i)if(s(e,(t=r._ancestors[i]).data)<0)return r._cursor=t,r._ancestors.length=i,r;return r._ancestors.length=0,r},TreeBase$2.prototype.upperBound=function(e){for(var t=this.lowerBound(e),r=this._comparator;null!==t.data()&&0===r(t.data(),e);)t.next();return t},TreeBase$2.prototype.min=function(){var e=this._root;if(null===e)return null;for(;null!==e.left;)e=e.left;return e.data},TreeBase$2.prototype.max=function(){var e=this._root;if(null===e)return null;for(;null!==e.right;)e=e.right;return e.data},TreeBase$2.prototype.iterator=function(){return new Iterator(this)},TreeBase$2.prototype.each=function(e){for(var t,r=this.iterator();null!==(t=r.next());)if(!1===e(t))return},TreeBase$2.prototype.reach=function(e){for(var t,r=this.iterator();null!==(t=r.prev());)if(!1===e(t))return},Iterator.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},Iterator.prototype.next=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._minNode(e)}else{var t;if(null===this._cursor.right)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===t);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},Iterator.prototype.prev=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._maxNode(e)}else{var t;if(null===this._cursor.left)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===t);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},Iterator.prototype._minNode=function(e){for(;null!==e.left;)this._ancestors.push(e),e=e.left;this._cursor=e},Iterator.prototype._maxNode=function(e){for(;null!==e.right;)this._ancestors.push(e),e=e.right;this._cursor=e};var treebase=TreeBase$2,TreeBase$1=treebase;function Node$1(e){this.data=e,this.left=null,this.right=null,this.red=!0}function RBTree$1(e){this._root=null,this._comparator=e,this.size=0}function is_red(e){return null!==e&&e.red}function single_rotate(e,t){var r=e.get_child(!t);return e.set_child(!t,r.get_child(t)),r.set_child(t,e),e.red=!0,r.red=!1,r}function double_rotate(e,t){return e.set_child(!t,single_rotate(e.get_child(!t),!t)),single_rotate(e,t)}Node$1.prototype.get_child=function(e){return e?this.right:this.left},Node$1.prototype.set_child=function(e,t){e?this.right=t:this.left=t},RBTree$1.prototype=new TreeBase$1,RBTree$1.prototype.insert=function(e){var t=!1;if(null===this._root)this._root=new Node$1(e),t=!0,this.size++;else{var r=new Node$1(void 0),s=0,n=0,i=null,a=r,o=null,c=this._root;for(a.right=this._root;;){if(null===c?(c=new Node$1(e),o.set_child(s,c),t=!0,this.size++):is_red(c.left)&&is_red(c.right)&&(c.red=!0,c.left.red=!1,c.right.red=!1),is_red(c)&&is_red(o)){var u=a.right===i;c===o.get_child(n)?a.set_child(u,single_rotate(i,!n)):a.set_child(u,double_rotate(i,!n))}var l=this._comparator(c.data,e);if(0===l)break;n=s,s=l<0,null!==i&&(a=i),i=o,o=c,c=c.get_child(s)}this._root=r.right}return this._root.red=!1,t},RBTree$1.prototype.remove=function(e){if(null===this._root)return!1;var t=new Node$1(void 0),r=t;r.right=this._root;for(var s=null,n=null,i=null,a=1;null!==r.get_child(a);){var o=a;n=s,s=r,r=r.get_child(a);var c=this._comparator(e,r.data);if(a=c>0,0===c&&(i=r),!is_red(r)&&!is_red(r.get_child(a)))if(is_red(r.get_child(!a))){var u=single_rotate(r,a);s.set_child(o,u),s=u}else if(!is_red(r.get_child(!a))){var l=s.get_child(!o);if(null!==l)if(is_red(l.get_child(!o))||is_red(l.get_child(o))){var p=n.right===s;is_red(l.get_child(o))?n.set_child(p,double_rotate(s,o)):is_red(l.get_child(!o))&&n.set_child(p,single_rotate(s,o));var d=n.get_child(p);d.red=!0,r.red=!0,d.left.red=!1,d.right.red=!1}else s.red=!1,l.red=!0,r.red=!0}}return null!==i&&(i.data=r.data,s.set_child(s.right===r,r.get_child(null===r.left)),this.size--),this._root=t.right,null!==this._root&&(this._root.red=!1),null!==i};var rbtree=RBTree$1,TreeBase=treebase;function Node(e){this.data=e,this.left=null,this.right=null}function BinTree(e){this._root=null,this._comparator=e,this.size=0}Node.prototype.get_child=function(e){return e?this.right:this.left},Node.prototype.set_child=function(e,t){e?this.right=t:this.left=t},BinTree.prototype=new TreeBase,BinTree.prototype.insert=function(e){if(null===this._root)return this._root=new Node(e),this.size++,!0;for(var t=0,r=null,s=this._root;;){if(null===s)return s=new Node(e),r.set_child(t,s),ret=!0,this.size++,!0;if(0===this._comparator(s.data,e))return!1;t=this._comparator(s.data,e)<0,r=s,s=s.get_child(t)}},BinTree.prototype.remove=function(e){if(null===this._root)return!1;var t=new Node(void 0),r=t;r.right=this._root;for(var s=null,n=null,i=1;null!==r.get_child(i);){s=r,r=r.get_child(i);var a=this._comparator(e,r.data);i=a>0,0===a&&(n=r)}return null!==n&&(n.data=r.data,s.set_child(s.right===r,r.get_child(null===r.left)),this._root=t.right,this.size--,!0)};var bintree=BinTree,bintrees={RBTree:rbtree,BinTree:bintree},RBTree=bintrees.RBTree;function TDigest$1(e,t,r){this.discrete=!1===e,this.delta=e||.01,this.K=void 0===t?25:t,this.CX=void 0===r?1.1:r,this.centroids=new RBTree(compare_centroid_means),this.nreset=0,this.reset()}function compare_centroid_means(e,t){return e.mean>t.mean?1:e.mean<t.mean?-1:0}function compare_centroid_mean_cumns(e,t){return e.mean_cumn-t.mean_cumn}function pop_random(e){var t=Math.floor(Math.random()*e.length);return e.splice(t,1)[0]}function Digest(e){this.config=e||{},this.mode=this.config.mode||"auto",TDigest$1.call(this,"cont"===this.mode&&e.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}TDigest$1.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},TDigest$1.prototype.size=function(){return this.centroids.size},TDigest$1.prototype.toArray=function(e){var t=[];return e?(this._cumulate(!0),this.centroids.each((function(e){t.push(e)}))):this.centroids.each((function(e){t.push({mean:e.mean,n:e.n})})),t},TDigest$1.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},TDigest$1.prototype.push=function(e,t){t=t||1,e=Array.isArray(e)?e:[e];for(var r=0;r<e.length;r++)this._digest(e[r],t)},TDigest$1.prototype.push_centroid=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this._digest(e[t].mean,e[t].n)},TDigest$1.prototype._cumulate=function(e){if(!(this.n===this.last_cumulate||!e&&this.CX&&this.CX>this.n/this.last_cumulate)){var t=0;this.centroids.each((function(e){e.mean_cumn=t+e.n/2,t=e.cumn=t+e.n})),this.n=this.last_cumulate=t}},TDigest$1.prototype.find_nearest=function(e){if(0===this.size())return null;var t=this.centroids.lowerBound({mean:e}),r=null===t.data()?t.prev():t.data();if(r.mean===e||this.discrete)return r;var s=t.prev();return s&&Math.abs(s.mean-e)<Math.abs(r.mean-e)?s:r},TDigest$1.prototype._new_centroid=function(e,t,r){var s={mean:e,n:t,cumn:r};return this.centroids.insert(s),this.n+=t,s},TDigest$1.prototype._addweight=function(e,t,r){t!==e.mean&&(e.mean+=r*(t-e.mean)/(e.n+r)),e.cumn+=r,e.mean_cumn+=r/2,e.n+=r,this.n+=r},TDigest$1.prototype._digest=function(e,t){var r=this.centroids.min(),s=this.centroids.max(),n=this.find_nearest(e);if(n&&n.mean===e)this._addweight(n,e,t);else if(n===r)this._new_centroid(e,t,0);else if(n===s)this._new_centroid(e,t,this.n);else if(this.discrete)this._new_centroid(e,t,n.cumn);else{var i=n.mean_cumn/this.n;Math.floor(4*this.n*this.delta*i*(1-i))-n.n>=t?this._addweight(n,e,t):this._new_centroid(e,t,n.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},TDigest$1.prototype.bound_mean=function(e){var t=this.centroids.upperBound({mean:e}),r=t.prev();return[r,r.mean===e?r:t.next()]},TDigest$1.prototype.p_rank=function(e){var t=(Array.isArray(e)?e:[e]).map(this._p_rank,this);return Array.isArray(e)?t:t[0]},TDigest$1.prototype._p_rank=function(e){if(0!==this.size()){if(e<this.centroids.min().mean)return 0;if(e>this.centroids.max().mean)return 1;this._cumulate(!0);var t=this.bound_mean(e),r=t[0],s=t[1];if(this.discrete)return r.cumn/this.n;var n=r.mean_cumn;return r!==s&&(n+=(e-r.mean)*(s.mean_cumn-r.mean_cumn)/(s.mean-r.mean)),n/this.n}},TDigest$1.prototype.bound_mean_cumn=function(e){this.centroids._comparator=compare_centroid_mean_cumns;var t=this.centroids.upperBound({mean_cumn:e});this.centroids._comparator=compare_centroid_means;var r=t.prev();return[r,r&&r.mean_cumn===e?r:t.next()]},TDigest$1.prototype.percentile=function(e){var t=(Array.isArray(e)?e:[e]).map(this._percentile,this);return Array.isArray(e)?t:t[0]},TDigest$1.prototype._percentile=function(e){if(0!==this.size()){this._cumulate(!0);var t=this.n*e,r=this.bound_mean_cumn(t),s=r[0],n=r[1];return n===s||null===s||null===n?(s||n).mean:this.discrete?t<=s.cumn?s.mean:n.mean:s.mean+(t-s.mean_cumn)*(n.mean-s.mean)/(n.mean_cumn-s.mean_cumn)}},TDigest$1.prototype.compress=function(){if(!this.compressing){var e=this.toArray();for(this.reset(),this.compressing=!0;e.length>0;)this.push_centroid(pop_random(e));this._cumulate(!0),this.compressing=!1}},Digest.prototype=Object.create(TDigest$1.prototype),Digest.prototype.constructor=Digest,Digest.prototype.push=function(e){TDigest$1.prototype.push.call(this,e),this.check_continuous()},Digest.prototype._new_centroid=function(e,t,r){this.n_unique+=1,TDigest$1.prototype._new_centroid.call(this,e,t,r)},Digest.prototype._addweight=function(e,t,r){1===e.n&&(this.n_unique-=1),TDigest$1.prototype._addweight.call(this,e,t,r)},Digest.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&(this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0))};var tdigest={TDigest:TDigest$1,Digest:Digest};const{TDigest:TDigest}=tdigest;class TimeWindowQuantiles{constructor(e,t){this.maxAgeSeconds=e||0,this.ageBuckets=t||0,this.shouldRotate=e&&t,this.ringBuffer=Array(t).fill(new TDigest),this.currentBuffer=0,this.lastRotateTimestampMillis=Date.now(),this.durationBetweenRotatesMillis=1e3*e/t||1/0}size(){return rotate.call(this).size()}percentile(e){return rotate.call(this).percentile(e)}push(e){rotate.call(this),this.ringBuffer.forEach((t=>{t.push(e)}))}reset(){this.ringBuffer.forEach((e=>{e.reset()}))}compress(){this.ringBuffer.forEach((e=>{e.compress()}))}}function rotate(){let e=Date.now()-this.lastRotateTimestampMillis;for(;e>this.durationBetweenRotatesMillis&&this.shouldRotate;)this.ringBuffer[this.currentBuffer]=new TDigest,++this.currentBuffer>=this.ringBuffer.length&&(this.currentBuffer=0),e-=this.durationBetweenRotatesMillis,this.lastRotateTimestampMillis+=this.durationBetweenRotatesMillis;return this.ringBuffer[this.currentBuffer]}var timeWindowQuantiles$1=TimeWindowQuantiles;const util=require$$0$3,{getLabels:getLabels,hashObject:hashObject,removeLabels:removeLabels}=util$5,{validateLabel:validateLabel}=validation,{Metric:Metric}=metric,timeWindowQuantiles=timeWindowQuantiles$1,DEFAULT_COMPRESS_COUNT=1e3;let Summary$1=class extends Metric{constructor(e){super(e,{percentiles:[.01,.05,.5,.9,.95,.99,.999],compressCount:DEFAULT_COMPRESS_COUNT,hashMap:{}}),this.type="summary";for(const e of this.labelNames)if("quantile"===e)throw new Error("quantile is a reserved label keyword");0===this.labelNames.length&&(this.hashMap={[hashObject({})]:{labels:{},td:new timeWindowQuantiles(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}})}observe(e,t){observe.call(this,0===e?0:e||{})(t)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.keys(this.hashMap),t=[];return e.forEach((e=>{const r=this.hashMap[e];r&&(this.pruneAgedBuckets&&0===r.td.size()?delete this.hashMap[e]:(extractSummariesForExport(r,this.percentiles).forEach((e=>{t.push(e)})),t.push(getSumForExport(r,this)),t.push(getCountForExport(r,this))))})),{name:this.name,help:this.help,type:this.type,values:t,aggregator:this.aggregator}}reset(){Object.values(this.hashMap).forEach((e=>{e.td.reset(),e.count=0,e.sum=0}))}startTimer(e){return startTimer.call(this,e)()}labels(...e){const t=getLabels(this.labelNames,e);return validateLabel(this.labelNames,t),{observe:observe.call(this,t),startTimer:startTimer.call(this,t)}}remove(...e){const t=getLabels(this.labelNames,e);validateLabel(this.labelNames,t),removeLabels.call(this,this.hashMap,t,this.sortedLabelNames)}};function extractSummariesForExport(e,t){return e.td.compress(),t.map((t=>{const r=e.td.percentile(t);return{labels:Object.assign({quantile:t},e.labels),value:r||0}}))}function getCountForExport(e,t){return{metricName:`${t.name}_count`,labels:e.labels,value:e.count}}function getSumForExport(e,t){return{metricName:`${t.name}_sum`,labels:e.labels,value:e.sum}}function startTimer(e){return()=>{const t=process.hrtime();return r=>{const s=process.hrtime(t),n=s[0]+s[1]/1e9;return this.observe(Object.assign({},e,r),n),n}}}function observe(e){return t=>{const r=convertLabelsAndValues(e,t);if(validateLabel(this.labelNames,e),!Number.isFinite(r.value))throw new TypeError(`Value is not a valid number: ${util.format(r.value)}`);const s=hashObject(r.labels,this.sortedLabelNames);let n=this.hashMap[s];n||(n={labels:r.labels,td:new timeWindowQuantiles(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}),n.td.push(r.value),n.count++,n.count%this.compressCount==0&&n.td.compress(),n.sum+=r.value,this.hashMap[s]=n}}function convertLabelsAndValues(e,t){return void 0===t?{value:e,labels:{}}:{labels:e,value:t}}var summary=Summary$1,defaultMetrics={exports:{}},processCpuTotal$1={exports:{}};const OtelApi=require$$0,Counter$1=counter,PROCESS_CPU_USER_SECONDS="process_cpu_user_seconds_total",PROCESS_CPU_SYSTEM_SECONDS="process_cpu_system_seconds_total",PROCESS_CPU_SECONDS="process_cpu_seconds_total";processCpuTotal$1.exports=(e,t={})=>{const r=e?[e]:void 0,s=t.prefix?t.prefix:"",n=t.labels?t.labels:{},i=!!t.enableExemplars&&t.enableExemplars,a=Object.keys(n);let o=process.cpuUsage();const c=new Counter$1({name:s+PROCESS_CPU_USER_SECONDS,help:"Total user CPU time spent in seconds.",enableExemplars:i,registers:r,labelNames:a,collect(){const e=process.cpuUsage(),t=e.user-o.user,r=e.system-o.system;if(o=e,this.enableExemplars){let e={};const s=OtelApi.trace.getSpan(OtelApi.context.active());s&&(e={traceId:s.spanContext().traceId,spanId:s.spanContext().spanId}),c.inc({labels:n,value:t/1e6,exemplarLabels:e}),u.inc({labels:n,value:r/1e6,exemplarLabels:e}),l.inc({labels:n,value:(t+r)/1e6,exemplarLabels:e})}else c.inc(n,t/1e6),u.inc(n,r/1e6),l.inc(n,(t+r)/1e6)}}),u=new Counter$1({name:s+PROCESS_CPU_SYSTEM_SECONDS,help:"Total system CPU time spent in seconds.",enableExemplars:i,registers:r,labelNames:a}),l=new Counter$1({name:s+PROCESS_CPU_SECONDS,help:"Total user and system CPU time spent in seconds.",enableExemplars:i,registers:r,labelNames:a})},processCpuTotal$1.exports.metricNames=[PROCESS_CPU_USER_SECONDS,PROCESS_CPU_SYSTEM_SECONDS,PROCESS_CPU_SECONDS];var processCpuTotalExports=processCpuTotal$1.exports,processStartTime$1={exports:{}};const Gauge$c=gauge,startInSeconds=Math.round(Date.now()/1e3-process.uptime()),PROCESS_START_TIME="process_start_time_seconds";processStartTime$1.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$c({name:r+PROCESS_START_TIME,help:"Start time of the process since unix epoch in seconds.",registers:e?[e]:void 0,labelNames:n,aggregator:"omit",collect(){this.set(s,startInSeconds)}})},processStartTime$1.exports.metricNames=[PROCESS_START_TIME];var processStartTimeExports=processStartTime$1.exports,osMemoryHeap$1={exports:{}},osMemoryHeapLinux={exports:{}};const Gauge$b=gauge,fs$2=require$$0$6,values=["VmSize","VmRSS","VmData"],PROCESS_RESIDENT_MEMORY$1="process_resident_memory_bytes",PROCESS_VIRTUAL_MEMORY="process_virtual_memory_bytes",PROCESS_HEAP="process_heap_bytes";function structureOutput(e){return e.split("\n").reduce(((e,t)=>{if(!values.some((e=>t.startsWith(e))))return e;const r=t.split(":");let s=r[1].trim();return s=s.substr(0,s.length-3),s=1024*Number(s),e[r[0]]=s,e}),{})}osMemoryHeapLinux.exports=(e,t={})=>{const r=e?[e]:void 0,s=t.prefix?t.prefix:"",n=t.labels?t.labels:{},i=Object.keys(n),a=new Gauge$b({name:s+PROCESS_RESIDENT_MEMORY$1,help:"Resident memory size in bytes.",registers:r,labelNames:i,collect(){try{const e=structureOutput(fs$2.readFileSync("/proc/self/status","utf8"));a.set(n,e.VmRSS),o.set(n,e.VmSize),c.set(n,e.VmData)}catch{}}}),o=new Gauge$b({name:s+PROCESS_VIRTUAL_MEMORY,help:"Virtual memory size in bytes.",registers:r,labelNames:i}),c=new Gauge$b({name:s+PROCESS_HEAP,help:"Process heap size in bytes.",registers:r,labelNames:i})},osMemoryHeapLinux.exports.metricNames=[PROCESS_RESIDENT_MEMORY$1,PROCESS_VIRTUAL_MEMORY,PROCESS_HEAP];var osMemoryHeapLinuxExports=osMemoryHeapLinux.exports;function safeMemoryUsage$2(){try{return process.memoryUsage()}catch{return}}var safeMemoryUsage_1=safeMemoryUsage$2;const Gauge$a=gauge,linuxVariant=osMemoryHeapLinuxExports,safeMemoryUsage$1=safeMemoryUsage_1,PROCESS_RESIDENT_MEMORY="process_resident_memory_bytes";function notLinuxVariant(e,t={}){const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$a({name:r+PROCESS_RESIDENT_MEMORY,help:"Resident memory size in bytes.",registers:e?[e]:void 0,labelNames:n,collect(){const e=safeMemoryUsage$1();e&&this.set(s,e.rss)}})}osMemoryHeap$1.exports=(e,t)=>"linux"===process.platform?linuxVariant(e,t):notLinuxVariant(e,t),osMemoryHeap$1.exports.metricNames="linux"===process.platform?linuxVariant.metricNames:[PROCESS_RESIDENT_MEMORY];var osMemoryHeapExports=osMemoryHeap$1.exports,processOpenFileDescriptors$1={exports:{}};const Gauge$9=gauge,fs$1=require$$0$6,process$1=require$$1$5,PROCESS_OPEN_FDS="process_open_fds";processOpenFileDescriptors$1.exports=(e,t={})=>{if("linux"!==process$1.platform)return;const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$9({name:r+PROCESS_OPEN_FDS,help:"Number of open file descriptors.",registers:e?[e]:void 0,labelNames:n,collect(){try{const e=fs$1.readdirSync("/proc/self/fd");this.set(s,e.length-1)}catch{}}})},processOpenFileDescriptors$1.exports.metricNames=[PROCESS_OPEN_FDS];var processOpenFileDescriptorsExports=processOpenFileDescriptors$1.exports,processMaxFileDescriptors$1={exports:{}};const Gauge$8=gauge,fs=require$$0$6,PROCESS_MAX_FDS="process_max_fds";let maxFds;processMaxFileDescriptors$1.exports=(e,t={})=>{if(void 0===maxFds)try{const e=fs.readFileSync("/proc/self/limits","utf8").split("\n");for(const t of e)if(t.startsWith("Max open files")){const e=t.split(/  +/);maxFds=Number(e[1]);break}}catch{return}if(void 0===maxFds)return;const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$8({name:r+PROCESS_MAX_FDS,help:"Maximum number of open file descriptors.",registers:e?[e]:void 0,labelNames:n,collect(){void 0!==maxFds&&this.set(s,maxFds)}})},processMaxFileDescriptors$1.exports.metricNames=[PROCESS_MAX_FDS];var processMaxFileDescriptorsExports=processMaxFileDescriptors$1.exports,eventLoopLag$1={exports:{}};const Gauge$7=gauge;let perf_hooks$1;try{perf_hooks$1=require("perf_hooks")}catch{}const NODEJS_EVENTLOOP_LAG="nodejs_eventloop_lag_seconds",NODEJS_EVENTLOOP_LAG_MIN="nodejs_eventloop_lag_min_seconds",NODEJS_EVENTLOOP_LAG_MAX="nodejs_eventloop_lag_max_seconds",NODEJS_EVENTLOOP_LAG_MEAN="nodejs_eventloop_lag_mean_seconds",NODEJS_EVENTLOOP_LAG_STDDEV="nodejs_eventloop_lag_stddev_seconds",NODEJS_EVENTLOOP_LAG_P50="nodejs_eventloop_lag_p50_seconds",NODEJS_EVENTLOOP_LAG_P90="nodejs_eventloop_lag_p90_seconds",NODEJS_EVENTLOOP_LAG_P99="nodejs_eventloop_lag_p99_seconds";function reportEventloopLag(e,t,r){const s=process.hrtime(e),n=(1e9*s[0]+s[1])/1e9;t.set(r,n)}eventLoopLag$1.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s),i=e?[e]:void 0;let a;if(perf_hooks$1&&perf_hooks$1.monitorEventLoopDelay){const e=perf_hooks$1.monitorEventLoopDelay({resolution:t.eventLoopMonitoringPrecision});e.enable(),a=()=>{const t=process.hrtime();setImmediate(reportEventloopLag,t,o,s),c.set(s,e.min/1e9),u.set(s,e.max/1e9),l.set(s,e.mean/1e9),p.set(s,e.stddev/1e9),d.set(s,e.percentile(50)/1e9),h.set(s,e.percentile(90)/1e9),f.set(s,e.percentile(99)/1e9),e.reset()}}else a=()=>{const e=process.hrtime();setImmediate(reportEventloopLag,e,o,s)};const o=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG,help:"Lag of event loop in seconds.",registers:i,labelNames:n,aggregator:"average",collect:a}),c=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_MIN,help:"The minimum recorded event loop delay.",registers:i,labelNames:n,aggregator:"min"}),u=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_MAX,help:"The maximum recorded event loop delay.",registers:i,labelNames:n,aggregator:"max"}),l=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_MEAN,help:"The mean of the recorded event loop delays.",registers:i,labelNames:n,aggregator:"average"}),p=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_STDDEV,help:"The standard deviation of the recorded event loop delays.",registers:i,labelNames:n,aggregator:"average"}),d=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_P50,help:"The 50th percentile of the recorded event loop delays.",registers:i,labelNames:n,aggregator:"average"}),h=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_P90,help:"The 90th percentile of the recorded event loop delays.",registers:i,labelNames:n,aggregator:"average"}),f=new Gauge$7({name:r+NODEJS_EVENTLOOP_LAG_P99,help:"The 99th percentile of the recorded event loop delays.",registers:i,labelNames:n,aggregator:"average"})},eventLoopLag$1.exports.metricNames=[NODEJS_EVENTLOOP_LAG,NODEJS_EVENTLOOP_LAG_MIN,NODEJS_EVENTLOOP_LAG_MAX,NODEJS_EVENTLOOP_LAG_MEAN,NODEJS_EVENTLOOP_LAG_STDDEV,NODEJS_EVENTLOOP_LAG_P50,NODEJS_EVENTLOOP_LAG_P90,NODEJS_EVENTLOOP_LAG_P99];var eventLoopLagExports=eventLoopLag$1.exports,processHandles$1={exports:{}};function aggregateByObjectName$2(e){const t={};for(let r=0;r<e.length;r++){const s=e[r];s&&void 0!==s.constructor&&(Object.hasOwnProperty.call(t,s.constructor.name)?t[s.constructor.name]+=1:t[s.constructor.name]=1)}return t}function updateMetrics$3(e,t,r){e.reset();for(const s in t)e.set(Object.assign({type:s},r||{}),t[s])}var processMetricsHelpers={aggregateByObjectName:aggregateByObjectName$2,updateMetrics:updateMetrics$3};const{aggregateByObjectName:aggregateByObjectName$1}=processMetricsHelpers,{updateMetrics:updateMetrics$2}=processMetricsHelpers,Gauge$6=gauge,NODEJS_ACTIVE_HANDLES="nodejs_active_handles",NODEJS_ACTIVE_HANDLES_TOTAL="nodejs_active_handles_total";processHandles$1.exports=(e,t={})=>{if("function"!=typeof process._getActiveHandles)return;const r=e?[e]:void 0,s=t.prefix?t.prefix:"",n=t.labels?t.labels:{},i=Object.keys(n);new Gauge$6({name:s+NODEJS_ACTIVE_HANDLES,help:"Number of active libuv handles grouped by handle type. Every handle type is C++ class name.",labelNames:["type",...i],registers:r,collect(){const e=process._getActiveHandles();updateMetrics$2(this,aggregateByObjectName$1(e),n)}}),new Gauge$6({name:s+NODEJS_ACTIVE_HANDLES_TOTAL,help:"Total number of active handles.",registers:r,labelNames:i,collect(){const e=process._getActiveHandles();this.set(n,e.length)}})},processHandles$1.exports.metricNames=[NODEJS_ACTIVE_HANDLES,NODEJS_ACTIVE_HANDLES_TOTAL];var processHandlesExports=processHandles$1.exports,processRequests$1={exports:{}};const Gauge$5=gauge,{aggregateByObjectName:aggregateByObjectName}=processMetricsHelpers,{updateMetrics:updateMetrics$1}=processMetricsHelpers,NODEJS_ACTIVE_REQUESTS="nodejs_active_requests",NODEJS_ACTIVE_REQUESTS_TOTAL="nodejs_active_requests_total";processRequests$1.exports=(e,t={})=>{if("function"!=typeof process._getActiveRequests)return;const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$5({name:r+NODEJS_ACTIVE_REQUESTS,help:"Number of active libuv requests grouped by request type. Every request type is C++ class name.",labelNames:["type",...n],registers:e?[e]:void 0,collect(){const e=process._getActiveRequests();updateMetrics$1(this,aggregateByObjectName(e),s)}}),new Gauge$5({name:r+NODEJS_ACTIVE_REQUESTS_TOTAL,help:"Total number of active requests.",registers:e?[e]:void 0,labelNames:n,collect(){const e=process._getActiveRequests();this.set(s,e.length)}})},processRequests$1.exports.metricNames=[NODEJS_ACTIVE_REQUESTS,NODEJS_ACTIVE_REQUESTS_TOTAL];var processRequestsExports=processRequests$1.exports,processResources$1={exports:{}};const Gauge$4=gauge,{updateMetrics:updateMetrics}=processMetricsHelpers,NODEJS_ACTIVE_RESOURCES="nodejs_active_resources",NODEJS_ACTIVE_RESOURCES_TOTAL="nodejs_active_resources_total";processResources$1.exports=(e,t={})=>{if("function"!=typeof process.getActiveResourcesInfo)return;const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$4({name:r+NODEJS_ACTIVE_RESOURCES,help:"Number of active resources that are currently keeping the event loop alive, grouped by async resource type.",labelNames:["type",...n],registers:e?[e]:void 0,collect(){const e=process.getActiveResourcesInfo(),t={};for(let r=0;r<e.length;r++){const s=e[r];Object.hasOwn(t,s)?t[s]+=1:t[s]=1}updateMetrics(this,t,s)}}),new Gauge$4({name:r+NODEJS_ACTIVE_RESOURCES_TOTAL,help:"Total number of active resources.",registers:e?[e]:void 0,labelNames:n,collect(){const e=process.getActiveResourcesInfo();this.set(s,e.length)}})},processResources$1.exports.metricNames=[NODEJS_ACTIVE_RESOURCES,NODEJS_ACTIVE_RESOURCES_TOTAL];var processResourcesExports=processResources$1.exports,heapSizeAndUsed$1={exports:{}};const Gauge$3=gauge,safeMemoryUsage=safeMemoryUsage_1,NODEJS_HEAP_SIZE_TOTAL="nodejs_heap_size_total_bytes",NODEJS_HEAP_SIZE_USED="nodejs_heap_size_used_bytes",NODEJS_EXTERNAL_MEMORY="nodejs_external_memory_bytes";heapSizeAndUsed$1.exports=(e,t={})=>{if("function"!=typeof process.memoryUsage)return;const r=t.labels?t.labels:{},s=Object.keys(r),n=e?[e]:void 0,i=t.prefix?t.prefix:"",a=new Gauge$3({name:i+NODEJS_HEAP_SIZE_TOTAL,help:"Process heap size from Node.js in bytes.",registers:n,labelNames:s,collect:()=>{const e=safeMemoryUsage();e&&(a.set(r,e.heapTotal),o.set(r,e.heapUsed),void 0!==e.external&&c.set(r,e.external))}}),o=new Gauge$3({name:i+NODEJS_HEAP_SIZE_USED,help:"Process heap size used from Node.js in bytes.",registers:n,labelNames:s}),c=new Gauge$3({name:i+NODEJS_EXTERNAL_MEMORY,help:"Node.js external memory size in bytes.",registers:n,labelNames:s})},heapSizeAndUsed$1.exports.metricNames=[NODEJS_HEAP_SIZE_TOTAL,NODEJS_HEAP_SIZE_USED,NODEJS_EXTERNAL_MEMORY];var heapSizeAndUsedExports=heapSizeAndUsed$1.exports,heapSpacesSizeAndUsed$1={exports:{}};const Gauge$2=gauge,v8=require$$0$b,METRICS=["total","used","available"],NODEJS_HEAP_SIZE={};METRICS.forEach((e=>{NODEJS_HEAP_SIZE[e]=`nodejs_heap_space_size_${e}_bytes`})),heapSpacesSizeAndUsed$1.exports=(e,t={})=>{const r=e?[e]:void 0,s=t.prefix?t.prefix:"",n=t.labels?t.labels:{},i=["space",...Object.keys(n)],a={};METRICS.forEach((e=>{a[e]=new Gauge$2({name:s+NODEJS_HEAP_SIZE[e],help:`Process heap space size ${e} from Node.js in bytes.`,labelNames:i,registers:r})})),a.total.collect=()=>{for(const e of v8.getHeapSpaceStatistics()){const t=e.space_name.substr(0,e.space_name.indexOf("_space"));a.total.set({space:t,...n},e.space_size),a.used.set({space:t,...n},e.space_used_size),a.available.set({space:t,...n},e.space_available_size)}}},heapSpacesSizeAndUsed$1.exports.metricNames=Object.values(NODEJS_HEAP_SIZE);var heapSpacesSizeAndUsedExports=heapSpacesSizeAndUsed$1.exports,version$2={exports:{}};const Gauge$1=gauge,version$1=process.version,versionSegments=version$1.slice(1).split(".").map(Number),NODE_VERSION_INFO="nodejs_version_info";version$2.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s);new Gauge$1({name:r+NODE_VERSION_INFO,help:"Node.js version info.",labelNames:["version","major","minor","patch",...n],registers:e?[e]:void 0,aggregator:"first",collect(){this.labels(version$1,versionSegments[0],versionSegments[1],versionSegments[2],...Object.values(s)).set(1)}})},version$2.exports.metricNames=[NODE_VERSION_INFO];var versionExports=version$2.exports,gc$1={exports:{}};const Histogram$1=histogram;let perf_hooks;try{perf_hooks=require("perf_hooks")}catch{}const NODEJS_GC_DURATION_SECONDS="nodejs_gc_duration_seconds",DEFAULT_GC_DURATION_BUCKETS=[.001,.01,.1,1,2,5],kinds=[];perf_hooks&&perf_hooks.constants&&(kinds[perf_hooks.constants.NODE_PERFORMANCE_GC_MAJOR]="major",kinds[perf_hooks.constants.NODE_PERFORMANCE_GC_MINOR]="minor",kinds[perf_hooks.constants.NODE_PERFORMANCE_GC_INCREMENTAL]="incremental",kinds[perf_hooks.constants.NODE_PERFORMANCE_GC_WEAKCB]="weakcb"),gc$1.exports=(e,t={})=>{if(!perf_hooks)return;const r=t.prefix?t.prefix:"",s=t.labels?t.labels:{},n=Object.keys(s),i=t.gcDurationBuckets?t.gcDurationBuckets:DEFAULT_GC_DURATION_BUCKETS,a=new Histogram$1({name:r+NODEJS_GC_DURATION_SECONDS,help:"Garbage collection duration by kind, one of major, minor, incremental or weakcb.",labelNames:["kind",...n],enableExemplars:!1,buckets:i,registers:e?[e]:void 0});new perf_hooks.PerformanceObserver((e=>{const t=e.getEntries()[0],r=t.detail?kinds[t.detail.kind]:kinds[t.kind];a.observe(Object.assign({kind:r},s),t.duration/1e3)})).observe({entryTypes:["gc"]})},gc$1.exports.metricNames=[NODEJS_GC_DURATION_SECONDS];var gcExports=gc$1.exports;const{isObject:isObject}=util$5,processCpuTotal=processCpuTotalExports,processStartTime=processStartTimeExports,osMemoryHeap=osMemoryHeapExports,processOpenFileDescriptors=processOpenFileDescriptorsExports,processMaxFileDescriptors=processMaxFileDescriptorsExports,eventLoopLag=eventLoopLagExports,processHandles=processHandlesExports,processRequests=processRequestsExports,processResources=processResourcesExports,heapSizeAndUsed=heapSizeAndUsedExports,heapSpacesSizeAndUsed=heapSpacesSizeAndUsedExports,version=versionExports,gc=gcExports,metrics={processCpuTotal:processCpuTotal,processStartTime:processStartTime,osMemoryHeap:osMemoryHeap,processOpenFileDescriptors:processOpenFileDescriptors,processMaxFileDescriptors:processMaxFileDescriptors,eventLoopLag:eventLoopLag,..."function"==typeof process.getActiveResourcesInfo?{processResources:processResources}:{},processHandles:processHandles,processRequests:processRequests,heapSizeAndUsed:heapSizeAndUsed,heapSpacesSizeAndUsed:heapSpacesSizeAndUsed,version:version,gc:gc},metricsList=Object.keys(metrics);defaultMetrics.exports=function(e){if(null!=e&&!isObject(e))throw new TypeError("config must be null, undefined, or an object");e={eventLoopMonitoringPrecision:10,...e};for(const t of Object.values(metrics))t(e.register,e)},defaultMetrics.exports.metricsList=metricsList;const Registry=registryExports;Registry.globalRegistry,registryExports.globalRegistry,registryExports.globalRegistry.contentType,registryExports.PROMETHEUS_CONTENT_TYPE,registryExports.OPENMETRICS_CONTENT_TYPE;var Counter=counter,Gauge=gauge,Histogram=histogram,Summary=summary;class PrometheusClient{constructor(){this.HistogramVecs={},this.CounterVecs={},this.GaugeVecs={},this.SummaryVecs={}}CreateHistogramVec(e,t,r,s){this.HistogramVecs[e]||(this.HistogramVecs[e]={Labels:r,Metric:new Histogram({name:e,help:t,labelNames:r,buckets:s})})}CreateCounterVec(e,t,r){this.CounterVecs[e]||(this.CounterVecs[e]={Labels:r,Metric:new Counter({name:e,help:t,labelNames:r})})}CreateGaugeVec(e,t,r){this.GaugeVecs[e]||(this.GaugeVecs[e]={Labels:r,Metric:new Gauge({name:e,help:t,labelNames:r})})}CreateSummaryVec(e,t,r){this.SummaryVecs[e]||(this.SummaryVecs[e]={Labels:r,Metric:new Summary({name:e,help:t,labelNames:r})})}Histogram(e,t,r){const s=Object.keys(r);this.HistogramVecs[e]||this.CreateHistogramVec(e,e,s);const n=[];for(const t of this.HistogramVecs[e].Labels)n.push(r[t]);this.HistogramVecs[e].Metric.labels(...n).observe(t)}Count(e,t){const r=Object.keys(t);this.CounterVecs[e]||this.CreateCounterVec(e,e,r);const s=[];for(const r of this.CounterVecs[e].Labels)s.push(t[r]);this.CounterVecs[e].Metric.labels(...s).inc()}Gauge(e,t,r){const s=Object.keys(r);this.GaugeVecs[e]||this.CreateGaugeVec(e,e,s);const n=[];for(const t of this.GaugeVecs[e].Labels)n.push(r[t]);this.GaugeVecs[e].Metric.labels(...n).set(t)}Summary(e,t,r){const s=Object.keys(r);this.SummaryVecs[e]||this.CreateSummaryVec(e,e,s);const n=[];for(const t of this.SummaryVecs[e].Labels)n.push(r[t]);this.SummaryVecs[e].Metric.labels(...n).observe(t)}}exports.ApiMetric=ApiMetric,exports.CallMetric=CallMetric,exports.DataDogClient=DataDogClient,exports.DatabaseMetric=DatabaseMetric,exports.HttpMiddlewareMetric=HttpMiddlewareMetric,exports.Metrics=Metrics,exports.PrometheusClient=PrometheusClient,exports.ResolverMetric=ResolverMetric;
