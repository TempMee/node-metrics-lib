"use strict";var e=require("util");require("url"),require("http"),require("https"),require("zlib");var t,r,n=require("fs"),s=require("process"),i=require("v8");function o(e,t,r){const n={Resolver:r.Resolver,Service:r.Service,Protocol:r.Protocol,Result:r.Result};e.Histogram("resolver_request_duration_histogram_milliseconds",t,n)}function a(e,t,r){const n={Service:r.Service,Vendor:r.Vendor,Call:r.Call,Result:r.Result};e.Histogram("api_request_duration_histogram_milliseconds",t,n)}function l(e,t){return(r,n,s)=>{const i=Date.now();n.on("finish",(()=>{const r=Date.now(),n={Service:t.Service};e.Histogram("http_request_duration_histogram_milliseconds",r-i,n)})),s()}}function c(e,t,r){const n={Service:r.Service,Function:r.Function,Result:r.Result};e.Histogram("call_duration_histogram_milliseconds",t,n)}function u(e,t,r){const n={Service:r.Service,Table:r.Table,Method:r.Method,Result:r.Result};e.Histogram("database_duration_histogram_milliseconds",t,n)}require("cluster"),function(e){e.Insert="insert",e.Update="update",e.Delete="delete",e.Select="select"}(t||(t={}));class h{constructor(e){this.client=e}static getInstance(e){return h.instance||(h.instance=new h(e)),h.instance}Histogram(e,t,r){this.client.Histogram(e,t,r)}Count(e,t){this.client.Count(e,t)}Gauge(e,t,r){this.client.Gauge(e,t,r)}Summary(e,t,r){this.client.Summary(e,t,r)}ResolverMetric(e,t){return o(this.client,e,t)}ApiMetric(e,t){return a(this.client,e,t)}HttpMiddlewareMetric(e){return l(this.client,e)}CallMetric(e,t){return c(this.client,e,t)}DatabaseMetric(e,t){return u(this.client,e,t)}}exports.Result=void 0,(r=exports.Result||(exports.Result={})).Success="success",r.Error="error";const p=require("dd-trace");function f(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var m={exports:{}},d={};function g(e,t){if(0===e.length)return"";let r="";for(let n=0;n<e.length;n++){const s=e[n],i=t[s];void 0!==i&&(r+=`${s}:${i},`)}return r}function b(e,t){if(t)return g(t,e);const r=Object.keys(e);return r.length>1&&r.sort(),g(r,e)}d.getValueAsString=function(e){return Number.isNaN(e)?"Nan":Number.isFinite(e)?`${e}`:e<0?"-Inf":"+Inf"},d.removeLabels=function(e,t,r){delete e[b(t,r)]},d.setValue=function(e,t,r){return e[b(r)]={value:"number"==typeof t?t:0,labels:r||{}},e},d.setValueDelta=function(e,t,r,n=""){const s="number"==typeof t?t:0;return e[n]?e[n].value+=s:e[n]={value:s,labels:r},e},d.getLabels=function(e,t){if("object"==typeof t[0])return t[0];if(e.length!==t.length)throw new Error("Invalid number of arguments");const r={};for(let n=0;n<e.length;n++)r[e[n]]=t[n];return r},d.hashObject=b,d.isObject=function(e){return null!==e&&"object"==typeof e},d.nowTimestamp=function(){return Date.now()/1e3};class _ extends Map{add(e,t){this.has(e)?this.get(e).push(t):this.set(e,[t])}}d.Grouper=_;const{getValueAsString:v}=d;let y=class e{static get PROMETHEUS_CONTENT_TYPE(){return"text/plain; version=0.0.4; charset=utf-8"}static get OPENMETRICS_CONTENT_TYPE(){return"application/openmetrics-text; version=1.0.0; charset=utf-8"}constructor(t=e.PROMETHEUS_CONTENT_TYPE){if(this._metrics={},this._collectors=[],this._defaultLabels={},t!==e.PROMETHEUS_CONTENT_TYPE&&t!==e.OPENMETRICS_CONTENT_TYPE)throw new TypeError(`Content type ${t} is unsupported`);this._contentType=t}getMetricsAsArray(){return Object.values(this._metrics)}async getMetricsAsString(t){const r="function"==typeof t.getForPromString?await t.getForPromString():await t.get(),n=O(r.name),s=[`# HELP ${n} ${O(r.help)}`,`# TYPE ${n} ${r.type}`],i=Object.keys(this._defaultLabels).length>0?this._defaultLabels:null,o=this.contentType===e.OPENMETRICS_CONTENT_TYPE;for(const e of r.values||[]){let{metricName:t=n,labels:a={}}=e;const{sharedLabels:l={}}=e;o&&"counter"===r.type&&(t=`${t}_total`),i&&(a={...a,...i,...a});const c=[...x(a,l),N(l)].filter(Boolean);let u=`${t}${c.length?`{${c.join(",")}}`:""} ${v(e.value)}`;const{exemplar:h}=e;if(h&&o){u+=` # {${x(h.labelSet).join(",")}} ${v(h.value)} ${h.timestamp}`}s.push(u)}return s.join("\n")}async metrics(){const t=this.contentType===e.OPENMETRICS_CONTENT_TYPE,r=this.getMetricsAsArray().map((e=>(t&&"counter"===e.type&&(e.name=e.name.replace(/_total$/,"")),this.getMetricsAsString(e)))),n=await Promise.all(r);return t?`${n.join("\n")}\n# EOF\n`:`${n.join("\n\n")}\n`}registerMetric(e){if(this._metrics[e.name]&&this._metrics[e.name]!==e)throw new Error(`A metric with the name ${e.name} has already been registered.`);this._metrics[e.name]=e}clear(){this._metrics={},this._defaultLabels={}}async getMetricsAsJSON(){const e=[],t=Object.keys(this._defaultLabels),r=[];for(const e of this.getMetricsAsArray())r.push(e.get());const n=await Promise.all(r);for(const r of n){if(r.values&&t.length>0)for(const e of r.values){e.labels=Object.assign({},e.labels);for(const r of t)e.labels[r]=e.labels[r]||this._defaultLabels[r]}e.push(r)}return e}removeSingleMetric(e){delete this._metrics[e]}getSingleMetricAsString(e){return this.getMetricsAsString(this._metrics[e])}getSingleMetric(e){return this._metrics[e]}setDefaultLabels(e){this._defaultLabels=e}resetMetrics(){for(const e in this._metrics)this._metrics[e].reset()}get contentType(){return this._contentType}setContentType(t){if(t!==e.OPENMETRICS_CONTENT_TYPE&&t!==e.PROMETHEUS_CONTENT_TYPE)throw new Error(`Content type ${t} is unsupported`);this._contentType=t}static merge(t){const r=t[0].contentType;for(const e of t)if(e.contentType!==r)throw new Error("Registers can only be merged if they have the same content type");const n=new e(r);return t.reduce(((e,t)=>e.concat(t.getMetricsAsArray())),[]).forEach(n.registerMetric,n),n}};function x(e,t){const{hasOwnProperty:r}=Object.prototype,n=[];for(const[s,i]of Object.entries(e))t&&r.call(t,s)||n.push(`${s}="${E(i)}"`);return n}const w=new WeakMap;function N(e){const t=w.get(e);if(t)return t;const r=x(e).join(",");return w.set(e,r),r}function E(e){return"string"!=typeof e?e:O(e).replace(/"/g,'\\"')}function O(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n")}m.exports=y,m.exports.globalRegistry=new y;var T=m.exports,M={};const S=e,C=/^[a-zA-Z_:][a-zA-Z0-9_:]*$/,j=/^[a-zA-Z_][a-zA-Z0-9_]*$/;M.validateMetricName=function(e){return C.test(e)},M.validateLabelName=function(e=[]){return e.every((e=>j.test(e)))},M.validateLabel=function(e,t){for(const r in t)if(!e.includes(r))throw new Error(`Added label "${r}" is not included in initial labelset: ${S.inspect(e)}`)};const R=T,{isObject:L}=d,{validateMetricName:A,validateLabelName:k}=M;var P={Metric:class{constructor(e,t={}){if(!L(e))throw new TypeError("constructor expected a config object");if(Object.assign(this,{labelNames:[],registers:[R.globalRegistry],aggregator:"sum",enableExemplars:!1},t,e),this.registers||(this.registers=[R.globalRegistry]),!this.help)throw new Error("Missing mandatory help parameter");if(!this.name)throw new Error("Missing mandatory name parameter");if(!A(this.name))throw new Error("Invalid metric name");if(!k(this.labelNames))throw new Error("Invalid label name");if(this.collect&&"function"!=typeof this.collect)throw new Error('Optional "collect" parameter must be a function');this.labelNames?this.sortedLabelNames=[...this.labelNames].sort():this.sortedLabelNames=[],this.reset();for(const e of this.registers){if(this.enableExemplars&&e.contentType===R.PROMETHEUS_CONTENT_TYPE)throw new TypeError("Exemplars are supported only on OpenMetrics registries");e.registerMetric(this)}}reset(){}}};var V=class{constructor(e={},t=null){this.labelSet=e,this.value=t}validateExemplarLabelSet(e){let t="";for(const[r,n]of Object.entries(e))t+=`${r}${n}`;if(t.length>128)throw new RangeError("Label set size must be smaller than 128 UTF-8 chars")}};const D=e,{hashObject:I,isObject:B,getLabels:z,removeLabels:$,nowTimestamp:H}=d,{validateLabel:q}=M,{Metric:U}=P,G=V;function F(e,t,r={},n=""){return e[n]?e[n].value+=t:e[n]={value:t,labels:r},e}var W=class extends U{constructor(e){super(e),this.type="counter",this.defaultLabels={},this.defaultValue=1,this.defaultExemplarLabelSet={},e.enableExemplars?(this.enableExemplars=!0,this.inc=this.incWithExemplar):this.inc=this.incWithoutExemplar}incWithoutExemplar(e,t){let r="";if(B(e)?(r=I(e,this.sortedLabelNames),q(this.labelNames,e)):(t=e,e={}),t&&!Number.isFinite(t))throw new TypeError(`Value is not a valid number: ${D.format(t)}`);if(t<0)throw new Error("It is not possible to decrease a counter");return null==t&&(t=1),F(this.hashMap,t,e,r),{labelHash:r}}incWithExemplar({labels:e=this.defaultLabels,value:t=this.defaultValue,exemplarLabels:r=this.defaultExemplarLabelSet}={}){const n=this.incWithoutExemplar(e,t);this.updateExemplar(r,t,n.labelHash)}updateExemplar(e,t,r){B(this.hashMap[r].exemplar)||(this.hashMap[r].exemplar=new G),this.hashMap[r].exemplar.validateExemplarLabelSet(e),this.hashMap[r].exemplar.labelSet=e,this.hashMap[r].exemplar.value=t||1,this.hashMap[r].exemplar.timestamp=H()}reset(){this.hashMap={},0===this.labelNames.length&&F(this.hashMap,0)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}labels(...e){const t=z(this.labelNames,e)||{};return{inc:this.inc.bind(this,t)}}remove(...e){const t=z(this.labelNames,e)||{};return q(this.labelNames,t),$.call(this,this.hashMap,t,this.sortedLabelNames)}};const Y=e,{setValue:K,setValueDelta:X,getLabels:Z,hashObject:Q,isObject:J,removeLabels:ee}=d,{validateLabel:te}=M,{Metric:re}=P;function ne(e,t,r){if("number"!=typeof r)throw new TypeError(`Delta is not a valid number: ${Y.format(r)}`);te(e.labelNames,t);const n=Q(t,e.sortedLabelNames);X(e.hashMap,r,t,n)}function se(e){return J(e)?e:{}}function ie(e,t){return J(e)?t:e}var oe=class extends re{constructor(e){super(e),this.type="gauge"}set(e,t){t=ie(e,t),function(e,t,r){if("number"!=typeof r)throw new TypeError(`Value is not a valid number: ${Y.format(r)}`);te(e.labelNames,t),K(e.hashMap,r,t)}(this,e=se(e),t)}reset(){this.hashMap={},0===this.labelNames.length&&K(this.hashMap,0,{})}inc(e,t){void 0===(t=ie(e,t))&&(t=1),ne(this,e=se(e),t)}dec(e,t){void 0===(t=ie(e,t))&&(t=1),ne(this,e=se(e),-t)}setToCurrentTime(e){const t=Date.now()/1e3;void 0===e?this.set(t):this.set(e,t)}startTimer(e){const t=process.hrtime();return r=>{const n=process.hrtime(t),s=n[0]+n[1]/1e9;return this.set(Object.assign({},e,r),s),s}}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}_getValue(e){const t=Q(e||{},this.sortedLabelNames);return this.hashMap[t]?this.hashMap[t].value:0}labels(...e){const t=Z(this.labelNames,e);return te(this.labelNames,t),{inc:this.inc.bind(this,t),dec:this.dec.bind(this,t),set:this.set.bind(this,t),setToCurrentTime:this.setToCurrentTime.bind(this,t),startTimer:this.startTimer.bind(this,t)}}remove(...e){const t=Z(this.labelNames,e);te(this.labelNames,t),ee.call(this,this.hashMap,t,this.sortedLabelNames)}};const ae=e,{getLabels:le,hashObject:ce,isObject:ue,removeLabels:he,nowTimestamp:pe}=d,{validateLabel:fe}=M,{Metric:me}=P,de=V;function ge(e){return()=>{const t=process.hrtime();return r=>{const n=process.hrtime(t),s=n[0]+n[1]/1e9;return this.observe(Object.assign({},e,r),s),s}}}function be(e,t){return()=>{const r=process.hrtime();return(n,s)=>{const i=process.hrtime(r),o=i[0]+i[1]/1e9;return this.observe({labels:Object.assign({},e,n),value:o,exemplarLabels:Object.assign({},t,s)}),o}}}function _e(e,t,r,n,s={}){return{labels:e,sharedLabels:s,value:t,metricName:r,exemplar:n}}function ve(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(t<=n)return n}return-1}function ye(e){return t=>{const r=function(e,t){return ue(e)?{labels:e,value:t}:{value:e,labels:{}}}(e,t);if(fe(this.labelNames,r.labels),!Number.isFinite(r.value))throw new TypeError(`Value is not a valid number: ${ae.format(r.value)}`);const n=ce(r.labels,this.sortedLabelNames);let s=this.hashMap[n];s||(s=xe(r.labels,this.bucketValues,this.bucketExemplars));const i=ve(this.upperBounds,r.value);s.sum+=r.value,s.count+=1,Object.prototype.hasOwnProperty.call(s.bucketValues,i)&&(s.bucketValues[i]+=1),this.hashMap[n]=s}}function xe(e,t,r){return{labels:e,bucketValues:{...t},bucketExemplars:{...r},sum:0,count:0}}function we(e){const{sharedLabels:t,labels:r,...n}=e;for(const e of Object.keys(t))r[e]=t[e];return n.labels=r,n}var Ne=class extends me{constructor(e){super(e,{buckets:[.005,.01,.025,.05,.1,.25,.5,1,2.5,5,10]}),this.type="histogram",this.defaultLabels={},this.defaultExemplarLabelSet={},this.enableExemplars=!1,e.enableExemplars?(this.enableExemplars=!0,this.observe=this.observeWithExemplar):this.observe=this.observeWithoutExemplar;for(const e of this.labelNames)if("le"===e)throw new Error("le is a reserved label keyword");this.upperBounds=this.buckets,this.bucketValues=this.upperBounds.reduce(((e,t)=>(e[t]=0,e)),{}),this.bucketExemplars=this.upperBounds.reduce(((e,t)=>(e[t]=null,e)),{}),Object.freeze(this.bucketValues),Object.freeze(this.bucketExemplars),Object.freeze(this.upperBounds),0===this.labelNames.length&&(this.hashMap={[ce({})]:xe({},this.bucketValues,this.bucketExemplars)})}observeWithoutExemplar(e,t){ye.call(this,0===e?0:e||{})(t)}observeWithExemplar({labels:e=this.defaultLabels,value:t,exemplarLabels:r=this.defaultExemplarLabelSet}={}){ye.call(this,0===e?0:e||{})(t),this.updateExemplar(e,t,r)}updateExemplar(e,t,r){const n=ce(e,this.sortedLabelNames),s=ve(this.upperBounds,t),{bucketExemplars:i}=this.hashMap[n];let o=i[s];ue(o)||(o=new de,i[s]=o),o.validateExemplarLabelSet(r),o.labelSet=r,o.value=t,o.timestamp=pe()}async get(){const e=await this.getForPromString();return e.values=e.values.map(we),e}async getForPromString(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.values(this.hashMap).map(function(e){const t=`${e.name}_bucket`;return r=>{let n=0;return{buckets:e.upperBounds.map((e=>(n+=r.bucketValues[e],_e({le:e},n,t,r.bucketExemplars[e],r.labels)))),data:r}}}(this)).reduce(function(e){return(t,r)=>{t.push(...r.buckets);const n={le:"+Inf"};return t.push(_e(n,r.data.count,`${e.name}_bucket`,r.data.bucketExemplars[-1],r.data.labels),_e({},r.data.sum,`${e.name}_sum`,void 0,r.data.labels),_e({},r.data.count,`${e.name}_count`,void 0,r.data.labels)),t}}(this),[]);return{name:this.name,help:this.help,type:this.type,values:e,aggregator:this.aggregator}}reset(){this.hashMap={}}zero(e){const t=ce(e,this.sortedLabelNames);this.hashMap[t]=xe(e,this.bucketValues,this.bucketExemplars)}startTimer(e,t){return this.enableExemplars?be.call(this,e,t)():ge.call(this,e)()}labels(...e){const t=le(this.labelNames,e);return fe(this.labelNames,t),{observe:ye.call(this,t),startTimer:ge.call(this,t)}}remove(...e){const t=le(this.labelNames,e);fe(this.labelNames,t),he.call(this,this.hashMap,t,this.sortedLabelNames)}};function Ee(){}function Oe(e){this._tree=e,this._ancestors=[],this._cursor=null}Ee.prototype.clear=function(){this._root=null,this.size=0},Ee.prototype.find=function(e){for(var t=this._root;null!==t;){var r=this._comparator(e,t.data);if(0===r)return t.data;t=t.get_child(r>0)}return null},Ee.prototype.findIter=function(e){for(var t=this._root,r=this.iterator();null!==t;){var n=this._comparator(e,t.data);if(0===n)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(n>0)}return null},Ee.prototype.lowerBound=function(e){for(var t=this._root,r=this.iterator(),n=this._comparator;null!==t;){var s=n(e,t.data);if(0===s)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(s>0)}for(var i=r._ancestors.length-1;i>=0;--i)if(n(e,(t=r._ancestors[i]).data)<0)return r._cursor=t,r._ancestors.length=i,r;return r._ancestors.length=0,r},Ee.prototype.upperBound=function(e){for(var t=this.lowerBound(e),r=this._comparator;null!==t.data()&&0===r(t.data(),e);)t.next();return t},Ee.prototype.min=function(){var e=this._root;if(null===e)return null;for(;null!==e.left;)e=e.left;return e.data},Ee.prototype.max=function(){var e=this._root;if(null===e)return null;for(;null!==e.right;)e=e.right;return e.data},Ee.prototype.iterator=function(){return new Oe(this)},Ee.prototype.each=function(e){for(var t,r=this.iterator();null!==(t=r.next());)if(!1===e(t))return},Ee.prototype.reach=function(e){for(var t,r=this.iterator();null!==(t=r.prev());)if(!1===e(t))return},Oe.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},Oe.prototype.next=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._minNode(e)}else{var t;if(null===this._cursor.right)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===t);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},Oe.prototype.prev=function(){if(null===this._cursor){var e=this._tree._root;null!==e&&this._maxNode(e)}else{var t;if(null===this._cursor.left)do{if(t=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===t);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},Oe.prototype._minNode=function(e){for(;null!==e.left;)this._ancestors.push(e),e=e.left;this._cursor=e},Oe.prototype._maxNode=function(e){for(;null!==e.right;)this._ancestors.push(e),e=e.right;this._cursor=e};var Te=Ee,Me=Te;function Se(e){this.data=e,this.left=null,this.right=null,this.red=!0}function Ce(e){this._root=null,this._comparator=e,this.size=0}function je(e){return null!==e&&e.red}function Re(e,t){var r=e.get_child(!t);return e.set_child(!t,r.get_child(t)),r.set_child(t,e),e.red=!0,r.red=!1,r}function Le(e,t){return e.set_child(!t,Re(e.get_child(!t),!t)),Re(e,t)}Se.prototype.get_child=function(e){return e?this.right:this.left},Se.prototype.set_child=function(e,t){e?this.right=t:this.left=t},Ce.prototype=new Me,Ce.prototype.insert=function(e){var t=!1;if(null===this._root)this._root=new Se(e),t=!0,this.size++;else{var r=new Se(void 0),n=0,s=0,i=null,o=r,a=null,l=this._root;for(o.right=this._root;;){if(null===l?(l=new Se(e),a.set_child(n,l),t=!0,this.size++):je(l.left)&&je(l.right)&&(l.red=!0,l.left.red=!1,l.right.red=!1),je(l)&&je(a)){var c=o.right===i;l===a.get_child(s)?o.set_child(c,Re(i,!s)):o.set_child(c,Le(i,!s))}var u=this._comparator(l.data,e);if(0===u)break;s=n,n=u<0,null!==i&&(o=i),i=a,a=l,l=l.get_child(n)}this._root=r.right}return this._root.red=!1,t},Ce.prototype.remove=function(e){if(null===this._root)return!1;var t=new Se(void 0),r=t;r.right=this._root;for(var n=null,s=null,i=null,o=1;null!==r.get_child(o);){var a=o;s=n,n=r,r=r.get_child(o);var l=this._comparator(e,r.data);if(o=l>0,0===l&&(i=r),!je(r)&&!je(r.get_child(o)))if(je(r.get_child(!o))){var c=Re(r,o);n.set_child(a,c),n=c}else if(!je(r.get_child(!o))){var u=n.get_child(!a);if(null!==u)if(je(u.get_child(!a))||je(u.get_child(a))){var h=s.right===n;je(u.get_child(a))?s.set_child(h,Le(n,a)):je(u.get_child(!a))&&s.set_child(h,Re(n,a));var p=s.get_child(h);p.red=!0,r.red=!0,p.left.red=!1,p.right.red=!1}else n.red=!1,u.red=!0,r.red=!0}}return null!==i&&(i.data=r.data,n.set_child(n.right===r,r.get_child(null===r.left)),this.size--),this._root=t.right,null!==this._root&&(this._root.red=!1),null!==i};var Ae=Ce,ke=Te;function Pe(e){this.data=e,this.left=null,this.right=null}function Ve(e){this._root=null,this._comparator=e,this.size=0}Pe.prototype.get_child=function(e){return e?this.right:this.left},Pe.prototype.set_child=function(e,t){e?this.right=t:this.left=t},Ve.prototype=new ke,Ve.prototype.insert=function(e){if(null===this._root)return this._root=new Pe(e),this.size++,!0;for(var t=0,r=null,n=this._root;;){if(null===n)return n=new Pe(e),r.set_child(t,n),ret=!0,this.size++,!0;if(0===this._comparator(n.data,e))return!1;t=this._comparator(n.data,e)<0,r=n,n=n.get_child(t)}},Ve.prototype.remove=function(e){if(null===this._root)return!1;var t=new Pe(void 0),r=t;r.right=this._root;for(var n=null,s=null,i=1;null!==r.get_child(i);){n=r,r=r.get_child(i);var o=this._comparator(e,r.data);i=o>0,0===o&&(s=r)}return null!==s&&(s.data=r.data,n.set_child(n.right===r,r.get_child(null===r.left)),this._root=t.right,this.size--,!0)};var De={RBTree:Ae,BinTree:Ve}.RBTree;function Ie(e,t,r){this.discrete=!1===e,this.delta=e||.01,this.K=void 0===t?25:t,this.CX=void 0===r?1.1:r,this.centroids=new De(Be),this.nreset=0,this.reset()}function Be(e,t){return e.mean>t.mean?1:e.mean<t.mean?-1:0}function ze(e,t){return e.mean_cumn-t.mean_cumn}function $e(e){this.config=e||{},this.mode=this.config.mode||"auto",Ie.call(this,"cont"===this.mode&&e.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}Ie.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},Ie.prototype.size=function(){return this.centroids.size},Ie.prototype.toArray=function(e){var t=[];return e?(this._cumulate(!0),this.centroids.each((function(e){t.push(e)}))):this.centroids.each((function(e){t.push({mean:e.mean,n:e.n})})),t},Ie.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},Ie.prototype.push=function(e,t){t=t||1,e=Array.isArray(e)?e:[e];for(var r=0;r<e.length;r++)this._digest(e[r],t)},Ie.prototype.push_centroid=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this._digest(e[t].mean,e[t].n)},Ie.prototype._cumulate=function(e){if(!(this.n===this.last_cumulate||!e&&this.CX&&this.CX>this.n/this.last_cumulate)){var t=0;this.centroids.each((function(e){e.mean_cumn=t+e.n/2,t=e.cumn=t+e.n})),this.n=this.last_cumulate=t}},Ie.prototype.find_nearest=function(e){if(0===this.size())return null;var t=this.centroids.lowerBound({mean:e}),r=null===t.data()?t.prev():t.data();if(r.mean===e||this.discrete)return r;var n=t.prev();return n&&Math.abs(n.mean-e)<Math.abs(r.mean-e)?n:r},Ie.prototype._new_centroid=function(e,t,r){var n={mean:e,n:t,cumn:r};return this.centroids.insert(n),this.n+=t,n},Ie.prototype._addweight=function(e,t,r){t!==e.mean&&(e.mean+=r*(t-e.mean)/(e.n+r)),e.cumn+=r,e.mean_cumn+=r/2,e.n+=r,this.n+=r},Ie.prototype._digest=function(e,t){var r=this.centroids.min(),n=this.centroids.max(),s=this.find_nearest(e);if(s&&s.mean===e)this._addweight(s,e,t);else if(s===r)this._new_centroid(e,t,0);else if(s===n)this._new_centroid(e,t,this.n);else if(this.discrete)this._new_centroid(e,t,s.cumn);else{var i=s.mean_cumn/this.n;Math.floor(4*this.n*this.delta*i*(1-i))-s.n>=t?this._addweight(s,e,t):this._new_centroid(e,t,s.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},Ie.prototype.bound_mean=function(e){var t=this.centroids.upperBound({mean:e}),r=t.prev();return[r,r.mean===e?r:t.next()]},Ie.prototype.p_rank=function(e){var t=(Array.isArray(e)?e:[e]).map(this._p_rank,this);return Array.isArray(e)?t:t[0]},Ie.prototype._p_rank=function(e){if(0!==this.size()){if(e<this.centroids.min().mean)return 0;if(e>this.centroids.max().mean)return 1;this._cumulate(!0);var t=this.bound_mean(e),r=t[0],n=t[1];if(this.discrete)return r.cumn/this.n;var s=r.mean_cumn;return r!==n&&(s+=(e-r.mean)*(n.mean_cumn-r.mean_cumn)/(n.mean-r.mean)),s/this.n}},Ie.prototype.bound_mean_cumn=function(e){this.centroids._comparator=ze;var t=this.centroids.upperBound({mean_cumn:e});this.centroids._comparator=Be;var r=t.prev();return[r,r&&r.mean_cumn===e?r:t.next()]},Ie.prototype.percentile=function(e){var t=(Array.isArray(e)?e:[e]).map(this._percentile,this);return Array.isArray(e)?t:t[0]},Ie.prototype._percentile=function(e){if(0!==this.size()){this._cumulate(!0);var t=this.n*e,r=this.bound_mean_cumn(t),n=r[0],s=r[1];return s===n||null===n||null===s?(n||s).mean:this.discrete?t<=n.cumn?n.mean:s.mean:n.mean+(t-n.mean_cumn)*(s.mean-n.mean)/(s.mean_cumn-n.mean_cumn)}},Ie.prototype.compress=function(){if(!this.compressing){var e,t,r=this.toArray();for(this.reset(),this.compressing=!0;r.length>0;)this.push_centroid((e=r,t=void 0,t=Math.floor(Math.random()*e.length),e.splice(t,1)[0]));this._cumulate(!0),this.compressing=!1}},$e.prototype=Object.create(Ie.prototype),$e.prototype.constructor=$e,$e.prototype.push=function(e){Ie.prototype.push.call(this,e),this.check_continuous()},$e.prototype._new_centroid=function(e,t,r){this.n_unique+=1,Ie.prototype._new_centroid.call(this,e,t,r)},$e.prototype._addweight=function(e,t,r){1===e.n&&(this.n_unique-=1),Ie.prototype._addweight.call(this,e,t,r)},$e.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&(this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0))};var He={TDigest:Ie,Digest:$e};const{TDigest:qe}=He;function Ue(){let e=Date.now()-this.lastRotateTimestampMillis;for(;e>this.durationBetweenRotatesMillis&&this.shouldRotate;)this.ringBuffer[this.currentBuffer]=new qe,++this.currentBuffer>=this.ringBuffer.length&&(this.currentBuffer=0),e-=this.durationBetweenRotatesMillis,this.lastRotateTimestampMillis+=this.durationBetweenRotatesMillis;return this.ringBuffer[this.currentBuffer]}var Ge=class{constructor(e,t){this.maxAgeSeconds=e||0,this.ageBuckets=t||0,this.shouldRotate=e&&t,this.ringBuffer=Array(t).fill(new qe),this.currentBuffer=0,this.lastRotateTimestampMillis=Date.now(),this.durationBetweenRotatesMillis=1e3*e/t||1/0}size(){return Ue.call(this).size()}percentile(e){return Ue.call(this).percentile(e)}push(e){Ue.call(this),this.ringBuffer.forEach((t=>{t.push(e)}))}reset(){this.ringBuffer.forEach((e=>{e.reset()}))}compress(){this.ringBuffer.forEach((e=>{e.compress()}))}};const Fe=e,{getLabels:We,hashObject:Ye,removeLabels:Ke}=d,{validateLabel:Xe}=M,{Metric:Ze}=P,Qe=Ge;function Je(e){return()=>{const t=process.hrtime();return r=>{const n=process.hrtime(t),s=n[0]+n[1]/1e9;return this.observe(Object.assign({},e,r),s),s}}}function et(e){return t=>{const r=function(e,t){if(void 0===t)return{value:e,labels:{}};return{labels:e,value:t}}(e,t);if(Xe(this.labelNames,e),!Number.isFinite(r.value))throw new TypeError(`Value is not a valid number: ${Fe.format(r.value)}`);const n=Ye(r.labels,this.sortedLabelNames);let s=this.hashMap[n];s||(s={labels:r.labels,td:new Qe(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}),s.td.push(r.value),s.count++,s.count%this.compressCount==0&&s.td.compress(),s.sum+=r.value,this.hashMap[n]=s}}var tt=class extends Ze{constructor(e){super(e,{percentiles:[.01,.05,.5,.9,.95,.99,.999],compressCount:1e3,hashMap:{}}),this.type="summary";for(const e of this.labelNames)if("quantile"===e)throw new Error("quantile is a reserved label keyword");0===this.labelNames.length&&(this.hashMap={[Ye({})]:{labels:{},td:new Qe(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}})}observe(e,t){et.call(this,0===e?0:e||{})(t)}async get(){if(this.collect){const e=this.collect();e instanceof Promise&&await e}const e=Object.keys(this.hashMap),t=[];return e.forEach((e=>{const r=this.hashMap[e];var n,s;r&&(this.pruneAgedBuckets&&0===r.td.size()?delete this.hashMap[e]:((n=r,s=this.percentiles,n.td.compress(),s.map((e=>{const t=n.td.percentile(e);return{labels:Object.assign({quantile:e},n.labels),value:t||0}}))).forEach((e=>{t.push(e)})),t.push(function(e,t){return{metricName:`${t.name}_sum`,labels:e.labels,value:e.sum}}(r,this)),t.push(function(e,t){return{metricName:`${t.name}_count`,labels:e.labels,value:e.count}}(r,this))))})),{name:this.name,help:this.help,type:this.type,values:t,aggregator:this.aggregator}}reset(){Object.values(this.hashMap).forEach((e=>{e.td.reset(),e.count=0,e.sum=0}))}startTimer(e){return Je.call(this,e)()}labels(...e){const t=We(this.labelNames,e);return Xe(this.labelNames,t),{observe:et.call(this,t),startTimer:Je.call(this,t)}}remove(...e){const t=We(this.labelNames,e);Xe(this.labelNames,t),Ke.call(this,this.hashMap,t,this.sortedLabelNames)}},rt={exports:{}},nt={exports:{}},st="object"==typeof globalThis?globalThis:global,it="1.7.0",ot=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var at=function(e){var t=new Set([e]),r=new Set,n=e.match(ot);if(!n)return function(){return!1};var s=+n[1],i=+n[2],o=+n[3];if(null!=n[4])return function(t){return t===e};function a(e){return r.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;var n=e.match(ot);if(!n)return a(e);var c=+n[1],u=+n[2],h=+n[3];return null!=n[4]||s!==c?a(e):0===s?i===u&&o<=h?l(e):a(e):i<=u?l(e):a(e)}}(it),lt=it.split(".")[0],ct=Symbol.for("opentelemetry.js.api."+lt),ut=st;function ht(e,t,r,n){var s;void 0===n&&(n=!1);var i=ut[ct]=null!==(s=ut[ct])&&void 0!==s?s:{version:it};if(!n&&i[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),!1}if(i.version!==it){o=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+e+" does not match previously registered API v"+it);return r.error(o.stack||o.message),!1}return i[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+it+"."),!0}function pt(e){var t,r,n=null===(t=ut[ct])||void 0===t?void 0:t.version;if(n&&at(n))return null===(r=ut[ct])||void 0===r?void 0:r[e]}function ft(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+it+".");var r=ut[ct];r&&delete r[e]}var mt,dt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o},gt=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},bt=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _t("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _t("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _t("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _t("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _t("verbose",this._namespace,e)},e}();function _t(e,t,r){var n=pt("diag");if(n)return r.unshift(t),n[e].apply(n,gt([],dt(r),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(mt||(mt={}));var vt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o},yt=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},xt=function(){function e(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=pt("diag");if(n)return n[e].apply(n,yt([],vt(t),!1))}}var t=this;t.setLogger=function(e,r){var n,s,i;if(void 0===r&&(r={logLevel:mt.INFO}),e===t){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(n=o.stack)&&void 0!==n?n:o.message),!1}"number"==typeof r&&(r={logLevel:r});var a=pt("diag"),l=function(e,t){function r(r,n){var s=t[r];return"function"==typeof s&&e>=n?s.bind(t):function(){}}return e<mt.NONE?e=mt.NONE:e>mt.ALL&&(e=mt.ALL),t=t||{},{error:r("error",mt.ERROR),warn:r("warn",mt.WARN),info:r("info",mt.INFO),debug:r("debug",mt.DEBUG),verbose:r("verbose",mt.VERBOSE)}}(null!==(s=r.logLevel)&&void 0!==s?s:mt.INFO,e);if(a&&!r.suppressOverrideMessage){var c=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),l.warn("Current logger will overwrite one already registered from "+c)}return ht("diag",l,t,!0)},t.disable=function(){ft("diag",t)},t.createComponentLogger=function(e){return new bt(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),wt=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o},Nt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Et=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=wt(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,r){var n=new e(this._entries);return n._entries.set(t,r),n},e.prototype.removeEntry=function(t){var r=new e(this._entries);return r._entries.delete(t),r},e.prototype.removeEntries=function(){for(var t,r,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var i=new e(this._entries);try{for(var o=Nt(n),a=o.next();!a.done;a=o.next()){var l=a.value;i._entries.delete(l)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},e.prototype.clear=function(){return new e},e}(),Ot=Symbol("BaggageEntryMetadata"),Tt=xt.instance();function Mt(e){return void 0===e&&(e={}),new Et(new Map(Object.entries(e)))}function St(e){return Symbol.for(e)}var Ct,jt,Rt=function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(e){return r._currentContext.get(e)},r.setValue=function(t,n){var s=new e(r._currentContext);return s._currentContext.set(t,n),s},r.deleteValue=function(t){var n=new e(r._currentContext);return n._currentContext.delete(t),n}},Lt=new Rt,At=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],kt=function(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(console){var n=console[e];if("function"!=typeof n&&(n=console.log),"function"==typeof n)return n.apply(console,t)}}}for(var t=0;t<At.length;t++)this[At[t].n]=e(At[t].c)},Pt=(Ct=function(e,t){return Ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Ct(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ct(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Vt=function(){function e(){}return e.prototype.createHistogram=function(e,t){return Wt},e.prototype.createCounter=function(e,t){return Ft},e.prototype.createUpDownCounter=function(e,t){return Yt},e.prototype.createObservableGauge=function(e,t){return Xt},e.prototype.createObservableCounter=function(e,t){return Kt},e.prototype.createObservableUpDownCounter=function(e,t){return Zt},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),Dt=function(){},It=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t.prototype.add=function(e,t){},t}(Dt),Bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t.prototype.add=function(e,t){},t}(Dt),zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t.prototype.record=function(e,t){},t}(Dt),$t=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),Ht=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t}($t),qt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t}($t),Ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t}($t),Gt=new Vt,Ft=new It,Wt=new zt,Yt=new Bt,Kt=new Ht,Xt=new qt,Zt=new Ut;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(jt||(jt={}));var Qt,Jt={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},er={set:function(e,t,r){null!=e&&(e[t]=r)}},tr=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o},rr=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},nr=function(){function e(){}return e.prototype.active=function(){return Lt},e.prototype.with=function(e,t,r){for(var n=[],s=3;s<arguments.length;s++)n[s-3]=arguments[s];return t.call.apply(t,rr([r],tr(n),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),sr=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o},ir=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},or="context",ar=new nr,lr=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return ht(or,e,xt.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,r){for(var n,s=[],i=3;i<arguments.length;i++)s[i-3]=arguments[i];return(n=this._getContextManager()).with.apply(n,ir([e,t,r],sr(s),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return pt(or)||ar},e.prototype.disable=function(){this._getContextManager().disable(),ft(or,xt.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(Qt||(Qt={}));var cr="0000000000000000",ur="00000000000000000000000000000000",hr={traceId:ur,spanId:cr,traceFlags:Qt.NONE},pr=function(){function e(e){void 0===e&&(e=hr),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),fr=St("OpenTelemetry Context Key SPAN");function mr(e){return e.getValue(fr)||void 0}function dr(){return mr(lr.getInstance().active())}function gr(e,t){return e.setValue(fr,t)}function br(e){return e.deleteValue(fr)}function _r(e,t){return gr(e,new pr(t))}function vr(e){var t;return null===(t=mr(e))||void 0===t?void 0:t.spanContext()}var yr=/^([0-9a-f]{32})$/i,xr=/^[0-9a-f]{16}$/i;function wr(e){return yr.test(e)&&e!==ur}function Nr(e){return xr.test(e)&&e!==cr}function Er(e){return wr(e.traceId)&&Nr(e.spanId)}function Or(e){return new pr(e)}var Tr=lr.getInstance(),Mr=function(){function e(){}return e.prototype.startSpan=function(e,t,r){if(void 0===r&&(r=Tr.active()),Boolean(null==t?void 0:t.root))return new pr;var n,s=r&&vr(r);return"object"==typeof(n=s)&&"string"==typeof n.spanId&&"string"==typeof n.traceId&&"number"==typeof n.traceFlags&&Er(s)?new pr(s):new pr},e.prototype.startActiveSpan=function(e,t,r,n){var s,i,o;if(!(arguments.length<2)){2===arguments.length?o=t:3===arguments.length?(s=t,o=r):(s=t,i=r,o=n);var a=null!=i?i:Tr.active(),l=this.startSpan(e,s,a),c=gr(a,l);return Tr.with(c,o,void 0,l)}},e}();var Sr,Cr,jr,Rr=new Mr,Lr=function(){function e(e,t,r,n){this._provider=e,this.name=t,this.version=r,this.options=n}return e.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},e.prototype.startActiveSpan=function(e,t,r,n){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Rr},e}(),Ar=new(function(){function e(){}return e.prototype.getTracer=function(e,t,r){return new Mr},e}()),kr=function(){function e(){}return e.prototype.getTracer=function(e,t,r){var n;return null!==(n=this.getDelegateTracer(e,t,r))&&void 0!==n?n:new Lr(this,e,t,r)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Ar},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,r){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t,r)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Sr||(Sr={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(Cr||(Cr={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(jr||(jr={}));var Pr="[_0-9a-z-*/]",Vr=new RegExp("^(?:"+("[a-z]"+Pr+"{0,255}")+"|"+("[a-z0-9]"+Pr+"{0,240}@[a-z]"+Pr+"{0,13}")+")$"),Dr=/^[ -~]{0,255}[!-~]$/,Ir=/,|=/;var Br=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,r){return t.push(r+"="+e.get(r)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var r=t.trim(),n=r.indexOf("=");if(-1!==n){var s=r.slice(0,n),i=r.slice(n+1,t.length);(function(e){return Vr.test(e)})(s)&&function(e){return Dr.test(e)&&!Ir.test(e)}(i)&&e.set(s,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();var zr=lr.getInstance(),$r=xt.instance(),Hr=new(function(){function e(){}return e.prototype.getMeter=function(e,t,r){return Gt},e}()),qr="metrics",Ur=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return ht(qr,e,xt.instance())},e.prototype.getMeterProvider=function(){return pt(qr)||Hr},e.prototype.getMeter=function(e,t,r){return this.getMeterProvider().getMeter(e,t,r)},e.prototype.disable=function(){ft(qr,xt.instance())},e}(),Gr=Ur.getInstance(),Fr=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),Wr=St("OpenTelemetry Baggage Key");function Yr(e){return e.getValue(Wr)||void 0}function Kr(){return Yr(lr.getInstance().active())}function Xr(e,t){return e.setValue(Wr,t)}function Zr(e){return e.deleteValue(Wr)}var Qr="propagation",Jr=new Fr,en=function(){function e(){this.createBaggage=Mt,this.getBaggage=Yr,this.getActiveBaggage=Kr,this.setBaggage=Xr,this.deleteBaggage=Zr}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return ht(Qr,e,xt.instance())},e.prototype.inject=function(e,t,r){return void 0===r&&(r=er),this._getGlobalPropagator().inject(e,t,r)},e.prototype.extract=function(e,t,r){return void 0===r&&(r=Jt),this._getGlobalPropagator().extract(e,t,r)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){ft(Qr,xt.instance())},e.prototype._getGlobalPropagator=function(){return pt(Qr)||Jr},e}(),tn=en.getInstance(),rn="trace",nn=function(){function e(){this._proxyTracerProvider=new kr,this.wrapSpanContext=Or,this.isSpanContextValid=Er,this.deleteSpan=br,this.getSpan=mr,this.getActiveSpan=dr,this.getSpanContext=vr,this.setSpan=gr,this.setSpanContext=_r}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=ht(rn,this._proxyTracerProvider,xt.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return pt(rn)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){ft(rn,xt.instance()),this._proxyTracerProvider=new kr},e}(),sn=nn.getInstance(),on={context:zr,diag:$r,metrics:Gr,propagation:tn,trace:sn};const an=f(Object.freeze({__proto__:null,DiagConsoleLogger:kt,get DiagLogLevel(){return mt},INVALID_SPANID:cr,INVALID_SPAN_CONTEXT:hr,INVALID_TRACEID:ur,ProxyTracer:Lr,ProxyTracerProvider:kr,ROOT_CONTEXT:Lt,get SamplingDecision(){return Sr},get SpanKind(){return Cr},get SpanStatusCode(){return jr},get TraceFlags(){return Qt},get ValueType(){return jt},baggageEntryMetadataFromString:function(e){return"string"!=typeof e&&(Tt.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:Ot,toString:function(){return e}}},context:zr,createContextKey:St,createNoopMeter:function(){return Gt},createTraceState:function(e){return new Br(e)},default:on,defaultTextMapGetter:Jt,defaultTextMapSetter:er,diag:$r,isSpanContextValid:Er,isValidSpanId:Nr,isValidTraceId:wr,metrics:Gr,propagation:tn,trace:sn})),ln=W,cn="process_cpu_user_seconds_total",un="process_cpu_system_seconds_total",hn="process_cpu_seconds_total";nt.exports=(e,t={})=>{const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},i=!!t.enableExemplars&&t.enableExemplars,o=Object.keys(s);let a=process.cpuUsage();const l=new ln({name:n+cn,help:"Total user CPU time spent in seconds.",enableExemplars:i,registers:r,labelNames:o,collect(){const e=process.cpuUsage(),t=e.user-a.user,r=e.system-a.system;if(a=e,this.enableExemplars){let e={};const n=an.trace.getSpan(an.context.active());n&&(e={traceId:n.spanContext().traceId,spanId:n.spanContext().spanId}),l.inc({labels:s,value:t/1e6,exemplarLabels:e}),c.inc({labels:s,value:r/1e6,exemplarLabels:e}),u.inc({labels:s,value:(t+r)/1e6,exemplarLabels:e})}else l.inc(s,t/1e6),c.inc(s,r/1e6),u.inc(s,(t+r)/1e6)}}),c=new ln({name:n+un,help:"Total system CPU time spent in seconds.",enableExemplars:i,registers:r,labelNames:o}),u=new ln({name:n+hn,help:"Total user and system CPU time spent in seconds.",enableExemplars:i,registers:r,labelNames:o})},nt.exports.metricNames=[cn,un,hn];var pn=nt.exports,fn={exports:{}};const mn=oe,dn=Math.round(Date.now()/1e3-process.uptime()),gn="process_start_time_seconds";fn.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new mn({name:r+gn,help:"Start time of the process since unix epoch in seconds.",registers:e?[e]:void 0,labelNames:s,aggregator:"omit",collect(){this.set(n,dn)}})},fn.exports.metricNames=[gn];var bn=fn.exports,_n={exports:{}},vn={exports:{}};const yn=oe,xn=n,wn=["VmSize","VmRSS","VmData"],Nn="process_resident_memory_bytes",En="process_virtual_memory_bytes",On="process_heap_bytes";vn.exports=(e,t={})=>{const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},i=Object.keys(s),o=new yn({name:n+Nn,help:"Resident memory size in bytes.",registers:r,labelNames:i,collect(){try{const e=xn.readFileSync("/proc/self/status","utf8"),t=e.split("\n").reduce(((e,t)=>{if(!wn.some((e=>t.startsWith(e))))return e;const r=t.split(":");let n=r[1].trim();return n=n.substr(0,n.length-3),n=1024*Number(n),e[r[0]]=n,e}),{});o.set(s,t.VmRSS),a.set(s,t.VmSize),l.set(s,t.VmData)}catch{}}}),a=new yn({name:n+En,help:"Virtual memory size in bytes.",registers:r,labelNames:i}),l=new yn({name:n+On,help:"Process heap size in bytes.",registers:r,labelNames:i})},vn.exports.metricNames=[Nn,En,On];var Tn=vn.exports;var Mn=function(){try{return process.memoryUsage()}catch{return}};const Sn=oe,Cn=Tn,jn=Mn,Rn="process_resident_memory_bytes";_n.exports=(e,t)=>"linux"===process.platform?Cn(e,t):function(e,t={}){const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new Sn({name:r+Rn,help:"Resident memory size in bytes.",registers:e?[e]:void 0,labelNames:s,collect(){const e=jn();e&&this.set(n,e.rss)}})}(e,t),_n.exports.metricNames="linux"===process.platform?Cn.metricNames:[Rn];var Ln=_n.exports,An={exports:{}};const kn=oe,Pn=n,Vn=s,Dn="process_open_fds";An.exports=(e,t={})=>{if("linux"!==Vn.platform)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new kn({name:r+Dn,help:"Number of open file descriptors.",registers:e?[e]:void 0,labelNames:s,collect(){try{const e=Pn.readdirSync("/proc/self/fd");this.set(n,e.length-1)}catch{}}})},An.exports.metricNames=[Dn];var In=An.exports,Bn={exports:{}};const zn=oe,$n=n,Hn="process_max_fds";let qn;Bn.exports=(e,t={})=>{if(void 0===qn)try{const e=$n.readFileSync("/proc/self/limits","utf8").split("\n");for(const t of e)if(t.startsWith("Max open files")){const e=t.split(/  +/);qn=Number(e[1]);break}}catch{return}if(void 0===qn)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new zn({name:r+Hn,help:"Maximum number of open file descriptors.",registers:e?[e]:void 0,labelNames:s,collect(){void 0!==qn&&this.set(n,qn)}})},Bn.exports.metricNames=[Hn];var Un=Bn.exports,Gn={exports:{}};const Fn=oe;let Wn;try{Wn=require("perf_hooks")}catch{}const Yn="nodejs_eventloop_lag_seconds",Kn="nodejs_eventloop_lag_min_seconds",Xn="nodejs_eventloop_lag_max_seconds",Zn="nodejs_eventloop_lag_mean_seconds",Qn="nodejs_eventloop_lag_stddev_seconds",Jn="nodejs_eventloop_lag_p50_seconds",es="nodejs_eventloop_lag_p90_seconds",ts="nodejs_eventloop_lag_p99_seconds";function rs(e,t,r){const n=process.hrtime(e),s=(1e9*n[0]+n[1])/1e9;t.set(r,s)}Gn.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n),i=e?[e]:void 0;let o;if(Wn&&Wn.monitorEventLoopDelay){const e=Wn.monitorEventLoopDelay({resolution:t.eventLoopMonitoringPrecision});e.enable(),o=()=>{const t=process.hrtime();setImmediate(rs,t,a,n),l.set(n,e.min/1e9),c.set(n,e.max/1e9),u.set(n,e.mean/1e9),h.set(n,e.stddev/1e9),p.set(n,e.percentile(50)/1e9),f.set(n,e.percentile(90)/1e9),m.set(n,e.percentile(99)/1e9),e.reset()}}else o=()=>{const e=process.hrtime();setImmediate(rs,e,a,n)};const a=new Fn({name:r+Yn,help:"Lag of event loop in seconds.",registers:i,labelNames:s,aggregator:"average",collect:o}),l=new Fn({name:r+Kn,help:"The minimum recorded event loop delay.",registers:i,labelNames:s,aggregator:"min"}),c=new Fn({name:r+Xn,help:"The maximum recorded event loop delay.",registers:i,labelNames:s,aggregator:"max"}),u=new Fn({name:r+Zn,help:"The mean of the recorded event loop delays.",registers:i,labelNames:s,aggregator:"average"}),h=new Fn({name:r+Qn,help:"The standard deviation of the recorded event loop delays.",registers:i,labelNames:s,aggregator:"average"}),p=new Fn({name:r+Jn,help:"The 50th percentile of the recorded event loop delays.",registers:i,labelNames:s,aggregator:"average"}),f=new Fn({name:r+es,help:"The 90th percentile of the recorded event loop delays.",registers:i,labelNames:s,aggregator:"average"}),m=new Fn({name:r+ts,help:"The 99th percentile of the recorded event loop delays.",registers:i,labelNames:s,aggregator:"average"})},Gn.exports.metricNames=[Yn,Kn,Xn,Zn,Qn,Jn,es,ts];var ns=Gn.exports,ss={exports:{}};var is={aggregateByObjectName:function(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];n&&void 0!==n.constructor&&(Object.hasOwnProperty.call(t,n.constructor.name)?t[n.constructor.name]+=1:t[n.constructor.name]=1)}return t},updateMetrics:function(e,t,r){e.reset();for(const n in t)e.set(Object.assign({type:n},r||{}),t[n])}};const{aggregateByObjectName:os}=is,{updateMetrics:as}=is,ls=oe,cs="nodejs_active_handles",us="nodejs_active_handles_total";ss.exports=(e,t={})=>{if("function"!=typeof process._getActiveHandles)return;const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},i=Object.keys(s);new ls({name:n+cs,help:"Number of active libuv handles grouped by handle type. Every handle type is C++ class name.",labelNames:["type",...i],registers:r,collect(){const e=process._getActiveHandles();as(this,os(e),s)}}),new ls({name:n+us,help:"Total number of active handles.",registers:r,labelNames:i,collect(){const e=process._getActiveHandles();this.set(s,e.length)}})},ss.exports.metricNames=[cs,us];var hs=ss.exports,ps={exports:{}};const fs=oe,{aggregateByObjectName:ms}=is,{updateMetrics:ds}=is,gs="nodejs_active_requests",bs="nodejs_active_requests_total";ps.exports=(e,t={})=>{if("function"!=typeof process._getActiveRequests)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new fs({name:r+gs,help:"Number of active libuv requests grouped by request type. Every request type is C++ class name.",labelNames:["type",...s],registers:e?[e]:void 0,collect(){const e=process._getActiveRequests();ds(this,ms(e),n)}}),new fs({name:r+bs,help:"Total number of active requests.",registers:e?[e]:void 0,labelNames:s,collect(){const e=process._getActiveRequests();this.set(n,e.length)}})},ps.exports.metricNames=[gs,bs];var _s=ps.exports,vs={exports:{}};const ys=oe,{updateMetrics:xs}=is,ws="nodejs_active_resources",Ns="nodejs_active_resources_total";vs.exports=(e,t={})=>{if("function"!=typeof process.getActiveResourcesInfo)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new ys({name:r+ws,help:"Number of active resources that are currently keeping the event loop alive, grouped by async resource type.",labelNames:["type",...s],registers:e?[e]:void 0,collect(){const e=process.getActiveResourcesInfo(),t={};for(let r=0;r<e.length;r++){const n=e[r];Object.hasOwn(t,n)?t[n]+=1:t[n]=1}xs(this,t,n)}}),new ys({name:r+Ns,help:"Total number of active resources.",registers:e?[e]:void 0,labelNames:s,collect(){const e=process.getActiveResourcesInfo();this.set(n,e.length)}})},vs.exports.metricNames=[ws,Ns];var Es=vs.exports,Os={exports:{}};const Ts=oe,Ms=Mn,Ss="nodejs_heap_size_total_bytes",Cs="nodejs_heap_size_used_bytes",js="nodejs_external_memory_bytes";Os.exports=(e,t={})=>{if("function"!=typeof process.memoryUsage)return;const r=t.labels?t.labels:{},n=Object.keys(r),s=e?[e]:void 0,i=t.prefix?t.prefix:"",o=new Ts({name:i+Ss,help:"Process heap size from Node.js in bytes.",registers:s,labelNames:n,collect:()=>{const e=Ms();e&&(o.set(r,e.heapTotal),a.set(r,e.heapUsed),void 0!==e.external&&l.set(r,e.external))}}),a=new Ts({name:i+Cs,help:"Process heap size used from Node.js in bytes.",registers:s,labelNames:n}),l=new Ts({name:i+js,help:"Node.js external memory size in bytes.",registers:s,labelNames:n})},Os.exports.metricNames=[Ss,Cs,js];var Rs=Os.exports,Ls={exports:{}};const As=oe,ks=i,Ps=["total","used","available"],Vs={};Ps.forEach((e=>{Vs[e]=`nodejs_heap_space_size_${e}_bytes`})),Ls.exports=(e,t={})=>{const r=e?[e]:void 0,n=t.prefix?t.prefix:"",s=t.labels?t.labels:{},i=["space",...Object.keys(s)],o={};Ps.forEach((e=>{o[e]=new As({name:n+Vs[e],help:`Process heap space size ${e} from Node.js in bytes.`,labelNames:i,registers:r})})),o.total.collect=()=>{for(const e of ks.getHeapSpaceStatistics()){const t=e.space_name.substr(0,e.space_name.indexOf("_space"));o.total.set({space:t,...s},e.space_size),o.used.set({space:t,...s},e.space_used_size),o.available.set({space:t,...s},e.space_available_size)}}},Ls.exports.metricNames=Object.values(Vs);var Ds=Ls.exports,Is={exports:{}};const Bs=oe,zs=process.version,$s=zs.slice(1).split(".").map(Number),Hs="nodejs_version_info";Is.exports=(e,t={})=>{const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n);new Bs({name:r+Hs,help:"Node.js version info.",labelNames:["version","major","minor","patch",...s],registers:e?[e]:void 0,aggregator:"first",collect(){this.labels(zs,$s[0],$s[1],$s[2],...Object.values(n)).set(1)}})},Is.exports.metricNames=[Hs];var qs=Is.exports,Us={exports:{}};const Gs=Ne;let Fs;try{Fs=require("perf_hooks")}catch{}const Ws="nodejs_gc_duration_seconds",Ys=[.001,.01,.1,1,2,5],Ks=[];Fs&&Fs.constants&&(Ks[Fs.constants.NODE_PERFORMANCE_GC_MAJOR]="major",Ks[Fs.constants.NODE_PERFORMANCE_GC_MINOR]="minor",Ks[Fs.constants.NODE_PERFORMANCE_GC_INCREMENTAL]="incremental",Ks[Fs.constants.NODE_PERFORMANCE_GC_WEAKCB]="weakcb"),Us.exports=(e,t={})=>{if(!Fs)return;const r=t.prefix?t.prefix:"",n=t.labels?t.labels:{},s=Object.keys(n),i=t.gcDurationBuckets?t.gcDurationBuckets:Ys,o=new Gs({name:r+Ws,help:"Garbage collection duration by kind, one of major, minor, incremental or weakcb.",labelNames:["kind",...s],enableExemplars:!1,buckets:i,registers:e?[e]:void 0});new Fs.PerformanceObserver((e=>{const t=e.getEntries()[0],r=t.detail?Ks[t.detail.kind]:Ks[t.kind];o.observe(Object.assign({kind:r},n),t.duration/1e3)})).observe({entryTypes:["gc"]})},Us.exports.metricNames=[Ws];var Xs=Us.exports;const{isObject:Zs}=d,Qs=hs,Js=_s,ei=Es,ti=Rs,ri=Ds,ni=qs,si=Xs,ii={processCpuTotal:pn,processStartTime:bn,osMemoryHeap:Ln,processOpenFileDescriptors:In,processMaxFileDescriptors:Un,eventLoopLag:ns,..."function"==typeof process.getActiveResourcesInfo?{processResources:ei}:{},processHandles:Qs,processRequests:Js,heapSizeAndUsed:ti,heapSpacesSizeAndUsed:ri,version:ni,gc:si},oi=Object.keys(ii);rt.exports=function(e){if(null!=e&&!Zs(e))throw new TypeError("config must be null, undefined, or an object");e={eventLoopMonitoringPrecision:10,...e};for(const t of Object.values(ii))t(e.register,e)},rt.exports.metricsList=oi;T.globalRegistry,T.globalRegistry,T.globalRegistry.contentType,T.PROMETHEUS_CONTENT_TYPE,T.OPENMETRICS_CONTENT_TYPE;var ai=W,li=oe,ci=Ne,ui=tt;exports.ApiMetric=a,exports.CallMetric=c,exports.DataDogClient=class{constructor(){p.init()}Count(e,t,r=1){p.dogstatsd.increment(e,r,t)}Histogram(e,t,r,n=1){p.dogstatsd.distribution(e,t,r)}Gauge(e,t,r,n=1){p.dogstatsd.gauge(e,t,r)}Summary(e,t,r,n=1){console.log("Summary is unsupported")}},exports.DatabaseMetric=u,exports.HttpMiddlewareMetric=l,exports.Metrics=h,exports.PrometheusClient=class{constructor(){this.HistogramVecs={},this.CounterVecs={},this.GaugeVecs={},this.SummaryVecs={}}CreateHistogramVec(e,t,r,n){this.HistogramVecs[e]||(this.HistogramVecs[e]={Labels:r,Metric:new ci({name:e,help:t,labelNames:r,buckets:n})})}CreateCounterVec(e,t,r){this.CounterVecs[e]||(this.CounterVecs[e]={Labels:r,Metric:new ai({name:e,help:t,labelNames:r})})}CreateGaugeVec(e,t,r){this.GaugeVecs[e]||(this.GaugeVecs[e]={Labels:r,Metric:new li({name:e,help:t,labelNames:r})})}CreateSummaryVec(e,t,r){this.SummaryVecs[e]||(this.SummaryVecs[e]={Labels:r,Metric:new ui({name:e,help:t,labelNames:r})})}Histogram(e,t,r){const n=Object.keys(r);this.HistogramVecs[e]||this.CreateHistogramVec(e,e,n);const s=[];for(const t of this.HistogramVecs[e].Labels)s.push(r[t]);this.HistogramVecs[e].Metric.labels(...s).observe(t)}Count(e,t){const r=Object.keys(t);this.CounterVecs[e]||this.CreateCounterVec(e,e,r);const n=[];for(const r of this.CounterVecs[e].Labels)n.push(t[r]);this.CounterVecs[e].Metric.labels(...n).inc()}Gauge(e,t,r){const n=Object.keys(r);this.GaugeVecs[e]||this.CreateGaugeVec(e,e,n);const s=[];for(const t of this.GaugeVecs[e].Labels)s.push(r[t]);this.GaugeVecs[e].Metric.labels(...s).set(t)}Summary(e,t,r){const n=Object.keys(r);this.SummaryVecs[e]||this.CreateSummaryVec(e,e,n);const s=[];for(const t of this.SummaryVecs[e].Labels)s.push(r[t]);this.SummaryVecs[e].Metric.labels(...s).observe(t)}},exports.ResolverMetric=o;
