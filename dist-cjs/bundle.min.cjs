"use strict";var e,t,s=require("dd-trace"),r=require("prom-client");function i(e,t,s){const r={Resolver:s.Resolver,Service:s.Service,Protocol:s.Protocol,Result:s.Result};e.Histogram("resolver_request_duration_histogram_milliseconds",t,r)}function c(e,t,s){const r={Service:s.Service,Vendor:s.Vendor,Call:s.Call,Result:s.Result};e.Histogram("api_request_duration_histogram_milliseconds",t,r)}function o(e,t){return(s,r,i)=>{const c=Date.now();r.on("finish",(()=>{const s=Date.now(),r={Service:t.Service};e.Histogram("http_request_duration_histogram_milliseconds",s-c,r)})),i()}}function a(e,t,s){const r={Service:s.Service,Function:s.Function,Result:s.Result};e.Histogram("call_duration_histogram_milliseconds",t,r)}function n(e,t,s){const r={Service:s.Service,Table:s.Table,Method:s.Method,Result:s.Result};e.Histogram("database_duration_histogram_milliseconds",t,r)}!function(e){e.Insert="insert",e.Update="update",e.Delete="delete",e.Select="select"}(e||(e={}));class u{constructor(e){this.client=e}static getInstance(e){return u.instance||(u.instance=new u(e)),u.instance}Histogram(e,t,s){this.client.Histogram(e,t,s)}Count(e,t){this.client.Count(e,t)}Gauge(e,t,s){this.client.Gauge(e,t,s)}Summary(e,t,s){this.client.Summary(e,t,s)}ResolverMetric(e,t){return i(this.client,e,t)}ApiMetric(e,t){return c(this.client,e,t)}HttpMiddlewareMetric(e){return o(this.client,e)}CallMetric(e,t){return a(this.client,e,t)}DatabaseMetric(e,t){return n(this.client,e,t)}}exports.Result=void 0,(t=exports.Result||(exports.Result={})).Success="success",t.Error="error";exports.ApiMetric=c,exports.CallMetric=a,exports.DataDogClient=class{constructor(){s.tracer.init()}Count(e,t,r=1){s.tracer.dogstatsd.increment(e,r,t)}Histogram(e,t,r,i=1){s.tracer.dogstatsd.distribution(e,t,r)}Gauge(e,t,r,i=1){s.tracer.dogstatsd.gauge(e,t,r)}Summary(e,t,s,r=1){console.log("Summary is unsupported")}},exports.DatabaseMetric=n,exports.HttpMiddlewareMetric=o,exports.Metrics=u,exports.PrometheusClient=class{constructor(){this.HistogramVecs={},this.CounterVecs={},this.GaugeVecs={},this.SummaryVecs={}}CreateHistogramVec(e,t,s,i){this.HistogramVecs[e]||(this.HistogramVecs[e]={Labels:s,Metric:new r.Histogram({name:e,help:t,labelNames:s,buckets:i})})}CreateCounterVec(e,t,s){this.CounterVecs[e]||(this.CounterVecs[e]={Labels:s,Metric:new r.Counter({name:e,help:t,labelNames:s})})}CreateGaugeVec(e,t,s){this.GaugeVecs[e]||(this.GaugeVecs[e]={Labels:s,Metric:new r.Gauge({name:e,help:t,labelNames:s})})}CreateSummaryVec(e,t,s){this.SummaryVecs[e]||(this.SummaryVecs[e]={Labels:s,Metric:new r.Summary({name:e,help:t,labelNames:s})})}Histogram(e,t,s){const r=Object.keys(s);this.HistogramVecs[e]||this.CreateHistogramVec(e,e,r);const i=[];for(const t of this.HistogramVecs[e].Labels)i.push(s[t]);this.HistogramVecs[e].Metric.labels(...i).observe(t)}Count(e,t){const s=Object.keys(t);this.CounterVecs[e]||this.CreateCounterVec(e,e,s);const r=[];for(const s of this.CounterVecs[e].Labels)r.push(t[s]);this.CounterVecs[e].Metric.labels(...r).inc()}Gauge(e,t,s){const r=Object.keys(s);this.GaugeVecs[e]||this.CreateGaugeVec(e,e,r);const i=[];for(const t of this.GaugeVecs[e].Labels)i.push(s[t]);this.GaugeVecs[e].Metric.labels(...i).set(t)}Summary(e,t,s){const r=Object.keys(s);this.SummaryVecs[e]||this.CreateSummaryVec(e,e,r);const i=[];for(const t of this.SummaryVecs[e].Labels)i.push(s[t]);this.SummaryVecs[e].Metric.labels(...i).observe(t)}},exports.ResolverMetric=i;
